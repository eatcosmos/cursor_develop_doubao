(self.webpackChunkflow_web_extension=self.webpackChunkflow_web_extension||[]).push([[609],{15704:(e,t,i)=>{i.d(t,{v:()=>n});var s=i(24337);let a=[];const n=e=>{try{a.forEach((t=>null==t?void 0:t.postMessage(e)))}catch(t){(0,s.z3)("[lwx] send log to port error",t)}}},93888:(e,t,i)=>{i.d(t,{f:()=>c});var s=i(14065),a=i(77591),n=i(21559),o=i(91376),r=i(77191),d=i(36700),l=i(75943);function u(){return(u=(0,s.A)((function*(){var e;const t=yield(0,r.UJ)(),i="enable"===(null==t||null===(e=t.ab_config)||void 0===e||null===(e=e.ab_results)||void 0===e?void 0:e.extension_collection_entry);(0,a.vE)("collectionConfig",{showEntry:i})}))).apply(this,arguments)}function c(){return h.apply(this,arguments)}function h(){return h=(0,s.A)((function*(){try{yield function(){return u.apply(this,arguments)}()}catch(e){n.vF.persist.error({message:"initCollectionUserSetting error",error:e})}(0,o.ku)()&&function(){function e(){const e=window.getSelection();(null==e?void 0:e.toString().trim())?(0,d.ae)(d.vP.right_click,d.p6.textfragment):(0,d.ae)(d.vP.collect_this_page,d.p6.web)}document.addEventListener("contextmenu",e),(0,l.A)((()=>{document.removeEventListener("contextmenu",e)}))}()})),h.apply(this,arguments)}},89124:(e,t,i)=>{i.d(t,{q:()=>o});var s=i(14065),a=i(15965),n=i(13464);function o(e){return r.apply(this,arguments)}function r(){return r=(0,s.A)((function*(e){return(/doubao/.test(location.hostname)||/ciciai/.test(location.hostname))&&location.pathname.startsWith("/browser-extension/welcome")?function(e){return d.apply(this,arguments)}(e):(0,a.Tp)(e)})),r.apply(this,arguments)}function d(){return(d=(0,s.A)((function*(e){const t=(0,a.Tp)(e),i=document.querySelector("[class^=welcomeCard]");if(i&&t){const{width:e,height:s}=i.getBoundingClientRect(),a=yield(0,n.dp)(i);t.content=(0,n.NS)(a.innerHTML,s,e)}return t}))).apply(this,arguments)}},18797:(e,t,i)=>{i.d(t,{E:()=>n});var s=i(14065),a=i(10633);class n{constructor(e){var t=this;(0,a.A)(this,"macrotaskQueue",[]),(0,a.A)(this,"onFinished",void 0),(0,a.A)(this,"pushTask",(e=>{this.macrotaskQueue.push(e)})),(0,a.A)(this,"loop",(()=>{this.macrotaskQueue.length?setTimeout((0,s.A)((function*(){const e=t.macrotaskQueue.pop();e&&(yield e(),t.loop())})),0):this.onFinished()})),this.onFinished=e}}},37424:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(16409),a=i(2573),n=i(20825),o=i(52833),r=i(93476);const d=()=>r.l.getState().isSidePanelMode&&!n._K.isInSidePanel?new Promise((e=>{a.A.once("chat-page-ready",(t=>e(t))),(0,s.cs)("check-page-ready",6e4).then((t=>{null!=t&&t.success&&e(t.data)}))})):new Promise((e=>{if(o.on.getState().chatPageReady)e(!0);else{const t=o.on.subscribe((e=>e.chatPageReady),(i=>{i&&(e(!0),t())}))}}))},20825:(e,t,i)=>{i.d(t,{Cu:()=>a,_K:()=>s});const s={windowId:-1,get isInSidePanel(){return location.href.startsWith(chrome.runtime.getURL("side_panel.html"))}};const a=!1},4297:(e,t,i)=>{i.d(t,{r:()=>d});var s=i(14065),a=i(20716),n=i(11855),o=i(67593),r=i(29988);const d=(e,t)=>{const i="object"==typeof e,d=i?e.key:e,[l,u]=(0,n.useState)(t),c=(0,n.useRef)(!1),h=(0,n.useRef)(t instanceof Function?t():t);(0,n.useEffect)((()=>{h.current=l}),[l]);const v=(0,n.useRef)(i?e.instance:new o.w({area:r.q})),p=(0,n.useCallback)((e=>v.current.set(d,void 0!==e?e:h.current)),[d]),m=(0,n.useCallback)(function(){var e=(0,s.A)((function*(e){const t=e instanceof Function?e(h.current):e;yield p(t),c.current&&u(t)}));return function(t){return e.apply(this,arguments)}}(),[p]);(0,n.useEffect)((()=>{var e;c.current=!0;const i={[d]:e=>{c.current&&u(e.newValue)}};return v.current.watch(i),null===(e=v.current.get(d))||void 0===e||e.then((e=>{if(t instanceof Function){const i=null==t?void 0:t(e,!0);void 0!==i&&m(i)}else(0,a.A)(e,t)||u(void 0!==e?e:t)})),()=>{c.current=!1,v.current.unwatch(i),t instanceof Function&&u(t)}}),[d,m]);const g=(0,n.useCallback)((()=>{v.current.remove(d),u(void 0)}),[d]);return[l,m,{setRenderValue:u,setStoreValue:p,remove:g}]}},46241:(e,t,i)=>{i.d(t,{A:()=>h});var s=i(44557),a=i(10633),n=i(60449),o=i(83064),r=i(16029),d=i(75882),l=i(16409),u=i(24337);class c extends n.A{constructor(e,t){super(e,t),(0,a.A)(this,"injectTabIds",void 0),(0,a.A)(this,"removeTabId",(e=>{var t;this.injectTabIds.has(e)&&(clearTimeout(null===(t=this.injectTabIds.get(e))||void 0===t?void 0:t.timer),this.injectTabIds.delete(e))})),(0,a.A)(this,"clearTimeId",(e=>{var t;void 0!==e&&this.injectTabIds.has(e)&&(clearTimeout(null===(t=this.injectTabIds.get(e))||void 0===t?void 0:t.timer),this.injectTabIds.set(e,(0,s.A)((0,s.A)({},this.injectTabIds.get(e)),{},{timer:null,active:!1})))})),(0,a.A)(this,"clearAllTimers",(()=>{this.injectTabIds.forEach(((e,t)=>{clearTimeout(null==e?void 0:e.timer),this.injectTabIds.set(t,(0,s.A)((0,s.A)({},e),{},{timer:null,active:!1}))}))})),(0,a.A)(this,"start",(()=>{try{this.clearAllTimers();const e=this;chrome.tabs.query({active:!0},(t=>{t.forEach((t=>{null!=t&&t.id&&this.injectTabIds.has(null==t?void 0:t.id)&&e.sendHeartBeat(t,0)}))}))}catch(e){u.z3(e)}})),(0,a.A)(this,"sendHeartBeat",((e,t=0)=>{let i=t;if(null!=e&&e.id&&this.injectTabIds.has(null==e?void 0:e.id)){var s;this.clearTimeId(null==e?void 0:e.id),Number(new Date)-((null===(s=this.injectTabIds.get(null==e?void 0:e.id))||void 0===s?void 0:s.lastTimestamp)||Number(new Date))>8e3&&(this.updateActiveTime(null==e?void 0:e.id),i++),this.crashLog&&u.Rm("HEARTBEAT_ALIVE_TAB~~~~~~~~~~~",null==e?void 0:e.id),this.crashLog&&u.Rm(this.injectTabIds);try{var a;(0,l.UL)({tabId:null==e?void 0:e.id,name:"crash-monitor-message",body:{type:r.lh.HEARTBEAT,tabId:null==e?void 0:e.id}}).then((e=>{if(e.success){const{type:t,tabId:i}=e.data||{};t===r.lh.HEARTBEAT_RESPONSE&&this.updateActiveTime(i),t===r.lh.HEARTBEAT_STOP&&this.removeTabId(i)}})),this.injectTabIds.set(null==e?void 0:e.id,{timer:setTimeout((()=>{var t;i>=2?this.stopHeartBeatAndReport((null==e?void 0:e.id)||0):(this.crashLog&&u.Rm("curRetryCount:",i),void 0!==(null==e?void 0:e.id)&&null!==(t=this.injectTabIds.get(null==e?void 0:e.id))&&void 0!==t&&t.active&&this.sendHeartBeat(e,i))}),5e3),lastTimestamp:(null===(a=this.injectTabIds.get(null==e?void 0:e.id))||void 0===a?void 0:a.lastTimestamp)||Number(new Date),tabInfo:e,active:!0})}catch(n){u.z3(n)}}})),(0,a.A)(this,"updateActiveTime",(e=>{void 0!==e&&this.injectTabIds.has(e)&&this.injectTabIds.set(e,(0,s.A)((0,s.A)({},this.injectTabIds.get(e)),{},{lastTimestamp:Number(new Date),active:!0}))})),(0,a.A)(this,"stopHeartBeatAndReport",(e=>{var t,i,s,a,n;this.crashLog&&u.Rm(">>>>>>>>>>>>crash>>>>>>>>>>>>>>>>",null===(t=this.injectTabIds.get(e))||void 0===t?void 0:t.tabInfo),this.category=o.w.PAGE_CRASH,this.msg=`${(null===(i=this.injectTabIds.get(e))||void 0===i||null===(i=i.tabInfo)||void 0===i?void 0:i.title)||""}\u53d1\u751fcrash\uff0c\u9875\u9762\u72b6\u6001\u4e3a${(null===(s=this.injectTabIds.get(e))||void 0===s||null===(s=s.tabInfo)||void 0===s?void 0:s.status)||""}`,this.pageUrl=(null===(a=this.injectTabIds.get(e))||void 0===a||null===(a=a.tabInfo)||void 0===a?void 0:a.url)||"",this.recordError({name:o.w.PAGE_CRASH}),clearTimeout(null===(n=this.injectTabIds.get(e))||void 0===n?void 0:n.timer),this.injectTabIds.delete(e)})),this.injectTabIds=new Map,this.initListeners()}initListeners(){var e;const t=this,i={name:"crash-monitor-message",handle:(e,i)=>{var s,a,n,o,d,l,c;if(null!=e&&e.crashMonitorInject&&null!=i&&null!==(s=i.tab)&&void 0!==s&&s.id)return t.removeTabId(null==i||null===(a=i.tab)||void 0===a?void 0:a.id),t.injectTabIds.set(null===(n=i.tab)||void 0===n?void 0:n.id,null),t.crashLog&&u.Rm("injectTabIds: ",t.injectTabIds),t.start(),!0;(null==e?void 0:e.type)===r.lh.PAGE_VISIBILITY_FALSE&&(t.crashLog&&u.Rm("PAGE_VISIBILITY_FALSE: ",null===(o=i.tab)||void 0===o?void 0:o.id),t.clearTimeId(null==i||null===(d=i.tab)||void 0===d?void 0:d.id));(null==e?void 0:e.type)===r.lh.PAGE_VISIBILITY_TRUE&&(t.crashLog&&u.Rm("PAGE_VISIBILITY_TRUE: ",null===(l=i.tab)||void 0===l?void 0:l.id),t.updateActiveTime(null==i||null===(c=i.tab)||void 0===c?void 0:c.id),t.start())}};(0,d.c)(i),null===(e=chrome.tabs)||void 0===e||e.onActivated.addListener((e=>{t.crashLog&&u.Rm("currentActiveTabId:  ",null==e?void 0:e.tabId),t.updateActiveTime(null==e?void 0:e.tabId),t.start()})),chrome.tabs.onRemoved.addListener((e=>{t.removeTabId(e)}))}}const h=c},37890:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(10633),a=i(60449),n=i(83064);class o extends a.A{constructor(e){super(e.region),(0,s.A)(this,"rule",void 0),this.run(),this.rule=e.rule}run(){const e=self,t=this,i=e.fetch;e.fetch=function(...e){return new Promise(((s,a)=>{var o;const r=[null==e||null===(o=e[0])||void 0===o?void 0:o.replace("#skipBGMonitor=true",""),...null==e?void 0:e.slice(1)];i.apply(this,r).then((e=>{var i;const a=e.headers.get("x-tt-logid");t.msg=`Network error ${null==e?void 0:e.status}`,t.url=e.url||"",t.statusCode=(null==e?void 0:e.status)||0,t.logId=a||"",/^2\d{2}$/.test(null==e||null===(i=e.status)||void 0===i?void 0:i.toString())||t.recordError({name:n.w.FETCH_ERROR}),s(e)})).catch((e=>a(e)))}))}}}const r=o},88608:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(60449),a=i(83064),n=i(24337);class o extends s.A{constructor(e){super(e),this.run()}run(){self.onerror=(e,t,i,s,o)=>{try{this.msg=JSON.stringify(e),this.url=t||"",this.line=i||0,this.col=s||0,this.errorName=(null==o?void 0:o.name)||"",this.stack=(null==o?void 0:o.stack)||"",this.recordError({name:a.w.JS_ERROR})}catch(o){(0,n.z3)("js\u9519\u8bef\u5f02\u5e38",o)}}}destroy(){self.onerror=null}}},79267:(e,t,i)=>{i.d(t,{A:()=>d});var s=i(10633),a=i(60449),n=i(83064),o=i(24337);class r extends a.A{constructor(e){super(e),(0,s.A)(this,"handleError",(e=>{try{var t,i,s,a;if(null==e||!e.reason)return;const o=(null==e?void 0:e.fileName)||"unknown",r=0,d=`${null==e||null===(t=e.reason)||void 0===t?void 0:t.message}\n   at ? (${o}:${r})`,l=(null==e||null===(i=e.reason)||void 0===i?void 0:i.stack)||d,u="string"==typeof(null==e?void 0:e.reason)?null==e?void 0:e.reason:null!==(s=JSON.stringify(null==e?void 0:e.reason))&&void 0!==s?s:"Unspecified reason";null!==(a=e.reason.config)&&void 0!==a&&a.url&&(this.url=e.reason.config.url),this.stack=l,this.msg=u,this.recordError({name:n.w.PROMISE_ERROR})}catch(r){(0,o.z3)(r)}})),this.run()}run(){self.addEventListener("unhandledrejection",this.handleError,!0)}destroy(){self.removeEventListener("unhandledrejection",this.handleError)}}const d=r},5008:(e,t,i)=>{i.d(t,{sN:()=>l});var s=i(86322),a=i(67685),n=i(24337);let o=null;const r=new s.qK(100);globalThis.__perfCache=r;const d=new PerformanceObserver((function(e,t){e.getEntries().forEach((e=>{if("resource"===e.entryType){const t=(e=>{try{const t=new URL(e);return!!t.origin.includes(a.FI)&&`${t.origin}${t.pathname}`}catch(t){return!1}})(e.name);if(t){(0,n.Rm)("[Daniel] PerformanceObserver",`${t} duration: ${e.duration}`,e);const{startTime:i,domainLookupStart:s,domainLookupEnd:a,connectStart:d,connectEnd:l,requestStart:u,responseStart:c,responseEnd:h,transferSize:v,encodedBodySize:p,duration:m}=e;o?o.sendEvent({name:"api_timing",metrics:{startTime:i,domainLookupStart:s,domainLookupEnd:a,connectStart:d,connectEnd:l,requestStart:u,responseStart:c,responseEnd:h,transferSize:v,encodedBodySize:p,duration:m},categories:{url:t}}):(0,n.z3)("[lwx] BgSlardar not set!!"),r.set(`${Date.now()} - ${t}`,{"server-origin":performance.timeOrigin,"server-duration":m,"server-startTime":i,"server-transferSize":v,"server-requestStart":u,"server-responseStart":c,"server-responseEnd":h,"server-encodedBodySize":p})}}}))})),l=e=>{o=e,d.observe({entryTypes:["resource"]})}},29659:(e,t,i)=>{i.d(t,{m:()=>o});var s=i(14065),a=i(37462);const n=function(){var e=(0,s.A)((function*(e,t){const{url:i,data:s,success:n=a.A,fail:o=a.A}=t,r={method:e,headers:{"Content-Type":"application/json"},mode:"cors",credentials:"include"};s&&(r.body=s);try{const e=yield fetch(i,r),t=yield e.json();if(!e.ok)throw Error(t);n(t)}catch(d){o(d)}}));return function(t,i){return e.apply(this,arguments)}}(),o=()=>"function"==typeof fetch?{get(e){n("GET",e)},post(e){n("POST",e)}}:{get:a.A,post:a.A}},17114:(e,t,i)=>{i.d(t,{A:()=>u});i(11855);var s=i(86012),a=i(34944);const n="palette-item-vRJj6B",o="icon-wYp17b",r="palette-overlay-M4TSOy",d="palette-wrapper-_IGDei";var l=i(63159);const u=e=>{const{children:t,palette:i,getPopupContainer:u,selected:c,onSelectedChange:h,position:v="bottomRight"}=e;return(0,l.jsx)(a.AM,{className:r,content:(0,l.jsx)("div",{className:d,children:i.map((([e,t])=>(0,l.jsx)("div",{className:n,style:{background:e},onPointerEnter:e=>{e.target instanceof HTMLElement&&(e.target.style.background=t)},onPointerLeave:t=>{t.target instanceof HTMLElement&&(t.target.style.background=e)},onPointerDownCapture:t=>{t.stopPropagation(),t.preventDefault(),null==h||h(e)},children:c===e&&(0,l.jsx)(s.A,{className:o})},e)))}),trigger:"click",position:v,getPopupContainer:u,children:t})}},42101:(e,t,i)=>{i.d(t,{t:()=>s});let s=function(e){return e.default="default",e.loading="loading",e.done="done",e.commonFailed="commonFailed",e.exceedSizeFailed="exceedSizeFailed",e}({})},23427:(e,t,i)=>{i.d(t,{x:()=>n});var s=i(10633),a=i(69456);const n=new class{constructor(){(0,s.A)(this,"_status",{}),(0,s.A)(this,"getPodcastType",(()=>this._status.podcastType)),(0,s.A)(this,"getAudioUrl",(()=>this._status.audioUrl)),(0,s.A)(this,"getTitle",(()=>this._status.title)),(0,s.A)(this,"getCoverUrl",(()=>this._status.coverUrl)),(0,s.A)(this,"getTranscript",(()=>this._status.transcript)),(0,s.A)(this,"getSummaryStatus",(()=>this._status.summaryStatus)),(0,s.A)(this,"getSummaryId",(()=>this._status.summaryId)),(0,s.A)(this,"getStatus",(()=>this._status)),(0,s.A)(this,"resetVideoSummaryStatus",(()=>{this._status={}})),(0,s.A)(this,"getHtmlContentFunc",(()=>()=>(0,a.F4)(this._status.podcastType)))}setVideoSummaryStatus({podcastType:e,audioUrl:t,title:i,coverUrl:s,transcript:a,summaryStatus:n,summaryId:o,duration:r}){void 0!==e&&(this._status.podcastType=e),void 0!==t&&(this._status.audioUrl=t),void 0!==i&&(this._status.title=i),void 0!==s&&(this._status.coverUrl=s),void 0!==a&&(this._status.transcript=a),void 0!==n&&(this._status.summaryStatus=n),void 0!==o&&(this._status.summaryId=o),void 0!==r&&(this._status.duration=r)}}},9216:(e,t,i)=>{i.d(t,{S:()=>n,Z:()=>o});var s=i(14065),a=i(24337);const n=function(){var e=(0,s.A)((function*({videoId:e}){var t,i;const s=yield fetch(`https://api.bilibili.com/x/web-interface/view?bvid=${e}`,{credentials:"include"}).then((e=>e.json())).then((e=>e.data));if(null==s||!s.aid||null==s||!s.cid)return a.R8(`No web interface found for video: ${e}`),{subtitles:[]};const n=s.aid;let o=s.cid;if((null===(t=s.pages)||void 0===t?void 0:t.length)>1){o=s.pages.reduce(((e,t)=>(e[t.page]=t,e)),{})[new URLSearchParams(location.search).get("p")||1].cid}const r=yield fetch(`https://api.bilibili.com/x/player/v2?aid=${n}&cid=${o}`,{credentials:"include"}).then((e=>e.json())).then((e=>e.data)),d=null==r||null===(i=r.subtitle)||void 0===i||null===(i=i.subtitles)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.subtitle_url,l=!(null!=r&&r.need_login_subtitle);if(!d)return a.R8(`No captions url found for video: ${e}`),{subtitles:[],isUserLogin:l};const u=yield(yield fetch(`https:${d}`)).json();if(null==u||!u.body||0===u.body.length)return a.R8(`No captions found for video: ${e}`),{subtitles:[],isUserLogin:l};return{subtitles:u.body.map((e=>({text:e.content,offset:parseInt(String(1e3*e.from)),duration:parseInt(String(1e3*(e.to-e.from)))}))),isUserLogin:l,videoListInfo:{pages:s.pages,ugc_season:s.ugc_season}}}));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=(0,s.A)((function*(e){var t;const i=yield fetch(`https://api.bilibili.com/x/web-interface/view?bvid=${e}`,{credentials:"include"}).then((e=>e.json())).then((e=>e.data));if(null==i||!i.aid||null==i||!i.cid)return a.R8(`No web interface found for video: ${e}`),`https://player.bilibili.com/player.html?bvid=${e}`;const s=i.aid;let n=i.cid,o=1;if((null===(t=i.pages)||void 0===t?void 0:t.length)>1){const e=i.pages.reduce(((e,t)=>(e[t.page]=t,e)),{});o=Number(new URLSearchParams(location.search).get("p")||1),n=e[o].cid}return`https://player.bilibili.com/player.html?aid=${s}&bvid=${e}&cid=${n}&p=${o}`}));return function(t){return e.apply(this,arguments)}}()},55388:(e,t,i)=>{i.d(t,{S:()=>h});var s=i(14065),a=i(31937),n=i(79124),o=i.n(n),r=i(42664),d=i.n(r),l=i(77591),u=i(24337),c=i(88090);const h=function(){var e=(0,s.A)((function*({videoID:e,useUILang:t=!0,lang:i="en"}){const s=yield fetch(location.href),n=yield s.text();if(!n.includes("captionTracks"))return u.R8(`No captions found for video: ${e}`),{subtitles:[]};const r=/"captionTracks":(\[.*?\])/.exec(n);if(!r)return u.R8(`Failed to extract captionTracks from video: ${e}`),{subtitles:[]};const[h,v]=r,p=JSON.parse(v),m=t?(0,c.wz)((0,l.TK)("uiLanguage")):i;let g;g=m.includes("zh")?[m,"zh","zh-Hans","zh-Hant","en","es","ja"]:[m,"en","es","ja"];const y=(0,a.A)(g.map((e=>p.find((t=>"en"===e?t.languageCode.includes(e):t.languageCode===e))))),f=p[0],A=y[0]||f;if(null==A||!A.baseUrl)return u.R8(`Could not find ${i} captions for ${e}`),{subtitles:[]};const _=yield fetch(A.baseUrl),I=yield _.text(),b=/start="([\d.]+)"/,S=/dur="([\d.]+)"/;return{subtitles:I.replace('<?xml version="1.0" encoding="utf-8" ?><transcript>',"").replace("</transcript>","").split("</text>").filter((e=>e&&e.trim())).reduce(((e,t)=>{const i=b.exec(t),s=S.exec(t);if(!i||!s)return u.R8(`Failed to extract start or duration from line: ${t}`),e;const[,a]=i,[,n]=s,r=t.replace(/<text.+>/,"").replace(/&amp;/gi,"&").replace(/<\/?[^>]+(>|$)/g,""),l=d().decode(r),c=o()(l);return e.push({start:a,dur:n,text:c}),e}),[]).map((e=>{const{start:t,dur:i,text:s}=e;return{text:s,duration:1e3*parseInt(i),offset:1e3*parseInt(t)}}))}}));return function(t){return e.apply(this,arguments)}}()},71679:(e,t,i)=>{i.d(t,{W:()=>s,l:()=>a});const s=()=>{const e=document.querySelector(".ytp-caption-window-container");e&&(e.style.display="")},a=()=>{const e=document.querySelector(".ytp-caption-window-container");e&&"none"!==e.style.display&&(e.style.display="none")}},6601:(e,t,i)=>{i.d(t,{q:()=>r});var s=i(10633),a=i(28328),n=i(93772),o=i(77259);class r{constructor(){(0,s.A)(this,"videoPlaying",!1),(0,s.A)(this,"timeUpdateHandler",void 0),(0,s.A)(this,"lastTime",0),(0,s.A)(this,"handleBottomVisibilityToggle",void 0),(0,s.A)(this,"handleYoutubeToggleFullscreen",void 0),(0,s.A)(this,"getYoutubeVideoContainer",(()=>document.querySelector(".html5-video-player"))),(0,s.A)(this,"getVideoSetting",(()=>document.querySelector(".ytp-settings-menu"))),(0,s.A)(this,"getYoutubeVideo",(()=>document.querySelector(".html5-main-video"))),(0,s.A)(this,"watchVideoStatus",(()=>{const e=this.getYoutubeVideoContainer();e?(0,a.SM)(e,(e=>{var t,i,s,a;(e.includes("playing-mode")?this.videoPlaying=!0:e.includes("paused-mode")&&(this.videoPlaying=!1),e.includes("ytp-autohide"))?null===(t=this.handleBottomVisibilityToggle)||void 0===t||t.call(this,!1):null===(i=this.handleBottomVisibilityToggle)||void 0===i||i.call(this,!0);e.includes("ytp-fullscreen")?null===(s=this.handleYoutubeToggleFullscreen)||void 0===s||s.call(this,!0):null===(a=this.handleYoutubeToggleFullscreen)||void 0===a||a.call(this,!1)})):setTimeout(this.watchVideoStatus,300)})),(0,s.A)(this,"pauseVideo",(()=>{var e;null===(e=this.getYoutubeVideo())||void 0===e||e.pause()})),(0,s.A)(this,"playVideo",(()=>{var e;null===(e=this.getYoutubeVideo())||void 0===e||e.play()})),(0,s.A)(this,"bindVideoOnclickHandler",(e=>{e.addEventListener("click",(()=>{this.videoPlaying?this.pauseVideo():this.playVideo()}))})),(0,s.A)(this,"getBoundingClientRect",(()=>{const e=this.getYoutubeVideoContainer();if(!e)return{left:0,bottom:0};const{left:t,bottom:i}=e.getBoundingClientRect();return{left:t,bottom:i}})),(0,s.A)(this,"onVideoResizeHandler",(e=>{const t=this.getYoutubeVideoContainer();if(t){new ResizeObserver(e).observe(t)}else setTimeout(e,300)})),(0,s.A)(this,"onBottomVisibilityToggle",(e=>{e(!0),this.handleBottomVisibilityToggle=e})),(0,s.A)(this,"onYoutubeToggleFullscreen",(e=>{this.handleYoutubeToggleFullscreen=e})),(0,s.A)(this,"handleTimeupdate",null),(0,s.A)(this,"handleTimeJump",null),(0,s.A)(this,"watchSettingChange",((e,t=3)=>{const i=this.getVideoSetting();i?((0,a.V$)(i,e),e()):t&&setTimeout((()=>{this.watchSettingChange(e,t-1)}),600)})),(0,s.A)(this,"onTimeUpdated",(e=>{this.handleTimeupdate=e;const t=this.getYoutubeVideo();t&&(this.timeUpdateHandler&&t.removeEventListener("timeupdate",this.timeUpdateHandler),this.timeUpdateHandler=()=>{var e;const i=1e3*t.currentTime;var s;Math.abs(i-this.lastTime)>2e4&&(null===(s=this.handleTimeJump)||void 0===s||s.call(this));this.lastTime=i,null===(e=this.handleTimeupdate)||void 0===e||e.call(this,i)},t.addEventListener("timeupdate",this.timeUpdateHandler))})),(0,s.A)(this,"fireTimeUpdateEvent",(()=>{var e;const t=this.getYoutubeVideo();t&&(null===(e=this.handleTimeupdate)||void 0===e||e.call(this,1e3*t.currentTime))})),(0,s.A)(this,"pause",(()=>{var e;null===(e=this.getYoutubeVideo())||void 0===e||e.pause()})),(0,s.A)(this,"onTimeJump",(e=>{this.handleTimeJump=e})),(0,s.A)(this,"onCursorOverVideo",(e=>{const t=this.getYoutubeVideo();if(!t)return;const i=()=>{e(!0)},s=t=>{const{toElement:i}=t,s=o.j.getAssistantContainer();if(i){if(i.id===n.$||i===s)return}e(!1)};return t.addEventListener("mouseover",i),t.addEventListener("mouseout",s),()=>{t.removeEventListener("mouseover",i),t.removeEventListener("mouseout",s)}})),this.watchVideoStatus()}}},93772:(e,t,i)=>{i.d(t,{$:()=>s});const s=`${(0,i(76360).L2)()}_subtitle_window`},62881:(e,t,i)=>{i.d(t,{xp:()=>a});const s={UNSPECIFIED:0,AA:1,AB:2,AE:3,AF:4,AK:5,AM:6,AN:7,AR:8,AS:9,AV:10,AY:11,AZ:12,BA:13,BE:14,BG:15,BH:16,BI:17,BM:18,BN:19,BO:20,BR:21,BS:22,CA:23,CE:24,CH:25,CO:26,CR:27,CS:28,CU:29,CV:30,CY:31,DA:32,DE:33,DV:34,DZ:35,EE:36,EL:37,EN:38,EO:39,ES:40,ET:41,EU:42,FA:43,FF:44,FI:45,FJ:46,FO:47,FR:48,FY:49,GA:50,GD:51,GL:52,GN:53,GU:54,GV:55,HA:56,HE:57,HI:58,HO:59,HR:60,HT:61,HU:62,HY:63,HZ:64,IA:65,ID:66,IE:67,IG:68,II:69,IK:70,IO:71,IS:72,IT:73,IU:74,JA:75,JV:76,KA:77,KG:78,KI:79,KJ:80,KK:81,KL:82,KM:83,KN:84,KO:85,KR:86,KS:87,KU:88,KV:89,KW:90,KY:91,LA:92,LB:93,LG:94,LI:95,LN:96,LO:97,LT:98,LU:99,LV:100,MG:101,MH:102,MI:103,MK:104,ML:105,MN:106,MO:107,MR:108,MS:109,MT:110,MY:111,NA:112,NB:113,ND:114,NE:115,NG:116,NL:117,NN:118,NO:119,NR:120,NV:121,NY:122,OC:123,OJ:124,OM:125,OR:126,OS:127,PA:128,PI:129,PL:130,PS:131,PT:132,QU:133,RM:134,RN:135,RO:136,RU:137,RW:138,SA:139,SC:140,SD:141,SE:142,SG:143,SH:144,SI:145,SK:146,SL:147,SM:148,SN:149,SO:150,SQ:151,SR:152,SS:153,ST:154,SU:155,SV:156,SW:157,TA:158,TE:159,TG:160,TH:161,TI:162,TK:163,FIL:164,TN:165,TO:166,TR:167,TS:168,TT:169,TW:170,TY:171,UG:172,UK:173,UR:174,UZ:175,VE:176,VI:177,VO:178,WA:179,WO:180,XH:181,YI:182,YO:183,ZA:184,ZH:185,ZU:186,"HI-LATN":1001,"ZH-HANT":1002,"ZH-HANT-HK":1003,"ZH-HANT-TW":1004,CEB:2001,CKB:2002,KMR:2003,UMB:2004,NSO:2005,KAM:2006,LUO:2007,FUV:2008,LZH:3001,YUE:3002,CMN:3003,WUU:3004,NAN:3005};function a(e){return s[e.toUpperCase()]}},89962:(e,t,i)=>{i.d(t,{E:()=>C});var s=i(44557),a=i(85886),n=i(11855),o=i(29019),r=i.n(o),d=i(86012),l=i(57214),u=i(34944),c=i(40577);const h=[{id:1,tab_name:"flow_web_ext_setting_general_select_voice_rec",recommend_type:1},{id:2,tab_name:"flow_web_ext_setting_general_select_voice_female",tab_key:"female",recommend_type:10},{id:3,tab_name:"flow_web_ext_setting_general_select_voice_male",tab_key:"male",recommend_type:10},{id:4,tab_name:"flow_web_ext_setting_general_select_voice_char",tab_key:"characters",recommend_type:10},{id:5,tab_name:"flow_web_ext_setting_general_select_voice_accent",tab_key:"accent",recommend_type:10}];var v=i(47730),p=i(79724),m=i(66714);const g="speaker-selector-oh7mrC",y="categories-Garn0U",f="tab-Y0aL2A",A="tab-active-SEgViS",_="list-container-u_Hxnd",I="enable-shadow-ervn8v",b="speaker-list-Ut7cp4",S="speaker-item-XsLIAB",T="selected-icon-rohU0f",x="speaker-main-cGgbh_",P="speaker-avatar-Cejryl",L="speaker-info-cANi7A",E="speaker-name-kIpUVM",w="speaker-tags-rQabqF";var k=i(63159);const M=({speaker:e,active:t,onSelect:i,audioLoading:s,audioPlaying:a})=>{var n;return(0,k.jsxs)("div",{onClick:()=>i(e),className:S,children:[(0,k.jsxs)("div",{className:x,children:[(0,k.jsx)("img",{src:e.avatarUrl,alt:e.name,className:P}),(0,k.jsxs)("div",{className:L,children:[(0,k.jsx)("div",{className:E,children:e.name}),(0,k.jsx)("div",{className:w,children:null===(n=e.tags)||void 0===n?void 0:n.map((e=>(0,k.jsx)("span",{children:e},e)))})]})]}),(()=>{if(t)switch(!0){case s:return(0,k.jsx)(m.L,{size:22});case a:return(0,k.jsx)(p.d,{size:22});default:return(0,k.jsx)(d.A,{className:T})}})()]},e.id)},C=({onSelect:e})=>{var t;const i=(0,l.B)(),[o,d]=(0,n.useState)(1),p=(0,n.useRef)(null),{voicesMap:m,loadVoicesByTab:S}=(()=>{const[e,t]=(0,n.useState)({}),i=(0,n.useRef)(e);return i.current=e,{voicesMap:e,loadVoicesByTab:e=>{const a=i.current[e]||{page_index:0,data:[],loading:!1,hasMore:!0},n=h.find((t=>t.id===e));if(n&&!a.loading&&a.hasMore){t((t=>(0,s.A)((0,s.A)({},t),{},{[e]:(0,s.A)((0,s.A)({},a),{},{loading:!0})})));const i=a.page_index+1;c.B.getVoices({page_index:i,page_size:30,recommend_type:n.recommend_type,tab_key:n.tab_key}).then((({hasMore:n,voices:o})=>{t((t=>(0,s.A)((0,s.A)({},t),{},{[e]:(0,s.A)((0,s.A)({},a),{},{data:[...a.data,...o],page_index:i,hasMore:n,loading:!1})})))}))}}}})(),T=null===(t=(0,v.Y)("voiceSpeaker")[0])||void 0===t?void 0:t.id,x=(0,n.useRef)(null),[P,L]=(0,n.useState)(!0),[E,w]=(0,n.useState)({speakerId:T,loading:!1,playing:!1}),C=m[o]||{},{data:R=[],loading:N=!0,hasMore:U}=C;(0,n.useEffect)((()=>{R.length||S(o)}),[o]),(0,n.useEffect)((()=>{const e=p.current;if(e){const t=(0,a.A)((()=>{const{offsetHeight:t,scrollTop:i,scrollHeight:s}=e;t+i>s-400&&S(o),L(t+i<s)}),300,{leading:!0,trailing:!0});return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}}),[o]),(0,n.useEffect)((()=>{const e=document.createElement("audio");x.current=e;const t=()=>{w((e=>(0,s.A)((0,s.A)({},e),{},{loading:!1})))},i=()=>{w((e=>(0,s.A)((0,s.A)({},e),{},{playing:!1})))};return e.addEventListener("loadeddata",t),e.addEventListener("ended",i),()=>{e.removeEventListener("loadeddata",t),e.removeEventListener("ended",i),e.pause()}}),[]);const j=t=>{e(t),x.current&&(x.current.pause(),w({speakerId:t.id,loading:!0,playing:!0}),x.current.src=t.preview.previewMp3Url,x.current.play())};return(0,k.jsxs)("div",{className:g,children:[(0,k.jsx)("div",{className:y,children:h.map((e=>(0,k.jsx)("span",{className:r()(f,{[A]:e.id===o}),onClick:()=>{d(e.id)},children:i(e.tab_name)},e.id)))}),(0,k.jsx)(u.tK,{spinning:N&&!R.length,wrapperClassName:r()(_,{[I]:U||P}),children:(0,k.jsx)("div",{ref:p,className:b,style:{height:"min(400px, calc(100vh - 320px))"},children:R.map((e=>(0,k.jsx)(M,{speaker:e,active:e.id===E.speakerId,onSelect:j,audioLoading:E.loading,audioPlaying:E.playing},e.id)))})})]})}},98830:(e,t,i)=>{i.d(t,{K:()=>c});var s=i(14065),a=i(24323),n=i.n(a),o=i(88090),r=i(38523),d=i(77591),l=i(21559),u=i(89124);function c(e,t){return h.apply(this,arguments)}function h(){return(h=(0,s.A)((function*(e,t){var i;const s=null!==(i=(0,o.wz)((0,d.TK)("uiLanguage")))&&void 0!==i?i:navigator.language,a=`${e}_${location.href}_${s}_`;let c="";try{switch(e){case r.e.Web:var h;if(void 0!==t)c=t;else c=(null===(h=yield(0,u.q)(document))||void 0===h?void 0:h.textContent)||"";break;case r.e.Image:c=t||""}}catch(v){l.vF.persist.error({message:"calc business str error",error:v})}return n()(a+c)}))).apply(this,arguments)}},98847:(e,t,i)=>{i.d(t,{xj:()=>g});var s=i(44557),a=i(14065),n=i(98767),o=i(13162);function r(){return(r=(0,a.A)((function*(e){const t=yield Promise.all(e.map((e=>e.startsWith("//")?`https:${e}`:e)).map((e=>(0,n.n_)(e))));return yield Promise.all(t.map((e=>(0,o.r)(e.blob))))}))).apply(this,arguments)}function d(){return`https://api.bilibili.com/x/web-interface/view?bvid=${function(){const e=location.pathname.split("/").filter((e=>e));if(e.length>=2){const t=e.findIndex((e=>"video"===e));return-1===t||t+1>=e.length?"":e[t+1]||""}return""}()}`}function l(){return(l=(0,a.A)((function*(){const e=yield fetch(d(),{credentials:"include"}),t=yield e.json();return null==t?void 0:t.data}))).apply(this,arguments)}function u(){return u=(0,a.A)((function*(){const e=yield function(){return l.apply(this,arguments)}(),t=`https://api.bilibili.com/x/player/videoshot?aid=${e.aid}&cid=${e.cid}`,i=yield fetch(t,{mode:"cors",method:"GET"});return(yield i.json()).data})),u.apply(this,arguments)}function c(){return(c=(0,a.A)((function*(e){const t=yield fetch(e,{mode:"cors",method:"GET"}),i=yield t.arrayBuffer(),s=new DataView(i),a=[],n=i.byteLength/2;for(let o=1;o<n;o++)a.push(s.getInt16(2*o,!1));return a}))).apply(this,arguments)}function h(){return(h=(0,a.A)((function*(e){const t=yield Promise.all(e.map((e=>e.startsWith("//")?`https:${e}`:e)).map((e=>(0,n.n_)(e))));return yield Promise.all(t.map((e=>(0,o.r)(e.blob))))}))).apply(this,arguments)}var v=i(10633),p=i(24337);const m=class{constructor(e,t){if((0,v.A)(this,"vid",void 0),(0,v.A)(this,"initTotalTime",void 0),(0,v.A)(this,"specInfo",void 0),(0,v.A)(this,"videoUrl",void 0),(0,v.A)(this,"data",void 0),!t||!e)throw new Error("invalid params");this.vid=e,this.initTotalTime=t,this.data=[],this.specInfo=[],this.videoUrl=`https://www.youtube.com/watch?v=${this.vid}`}init(){var e=this;return(0,a.A)((function*(){let t={};try{var i,s;const a=yield fetch(e.videoUrl),{ok:n,status:o}=a;if(!n||200!==o)return;const r=yield a.text(),d=(null===(s=(null===(i=r.match(/"playerStoryboardSpecRenderer"\s*:\s*\{[^}]+\}/))||void 0===i?void 0:i[0])||"")||void 0===s||null===(s=s.split('"playerStoryboardSpecRenderer":'))||void 0===s?void 0:s[1])||"{}";t=JSON.parse(d)}catch(n){p.z3("getYoutubeStoryboards--error",n)}const{spec:a=""}=t||{};e.specInfo=a.split("|")}))()}generateCompleteData(){if(0===this.specInfo.length)return[];const[e,...t]=this.specInfo;return e?(this.data=t.filter((e=>!e.includes("default"))).map(((t,i)=>{const s=t.split("#"),[a,n,o,r,d,l,u,c]=s,h=Number(r)*Number(d),v=Math.ceil(Number(o)/h),p=Array.from({length:v}).map(((t,s)=>`${e.replace("$L",`${i+1}`).replace("$N",`${u.split("$")[0]||"M"}${s}`)}&sigh=${encodeURIComponent(c)}`)),m=Array.from({length:Number(o)}).map(((e,t)=>Number(l)/1e3*t));return{video_type:"youtube",video_url:this.videoUrl,shot_size:{width:Number(a),height:Number(n)},shot_len:{x:Number(r),y:Number(d)},total:Number(o),images:p,location:m}})),this.data):[]}getImgLocationByTime({location:e,shot_size:t,shot_len:i},a){const n=e.findIndex(((t,i)=>i+1>=e.length||t<=a&&e[i+1]>a))+1;if(0===n)return;const o=Math.ceil(n/i.x),r=n%i.x||i.x,d=Math.ceil(o/i.y),l=o%i.y||i.y;return(0,s.A)({idxGlobal:n,imgIdx:d,xPos:(r-1)*t.width,yPos:(l-1)*t.height},t)}getSingleImgInfoByTime(e){const{data:t}=this,[i,s,a]=t.map((t=>{const{location:i,total:s,images:a,shot_size:n,shot_len:o}=t,r=this.getImgLocationByTime({location:i,shot_size:n,shot_len:o},e),{idxGlobal:d,imgIdx:l,xPos:u,yPos:c,width:h,height:v}=r||{};return{imgIdx:l,spriteImgUrl:void 0===l?void 0:a[l-1],spriteLen:o.x||o.y,idxGlobal:d,xPos:u,yPos:c,xNum:u/n.width+1,yNum:c/n.height+1,width:h,height:v,total:s}}))||[];return{imgInfoL1:i,imgInfoL2:s,imgInfoL3:a}}};function g(){return y.apply(this,arguments)}function y(){return y=(0,a.A)((function*(){const{hostname:e}=location;return/bilibili/.test(e)?yield function(){return f.apply(this,arguments)}():/youtube/.test(e)?yield function(){return A.apply(this,arguments)}():void 0})),y.apply(this,arguments)}function f(){return f=(0,a.A)((function*(){const e=yield function(){return u.apply(this,arguments)}(),t=yield function(e){return c.apply(this,arguments)}(e.pvdata),i=yield function(e){return h.apply(this,arguments)}(e.image);return{location:t,images:i,shot_size:{width:e.img_x_size,height:e.img_y_size},shot_len:{x:e.img_x_len,y:e.img_y_len}}})),f.apply(this,arguments)}function A(){return A=(0,a.A)((function*(){const e=new m(new URL(location.href).searchParams.get("v")||"",function(){const e=document.querySelector("video");return(null==e?void 0:e.duration)||0}());yield e.init();const t=e.generateCompleteData()[1];if(!t)return;const i=yield function(e){return r.apply(this,arguments)}(t.images);return{location:t.location,images:i,shot_size:(0,s.A)({},t.shot_size),shot_len:(0,s.A)({},t.shot_len)}})),A.apply(this,arguments)}},35065:(e,t,i)=>{i.d(t,{wT:()=>r});var s=i(44557),a=i(34870),n=i(45498);const o={showSubtitleTranslation:!0,showSetting:!1,buttonHeight:33,subtitleReady:!1,popoverPosition:{left:0,bottom:0},resetVideoUI:0,isFullscreen:!1},r=(0,n.vt)()((0,a.eh)((e=>(0,s.A)((0,s.A)({},o),{},{setResetVideoUI:t=>e({resetVideoUI:t}),setShowSubtitleTranslation:t=>e({showSubtitleTranslation:t}),setShowSetting:t=>e({showSetting:t}),setButtonHeight:t=>e({buttonHeight:t}),setSubtitleReady:t=>e({subtitleReady:t}),setPopoverPosition:t=>e({popoverPosition:t}),setIsFullscreen:t=>e({isFullscreen:t})}))))},23835:(e,t,i)=>{i.d(t,{e:()=>d});var s=i(44557),a=i(34870),n=i(45498),o=i(75943);const r={videoId:"",title:"",partId:"0",highlightExploreCount:1,isLoadingDone:!1,showImmersionSider:!0},d=(0,n.vt)()((0,a.eh)((e=>(0,s.A)((0,s.A)({},r),{},{setVideoId:t=>e((()=>({videoId:t}))),setVideoTitle:t=>e((()=>({title:t}))),setVideoPartId:t=>e((()=>({partId:t}))),setHighlightExploreCount:()=>e((e=>({highlightExploreCount:e.highlightExploreCount+1}))),setIsLoadingDone:t=>e((()=>({isLoadingDone:t}))),setShowImmersionSider:t=>e((()=>({showImmersionSider:t})))}))));o.m.getInstance().registerStore("useVideoSummaryAssistantStore",d)},3310:(e,t,i)=>{i.d(t,{X:()=>s});const s=i(38523).e},67976:(e,t,i)=>{i.d(t,{AP:()=>o,XQ:()=>d,kW:()=>r,qf:()=>u});var s=i(77793),a=i(88090),n=i(77591);"undefined"!=typeof window?window:self;performance.timeOrigin.toString(36);const o=()=>(0,s.A)(),r=()=>{const{userAgent:e}=navigator;return!!/Windows/.test(e)};function d(e="en"){var t;return null!==(t=(0,a.wz)((0,n.TK)("uiLanguage")).replace(/-.*$/,""))&&void 0!==t?t:e}function l(e){return e>9?`${e}`:`0${e}`}function u(e){const t=3600;return e.map((e=>{const i=e.offset/1e3,s=Math.floor(i/t),a=Math.floor((i-s*t)/60),n=Math.floor(i-s*t-60*a);return`${l(s)}:${l(a)}:${l(n).substring(0,2)} ${e.text}`})).join("\n")}},86322:(e,t,i)=>{i.d(t,{qK:()=>o});var s=i(10633);let a=function(e){return e[e.None=0]="None",e[e.AsOld=1]="AsOld",e[e.AsNew=2]="AsNew",e}({});class n{constructor(){(0,s.A)(this,"_map",void 0),(0,s.A)(this,"_head",void 0),(0,s.A)(this,"_tail",void 0),(0,s.A)(this,"_size",void 0),this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return null===(e=this._head)||void 0===e?void 0:e.value}get last(){var e;return null===(e=this._tail)||void 0===e?void 0:e.value}has(e){return this._map.has(e)}get(e,t=a.None){const i=this._map.get(e);if(i)return t!==a.None&&this.touch(i,t),i.value}set(e,t,i=a.None){let s=this._map.get(e);if(s)s.value=t,i!==a.None&&this.touch(s,i);else{switch(s={key:e,value:t,next:void 0,previous:void 0},i){case a.None:this.addItemLast(s);break;case a.AsOld:this.addItemFirst(s);break;case a.AsNew:default:this.addItemLast(s)}this._map.set(e,s),this._size++}}delete(e){return!!this.remove(e)}remove(e){const t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let i=this._head;for(;i;)t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),i=i.next}forEachLast(e,t){let i=this._tail;for(;i;)t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),i=i.previous}findLast(e){let t=this._tail;for(;t;){if(e(t.value,t.key,this))return t;t=t.previous}}find(e){let t=this._head;for(;t;){if(e(t.value,t.key,this))return t;t=t.next}}values(){const e=[];let t=this._head;for(;t;)e.push(t.value),t=t.next;return e}keys(){const e=[];let t=this._head;for(;t;)e.push(t.key),t=t.next;return e}trimOld(e){if(e>=this.size)return;if(0===e)return void this.clear();let t=this._head,i=this.size;for(;t&&i>e;)this._map.delete(t.key),t=t.next,i--;this._head=t,this._size=i,t&&(t.previous=void 0)}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const{next:t}=e,{previous:i}=e;if(!t||!i)throw new Error("Invalid list");t.previous=i,i.next=t}e.next=void 0,e.previous=void 0}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===a.AsOld||t===a.AsNew)if(t===a.AsOld){if(e===this._head)return;const{next:t}=e,{previous:i}=e;e===this._tail?(i.next=void 0,this._tail=i):(t.previous=i,i.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e}else if(t===a.AsNew){if(e===this._tail)return;const{next:t}=e,{previous:i}=e;e===this._head?(t.previous=void 0,this._head=t):(t.previous=i,i.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e}}toJSON(){const e=[];return this.forEach(((t,i)=>{e.push([i,t])})),e}fromJSON(e){this.clear();for(const[t,i]of e)this.set(t,i)}}class o extends n{constructor(e,t=1){super(),(0,s.A)(this,"_limit",void 0),(0,s.A)(this,"_ratio",void 0),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e){return super.get(e,a.AsNew)}peek(e){return super.get(e,a.None)}set(e,t){super.set(e,t,a.AsNew),this.checkTrim()}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}},45577:(e,t,i)=>{function s(e,t,i){let s=!1;return e.then((e=>{s=!0})),setTimeout((()=>{s||i()}),t),e}i.d(t,{Rf:()=>s})},35661:(e,t,i)=>{i.d(t,{A2:()=>a,Jy:()=>n,hT:()=>s});const s={li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},a:{attrs:[{key:"href",getter:e=>e.href}]},code:{},strong:{},i:{},em:{},cite:{},ol:{}},a=Object.keys(s),n=["code"]},40577:(e,t,i)=>{i.d(t,{B:()=>y});var s,a=i(44557),n=i(14065),o=i(10633),r=i(60588);class d extends r.b{constructor(...e){var t;super(...e),t=this,(0,o.A)(this,"audioContext",new AudioContext),(0,o.A)(this,"src",""),(0,o.A)(this,"handlePlayEnd",void 0),(0,o.A)(this,"playing",!1),(0,o.A)(this,"paused",!1),(0,o.A)(this,"audioSource",void 0),(0,o.A)(this,"loading",!1),(0,o.A)(this,"loaded",!1),(0,o.A)(this,"played",!1),(0,o.A)(this,"playAfterLoading",!1),(0,o.A)(this,"loadSrc",(0,n.A)((function*(){if(!t.loading){t.loading=!0;try{const e=yield fetch(t.src),i=yield e.arrayBuffer(),s=yield t.audioContext.decodeAudioData(i),a=t.audioContext.createBufferSource();a.buffer=s,a.connect(t.audioContext.destination),a.addEventListener("ended",(()=>{var e;null===(e=t.handlePlayEnd)||void 0===e||e.call(t)})),t.audioSource=a,t.loaded=!0,t.emit("canplay"),t.playAfterLoading&&(t.audioSource.start(0),t.playing=!0,t.emit("playStart"))}catch(e){}}}))),(0,o.A)(this,"load",function(){var e=(0,n.A)((function*(e){t.src=e,yield t.loadSrc()}));return function(t){return e.apply(this,arguments)}}()),(0,o.A)(this,"play",(0,n.A)((function*(){var e;return t.paused?(t.audioContext.resume(),t.paused=!1,void(t.playing=!0)):t.loaded?(t.audioContext.resume(),null===(e=t.audioSource)||void 0===e||e.start(0),t.playing=!0,t.paused=!1,void t.emit("playStart")):(t.playAfterLoading=!0,void(yield t.loadSrc()))}))),(0,o.A)(this,"pause",(()=>{this.playing&&(this.paused=!0,this.playing=!1,this.audioContext.suspend())})),(0,o.A)(this,"reset",(()=>{var e,t;null===(e=this.handlePlayEnd)||void 0===e||e.call(this),this.removeAllListeners(),null===(t=this.audioSource)||void 0===t||t.disconnect(),this.audioSource=void 0,this.src="",this.handlePlayEnd=void 0,this.playing=!1,this.paused=!1,this.loading=!1,this.loaded=!1,this.played=!1,this.playAfterLoading=!1,this.audioContext.close(),this.audioContext=new AudioContext})),(0,o.A)(this,"hasSrc",(()=>""!==this.src)),(0,o.A)(this,"onPlayEnd",(e=>{this.handlePlayEnd=e})),(0,o.A)(this,"offPlayEnd",(()=>{this.handlePlayEnd=void 0}))}}s=d,(0,o.A)(d,"lastUsedPlayerIndex",-1),(0,o.A)(d,"audioPlayers",[new s,new s]),(0,o.A)(d,"getAudioPlayer",(()=>{s.lastUsedPlayerIndex=(s.lastUsedPlayerIndex+1)%2;const e=s.audioPlayers[s.lastUsedPlayerIndex];return e.reset(),e}));var l=i(64747),u=i(54422),c=i(16409),h=i(20825);const v=function(){var e=(0,n.A)((function*(e,t=""){const{success:i,data:s}=yield(0,c.cs)({name:u.dE,body:{text:e,speakerId:t,scene:h._K.isInSidePanel?"sidepanel":"content-script"}});if(!i)throw new Error("REQUEST TTS SEND TO BACKGROUND ERROR");return s}));return function(t){return e.apply(this,arguments)}}();var p,m=i(21559),g=i(77191);class y{constructor(){var e=this;(0,o.A)(this,"ended",!1),(0,o.A)(this,"isPlaying",!1),(0,o.A)(this,"isLoaded",!1),(0,o.A)(this,"isLoading",!1),(0,o.A)(this,"audioPlayer",void 0),(0,o.A)(this,"nextAudioPlayer",void 0),(0,o.A)(this,"error",""),(0,o.A)(this,"currentAudioIndex",0),(0,o.A)(this,"totalCount",-1),(0,o.A)(this,"receiveAudioId",""),(0,o.A)(this,"audioUrls",[]),(0,o.A)(this,"handleLoadStart",void 0),(0,o.A)(this,"handleLoadReady",void 0),(0,o.A)(this,"handlePlayStart",void 0),(0,o.A)(this,"handlePlayPause",void 0),(0,o.A)(this,"handlePlayEnd",void 0),(0,o.A)(this,"handleCurrentAudioUrlLoaded",void 0),(0,o.A)(this,"handleAudioDataLoaded",void 0),(0,o.A)(this,"realPlay",(()=>{var e,t;null===(e=this.audioPlayer)||void 0===e||e.play(),null===(t=this.handlePlayStart)||void 0===t||t.call(this),this.isPlaying=!0})),(0,o.A)(this,"audioLoadStart",(()=>{var e;this.isLoading=!0,null===(e=this.handleLoadStart)||void 0===e||e.call(this)})),(0,o.A)(this,"audioLoadReady",(()=>{var e;this.isLoading=!1,this.isLoaded=!0,null===(e=this.handleLoadReady)||void 0===e||e.call(this)})),(0,o.A)(this,"audioPlayStart",(()=>{var e;this.handleCurrentAudioUrlLoaded=void 0,this.isPlaying=!0,null===(e=this.handlePlayStart)||void 0===e||e.call(this)})),(0,o.A)(this,"audioPlayPause",(()=>{var e;this.isPlaying=!1,null===(e=this.handlePlayPause)||void 0===e||e.call(this)})),(0,o.A)(this,"cleanCurrentAudioPlayer",(()=>{this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.reset())})),(0,o.A)(this,"updateCurrentIndex",(()=>{if(!this.audioPlayer)return!1;const e=this.currentAudioIndex+1;var t,i,s;if(-1!==this.totalCount&&e>=this.totalCount)return this.pauseAudio(),this.ended=!0,null===(t=this.handlePlayEnd)||void 0===t||t.call(this),this.cleanCurrentAudioPlayer(),this.audioPlayer=this.nextAudioPlayer,this.nextAudioPlayer=d.getAudioPlayer(),this.currentAudioIndex=0,1===this.totalCount?(null===(s=this.audioPlayer)||void 0===s||s.load(this.audioUrls[this.currentAudioIndex]),!1):(null===(i=this.audioPlayer)||void 0===i||i.load(this.audioUrls[this.currentAudioIndex]),this.nextAudioPlayer.load(this.audioUrls[this.currentAudioIndex+1]),!1);this.currentAudioIndex=e,this.cleanCurrentAudioPlayer(),this.audioPlayer=this.nextAudioPlayer,this.nextAudioPlayer=d.getAudioPlayer();return this.audioUrls[this.currentAudioIndex+1]&&this.nextAudioPlayer.load(this.audioUrls[this.currentAudioIndex+1]),!0})),(0,o.A)(this,"handleCurrentAudioEnd",(()=>{var e;null===(e=this.audioPlayer)||void 0===e||e.offPlayEnd();this.updateCurrentIndex()&&this.playEachAudioInOrder()})),(0,o.A)(this,"playEachAudioInOrder",(()=>{this.audioPlayer&&this.nextAudioPlayer&&(this.audioPlayer.hasSrc()?(this.audioPlayer.onPlayEnd(this.handleCurrentAudioEnd),this.realPlay()):this.handleCurrentAudioUrlLoaded=()=>{this.playEachAudioInOrder()})})),(0,o.A)(this,"playAudio",(()=>{this.audioPlayStart(),this.playEachAudioInOrder()})),(0,o.A)(this,"pauseAudio",(()=>{var e,t;this.handleCurrentAudioUrlLoaded=void 0,null===(e=this.nextAudioPlayer)||void 0===e||e.pause(),null===(t=this.audioPlayer)||void 0===t||t.pause(),this.audioPlayPause()})),(0,o.A)(this,"timeupdateCount",0),(0,o.A)(this,"handleTimeupdated",(()=>{var e,t;(this.timeupdateCount+=1,this.timeupdateCount>3)&&(null===(e=this.audioPlayer)||void 0===e||e.off("playStart",this.handleTimeupdated),null===(t=this.audioPlayer)||void 0===t||t.off("canplay",this.handleCanplay),this.timeupdateCount=0)})),(0,o.A)(this,"handleCanplay",(()=>{var e;this.audioLoadReady(),null===(e=this.handleAudioDataLoaded)||void 0===e||e.call(this),this.handleAudioDataLoaded=void 0})),(0,o.A)(this,"handleAudioUpdate",((e,t)=>{var i;if(this.audioUrls[e]=t,e===this.currentAudioIndex&&this.audioPlayer)return null===(i=this.handleCurrentAudioUrlLoaded)||void 0===i||i.call(this),this.audioPlayer.on("playStart",this.handleTimeupdated),this.audioPlayer.on("canplay",this.handleCanplay),void this.audioPlayer.load(t);e===this.currentAudioIndex+1&&this.nextAudioPlayer&&this.nextAudioPlayer.load(t)})),(0,o.A)(this,"handleTTSFinished",(e=>{this.totalCount=e})),(0,o.A)(this,"handleTTSError",(e=>{this.error=e,this.isLoaded=!1,this.isLoading=!1,this.pauseAudio()})),(0,o.A)(this,"handleTTSMessage",(e=>{const{type:t,content:i}=e;if("update"===t){const{order:e,url:t}=i;this.handleAudioUpdate(e,t)}"finished"===t&&this.handleTTSFinished(i),"error"===t&&this.handleTTSError(i)})),(0,o.A)(this,"onLoadStart",(e=>{this.handleLoadStart=e})),(0,o.A)(this,"onLoadReady",(e=>{this.handleLoadReady=e})),(0,o.A)(this,"onPlayStart",(e=>{this.handlePlayStart=e})),(0,o.A)(this,"onPlayPause",(e=>{this.handlePlayPause=e})),(0,o.A)(this,"onPlayEnd",(e=>{this.handlePlayEnd=e})),(0,o.A)(this,"loadAudio",function(){var t=(0,n.A)((function*(t,i=""){try{e.audioLoadStart(),e.receiveAudioId&&l.s.off(e.receiveAudioId),e.receiveAudioId=yield v(t,i),l.s.on(e.receiveAudioId,e.handleTTSMessage)}catch(s){throw new Error("LOAD AUDIO FAILED: ",s||"unknown error")}}));return function(e){return t.apply(this,arguments)}}()),(0,o.A)(this,"loadAndPlay",((e,t="")=>{if(y.forceStopLastInstance(this),void 0===this.audioPlayer&&(this.audioPlayer=d.getAudioPlayer()),void 0===this.nextAudioPlayer&&(this.nextAudioPlayer=d.getAudioPlayer()),this.isLoaded)this.playAudio();else{if(this.isLoading)return this.audioLoadStart(),void(this.handleLoadReady=this.playAudio);this.handleLoadReady=this.playAudio,this.loadAudio(e,t)}})),(0,o.A)(this,"cancelLoadAndPause",(()=>{this.handleLoadReady=void 0,this.pauseAudio()})),(0,o.A)(this,"togglePlay",(()=>{this.isLoading||(this.isPlaying?this.pauseAudio():this.playAudio())})),(0,o.A)(this,"forceStop",(()=>{var e;this.ended||(this.cancelLoadAndPause(),null===(e=this.handlePlayEnd)||void 0===e||e.call(this))})),(0,o.A)(this,"destroy",(()=>{var e,t;this.cancelLoadAndPause(),null===(e=this.audioPlayer)||void 0===e||e.reset(),this.audioPlayer=void 0,null===(t=this.nextAudioPlayer)||void 0===t||t.reset(),this.nextAudioPlayer=void 0,l.s.off(this.receiveAudioId)}))}}p=y,(0,o.A)(y,"getVoices",function(){var e=(0,n.A)((function*(e){let t=[],i=!0;try{const{ugc_voice_list:s=[],has_more:n}=yield(0,g.J2)((0,a.A)((0,a.A)({},e),{},{language_code:"zh"}));i=n,t=s.map((e=>({id:e.id,style_id:e.style_id,name:e.name,avatarUrl:e.icon.url,preview:{previewMp3Url:e.preview.preview_audio,previewText:e.preview.preview_text},tags:e.tag_list.map((e=>e.tag_value))})))}catch(s){m.vF.persist.error({message:"FETCH_VOICE_FAILED",error:s})}return{voices:t,hasMore:i}}));return function(t){return e.apply(this,arguments)}}()),(0,o.A)(y,"lastPlayedInstance",null),(0,o.A)(y,"forceStopLastInstance",(e=>{p.lastPlayedInstance?p.lastPlayedInstance!==e&&(p.lastPlayedInstance.forceStop(),p.lastPlayedInstance=e):p.lastPlayedInstance=e}))},94984:(e,t,i)=>{i.d(t,{$q:()=>A,Gm:()=>f,O2:()=>v,TU:()=>p,dk:()=>g,eT:()=>m,uX:()=>y});var s=i(44557),a=i(40967),n=i(37814),o=i(20177),r=i(70593),d=i(16100),l=i(94268),u=i(46219),c=i(1456),h=i(10129);function v(e,{conversationId:t,replyId:i}){const s=(0,n.A)(e.localMessageMap[t],(e=>(null==e?void 0:e.reply_id)===i));return(0,a.A)(s)}function p(e,{conversationId:t,localMessageId:i}){var s;return null===(s=e.localMessageMap[t])||void 0===s?void 0:s[i]}function m(e){var t;const{conversationType:i,isRegenerate:a,immerUpdateMessage:n,newLocalMessageId:o,conversationId:r,replyId:c,messageId:h,sectionId:v,message:p={},timeout:m=0,regenHead:g,localMessageStatus:y,createdFrom:f,reportParams:A}=e,[_]=n,I=(0,s.A)({conversation_id:r,reply_id:c,message_id:h,local_message_id:o,is_regenerate:a,conversation_type:i},A);if("ack"===f){const e=_.draftMessageReportEventMap[c];_.draftMessageReportEventMap[c]={reportParams:(null==e?void 0:e.reportParams)||{},reportEvents:(0,s.A)((0,s.A)({},(null==e?void 0:e.reportEvents)||{}),{},{receive_total_messages:(0,d.XB)({eventName:"receive_total_messages",meta:I})})}}if("send_message"!==f&&"replace_temporary_message"!==f){const e=_.draftMessageReportEventMap[o];_.draftMessageReportEventMap[o]={reportParams:(null==e?void 0:e.reportParams)||{},reportEvents:(0,s.A)((0,s.A)({},(null==e?void 0:e.reportEvents)||{}),{},{receive_message:(0,d.XB)({eventName:"receive_message",meta:I}),receive_message_package:(0,d.XB)({eventName:"receive_message_package",meta:I})})}}_.draftLocalMessageMap[o]=(0,l.xf)({prevMessageId:a?null===(t=(0,l.WZ)(_.draftMessageLinks,(e=>e.regen_head===g&&!e.isLocalMessage)))||void 0===t?void 0:t.messageId:c,localMessageStatus:y,message:(0,s.A)((0,s.A)({},p),{},{conversation_id:r,section_id:v,local_message_id:o,reply_id:c}),failedExpired:Date.now()+(1e3*Number(m)||u.dc),messageLinks:_.draftMessageLinks,isRegenerate:a})}function g(e){const{isRegenerate:t,immerUpdateMessage:i,newLocalMessageId:a,regenHead:n,messageKey:r}=e,[d]=i,l=(0,o.A)(d.draftMessageLinks,(e=>e.messageId===a));if(l)l.regen_head=n;else{const e=(0,s.A)({isLocalMessage:!0,messageId:a},r?{messageKey:r}:{});t&&(e.regen_head=n),d.draftMessageLinks.push(e)}}function y(e){const{immerUpdateMessage:t,newLocalMessageId:i,isSearchMessage:a=!1}=e,[n]=t,o=(0,r.A)(n.draftMessageLinks,(e=>e.messageId===i));o&&a&&(n.draftMessageLinks[o]=(0,s.A)((0,s.A)({},n.draftMessageLinks[o]),{},{messageKey:"search_".concat(i)}))}const f=(e,t)=>{var i;return(null===(i=e.userOgfQuota)||void 0===i?void 0:i.nextMessageUseOgf)?(0,s.A)((0,s.A)({},t),{},{llm_model_type:"2"}):t};function A(e){const[t]=e,{draftLocalMessageMap:i,draftMessageLinks:s,draftMessageMap:a}=t;s.filter((({isLocalMessage:e,messageId:t})=>{var s;return e&&(null===(s=i[t])||void 0===s||null===(s=s.local)||void 0===s?void 0:s.status)===h.FQ.ReceivingFirstPackage})).sort(((e,t)=>(0,l.rV)(a[i[t.messageId].reply_id||""],a[i[e.messageId].reply_id||""]))).forEach(((e,i)=>{i&&(0,c.k)(t,e)}))}},79279:(e,t,i)=>{i.d(t,{P:()=>f});var s=i(44557),a=i(5099),n=i(42579),o=i.n(n),r=i(16100),d=i(37357),l=i(81435),u=i(27527),c=i(94268),h=i(9057),v=i(49944),p=i(88138),m=i(81626),g=i(83664);function y(e,t,i,n){if(!i||!(0,c.xX)(i)||!i.local_message_id||(0,c.wt)(i))return;const{message_id:h,local_message_id:y,reply_id:f}=i,A=e.getState();if((0,c.e1)(i)||(0,c.ET)(i))return A.finishSendMessageTask(y),A.updateMessageList({conversationId:t,immerUpdate:e=>{const{draftLocalMessageMap:t}=e,s=t[(null==i?void 0:i.local_message_id)||""];s&&(s.local.hasBroken=!0)}}),(0,p.PF)({localMessageId:null==i?void 0:i.local_message_id}),void g.B.emit("chat.localBreak");if(!(0,c.oS)(i)||(0,c.Ys)(i)){const e=(0,m.Tc)(t,{isLocalMessage:!1,messageId:f||""});(0,p.PF)({replyId:f||"",localMessageId:null==e?void 0:e.local_message_id}),(0,c.Wi)(i)?A.updateMessageList({conversationId:t,immerUpdate:({draftLocalMessageMap:e})=>{const t=e[y||""];t&&(t.local.hasBroken=!0,t.status=l.q7.InVisible)}}):(0,c.ln)(i)&&h&&(0,v.P)((0,s.A)((0,s.A)({conversation_id:t,message_id:h},(0,a.A)(i,["local","local_message_id"])),{},{status:l.q7.Broken,chunk_seq:"999999",is_finish:!0})),g.B.emit("chat.localBreak");const _=f||h,I=(0,r.XB)({eventName:"break_message"});if(!function(e){if(null==e||!e.create_time)return!1;const t=(0,c.Qw)(Number(e.create_time));return o()().isBefore(o()(t).add(10,"minute"))}(i)||!_||null!=t&&t.startsWith("local")||(0,c.xT)(i))return void d.v.persist.log({eventName:"break_message_invalid",meta:{replyId:String(_),conversation_id:String(t),is_finished:String(i.is_finish),create_time:String(i.create_time),message_type:String(i.message_type),content_type:String(i.content_type),status:String(i.status),localMessageStatus:String(i.local.status)}});u.j.apiService.message.MessageReport({reply_id:_,conversation_id:t,action:"break"}).then((()=>{I.addDurationPoint("success"),I.success()}),(e=>{I.error({reason:"break message failed",error:e,meta:{replyId:String(_),conversation_id:String(t),is_finished:String(i.is_finish),create_time:String(i.create_time),message_type:String(i.message_type),content_type:String(i.content_type),status:String(i.status),localMessageStatus:String(i.local.status)}}),null==n||n()}))}}function f(e,t){const i=e.getState();y(e,t,(0,h.qo)(i,t));const s=(0,h.qo)(i,t);(0,c.nt)(s)&&y(e,t,s)}},67805:(e,t,i)=>{i.d(t,{$_:()=>s});const s="data-img-tos-key"},14411:(e,t,i)=>{i.d(t,{A:()=>r});i(11855);var s=i(18935),a=i(44557),n=i(63159);const o=e=>(0,n.jsxs)("svg",(0,a.A)((0,a.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:[(0,n.jsx)("path",{fill:"currentColor",d:"M7.713 12q0-.339.244-.583a.78.78 0 0 1 .583-.25h2.634V8.54q0-.34.243-.583A.8.8 0 0 1 12 7.713q.347 0 .59.244a.8.8 0 0 1 .244.583v2.626h2.627q.339 0 .582.251a.8.8 0 0 1 .244.583.8.8 0 0 1-.244.59.8.8 0 0 1-.582.236h-2.627v2.642a.79.79 0 0 1-.244.575.8.8 0 0 1-.59.244.8.8 0 0 1-.583-.244.79.79 0 0 1-.243-.575v-2.642H8.54a.8.8 0 0 1-.583-.236.8.8 0 0 1-.244-.59"}),(0,n.jsx)("circle",{cx:12,cy:12,r:8.25,stroke:"currentColor",strokeWidth:1.5})]})),r=(0,s.a)((0,n.jsx)(o,{}))},10895:(e,t,i)=>{i.d(t,{A:()=>s});const s={toastContainer:"toastContainer-jcLkom",text:"text-ELyTEi",loadingText:"loadingText-pUEs4H",errorText:"errorText-s3voUO",linkToInfo:"linkToInfo-S7mz4k",toastCard:"toastCard-r9ido1",toastLoadingCard:"toastLoadingCard-twMuk9",toastErrorCard:"toastErrorCard-FBzVqH"}}}]);