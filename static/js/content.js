var e,t,n,i={20881:(e,t,n)=>{const i=n(92774);e.exports={highlight:e=>i.bgHex("#FFBA6B").hex("#1F2329")(e),highlightOutput:e=>{},strong(...e){},info(...e){},error(...e){}}},77191:(e,t,n)=>{n.d(t,{C$:()=>_,J2:()=>y,M$:()=>v,Pt:()=>h,U8:()=>l,UJ:()=>A,Y_:()=>p,jI:()=>d,ml:()=>w});var i=n(44557),o=n(14065),s=n(9144),r=n(70405),a=n(67685);function l(e){return c.apply(this,arguments)}function c(){return(c=(0,o.A)((function*({conversationId:e="0",messageIds:t=[],switchMessageId:n="0"}){yield(0,r.S6)({method:"POST",url:`${a.Jk}/message/put_chat_record`,data:{conversation_id:e,tool_message_id:t,switch_message_id:n}})}))).apply(this,arguments)}function d(e){return u.apply(this,arguments)}function u(){return(u=(0,o.A)((function*(e){return(0,r.S6)({method:"POST",url:`${a.kD}/plugin/detect_lang`,params:(0,s.wH)(),data:{raw_text:e}})}))).apply(this,arguments)}function h(e,t){return m.apply(this,arguments)}function m(){return(m=(0,o.A)((function*(e,t,n=0){return(0,r.S6)({method:"POST",url:`${a.kD}/plugin/translate`,params:(0,s.wH)(),data:{raw_text:e,target_lang:t,source_lang:n},preventDefaultAuthAction:!0})}))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=(0,o.A)((function*(e){return(0,r.S6)({method:"POST",url:`${a.kD}/plugin/revise`,params:(0,s.wH)(),data:{items:e}})}))).apply(this,arguments)}function v(e){return f.apply(this,arguments)}function f(){return(f=(0,o.A)((function*(e){let t=(0,s.wH)();return e&&(t=(0,i.A)((0,i.A)({},t),{},{language:e})),(0,r.S6)({method:"POST",url:`${a.kD}/skill/recommend`,params:t})}))).apply(this,arguments)}function _(e){return x.apply(this,arguments)}function x(){return(x=(0,o.A)((function*(e){const t=(0,s.wH)();return(0,r.S6)({method:"POST",url:`${a.kD}/plugin/search/card_recommend`,params:t,data:e})}))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=(0,o.A)((function*(e){const t=(0,s.wH)();return(0,r.S6)({method:"POST",url:`${a.Jk}/user_voice/recommend`,params:t,data:e})}))).apply(this,arguments)}function w(e){return C.apply(this,arguments)}function C(){return(C=(0,o.A)((function*(e){const t=(0,s.wH)();return(0,r.S6)({method:"POST",url:`${a.kD}/image/ocr`,params:t,data:e})}))).apply(this,arguments)}function A(){return S.apply(this,arguments)}function S(){return(S=(0,o.A)((function*(){return yield(0,r.S6)({method:"POST",url:`${a.kD}/user/setting/get`,data:{ab_param:{ab_request:{extension_collection_entry:{parmas:["collection_ability","show_entry"],is_login:!0}}}}})}))).apply(this,arguments)}},70405:(e,t,n)=>{n.d(t,{S6:()=>c,sY:()=>a});var i=n(14065),o=n(16409),s=n(2573),r=n(44969);const a=function(){var e=(0,i.A)((function*(e,t){const{data:n,success:i,error:s}=yield(0,o.cs)({name:"http-request",body:{config:e,options:t}});return i?n:s}));return function(t,n){return e.apply(this,arguments)}}(),l=new Set([r.Be,r.BW]),c=function(){var e=(0,i.A)((function*(e,t){try{const{data:n,success:i,error:r}=yield(0,o.cs)({name:"http-request",body:{config:e,options:t}});if(l.has(`${null==n?void 0:n.code}`)&&s.A.emit("api-request-proxy-unAuthorized",{params:e,data:n}),!i)throw r;const{code:a,msg:c,data:d}=n;if(void 0!==a&&0!==a)throw new Error(JSON.stringify({message:`code invalid error: ${a}, ${c}`,code:a}));return d}catch(n){return n}}));return function(t,n){return e.apply(this,arguments)}}()},9144:(e,t,n)=>{n.d(t,{Ql:()=>c,wH:()=>l});var i=n(77591),o=n(44969),s=n(67976),r=n(67685);const a=()=>{const{ttWid:e,webId:t=""}=(0,i.bU)();return e?t:"0"},l=()=>{var e;const{country:t,teaWebId:n,teaUuid:l}=(0,i.bU)();return{version:o.rE,version_code:o.br,language:(0,s.XQ)(),browser_language:navigator.language,device_platform:r.lx,aid:r.sZ,pkg_type:r.eG,device_id:a(),web_id:null!==(e=null!=n?n:l)&&void 0!==e?e:"0",is_new_user:"0",region:t,sys_region:t,"use-olympus-account":1,samantha_web:"1",real_aid:r.sZ||""}},c=()=>{const e={},{isEnableDebug:t,extEnv:n}=(0,i.MI)();return t&&n&&(e["x-tt-env"]=n,e["production"===r.nD?"x-use-ppe":"x-use-boe"]="1"),e}},85563:(e,t,n)=>{n.d(t,{X:()=>s,w:()=>r});var i=n(77591),o=n(47730);const s=()=>{const[e]=(0,o.Y)("authInfo");return(null==e?void 0:e.isAuthenticated)||!1},r=()=>{const e=(0,i.TK)("authInfo");return(null==e?void 0:e.isAuthenticated)||!1}},22074:(e,t,n)=>{n.d(t,{CN:()=>r,Im:()=>u,L8:()=>h,O:()=>c,fv:()=>d,fx:()=>m,gm:()=>l,nr:()=>a});var i=n(9012),o=n(55322),s=n(77591);function r(){return"ontouchend"in document}const a=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),l=()=>{var e;return null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Samantha")},c=()=>{var e;return(null===(e=Intl)||void 0===e||null===(e=e.DateTimeFormat())||void 0===e||null===(e=e.resolvedOptions())||void 0===e?void 0:e.timeZone)||""},d=()=>{try{return Boolean(getComputedStyle(document.documentElement||document.body).getPropertyValue("--arc-palette-title"))}catch(e){return!1}};function u(){var e;const{url_list:t}=(0,s.tl)("lark_urls");return t.some((e=>location.href.includes(e)))||["feishu","lark"].includes(null===(e=window.globalConfig)||void 0===e||null===(e=e.common)||void 0===e?void 0:e.product)}function h(){return location.hostname.includes("notion.so")}const m=()=>a()?"safari":(()=>{var e;const t=(0,i.A)(navigator,"userAgentData.brands",[]);return null==t||null===(e=t.some)||void 0===e?void 0:e.call(t,(e=>["Chrome"].some((t=>{var n;return null==e||null===(n=e.brand)||void 0===n?void 0:n.includes(t)}))))})()?"chrome":(0,o.m)()?"360":d()?"arc":(()=>{var e;const t=(0,i.A)(navigator,"userAgentData.brands",[]);return null==t||null===(e=t.some)||void 0===e?void 0:e.call(t,(e=>["Chrome","Edge"].some((t=>{var n;return null==e||null===(n=e.brand)||void 0===n?void 0:n.includes(t)}))))})()?"edge":""},13464:(e,t,n)=>{n.d(t,{NS:()=>y,l5:()=>f,dp:()=>_,hj:()=>b,cQ:()=>m,gs:()=>h,vg:()=>x});var i=n(14065),o=n(18797);const s=new Map,r=["META","STYLE","SCRIPT","NOSCRIPT"];var a=n(24337),l=n(44969),c=n(98767),d=n(13162),u=n(67805);const h=()=>{var e;return(null===(e=document.head.querySelector("title"))||void 0===e?void 0:e.innerText)||""},m=(e,t)=>{if(!e||!t)return null;let n=e.parentElement;for(;n;){if(n.matches(t))return n;n=n.parentElement}return null},p=e=>{let t=e;return e.startsWith("webkit")&&(t=`-${t}`),t.replace(/([A-Z])/g,(function(e){return`-${e.toLowerCase()}`}))},g=(e,t,n,i,o,c=[])=>{try{var d;const{tagName:a}=e;if(r.includes(a))return;const u=e.getAttribute("class");if(null!=u&&u.includes(l.AC))return;if(c.find((e=>t.matches(e))))return;Object.keys(e.dataset||{}).forEach((t=>{e.removeAttribute(`data-${p(t)}`)}));const h=window.getComputedStyle(t);if("none"===h.display)return void i.push(e);if(Object.entries(h).forEach((t=>{const[n,i]=t;if(!i||!isNaN(Number(n)))return;const o=(e=>{const t=s.get(e);if(t)return t;const n=document.createElement("div"),i=n.attachShadow({mode:"open"}),o=document.createElement(e);o.style.cssText="color: initial;",i.appendChild(o),"A"===e&&o.setAttribute("href","https://www.ciciai.com/browser-extension/landing"),document.body.insertBefore(n,document.body.firstElementChild);const r=new Map,a=window.getComputedStyle(o);return Object.entries(a).forEach((e=>{const[t,n]=e;n&&isNaN(Number(t))&&!t.includes("font")&&r.set(t,n)})),s.set(e,r),n.remove(),r})(a).get(n);o!==i&&(e.style[p(n)]=i)})),null!==(d=e.style.backgroundImage)&&void 0!==d&&d.includes("url")){const t=e.style.backgroundImage.substring(5,e.style.backgroundImage.length-2),n=o.get(t);n?n.push(e):o.set(t,[e])}if("IMG"===a){const{src:t}=e,n=o.get(t);n?n.push(e):o.set(t,[e])}else if("A"===a&&"A"===t.tagName)e.setAttribute("href",null==t?void 0:t.href),e.setAttribute("target","_blank");else{if("SVG"===a)return;if("VIDEO"===a){const t=e.getAttribute("poster");if(t){const n=o.get(t);n?n.push(e):o.set(t,[e])}}}for(let s=0;s<t.children.length&&s<e.children.length;s++)n.pushTask((()=>g(e.children[s],t.children[s],n,i,o,c)))}catch(u){(0,a.z3)("[collection] cloneDom error: ",u)}},v=function(){var e=(0,i.A)((function*(e,t){if(e)try{const n=yield(0,c.n_)(e);if(null!=n&&n.blob){const e=yield(0,d.r)(n.blob);t.forEach((t=>t.setAttribute(u.$_,e)))}}catch(n){return void(0,a.z3)("[collection] uploadImage error",n,e)}}));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=(0,i.A)((function*(e,t=!0,n=[]){const i=new Map,s=[],c=[];try{(0,a.Rm)("[collection] start clone dom"),yield new Promise((r=>{const a=new o.E(r);e.forEach((e=>{const o=e.cloneNode(!0);if(t){const e=document.createElement("div");e.appendChild(o),c.push(e)}else c.push(o);a.pushTask((()=>g(o,e,a,s,i,n)))})),a.loop()})),(0,a.Rm)("[collection] start upload img"),yield Promise.race([Promise.all([...i].map((e=>v(e[0],e[1])))),new Promise((e=>{setTimeout((()=>{e(),(0,a.Rm)("[collection] uploadImage timeout")}),6e4)}))]),(0,a.Rm)("[collection] start remove useless tag"),s.forEach((e=>e.remove())),c.forEach((e=>{e.querySelectorAll(`[class*=${l.AC}]`).forEach((e=>e.remove())),r.forEach((t=>e.querySelectorAll(t.toLocaleLowerCase()).forEach((e=>e.remove())))),n.forEach((t=>e.querySelectorAll(t).forEach((e=>e.remove()))))}))}catch(d){(0,a.z3)("[collection] clone dom error: ",d)}return(0,a.Rm)("[collection] clone done"),c}));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=(0,i.A)((function*(e,t=!0,n=[]){const i=yield f([e],t,n);return i.length?i[0]:e.cloneNode(!0)}));return function(t){return e.apply(this,arguments)}}(),x=e=>{null!=e&&e.style&&(e.style.height="unset",e.style.minHeight="unset",e.style.blockSize="unset",e.style.minBlockSize="unset")},y=(e,t,n)=>{const i=document.createElement("div");i.innerHTML='<iframe\n  scrolling="no"\n  frameBorder="no"\n  allowFullScreen="true"\n  sandbox="allow-popups allow-same-origin"></iframe>';const o=i.querySelector("iframe");return o?(o.style.width="100%",o.style.height=`${t}px`,o.style.width=`${n}px`,o.srcdoc=`<html>\n        <head>\n          <style>\n            * {\n              cursor: unset !important;\n            }\n            body {\n              padding: 0;\n              margin: 0;\n            }\n            a {\n              cursor: pointer !important;\n            }\n          </style>\n        </head>\n        <body>\n          ${e}\n        </body>\n      </html>`,i.innerHTML):e},b=e=>{const t=document.createElement("div");return t.style.overflow="hidden",t.style.display="flex",t.style.alignItems="center",t.style.flexWrap="nowrap",t.style.flexDirection="column",t.style.width=`${e}px`,t}},44969:(e,t,n)=>{n.d(t,{$9:()=>g,AC:()=>T,AJ:()=>C,BW:()=>M,Be:()=>R,Cp:()=>c,EN:()=>w,EP:()=>d,GW:()=>A,JE:()=>u,LN:()=>O,M0:()=>v,OD:()=>E,Ow:()=>P,QN:()=>r,R3:()=>x,Tz:()=>j,U6:()=>b,Vn:()=>B,Xf:()=>N,Yq:()=>p,Zn:()=>D,aJ:()=>L,aS:()=>S,br:()=>l,j0:()=>m,ly:()=>y,o$:()=>s,o2:()=>h,px:()=>k,rE:()=>a,sp:()=>I,tI:()=>f,tm:()=>_,v:()=>F});var i=n(77793);function o(){return(0,i.A)().replaceAll("-","")}const s="cici_host_style",r="static/css/content_list.json",a="1.12.0",l=20650,c="/browser-extension",d=`${c}/login`,u=`${c}/welcome`,h=`${c}/landing`,m=`${c}/uninstall`,p=`${o()}`,g=`${o()}`,v=`${o()}`,f=`${o()}`,_=`${o()}`,x="doubao",y=`${x}-ai-csui`,b=`${x}-ai-search-engine-assistant`,w=`${x}-ai-collection-image-assistant`,C=`${x}-ai-mail-assistant`,A=`${x}-ai-revision-highlighter`,S=`${x}-ai-revision-popup-card`,k=`${x}-ai-vocabruary-popup-card`,E=`${x}-ai-pdf-assistant`,T=`${x}-ai-collection-assistant`,I=`${x}-ai-podcast-assistant`,j="flow-ai-assistant",N="ciciai-shadow-container",R="710022013",M="710012001",P="2147483647",L="86",B=634880,D="en-GB",O="en",F="flow-ext-chat-chunk-task-store"},80459:(e,t,n)=>{n.d(t,{Ig:()=>A,JL:()=>B,Ku:()=>S,NR:()=>y,QN:()=>j,ST:()=>L,V6:()=>N,VT:()=>_,XX:()=>C,YB:()=>b,YD:()=>k,ZL:()=>f,ZP:()=>I,jg:()=>R,lK:()=>P,mn:()=>E,ow:()=>T,qB:()=>O,yL:()=>D});var i=n(14065),o=n(9012),s=n(11855),r=n(75541),a=n(44300),l=n(39415),c=n(77591),d=n(24337),u=n(44969),h=n(22074),m=n(76813),p=n(75943),g=n(77259);function v(e){e.stopPropagation()}function f(){const e=g.j.getContainerById("common-inner-popup-container");if(null!=e&&e.parentElement)return;const t=document.createElement("div");t.style.width="0",t.style.height="0",t.style.position="absolute",t.style.zIndex="200000";const n=t.attachShadow({mode:"open"}),i=document.createElement("body");i.id="cici-inline-container";const o=document.createElement("div");o.classList.add("cici-ext-container","semi-always-light","cici-ext-always-light"),n.appendChild(i),i.appendChild(o),document.body.prepend(t),g.j.recordContainer("common-inner-popup-container",t,n,o),y(n,u.QN)}const _=e=>{const t=(0,m.id)(),n=document.createElement(e);var i;t||(n.id=u.Yq),i=n,["click","copy","cut","paste","keydown","keyup","keypress"].forEach((e=>{i.addEventListener(e,v,!1)}));const o=n.attachShadow({mode:t?"closed":"open"}),s=document.createElement("div");if((0,l.nr)())s.setAttribute("aria-label",u.Tz);else if(t){if(t){const{children:e}=(0,c.tl)("assistant_mount_config");null==e||e.forEach((e=>{const t=document.createElement(e.tag);e.attr.forEach((e=>{t.setAttribute(e[0],e[1])}));try{t.innerHTML=(0,a.D4)(e.content)}catch(i){t.innerHTML=e.content}n.appendChild(t)}))}}else n.setAttribute("aria-label",u.Tz);s.id=u.Xf,s.classList.add("cici-ext-container"),s.style.zIndex=(0,h.Im)()?u.aJ:u.Ow,s.style.position="absolute";let r=0,d=0;if("relative"===window.getComputedStyle(document.body).position){const e=document.body.getBoundingClientRect(),t=document.documentElement.getBoundingClientRect(),n={top:t.top-e.top,left:t.left-e.left};r+=n.top,d+=n.left}return s.style.top=`${r}px`,s.style.left=`${d}px`,s.style.visibility="visible",o.appendChild(s),g.j.recordAssistantContainer(n,o,s),{shadowHost:n,shadowRoot:o,shadowContainer:s}};let x;const y=function(){var e=(0,i.A)((function*(e,t){try{if(!x){const e=yield fetch(chrome.runtime.getURL(t)),n=(yield e.json()).content_css,i=yield Promise.all(n.map((e=>fetch(chrome.runtime.getURL(e)))));x=Promise.all(i.map((e=>e.text()))).then((e=>e.join("\n")))}const n=document.createElement("style");n.className=u.o$,n.textContent=yield x,e.prepend(n)}catch(n){d.z3(`Error applying styles: ${n.message}`,n)}}));return function(t,n){return e.apply(this,arguments)}}();const b=e=>{document.body.appendChild(e)};let w;const C=(e,t)=>{if(w)try{w.unmount()}catch(n){d.Rm({message:"unmount fail",error:n})}w=(0,r.createRoot)(e),w.render(s.createElement(t)),(0,p.A)((()=>{var e;null===(e=w)||void 0===e||e.unmount(),w=void 0}))};function A(e,t){var n;const i=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0,cancelable:!0});null===(n=i.clipboardData)||void 0===n||n.setData("text/plain",e),t.dispatchEvent(i)}function S(e){return e&&("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName)}function k(e){if(S(e))return!0;let t=e;for(;t&&!t.isContentEditable;)t=t.parentElement;return Boolean(t)}function E(e){if(!e.isContentEditable){let n=e.parentElement;for(let i=0;i<10&&n;i++){var t;if(null!==(t=n)&&void 0!==t&&t.isContentEditable){e=n;break}n=n.parentElement}}if(e.isContentEditable){let t=e;for(;null!==(n=t)&&void 0!==n&&null!==(n=n.parentElement)&&void 0!==n&&n.isContentEditable;){var n;t=t.parentElement}return t}return null}function T(e){const t=getComputedStyle(e);return!("0"===t.opacity||"none"===t.display||"hidden"===t.visibility)}function I(){return!/\.(google|baidu|bing)\.com/.test(location.hostname)}function j(e){const t=e;return("INPUT"===t.tagName&&["text","search",""].includes(t.type)||"TEXTAREA"===t.tagName)&&!(t.disabled||t.readOnly)}function N(e,t){let n=null,i=null;const s=(0,o.A)(t,"maxWait",1e3);function r(){n&&(clearInterval(n),n=null)}return new Promise((a=>{const l=()=>{const n=(0,o.A)(t,"wrapper",document).querySelector(e);n&&(r(),i&&(clearTimeout(i),i=null),a(n))};n=window.setInterval(l,100),i=window.setTimeout((()=>{r(),a(null)}),s),l()}))}function R(e){let t=e;const n=g.j.getAssistantContainer();for(;t;){if(t===n)return!0;t=t.parentElement}return!1}const M={};function P(e){Object.assign(M,e);const t=function(){const e=document.getElementById("feature-flags");if(e)return e;const t=document.createElement("div");return t.id="feature-flags",t.style.width="0px",t.style.height="0px",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.display="none",document.body.appendChild(t),t}();if(t){const e=[];Object.keys(M).forEach((n=>{M[n]?(t.classList.add(n),e.push(n)):t.classList.remove(n)})),t.setAttribute("aria-description",e.join(" "))}}const L=e=>e instanceof Element&&"STYLE"===e.tagName.toUpperCase(),B=e=>e instanceof Element&&"LINK"===e.tagName.toUpperCase(),D=e=>e instanceof Element&&"SCRIPT"===e.tagName.toUpperCase(),O=e=>8===e.nodeType},2573:(e,t,n)=>{n.d(t,{A:()=>i});const i=new(n(60588).b)},91376:(e,t,n)=>{n.d(t,{I$:()=>s,gp:()=>r,ku:()=>o});var i=n(77591);n(22074);const o=()=>{var e;return null===(e=(0,i.TK)("collectionConfig"))||void 0===e?void 0:e.showEntry},s=()=>(0,i.tl)("search_addons").feed_card_show,r=()=>{var e;return null===(e=(0,i.tl)("tts"))||void 0===e?void 0:e.ttsReadPageEnabled}},59517:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(11855);function o(e,t){const n=(0,i.useRef)(null),o=i=>{var o;const s=null===(o=i.composedPath)||void 0===o?void 0:o.call(i);if(t){const n=t();s&&n&&!s.includes(n)&&e(i)}else s&&n.current&&!s.includes(n.current)&&e(i)};return(0,i.useEffect)((()=>(document.addEventListener("pointerdown",o),()=>{document.removeEventListener("pointerdown",o)})),[t]),n}},27609:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(11855),o=n(93804);const s=()=>(0,i.useContext)(o.A)},93804:(e,t,n)=>{n.d(t,{A:()=>i});const i=(0,n(11855).createContext)(null)},41659:(e,t,n)=>{n.d(t,{Ay:()=>c,N:()=>r,Vk:()=>l,nW:()=>s});var i=n(14065),o=n(11855);const s=e=>/^https:\/\/mail\.google\.com\/mail\/u\/\d+\//.test(e),r=e=>{if("gmail"!==e)return[];const t=[],n=document.querySelectorAll('[class="btC"]');for(const o of n){var i;const e=o.parentElement;if(!e)continue;const n=null===(i=e.closest("tr"))||void 0===i||null===(i=i.previousElementSibling)||void 0===i||null===(i=i.querySelector('[hidefocus="true"]'))||void 0===i?void 0:i.parentElement;n&&t.push([e,n])}return t},a=e=>{const t='[class="btC"]';return!(!e.matches(t)&&!e.matches(`:has(${t})`))},l=(0,o.createContext)(null),c=e=>{if(s(e)){return{name:"gmail",watchMailWritable:e=>{const t=new MutationObserver((function(t){for(const n of t)"childList"===n.type&&n.addedNodes.length>0&&n.addedNodes.forEach(function(){var t=(0,i.A)((function*(t){yield new Promise((e=>setTimeout(e,50))),t instanceof HTMLElement&&a(t)&&e()}));return function(e){return t.apply(this,arguments)}}())}));return t.observe(document.body,{childList:!0,subtree:!0}),()=>{t.disconnect()}}}}return null}},37358:(e,t,n)=>{n.d(t,{Iq:()=>d,UL:()=>c});var i=n(44557),o=n(14065),s=n(33451),r=n(24337),a=n(76360);const l=["tabId"];function c(e,t=1e4){const{tabId:n}=e,i=(0,s.A)(e,l);return Promise.race([new Promise((e=>{try{chrome.tabs.sendMessage(n,i,(t=>{var n;chrome.runtime.lastError?("tab-activated"!==i.name&&(0,r.z3)(`[ms][bg][runtime.lastError]${i.name}`,chrome.runtime.lastError),e({success:!1,error:new Error(`[${i.name}]${null===(n=chrome.runtime.lastError)||void 0===n?void 0:n.message}`),data:t})):null!=t&&t.__hasError?e({success:!1,error:new Error(t.errorMessage)}):e({success:!0,data:t})}))}catch(t){e({success:!1,error:t})}})),new Promise((e=>{setTimeout((()=>e({success:!1,error:new Error("timeout")})),t)}))])}function d(e){return u.apply(this,arguments)}function u(){return(u=(0,o.A)((function*(e,t=1e4){const n=yield(0,a.e6)();if(!n)return Promise.resolve({success:!1,data:{}});const o="string"==typeof e?{name:e}:e;return c((0,i.A)({tabId:n.id},o),t)}))).apply(this,arguments)}},16409:(e,t,n)=>{n.d(t,{Iq:()=>o.Iq,UL:()=>o.UL,cs:()=>i.c});var i=n(44963),o=n(37358)},75882:(e,t,n)=>{n.d(t,{F:()=>a,c:()=>l});var i=n(14065),o=n(10633),s=n(91689),r=n(24337);const a=new class{constructor(){var e,t;(0,o.A)(this,"handlers",{}),(0,o.A)(this,"interceptors",[]),null===(e=chrome)||void 0===e||null===(e=e.runtime)||void 0===e||null===(e=e.onMessage)||void 0===e||null===(t=e.addListener)||void 0===t||t.call(e,this.onMessage.bind(this)),this.interceptors=[],this.handlers={}}onMessage(e,t,n){let o=!1;this.interceptors.forEach((i=>{o=o||Boolean(i.onMessage(e,t,n))}));const s=this.handlers[e.name];var a;return(0,r.Rm)(`[runtime] onMessage -> [${e.name}][${s?"yes":"no"}] `,e.body||""),!!s&&(!s.preCheck||null!==(a=s.preCheck)&&void 0!==a&&a.call(s,t)?((0,i.A)((function*(){try{const i=yield s.handle(e.body,t);n(i)}catch(i){n({__hasError:!0,errorMessage:`${i.message}[${e.name}]`})}}))(),!0):o)}supportExternal(){var e,t;null===(e=chrome)||void 0===e||null===(e=e.runtime)||void 0===e||null===(e=e.onMessageExternal)||void 0===e||null===(t=e.addListener)||void 0===t||t.call(e,this.onMessage.bind(this))}register(e){const{name:t}=e||{};t&&(this.handlers[t]&&(0,r.z3)(`[runtime] handler name[${t}] duplicated !`),(0,r.Rm)(`[runtime] register handler for event: [${t}]`),this.handlers[t]=e)}unregister(e){delete this.handlers[e]}injectInterceptor(e){this.interceptors.push(e)}destroy(){this.handlers={},this.interceptors=[];try{chrome.runtime.onMessage.removeListener(this.onMessage)}catch(e){}}},l=e=>{const t=(0,s.A)(e)?e:[e];return t.forEach((e=>{a.register(e)})),()=>{t.forEach((e=>{a.unregister(e.name)}))}}},96638:(e,t,n)=>{n.d(t,{AA:()=>m,EU:()=>i,HO:()=>o,Hh:()=>u,I8:()=>g,R1:()=>s,Tz:()=>c,WN:()=>h,Xt:()=>p,YN:()=>_,_8:()=>y,aX:()=>l,em:()=>x,fS:()=>v,tE:()=>f,y3:()=>a});var i={search:"search",read:"read",pronounce:"pronounce",explain:"explain",translate:"translate",summarize:"summarize",grammar:"grammar",rewrite:"rewrite",ask:"browser_ask",browser_explain:"browser_explain",youtube:"youtube",mail:"browser_mail",copy:"copy",browser_plugin_info:"browser_plugin_info",input_skill:"input_skill",collect:"collect",adjust_skill:"adjust_skill"};[{cnName:"\u200b\u4e2d\u6587\u200b",enName:"Chinese\u200b",name:"\u4e2d\u6587",lang:"zh"},{cnName:"\u82f1\u6587\u200b",enName:"English\u200b",name:"English",lang:"en"},{cnName:"\u65e5\u8bed\u200b",enName:"Japanese\u200b",name:"\u65e5\u672c\u8a9e",lang:"ja"},{cnName:"\u97e9\u8bed\u200b",enName:"Korean\u200b",name:"\ud55c\uad6d\uc5b4",lang:"ko"},{cnName:"\u6cd5\u8bed\u200b",enName:"French\u200b",name:"Fran\xe7ais",lang:"fr"},{cnName:"\u5fb7\u8bed\u200b",enName:"German\u200b",name:"Deutsch",lang:"de"},{cnName:"\u897f\u73ed\u7259\u8bed\u200b",enName:"Spanish\u200b",name:"Espa\xf1ol",lang:"es"},{cnName:"\u4fc4\u8bed\u200b",enName:"Russian\u200b",name:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",lang:"ru"},{cnName:"\u610f\u5927\u5229\u8bed\u200b",enName:"Italian\u200b",name:"Italiano",lang:"it"},{cnName:"\u8461\u8404\u7259\u8bed\u200b",enName:"Portuguese\u200b",name:"Portugu\xeas",lang:"pt"},{cnName:"\u8377\u5170\u8bed\u200b",enName:"Dutch\u200b",name:"Nederlands",lang:"nl"},{cnName:"\u745e\u5178\u8bed\u200b",enName:"Swedish\u200b",name:"Svenska",lang:"sv"},{cnName:"\u4e39\u9ea6\u8bed\u200b",enName:"Danish\u200b",name:"Dansk",lang:"da"},{cnName:"\u632a\u5a01\u8bed\u200b",enName:"Norwegian\u200b",name:"Norsk",lang:"no"},{cnName:"\u6ce2\u5170\u8bed\u200b",enName:"Polish\u200b",name:"Polski",lang:"pl"},{cnName:"\u5e0c\u814a\u8bed\u200b",enName:"Greek\u200b",name:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",lang:"el"},{cnName:"\u571f\u8033\u5176\u8bed\u200b",enName:"Turkish\u200b",name:"T\xfcrk\xe7e",lang:"tr"},{cnName:"\u8d8a\u5357\u8bed\u200b",enName:"Vietlangse\u200b",name:"Ti\u1ebfng Vi\u1ec7t",lang:"vi"},{cnName:"\u6cf0\u8bed\u200b",enName:"Thai\u200b",name:"\u0e44\u0e17\u0e22",lang:"th"},{cnName:"\u5370\u5730\u8bed\u200b",enName:"Hindi\u200b",name:"\u0939\u093f\u0928\u094d\u0926\u0940\u200b",lang:"hi"}].reduce(((e,t)=>(e[t.lang]=t.name,e)),{});const o=[{id:i.ask,prompt:"",name:"flow_web_ext_action_ask",icon:"searchAI"},{id:i.explain,prompt:"\u89e3\u91ca\u8fd9\u6bb5\u6587\u672c: \n\u201d\u201d\u201d\n$[text]\n\u201d\u201d\u201d",name:"flow_web_ext_action_explain",icon:"explain"},{id:i.translate,prompt:"\u628a\u4e0b\u9762\u8fd9\u6bb5\u6587\u672c\u7ffb\u8bd1\u6210\u76ee\u6807\u8bed\u8a00: $[lang]\u3002\u9700\u8981\u7ffb\u8bd1\u7684\u5185\u5bb9\u662f: \n\u201d\u201d\u201d\n$[text]\n\u201d\u201d\u201d",name:"flow_web_ext_action_translate",icon:"IconTranslateOutline"},{id:i.pronounce,prompt:"",name:"\u6717\u8bfb",icon:"IconPlayAudio"},{id:i.summarize,prompt:"\u603b\u7ed3\u4ee5\u4e0b\u5185\u5bb9: \n\u201d\u201d\u201d\n$[text]\n\u201d\u201d\u201d",name:"flow_web_ext_action_summarize",icon:"summarize"},{id:i.grammar,prompt:"\u6821\u5bf9\u5e76\u7ea0\u6b63\u8fd9\u6bb5\u6587\u5b57: \n\u201d\u201d\u201d\n$[text]\n\u201d\u201d\u201d",name:"flow_web_ext_action_grammar",icon:"check"},{id:i.adjust_skill,prompt:"\u91cd\u65b0\u8868\u8ff0\u8fd9\u6bb5\u6587\u5b57, \u4f7f\u8fd9\u6bb5\u6587\u5b57\u8868\u8ff0\u7684\u66f4\u52a0\u5408\u7406: \n\u201d\u201d\u201d\n$[text]\n\u201d\u201d\u201d",name:"modify_change_tone",icon:"adjust_skill"},{id:i.copy,prompt:"",name:"message_long_press_copy",icon:"copy"},{id:i.collect,prompt:"",name:"flow_web_ext_action_bookmarks",icon:"collect",options:{brand:"\u8c46\u5305"}}],s=[i.ask,i.grammar,i.rewrite,i.adjust_skill],r=[i.grammar,i.rewrite,i.explain,i.translate,i.copy,i.adjust_skill],a=new Set([i.ask]),l=[i.explain,i.translate,i.pronounce,i.collect],c=[i.copy],d=new Set([i.summarize]),u=(e=[])=>o.filter((t=>l.includes(t.id)&&!d.has(t.id)&&!e.includes(t.id))),h=(e=[])=>o.filter((t=>c.includes(t.id)&&!d.has(t.id)&&!e.includes(t.id))),m=[i.grammar,i.rewrite,i.collect,i.pronounce,i.adjust_skill],p=[i.explain,i.translate,i.copy],g=(e=[])=>o.filter((t=>m.includes(t.id)&&!d.has(t.id)&&!e.includes(t.id))),v=(e=[])=>o.filter((t=>p.includes(t.id)&&!d.has(t.id)&&!e.includes(t.id))),f=e=>(e||o).filter((e=>r.includes(e.id))),_=o.reduce(((e,t)=>(e[t.id]=t,e)),{});const x=e=>!_[e],y=e=>{const t=_[e];return Boolean(t)}},15965:(e,t,n)=>{n.d(t,{B9:()=>u,CC:()=>c,GA:()=>d,Tp:()=>l});var i=n(89586);const o=10485760,s=new RegExp("^https?:\\/\\/www\\.zhihu\\.com\\/question\\/\\d+");function r(){s.test(location.href)&&(i.Readability.prototype.REGEXPS.negative=/-ad-|^kfecollection-viprecommendcard$|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i)}const a={charThreshold:500,keepClasses:!1};function l(e,t=o){const n=(e=e||document).cloneNode(!0);r();const s=new i.Readability(n,a).parse();return s&&s.content.length>t&&s.content.slice(0,t),s}function c(e){const t=(e=e||document).cloneNode(!0);r();const n=new i.Readability(t,a).parse();return n&&(n.content=""),n}function d(){return new Promise((e=>{if("complete"===document.readyState||"interactive"===document.readyState)e();else{const t=()=>{document.removeEventListener("DOMContentLoaded",t),e()};document.addEventListener("DOMContentLoaded",t)}}))}function u(e){return d().then((()=>l(document,e)))}},23362:(e,t,n)=>{n.d(t,{Ay:()=>s,mn:()=>o});var i=n(11855);const o=(0,i.createContext)(null),s=e=>/^http(s)?:\/\/www.baidu.com\//.test(e)?{name:"baidu",inputQuery:["input[name='wd']"],searchTag:"#searchTag",sidebarContainerQuery:"#content_right",searchParam:"wd",watchRouteChange:e=>{const t=document.getElementById("wrapper_wrapper");if(!t)return;const n=new MutationObserver((function(t){for(const n of t){if("childList"!==n.type)break;for(const t of n.addedNodes)if("container"===(null==t?void 0:t.id))return void e()}}));return n.observe(t,{childList:!0}),()=>{n.disconnect()}}}:/^https:\/\/www.google.com?(?:.\w+)?\/search\?/.test(e)?{name:"google",inputQuery:["input[name='q']","textarea[name='q']"],sidebarContainerQuery:"#rhs",searchParam:"q",customAppend(){if("lcl"===((e,t)=>new URL(t).searchParams.get(e))("tbm",window.location.href))return null;let e=document.querySelector(this.sidebarContainerQuery);if(!e){const t=document.querySelector("#rcnt");t&&(e=document.createElement("div"),e.id="rhs",e.style.width="368px",e.style.marginLeft="24px",t.appendChild(e))}return e}}:/^https:\/\/so.toutiao.com\/search\?/.test(e)?{name:"toutiao",inputQuery:["input[type='search']"],sidebarContainerQuery:".s-side-list",searchParam:"keyword",disabled:()=>!0}:/^https:\/\/\w+.bing.com\/search\?/.test(e)?{name:"bing",inputQuery:["[name='q']"],sidebarContainerQuery:"#b_context",searchParam:"q",containerStyle:{minWidth:470,marginLeft:-20},getPageContent:()=>[]}:null},64123:(e,t,n)=>{n.d(t,{AI:()=>m,Lj:()=>d,ZV:()=>a,jv:()=>u,o:()=>c,vK:()=>l});var i=n(7685),o=n.n(i),s=n(4252);const r=(()=>{let e=null;return()=>(null===e&&(e="macos"===o().getParser(navigator.userAgent).getOSName(!0)),e)})();function a(e){const t=r();switch(e){case s.e.OpenSide:return t?`${l.Command}+K`:`${l.Ctrl}+K`;case s.e.TranslatePage:return t?`${l.Option}+1`:`${l.Alt}+1`;case s.e.ReadPage:return t?`${l.Option}+2`:`${l.Alt}+2`;case s.e.HoverTextTranslate:return t?`${l.Command}`:`${l.Ctrl}`;case s.e.ScreenCapture:return t?`${l.Option}+3`:`${l.Alt}+3`;case s.e.CollectPage:return t?`${l.Option}+4`:`${l.Alt}+4`;case s.e.TTSReadPage:return t?`${l.Option}+5`:`${l.Alt}+5`;case s.e.VoiceInput:return"B";case s.e.BilingualSubtitles:return"H";default:return""}}let l=function(e){return e.Command="Command",e.Windows="Windows",e.Ctrl="Ctrl",e.Alt="Alt",e.Option="Option",e.Shift="Shift",e}({});function c(e){return e.split("+").map((e=>{switch(e){case l.Command:return"Cmd";case l.Windows:return"Win";case l.Option:return"Opt";default:return e}})).join(" + ")}function d(e){let t="";const n=e.match(/^Key(\w)$/),i=e.match(/^Digit(\d)$/);return(n||i)&&(n&&(t+=n[1]),i&&(t+=i[1])),t}let u=function(e){return e.Command="Command",e.Option="Option",e}({});const h={[u.Command]:{macKey:l.Command,winKey:l.Ctrl},[u.Option]:{macKey:l.Option,winKey:l.Alt}},m=e=>{const t=h[e];return r()?t.macKey:t.winKey}},77591:(e,t,n)=>{n.d(t,{Fc:()=>L,LR:()=>T,MI:()=>B,TK:()=>R,bU:()=>U,gv:()=>P,lv:()=>I,n5:()=>O,pu:()=>F,tl:()=>M,ue:()=>D,vE:()=>N});var i,o=n(14065),s=n(44557),r=n(22234),a=n(97724),l=n(39415),c=n(88090),d=n(87648),u=n(31826),h=n(59186),m=n(53262),p=n(98801),g=n(10242),v=n(96638),f=n(44969),_=n(41753),x=n(29988),y=n(58980),b=n(12710);const w=(0,m.c)();let C=(0,c.wz)(w);C===f.Zn&&(C=f.LN);let A=w;A===f.Zn&&(A=f.LN);const S={vocabruaryDisableAll:!0,vocabruaryDisableHosts:[],vocabruaryHighlightColor:b.Bx[4][0],vocabruaryOnboarding:!0,videoSubtitleDisableAll:!1,videoSubtitleDisableHosts:[],videoImmersionDisableAll:!1,videoImmersionDisableHosts:[],videoSummaryDisableAll:!1,videoMemoDisableAll:!1,videoMemoDisableHosts:[],videoSummaryDisableHosts:[],podcastSummaryDisableAll:!1,podcastSummaryDisableHosts:[],chatFloatCardDisableAll:!1,chatFloatCardDisableHosts:[],sidebarButtonDisabledAll:!1,sidebarButtonDisabledHosts:[],searchDisabledAll:!1,searchDisabledHosts:[],disableSearchAddonsGlobal:!0,disableSearchAddonsHosts:[],autoTranslatePageHosts:[],disableGlobalGrammar:!(0,l.UP)(),disableGrammarHosts:[],InputAssistantDisabledAll:!1,InputAssistantDisabledHosts:[],replyAssistantDisabledAll:!1,replyAssistantDisabledHosts:[],sidebarButtonTop:.5,sidebarButtonPosition:"right",inputAssistantLang:"zh",quickDisabledAll:!1,quickDisabledHosts:[],translateLanguage:C,autoTranslateSubtitles:!0,subtitleTranslateLang:"system",selectBarOnlyIcon:!1,pageTranslateService:y.c$.MICROSOFT,selectTranslateService:y.c$.DOUBAO,pageTranslateShowUnderline:!1,linkPreviewDisabledAll:!1,linkPreviewDisabledHosts:[],hoverTranslateSetting:y.X0.NO_TRANSLATE,inputTranslateInfo:{isFirstUse:!0,language:"en",showInputInnerTips:!0,translateService:y.c$.HUOSHAN,hotKeyCode:y.WR.Space,disableAll:!0},readingPopupActions:{actionList:(0,v.Hh)(),moreActionList:(0,v.WN)()},editingPopupActions:{actionList:(0,v.I8)(),moreActionList:(0,v.fS)()},transPreferConfig:{tipShown:!1,langMap:{}},collectImageDisabledAll:!1,collectImageDisabledHosts:[],socialWebcollectDisabledAll:!1,mediaCardTranslateLanguage:A,readWebPageCtxConfig:{enabled:!0,hasWebPageContextDialogShow:!0,hasUserSwitched:!1}},k=(Object.keys(S),(0,s.A)((0,s.A)({},S),{},{uuid:"",installReason:"",synced:!1,authInfo:{isAuthenticated:!1},launchInfo:{},launchConfig:{},abTestValue:{},chatInfo:{},debugInfo:{isEnableDebug:!1,webEnv:"",extEnv:""},requestCommonParams:{},shortcutsConfig:g.A,actions:v.HO,themeMode:y.lG.AUTO,uiLanguage:w,voiceSpeaker:h.F,sidePanelEnabled:!0,hostId:"",PopupListMaxCount:4,onboardingActionRecord:(0,u.wG)(),isSelectbarMoreMenuClicked:!1,needOpenSideBar:!1,featureInfo:null,collectionConfig:(0,_.i)(),tabConversationMap:{},isHistoryChatsClicked:!1,appSettings:p.K,overseaAccessibility:{},doubaoNoticeKey:"",searchUsageTimesInfo:{},voiceSettingTipShown:!1,isArc:!1,dismissUpdateKey:"",navigatorLanguage:(null===(i=navigator)||void 0===i?void 0:i.language)||"",voiceInputShortcutTipShown:!1}));let E=()=>{};const T=()=>{var e;null===(e=E)||void 0===e||e()},I=function(){var e=(0,o.A)((function*(){E=yield(0,d.X)(k),k.synced=!0}));return function(){return e.apply(this,arguments)}}(),j=(e,t,n=!1)=>{const i=k[e];return k[e]=n?(0,a.A)(i,t):t,x.A.set(e,k[e])},N=j;function R(e){return k[e]}const M=e=>{const t=R("appSettings")[e];return(0,r.A)(t,p.K[e])},P=()=>k.shortcutsConfig;function L(){return k.authInfo}function B(){return k.debugInfo}function D(){return k.launchInfo}function O(){return k.chatInfo}function F(e,t=!1){return j("chatInfo",e,t)}function U(){return k.requestCommonParams}},29988:(e,t,n)=>{n.d(t,{A:()=>s,q:()=>o});var i=n(67593);const o="local",s=new i.w({area:o})},5842:(e,t,n)=>{n.d(t,{$D:()=>_,IK:()=>b,hC:()=>x,u3:()=>y});var i=n(14065),o=n(85371),s=n(98502),r=n(12648),a=n(27527),l=n(10484),c=n(75484),d=n(96092),u=n(77591),h=n(24337),m=n(21559),p=n(47730),g=n(82770),v=n(52833);const f=()=>c.pU.getState().addNewLocalConversation({conversation:{conversation_type:r.Cr.CocoWebSub},conversationId:void 0}),_=function(){var e=(0,i.A)((function*(){const{convId:e,convType:t,mainBotId:n}=b(),i=t===l.H.NewThread;let s=e;try{if(i){var r;if(s=null===(r=(yield a.j.apiService.samantha.ThreadCreate({bot_id:n})).data)||void 0===r||null===(r=r.thread_info)||void 0===r||null===(r=r.conversation)||void 0===r?void 0:r.conversation_id,(0,o.A)(s))return void(0,h.z3)("[zx] create sub conversation failed, returned conversationId not valid",s);x(s)}}catch(c){throw m.vF.persist.error({message:"thread_create_failed",error:c}),c}return s}));return function(){return e.apply(this,arguments)}}(),x=e=>{const{tabId:t}=v.on.getState().tabInfo;t?(((e,t,n)=>{if(!(0,u.TK)("authInfo").isAuthenticated)return;const i=(0,u.TK)("tabConversationMap");(0,u.vE)("tabConversationMap",Object.assign({},i,{[e]:{conversationId:t,conversationType:n}}))})(t,e,l.H.Conversation),v.on.getState().setTabInfo({tabId:t})):(0,h.z3)("[zx] tabId not valid",t)};function y(){const{tabId:e}=(0,v.on)((e=>e.tabInfo)),[t]=(0,p.Y)("authInfo"),[n]=(0,p.Y)("chatInfo"),{value:i}=(0,g.Tu)(g.FM.enableNewChat,!1);var o;if(!t.isAuthenticated||!i||!e)return{tabId:e,convId:null===(o=n.mainConversation)||void 0===o?void 0:o.conversation_id,convType:l.H.Conversation};const a=(0,u.TK)("tabConversationMap"),m=a?a[e]:void 0;var _;if(a||((0,h.z3)("[zx] tabConvMap not init"),(0,u.vE)("tabConversationMap",{})),m&&""!==m.conversationId)return m.conversationType!==l.H.NewThread||null!==(_=c.pU.getState().localConversationMap[m.conversationId])&&void 0!==_&&_.local||c.pU.setState((0,s.jM)((e=>{e.localConversationMap[m.conversationId]={local:{createStatus:d.Et.Pending},conversation_type:r.Cr.CocoWebSub}}))),{tabId:e,convId:m.conversationId,convType:m.conversationType};const x=f();return(0,u.vE)("tabConversationMap",Object.assign({},a,{[e]:{conversationId:x,conversationType:l.H.NewThread}})),{tabId:e,convId:x,convType:l.H.NewThread}}function b(){var e;const t=(0,u.TK)("authInfo"),{mainConversation:n}=(0,u.TK)("chatInfo"),i=(0,g.Mz)(g.FM.enableNewChat,!1),o=null==n?void 0:n.bot_id;if(!t.isAuthenticated||!i)return{convId:null==n?void 0:n.conversation_id,convType:l.H.Conversation,mainBotId:o};const{tabId:s}=v.on.getState().tabInfo;if(!s){return{convId:null==n?void 0:n.conversation_id,convType:l.H.Conversation,mainBotId:o}}const r=(0,u.TK)("tabConversationMap"),a=void 0===r[s]?l.H.NewThread:r[s].conversationType;return{convId:null===(e=r[s])||void 0===e?void 0:e.conversationId,convType:a,mainBotId:o}}},36897:(e,t,n)=>{n.d(t,{Ay:()=>d,jB:()=>l,un:()=>c});var i=n(85886),o=n(11855),s=n(77591);let r=window.location.href;const a={youtube:/^https:\/\/www.youtube.com\/watch\?/,bilibili:/^https:\/\/www\.bilibili\.com\/video\/\w+/},l=e=>!!e&&a[e].test(location.href),c=(0,o.createContext)(null),d=e=>/^https:\/\/www.youtube.com\//.test(e)?{name:"youtube",sidebarContainerQuery:"#columns #secondary",searchParam:"v",customAppend:()=>{const e=document.querySelector("#fixed-columns-secondary #secondary");return e||null}}:/^https:\/\/www\.bilibili\.com\/video\/\w+/.test(e)?function(){const{bilibili_mount_config:e}=(0,s.tl)("video_assistant");return{name:"bilibili",sidebarContainerQuery:e.container_selector,mountPosition:e.mount_position,customAttr:e.custom_attr,searchParam:"v",pageIsReady:e=>{const t=(0,i.A)((()=>{const t=document.querySelector(".bui-dropdown-name");null!=t&&t.textContent&&document.querySelector("bili-comments")&&e()}),500,{leading:!0,trailing:!0}),n=new MutationObserver(t);return n.observe(document.body,{childList:!0}),()=>{n.disconnect()}},onUrlChange:e=>{const t=setInterval((function(){window.location.href!==r&&(e(),r=window.location.href)}),1e3);return()=>{window.clearInterval(t)}}}}():null},86785:(e,t,n)=>{n.d(t,{A:()=>y,u:()=>x});var i=n(85335),o=n(11855),s=n(29019),r=n.n(s),a=n(57214),l=n(34944),c=n(66351),d=n(67685),u=n(78503),h=n(17933),m=n(56397),p=n(64353),g=n(59517),v=n(47730),f=n(16464),_=n(63159);const x=({disabledScene:e,disableKey:t=u.lf.selectAssistant,onClickItem:n,onDisableOnceClick:o,optionPageSection:s})=>{const c=(0,a.B)(),[,g]=(0,v.Y)(d.zs[t].global),[x,y]=(0,v.Y)(d.zs[t].page);return(0,_.jsxs)(l.ms.Menu,{children:[d._E.filter((t=>!(null!=e&&e.includes(t.key)))).map((e=>(0,_.jsx)(l.ms.Item,{onClick:()=>(e=>{if((0,h.jk)(e.key,t),null==n||n(),"page"===e.key){const e=window.location.host;x.includes(e)||x.unshift(e),y([...x])}else"global"===e.key?g(!0):o()})(e),"data-testid":`disable-settings-role-${e.key}`,className:f.A.dropItem,children:(0,_.jsx)("span",{className:r()(f.A.name,"disable-menu-item-name"),children:c(e.name)})},e.id))),(0,_.jsx)("p",{className:r()(f.A.info,"disable-footer-info"),children:(0,_.jsxs)(i.x,{i18nKey:"flow_web_ext_setting_reopen",children:["Reopen in",(0,_.jsx)("span",{className:f.A.link,onClick:()=>(0,p.I)({enter_method:m.cz.disableMenu,settting_key:s}),children:"\xa0setting \xa0"})]})})]})},y=e=>{const{optionPageSection:t="",position:n="bottomRight",disableKey:i=u.lf.selectAssistant,className:s,dropdownClassName:a,show:d,setShow:m,cssStyle:p,closeClick:v,renderChildren:y,spacing:b=4,onDisableOnceClick:w,disabledScene:C=[],getPopupContainer:A,getPopupRootContainer:S,children:k,onOutsideClick:E}=e,T=(0,o.useRef)(null),I=(0,g.A)((e=>{const t=e.composedPath();if(S){const e=S();if(e&&t.includes(e))return}T.current&&t.includes(T.current)||(null==m||m(!1),null==E||E())}),S),j=(0,o.useMemo)((()=>A||(()=>I.current)),[A,I.current]),N=e=>{e.preventDefault(),e.stopPropagation(),null==m||m(!0),null==v||v()};(0,o.useEffect)((()=>{d&&(0,h.Bq)(i)}),[d]);return(0,_.jsx)("div",{className:s,ref:I,style:p,"data-testid":"disable-option",children:(0,_.jsx)(l.ms,{trigger:"custom",visible:d,spacing:b,position:n,className:f.A.dropdown,contentClassName:r()(a),getPopupContainer:j,render:(0,_.jsx)("div",{ref:T,onClick:e=>{e.preventDefault(),e.stopPropagation(),null==m||m(!0)},style:{overflow:"hidden"},children:(0,_.jsx)(x,{disabledScene:C,optionPageSection:t,disableKey:i,onClickItem:()=>null==m?void 0:m(!1),onDisableOnceClick:w})}),children:k||(y?y({onTriggerClick:N}):(0,_.jsx)("div",{className:f.A.area,onClick:N,children:(0,_.jsx)(c.gz,{className:f.A.icon})}))})})}},21811:(e,t,n)=>{n.d(t,{DT:()=>d,GT:()=>u,l_:()=>h});var i=n(44557),o=n(76813),s=n(67685),r=n(24228),a=n(16409),l=(n(24337),n(44969)),c=n(22074);const d=e=>{if(!location.href.includes(`${s.FI}${l.EP}`))if((0,c.nr)()){const{trackMeta:t}=e||{};window.open(function(e){const t={from:"ext"};return e&&(t.extra=btoa(JSON.stringify(e))),(0,o.ID)(`https://${s.FI}/browser-extension/login`,t)}({trackMeta:t}),"_blank")}else(0,a.cs)({name:"open-login-window",body:(0,i.A)((0,i.A)((0,i.A)({},(0,r.c)()),e),{},{clearWindow:(0,c.fv)()})})},u=()=>{window.location.hostname.endsWith(s.Ud)&&window.postMessage({name:"click_float_btn"})},h=()=>{var e,t,n;return{imageUrl:(null===(e=document.querySelector('meta[property="og:image"]'))||void 0===e?void 0:e.getAttribute("content"))||"",desc:(null===(t=document.querySelector('meta[property="og:description"]'))||void 0===t?void 0:t.getAttribute("content"))||(null===(n=document.querySelector('meta[name="description"]'))||void 0===n?void 0:n.getAttribute("content"))||""}}},66351:(e,t,n)=>{n.d(t,{$N:()=>Mt,AY:()=>_n,Ai:()=>cn,Cy:()=>Jt,EH:()=>an,GP:()=>Kt,Gk:()=>rn,H9:()=>zt,HD:()=>qt,Hx:()=>vn,I:()=>wn,JW:()=>Pt,K2:()=>$t,NK:()=>xn,P$:()=>on,Pl:()=>at,R0:()=>ln,TH:()=>Ft,Tf:()=>Gt,VA:()=>yn,YW:()=>fn,Zx:()=>Zt,dd:()=>dn,eD:()=>Ct,eI:()=>Lt,gz:()=>St,hI:()=>lt,hk:()=>un,jw:()=>xt,k$:()=>rt,kK:()=>ft,li:()=>nn,n4:()=>Xt,o0:()=>It,oE:()=>Yt,pt:()=>Qt,un:()=>sn,ut:()=>hn,vo:()=>Dt,wO:()=>en,w_:()=>Tt,wv:()=>st,yK:()=>gn,yZ:()=>mn,zG:()=>tn});var i=n(44557),o=(n(11855),n(54528)),s=n(47351),r=n(45041),a=n(59107),l=n(27398),c=n(70798),d=n(51405),u=n(79613),h=n(76360),m=n(89130),p=n(12508),g=n(34919),v=n(31442),f=n(93708),_=n(86617),x=n(70221),y=n(5960),b=n(67368),w=n(37730),C=n(21010),A=n(16593),S=n(3341),k=n(55615),E=n(98335),T=n(63751),I=n(90952),j=n(64390),N=n(4045),R=n(59799),M=n(34658),P=n(67455),L=n(27040),B=n(14089),D=n(24890),O=n(30961),F=n(21500),U=n(56317),H=n(52621),z=n(77355),q=n(27350),V=n(15440),$=n(23396),W=n(95633),K=n(15238),Y=n(40643),G=n(10360),Q=n(31870),Z=n(67310),X=n(61533),J=n(74772),ee=n(70279),te=n(36011),ne=n(15652),ie=n(56502),oe=n(1519),se=n(48231),re=n(81621),ae=n(6862),le=n(63904),ce=n(48158),de=n(5169),ue=n(52669),he=n(3040),me=n(50077),pe=n(26517),ge=n(55941),ve=n(63544),fe=n(67397),_e=n(96062),xe=n(32574),ye=n(96452),be=n(4501),we=n(13217),Ce=n(3225),Ae=n(5654),Se=n(89488),ke=n(47792),Ee=n(75862),Te=n(82787),Ie=n(93442),je=n(26025),Ne=n(67434),Re=n(78802),Me=n(98554),Pe=n(22392),Le=n(66408),Be=n(8237),De=n(16367),Oe=n(39007),Fe=n(70873),Ue=n(11007),He=n(25568),ze=n(9335),qe=n(53012),Ve=n(47494),$e=n(40549),We=n(92852),Ke=n(57810),Ye=n(2668),Ge=n(91985),Qe=n(47251),Ze=n(27834),Xe=n(28742),Je=n(93313),et=n(83112),tt=n(63610),nt=n(95960),it=n(28434),ot=n(63159);const st=(0,d.a)((0,ot.jsx)(ke.h,{})),rt=(0,d.a)((0,ot.jsx)(Ae.h,{})),at=((0,d.a)((0,ot.jsx)(Pe.h,{})),(0,d.a)((0,ot.jsx)(xe.h,{})),(0,d.a)((0,ot.jsx)(Ue.h,{})),(0,d.a)((0,ot.jsx)(He.h,{})),(0,d.a)((0,ot.jsx)(Fe.h,{})),(0,d.a)((0,ot.jsx)(ze.h,{})),(0,d.a)((0,ot.jsx)(le.h,{}))),lt=((0,d.a)((0,ot.jsx)(tt.h,{})),(0,d.a)((0,ot.jsx)(Ke.h,{})),(0,d.a)((0,ot.jsx)(ie.h,{})),(0,d.a)((0,ot.jsx)(de.h,{}))),ct=(0,d.a)((0,ot.jsx)(ae.h,{})),dt=(0,d.a)((0,ot.jsx)(ee.h,{})),ut=(0,d.a)((0,ot.jsx)(Y.h,{})),ht=(0,d.a)((0,ot.jsx)(z.h,{})),mt=(0,d.a)((0,ot.jsx)(k.h,{})),pt=(0,d.a)((0,ot.jsx)(A.h,{})),gt=(0,d.a)((0,ot.jsx)(w.h,{})),vt=(0,d.a)((0,ot.jsx)(y.h,{})),ft=(0,d.a)((0,ot.jsx)(m.h,{})),_t=(0,d.a)((0,ot.jsx)(G.h,{})),xt=((0,d.a)((0,ot.jsx)(Z.h,{})),(0,d.a)((0,ot.jsx)(X.h,{}))),yt=(0,d.a)((0,ot.jsx)(C.h,{})),bt=(0,d.a)((0,ot.jsx)(J.h,{})),wt=(0,d.a)((0,ot.jsx)(D.h,{})),Ct=((0,d.a)((0,ot.jsx)(j.h,{})),(0,d.a)((0,ot.jsx)(T.h,{}))),At=((0,d.a)((0,ot.jsx)(I.h,{})),(0,d.a)((0,ot.jsx)(W.h,{}))),St=(0,d.a)((0,ot.jsx)(te.h,{})),kt=((0,d.a)((0,ot.jsx)($.h,{})),(0,d.a)((0,ot.jsx)(se.h,{}))),Et=(0,d.a)((0,ot.jsx)(P.h,{})),Tt=(0,d.a)((0,ot.jsx)(L.h,{})),It=(0,d.a)((0,ot.jsx)(F.h,{})),jt=(0,d.a)((0,ot.jsx)(S.h,{})),Nt=(0,d.a)((0,ot.jsx)(N.h,{})),Rt=(0,d.a)((0,ot.jsx)(R.h,{})),Mt=((0,d.a)((0,ot.jsx)(Q.h,{})),(0,d.a)((0,ot.jsx)(ue.h,{})),(0,d.a)((0,ot.jsx)(_.h,{}))),Pt=(0,d.a)((0,ot.jsx)(x.h,{})),Lt=(0,d.a)((0,ot.jsx)(f.h,{})),Bt=(0,d.a)((0,ot.jsx)(V.h,{})),Dt=((0,d.a)((0,ot.jsx)(b.h,{})),(0,d.a)((0,ot.jsx)(K.h,{}))),Ot=((0,d.a)((0,ot.jsx)(M.h,{})),(0,d.a)((0,ot.jsx)(p.h,{}))),Ft=(0,d.a)((0,ot.jsx)(H.h,{})),Ut=(0,d.a)((0,ot.jsx)(g.h,{})),Ht=((0,d.a)((0,ot.jsx)(Ze.h,{})),(0,d.a)((0,ot.jsx)(et.h,{})),(0,d.a)((0,ot.jsx)(ge.h,{})),(0,d.a)((0,ot.jsx)(De.h,{})),(0,d.a)((0,ot.jsx)(Oe.h,{})),(0,d.a)((0,ot.jsx)(ye.h,{}))),zt=(0,d.a)((0,ot.jsx)(q.h,{})),qt=(0,d.a)((0,ot.jsx)(we.h,{})),Vt=((0,d.a)((0,ot.jsx)(Ve.h,{})),(0,d.a)((0,ot.jsx)($e.h,{})),(0,d.a)((0,ot.jsx)(be.h,{}))),$t=(0,d.a)((0,ot.jsx)(E.h,{})),Wt=(0,d.a)((0,ot.jsx)(U.h,{})),Kt=(0,d.a)((0,ot.jsx)(v.h,{})),Yt=(0,d.a)((0,ot.jsx)(oe.h,{})),Gt=(0,d.a)((0,ot.jsx)(ne.h,{})),Qt=(0,d.a)((0,ot.jsx)(O.h,{})),Zt=(0,d.a)((0,ot.jsx)(B.h,{})),Xt=(0,d.a)((0,ot.jsx)(ce.h,{})),Jt=(0,d.a)((0,ot.jsx)(qe.h,{})),en=((0,d.a)((0,ot.jsx)(Be.h,{})),(0,d.a)((0,ot.jsx)(me.h,{})),(0,d.a)((0,ot.jsx)(ve.h,{}))),tn=(0,d.a)((0,ot.jsx)(Ne.h,{})),nn=(0,d.a)((0,ot.jsx)(Le.h,{})),on=(0,d.a)((0,ot.jsx)(_e.h,{})),sn=(0,d.a)((0,ot.jsx)(he.h,{})),rn=(0,d.a)((0,ot.jsx)(Qe.h,{})),an=((0,d.a)((0,ot.jsx)(Je.h,{})),(0,d.a)((0,ot.jsx)(je.h,{}))),ln=(0,d.a)((0,ot.jsx)(Ye.h,{})),cn=((0,d.a)((0,ot.jsx)(pe.h,{})),(0,d.a)((0,ot.jsx)(We.h,{})),(0,d.a)((0,ot.jsx)(fe.h,{})),(0,d.a)((0,ot.jsx)(Re.h,{}))),dn=(0,d.a)((0,ot.jsx)(Me.h,{})),un=(0,d.a)((0,ot.jsx)(Xe.h,{})),hn=(0,d.a)((0,ot.jsx)(Ge.h,{})),mn=(0,d.a)((0,ot.jsx)(Ce.h,{})),pn=(0,d.N)((0,h.Nf)()),gn=((0,d.a)((0,ot.jsx)(re.h,{})),(0,d.a)((0,ot.jsx)(Te.h,{}))),vn=(0,d.a)((0,ot.jsx)(Se.h,{})),fn=(0,d.a)((0,ot.jsx)(Ie.h,{})),_n=(0,d.a)((0,ot.jsx)(Ee.h,{})),xn=(0,d.a)((0,ot.jsx)(nt.h,{})),yn=(0,d.a)((0,ot.jsx)(it.h,{})),bn=(0,i.A)((0,i.A)({},u.M),{},{arrow:at,avatar:ct,check:o.A,contact:dt,drag:ut,explain:s.A,instruct:ht,rewrite:mt,adjust_skill:r.A,search:pt,sider:gt,summarize:vt,translate:ft,del:_t,copy:a.A,conversation:bt,settings:yt,more:wt,regenerate:Ct,expand:At,close:St,cancel:kt,ok:Et,messageFailed:It,right:jt,IconRead:Nt,IconReadPage:Rt,global:Bt,expandDownFilled:Dt,IconTranslateOutline:Ot,IconLangSettings:Ft,IconTranslateOutlineActive:Ut,IconLink:Wt,cici:pn,searchToggleSize:Ht,searchMore:qt,searchSource:Vt,collect:l.A,searchAI:c.A,IconPlayAudio:st}),wn=(e,t)=>{const n=bn[e];return n?(0,ot.jsx)(n,(0,i.A)({},t)):(e=>{try{return new URL(e),!0}catch(t){return!1}})(e)?(0,ot.jsx)("img",(0,i.A)({src:e},t)):(0,ot.jsx)(Wt,(0,i.A)({},t))}},4290:(e,t,n)=>{n.d(t,{a4:()=>u,gR:()=>d,qk:()=>c});var i=n(88090),o=n(97311),s=n(58980),r=n(60296),a=n(77591),l=n(96638);function c(e){const t=(0,i.wz)((0,a.TK)("inputAssistantLang"));return r.P.getState().sendMessage({text:e.text,scene:o.sJ.writing_assistant,prompt:l.EU.input_skill,replyLang:t,input_skill:JSON.stringify({skill_id:"2",skill_type:2})})}function d(e){const t=(0,i.wz)((0,a.TK)("inputAssistantLang")),n={skill_name:"rewrite",template_type:e.template_type};e.adjust&&(n.adjust=e.adjust),e.tone&&(n.tone=e.tone);return r.P.getState().sendMessage({text:e.text,scene:e.scene||o.sJ.writing_assistant,sec_scene:e.sec_scene,prompt:l.EU.adjust_skill,replyLang:e.lang?e.lang:t,browser_plugin_info:JSON.stringify(n)})}function u(e){const t={prompt:l.EU.adjust_skill,scene:o.sJ.writing_assistant,browser_plugin_info:JSON.stringify({skill_name:"reply",ref:e.text,host:window.location.hostname,size:String(e.replySize),scene_id:s.Fc.CommentReply})};return r.P.getState().sendMessage(t)}},8391:(e,t,n)=>{n.d(t,{V_:()=>s,sw:()=>o});var i=n(77591);n(26472);function o(){const e=(0,i.TK)("featureInfo");null!=e&&e.version&&(e.dotVisibleVersion=e.version,(0,i.vE)("featureInfo",e))}function s(){const e=(0,i.TK)("featureInfo");null!=e&&e.version&&(e.dotVisibleVersion=e.version,e.cardVisibleVersion=e.version,(0,i.vE)("featureInfo",e))}},73717:(e,t,n)=>{n.d(t,{$3:()=>a,EX:()=>r,P9:()=>l,RB:()=>o,Z_:()=>i,cT:()=>d,g$:()=>s,pX:()=>c,pi:()=>u,yt:()=>h});const i="https://www.bilibili.com/video/BV18h411o7Go/?spm_id_from=333.337.search-card.all.click&vd_source=9ae70c4a7d1caf5f0565fa412b8b57bf8#onboarding_have_a_try",o="#onboarding_have_a_try",s="#bilingual_subtitle_onboarding_have_a_try",r="https://sameerbajaj.com/jobs/#onboarding_have_a_try",a="https://sameerbajaj.com/jobs/#onboarding_have_a_try",l="https://36kr.com/p/997609012833538#onboarding_have_a_try",c="https://sameerbajaj.com/jobs/",d="https://36kr.com/p/997609012833538#onboarding_have_a_try",u="#from_feed_card",h="#from_share_card"},50711:(e,t,n)=>{n.d(t,{J:()=>T,f:()=>E});var i=n(10633),o=n(14065),s=n(49392),r=n(48485),a=n(24323),l=n.n(a),c=n(58447),d=n(27527),u=n(10484),h=n(42265),m=n(67685),p=n(97311),g=n(56397),v=n(93476),f=n(47881),_=n(77591),x=n(36245),y=n(24337),b=n(21559),w=n(17411),C=n(20825),A=n(77191);const S=(e,t,n)=>{const i=`${m.C1}/pdf/${e}/${encodeURIComponent(t)}?from_source=${n}&pdf_reading=1`;window.open(i),v.l.getState().isSidePanelMode&&(C._K.isInSidePanel?setTimeout((()=>{v.l.getState().setIsShowSidebar(!1,g.cz.other)}),150):v.l.getState().setIsShowSidebar(!1,g.cz.other))},k=function(){var e=(0,o.A)((function*(e){try{var t;const n=null===(t=(yield d.j.apiService.conversation.ConversationInfo({conversation_id:e})).data)||void 0===t||null===(t=t.conversation)||void 0===t?void 0:t.deleted;return!(0,s.A)(n)&&!n}catch(n){return!1}}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,o.A)((function*(e){var t,n;const{type:i,link:o,file:s,fromSource:a,opt:l={createNewConv:!1,sendReadMessage:!1}}=e,m="file"===i?null==s?void 0:s.key:null==o?void 0:o.url;if(!m)return void b.vF.persist.error({eventName:"AI PDF read: file url empty",error:new Error("file url empty")});const g=sessionStorage.getItem(m);if(g){if(yield k(g))return void S(g,m,a);sessionStorage.removeItem(m)}const v=(0,_.n5)();let x=null===(t=v.mainConversation)||void 0===t?void 0:t.conversation_id;const y=null===(n=v.mainConversation)||void 0===n?void 0:n.bot_id;if(l.createNewConv)try{var C;x=null===(C=(yield d.j.apiService.samantha.ThreadCreate({bot_id:y})).data)||void 0===C||null===(C=C.thread_info)||void 0===C||null===(C=C.conversation)||void 0===C?void 0:C.conversation_id}catch(T){b.vF.persist.error({eventName:"PDF-READ create convId fail",error:T})}if(x){if(l.sendReadMessage){var E;const e=w.F2.t("skill_read_file_shortcut1"),t=yield(0,A.M$)(),n=(null===(E=(0,r.A)(t.latest_skills,(e=>(null==e?void 0:e.skill_type)===c.K9.ReadPDF)))||void 0===E?void 0:E.skill_id)||"",i={answer_with_suggest:"1",input_skill:JSON.stringify({skill_id:n,skill_type:c.K9.ReadPDF}),source:"chat_action_bar",stream:"1"};if(m.startsWith("http")){const t={compositeContent:{text:e,links:[m]},extraExt:i,reportParams:{scene:p.sJ.chat_action_bar},ctx:(0,f.Pe)(u.H.Conversation,x,y)};(0,h.C)([t],{chatType:u.H.Conversation,botType:"Main"})}else{const t={compositeContent:{text:e,files:[{from:"click",key:m,file_name:null==s?void 0:s.name}]},extraExt:i,reportParams:{scene:p.sJ.chat_action_bar},preGeneratedLocalMessageId:null==s?void 0:s.localMsgId,ctx:(0,f.Pe)(u.H.Conversation,x,y)};(0,h.C)([t],{chatType:u.H.Conversation,botType:"Main"})}}S(x,m,a),sessionStorage.setItem(m,x)}else b.vF.persist.error({eventName:"PDF-READ convId empty",error:new Error("empty convId")})}));return function(t){return e.apply(this,arguments)}}();const T=new class{constructor(){(0,i.A)(this,"blobChunkMap",{}),(0,i.A)(this,"port",null)}onFileChunk(e){var t=this;return(0,o.A)((function*(){const{id:n,chunkIndex:i=0,chunks:o=0,blobData:s,type:r,originMd5:a,error:c}=e||{},d=t.blobChunkMap[n];if(d){const[e,u]=d;if(c)return u(),void delete t.blobChunkMap[n];if(e[i]=new Uint8Array(s),i>=o){const i=new Blob(e.filter(Boolean),{type:r}),o=l()(new Uint8Array(yield i.arrayBuffer()));o!==a&&(0,y.z3)(`File transfer: md5 checks failed between origin(${a}) and chunks merged(${o})`),u(i),delete t.blobChunkMap[n]}}}))()}getFileBlob(e,t){const n=Math.random().toString(32).slice(2);this.blobChunkMap[n]=[[],t],this.port||(this.port=(0,x.c)("file-reader"),this.port.onMessage.addListener(this.onFileChunk.bind(this))),this.port.postMessage({body:{url:e,id:n}})}}},69456:(e,t,n)=>{n.d(t,{F4:()=>s,Ll:()=>a,lE:()=>r});var i=n(14065),o=n(13464);const s=function(){var e=(0,i.A)((function*(e){if("xiaoyuzhou"===e){const e=document.querySelector("main");if(!e)return"";const t=e.getBoundingClientRect(),{width:n}=t;let{height:i}=t;const s=n-36,r=(0,o.hj)(n-36);r.style.position="relative";const a=document.createElement("div");a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.height="96px",a.style.width="100%",a.style.backgroundImage="linear-gradient(#f8f8f8 0%, #f8f8f8 40%, #fff 40.1%, #fff 100%)",a.style.backgroundRepeat="repeat-y",a.style.backgroundSize="100% 5px",r.appendChild(a);const l=['button[data-testid="podcast-assistant-single-summary-btn"]','div[id*="doubao-ai-podcast-assistant"]',"main > aside"],c=e.querySelector("main > section");c&&!c.querySelector(".comment")&&(l.push("main > section"),i-=c.getBoundingClientRect().height);const d=e.querySelector("main > div.placeholder");d&&0===d.children.length&&(l.push("main > div.placeholder"),i-=d.getBoundingClientRect().height);const u=yield(0,o.dp)(e,!1,l);r.appendChild(u);return(0,o.NS)(r.outerHTML,i,s)}return""}));return function(t){return e.apply(this,arguments)}}(),r=e=>{if("xiaoyuzhou"===e){const e=document.querySelector("header .podcast-title .name");return e?window.getComputedStyle(e).color:""}return""},a=e=>(null==e?void 0:e.name)||"xiaoyuzhou"},792:(e,t,n)=>{n.d(t,{FH:()=>s,kF:()=>a,wu:()=>r});var i=n(82770),o=n(22074);const s=!0,r=()=>!(0,o.gm)()&&!0===(0,i.Mz)(i.FM.vocabruary,!1),a=!0},54422:(e,t,n)=>{n.d(t,{Cm:()=>s,F8:()=>u,Kn:()=>l,dE:()=>d,dZ:()=>r,lO:()=>a,ri:()=>c,sp:()=>i,ut:()=>o});const i="start_request_tts_stream",o="request_stop_tts_stream",s="request_tts_stream_with_text",r="finish_request_tts_stream",a="stop_all_audios",l="force_stop_tts_audio",c="register_tts_audio",d="request_tts_audio",u="receive_tts_audio"},75943:(e,t,n)=>{n.d(t,{A:()=>c,m:()=>l});var i,o=n(10633),s=n(77591),r=n(24337),a=n(44969);class l{static getInstance(){return l._instance}init(){void 0===this._hostId&&(this._hostId=(0,s.TK)("hostId"),this._listenBrandInfoMessage(),this._listenStoreMessage(),this._sendHostIdMessage(),this._sendBrandInfo(),this._listenHostIdMessage())}registerRecyclable(e){this._recyclables.push(e)}registerRecyclables(e){e.forEach((e=>{e&&this._recyclables.push(e)}))}registerStore(e,t){this._stores.set(e,t)}getHostId(){return this._hostId}constructor(){(0,o.A)(this,"_recyclables",[]),(0,o.A)(this,"_stores",new Map),(0,o.A)(this,"_hostId",void 0),(0,o.A)(this,"_listenHostIdMessage",(()=>{window.addEventListener("message",this._hostIdMessageHandler)})),(0,o.A)(this,"_listenStoreMessage",(()=>{window.addEventListener("message",this._storeMessageHandler)})),(0,o.A)(this,"_listenBrandInfoMessage",(()=>{window.addEventListener("message",this._brandInfoMessageHandler)})),(0,o.A)(this,"_hostIdMessageHandler",(e=>{var t,n,i,o;void 0!==(null==e||null===(t=e.data)||void 0===t?void 0:t.brand)&&(null==e||null===(n=e.data)||void 0===n?void 0:n.brand)!==a.R3||void 0!==(null==e||null===(i=e.data)||void 0===i?void 0:i.hostId)&&(null==e||null===(o=e.data)||void 0===o?void 0:o.hostId)!==this._hostId&&(window.removeEventListener("message",this._hostIdMessageHandler),this._destory())})),(0,o.A)(this,"_brandInfoMessageHandler",(e=>{var t;null!=e&&null!==(t=e.data)&&void 0!==t&&null!==(t=t.extensionReq)&&void 0!==t&&t.requireExtensionInfo&&this._sendBrandInfo(e.origin)})),(0,o.A)(this,"_storeMessageHandler",(e=>{var t,n,i;if(void 0!==(null==e||null===(t=e.data)||void 0===t?void 0:t.brand)&&(null==e||null===(n=e.data)||void 0===n?void 0:n.brand)!==a.R3)return;if(void 0===(null==e||null===(i=e.data)||void 0===i?void 0:i.storeData))return;const o=JSON.parse(e.data.storeData);Object.keys(o).forEach((e=>{const t=this._stores.get(e);t&&t.setState(JSON.parse(o[e]))}))})),(0,o.A)(this,"_sendStoreData",(()=>{const e={};this._stores.forEach(((t,n)=>{e[n]=JSON.stringify(t.getState())}));const t=JSON.stringify(e);window.postMessage({storeData:t}),this._stores.clear()}))}_sendHostIdMessage(){window.postMessage({hostId:this._hostId,brand:a.R3})}_sendBrandInfo(e="*"){const t={brandName:a.R3,version:chrome.runtime.getManifest().version};window.postMessage({extensionRes:t},e)}_destory(){window.removeEventListener("message",this._storeMessageHandler),window.removeEventListener("message",this._brandInfoMessageHandler),this._sendStoreData(),this._recyclables.forEach((e=>{try{"function"==typeof e?e():"function"==typeof(null==e?void 0:e.destory)&&e.destory()}catch(t){(0,r.z3)({message:"\u6267\u884cdestroy\u5931\u8d25",error:t})}})),this._recyclables=[]}}function c(e){l.getInstance().registerRecyclable(e)}i=l,(0,o.A)(l,"_instance",new i)},87702:(e,t,n)=>{var i={};n.r(i),n.d(i,{YoutubeImmersionPlayer:()=>xh});var o={};n.r(o),n.d(o,{autoTranslatePageRequestHandler:()=>CT,chatPageReadyHandler:()=>vT,getPageContentHandler:()=>PT,imMessage:()=>NT,locateHighlightDomHandler:()=>fT,readPageRequestHandler:()=>_T,readingWebpageContext:()=>TT,routerChangeHandler:()=>kT,switchCaptureModeHandler:()=>MT,translatePageRequestHandler:()=>wT,translateShowOriginRequestHandler:()=>AT,updateZustandStateHandler:()=>bT,vocabularyBookArchiveHandler:()=>yT});var s={};n.r(s),n.d(s,{contentMenuClickHandler:()=>dj,openSidebarHandler:()=>bx,receiveTTSAudio:()=>mj.J,stopTTSAudio:()=>pj.Q,tabActivatedHandler:()=>uj,toggleSidebarHandler:()=>hj});var r=n(44557),a=n(14065),l=(n(21255),n(39415)),c=n(10129),d=n(61276),u=n(75943),h=n(37462),m=n(11855),p=n(75541),g=n(31458),v=n(57214),f=n(47730);var _=n(56397);let x=function(e){return e[e.google=_.g6.google]="google",e[e.baidu=_.g6.baidu]="baidu",e[e.bing=_.g6.bing]="bing",e}({});var y=n(10633),b=n(63379);const w=(e=!1)=>{const t=document.createElement("div"),n={display:"flex",position:"relative",alignItems:"center",justifyContent:"center",margin:"0 auto",width:"800px",boxSizing:"border-box"};let i=null;return e&&(i=document.createElement("div"),t.appendChild(i),i.style.width="800px",i.style.display="block",i.style.position="relative",i.style.margin="0 auto",i.style.width="800px",i.style.boxSizing="border-box",n.width="100%"),(0,b.A)(t.style,n),{mountNode:t,contentNode:i}},C=e=>document.body.querySelector(e);var A=n(21559);const S=new class{constructor(){(0,y.A)(this,"mountContainer",null),(0,y.A)(this,"getInputEl",(()=>C("input[name='q']")||C("textarea[name='q']")||null)),(0,y.A)(this,"triggerSearch",(()=>{var e;const t=C('form[role="search"]');null==t||null===(e=t.submit)||void 0===e||e.call(t)})),(0,y.A)(this,"getAvatarSize",(()=>24))}getMountContainer(){try{const t=document.createElement("div");(0,b.A)(t.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",zIndex:9,height:"100%",paddingRight:"8px",paddingLeft:"8px"});const n=this.getInputEl();if(n){var e;const i=null===(e=n.parentElement)||void 0===e?void 0:e.nextElementSibling,o=(null==i?void 0:i.children)||[];if(o.length)for(let e=0;e<o.length;e++)if("DIV"===o[e].tagName)return i.insertBefore(t,o[e].nextElementSibling),this.mountContainer=t,this.mountContainer}}catch(t){A.vF.persist.error({message:"save memo error",error:t})}return null}getQueryContent(){var e;return(null===(e=this.getInputEl())||void 0===e?void 0:e.value)||""}reset(){var e;null===(e=this.mountContainer)||void 0===e||e.remove(),this.mountContainer=null}};const k=new class{constructor(){(0,y.A)(this,"mountContainer",null)}getMountContainer(){try{var e;const{mountNode:t}=w();t.style.margin="24px auto 50px auto",t.style.zIndex="1";const n=C('form[role="search"]');if(null!=n&&null!==(e=n.parentElement)&&void 0!==e&&e.parentElement)return n.parentElement.parentElement.insertBefore(t,n.parentElement.nextElementSibling),this.mountContainer=t,this.mountContainer}catch(t){A.vF.persist.error({message:"save memo error",error:t})}return null}reset(){var e;null===(e=this.mountContainer)||void 0===e||e.remove(),this.mountContainer=null}getThemeMode(){try{const e=getComputedStyle(document.body).backgroundColor,t=/rgb\((\d+),\s(\d+),\s(\d+)\)/g.exec(e);if(t){const e=[t[1],t[2],t[3]].map((e=>Number(e)/255)).sort();return(e[0]+e[2])/2>.5?"light":"dark"}}catch(e){}return""}},E={brand:x.google,search:S,feed:k};var T=n(85886);const I=()=>C("#sb_form");const j=new class{constructor(){(0,y.A)(this,"mountContainer",null),(0,y.A)(this,"unSubscribers",[]),(0,y.A)(this,"getAvatarSize",(()=>28))}getMountContainer(){try{const e=document.createElement("div");(0,b.A)(e.style,{display:"inline-flex",zIndex:9,height:"100%",alignItems:"center",justifyContent:"center",marginRight:"8px",position:"absolute"});const t=I();if(t)return this.mountContainer=e,t.appendChild(e),this.updateStyle(),e}catch(e){}return null}getInputEl(){return C('input[name="q"]')}getQueryContent(){var e;return null===(e=this.getInputEl())||void 0===e?void 0:e.value}reset(){var e;this.unSubscribers=[],this.unSubscribers.forEach((e=>null==e?void 0:e())),null===(e=this.mountContainer)||void 0===e||e.remove(),this.mountContainer=null}updateStyle(){const e=this.getInputEl();this.mountContainer&&e&&(this.mountContainer.style.left=e.offsetWidth-36+"px",e.style.paddingRight="40px")}onMountNode(){const e=(0,T.A)((()=>{this.updateStyle()}),100,{leading:!0,trailing:!0});window.addEventListener("resize",e),this.unSubscribers.push((()=>{window.addEventListener("resize",e)}));const t=I(),n=new MutationObserver((0,T.A)((()=>{this.mountContainer&&(t.contains(this.mountContainer)||t.appendChild(this.mountContainer),this.updateStyle())}),100,{leading:!0,trailing:!0}));n.observe(t,{childList:!0,attributes:!0}),this.unSubscribers.push((()=>n.disconnect()))}triggerSearch(){var e,t;null===(e=I())||void 0===e||null===(t=e.submit)||void 0===t||t.call(e)}};var N=n(44300),R=n(6918);const M={borderRadius:"16px",padding:"12px 20px 16px",boxShadow:"0 2px 4px 1px rgba(0, 0, 0, 0.09)",backdropFilter:"blur(2px)"},P={marginBottom:"48px",marginTop:"20px",width:"100%"},L=()=>C("form .below_sbox"),B=()=>{try{var e;const n=((null===(e=document.cookie)||void 0===e?void 0:e.split(/;\s+/))||[]).find((e=>e.includes("_HPVN=")));if(n){var t;const e=(((null===(t=n.split("_HPVN=")[1])||void 0===t?void 0:t.split("&"))||[]).find((e=>e.startsWith("CS=")))||"").split("CS=")[1]||"";return(0,R.O)((0,N.D4)(e),{})}}catch(n){}return null},D=(()=>{let e=null,t=!1;return{checkReady:()=>{var n;return t||(t=!0,(()=>{try{var t,n;if(((null===(t=document.cookie)||void 0===t?void 0:t.split(/;\s+/))||[]).some((e=>"BENVER=1"===e.split("ENSEARCH=")[1]))||"zh"!==(null===(n=document.documentElement)||void 0===n?void 0:n.getAttribute("lang")))return void(e={status:"success",wait:!1});const i=B();if(i&&void 0!==typeof(null==i?void 0:i.Tobn))return void(e={status:"success",wait:0===i.Tobn})}catch(i){}e={status:"fail"}})()),Boolean(C("#tobPrompt"))||"success"===(null===(n=e)||void 0===n?void 0:n.status)&&!e.wait}}})();const O=new class{constructor(){(0,y.A)(this,"mountContainer",null),(0,y.A)(this,"unSubscribers",[]),(0,y.A)(this,"themeMode","")}getAndSubscribeContainerStyle(e){e(M)}getMountContainer(){return new Promise((e=>{const{mountNode:t}=w();(0,b.A)(t.style,P);const n=n=>{const i=n||L();i?(i.appendChild(t),this.mountContainer=t,e(t)):e(null)},i=(e=>{const{retryCount:t=20,gap:n=500,onCheck:i,onDone:o}=e;let s=-1;const r=e=>{i()||e>=t?o():s=setTimeout((()=>r(e+1)),n)};return r(0),()=>{clearTimeout(s)}})({retryCount:10,gap:500,onCheck:()=>D.checkReady(),onDone:()=>n()});this.unSubscribers.push(i)}))}reset(){var e;null===(e=this.mountContainer)||void 0===e||e.remove(),this.mountContainer=null,this.unSubscribers.forEach((e=>null==e?void 0:e())),this.unSubscribers=[]}onMountNode(){const e=(0,T.A)((()=>{var e;this.mountContainer&&(Number(null===(e=document.scrollingElement)||void 0===e?void 0:e.scrollTop)>0?this.mountContainer.style.display="none":this.mountContainer.style.display="flex")}),200,{leading:!0,trailing:!0});document.addEventListener("scroll",e),this.unSubscribers.push((()=>{document.removeEventListener("scroll",e)}));const t=(0,T.A)((()=>{const e=C("#scroll_cont")||C(".show_all_onerowup");e&&(window.innerHeight>=700&&window.innerHeight<=1280?e.style.top="100%":e.style.top="")}),500,{leading:!0});t(),window.addEventListener("resize",t),this.unSubscribers.push((()=>window.removeEventListener("resize",t)));const n=L();if(n){const e=new MutationObserver((0,T.A)((()=>{this.mountContainer&&n.lastElementChild!==this.mountContainer&&n.appendChild(this.mountContainer)}),100,{leading:!0,trailing:!0}));e.observe(n,{childList:!0}),this.unSubscribers.push((()=>e.disconnect()))}}getThemeMode(){return this.themeMode||(this.themeMode=(()=>{var e,t;const n=B();let i=null!==(e=document.body.className)&&void 0!==e&&e.includes("b_dark")?"dark":"light";try{var o;const e=((null===(o=document.cookie)||void 0===o?void 0:o.split(/;\s+/))||[]).find((e=>e.includes("SRCHHPGUSR=")));if(e){var s;const t=((null===(s=e.split("SRCHHPGUSR=")[1])||void 0===s?void 0:s.split("&"))||[]).find((e=>e.startsWith("WEBTHEME=")))||"";switch(`${t.split("WEBTHEME=")[1]}`){case"0":i="light";break;case"1":i="dark";break;case"2":i="system"}}}catch(r){}return"light"!==i&&(n&&0===n.Iotd||null===(t=C(".hp_body"))||void 0===t||null===(t=t.className)||void 0===t||!t.includes("no_image"))&&(i="light"),i})()),this.themeMode}},F={brand:x.bing,search:j,feed:O};let U=88;const H=new class{constructor(){(0,y.A)(this,"mountContainer",null),(0,y.A)(this,"unSubscribers",[]),(0,y.A)(this,"onInputChange",(0,T.A)((()=>{this.updateContainerPosition()}),200,{leading:!0,trailing:!0})),(0,y.A)(this,"getAvatarSize",(()=>20))}getMountContainer(){try{const e=this.getInputEl(),t=document.createElement("div");if((0,b.A)(t.style,{display:"inline-flex",position:"absolute",top:"0px",right:`${U}px`,zIndex:9,height:"100%",alignItems:"center",justifyContent:"center",transform:"translateY(-1px)"}),null!=e&&e.parentElement)return e.nextElementSibling?e.parentElement.insertBefore(t,e.nextElementSibling):e.parentElement.appendChild(t),this.mountContainer=t,this.mountContainer}catch(e){A.vF.persist.error({message:"save memo error",error:e})}return null}getInputEl(){return document.querySelector("input[name=wd]")}getQueryContent(){var e;return(null===(e=this.getInputEl())||void 0===e?void 0:e.value)||""}onMountNode(){const e=this.getInputEl();e&&e.addEventListener("input",this.onInputChange);const t=C("#form .quickdelete");if(t){const e=new MutationObserver((e=>{this.updateContainerPosition()}));e.observe(t,{attributes:!0}),this.unSubscribers.push((()=>e.disconnect()))}const n=document.getElementById("wrapper_wrapper");if(n){const e=new MutationObserver((e=>{for(const t of e){if("childList"!==t.type)break;for(const e of t.addedNodes)if("container"===(null==e?void 0:e.id))return void this.reset()}}));e.observe(n,{childList:!0}),this.unSubscribers.push((()=>e.disconnect()))}const i=C("#form");if(i){const e=()=>{U=i.className.includes("has-voice")?88:56,this.updateContainerPosition()},t=new MutationObserver(e);t.observe(i,{attributes:!0}),this.unSubscribers.push((()=>t.disconnect())),e()}}updateContainerPosition(){if(this.mountContainer){const e=this.getQueryContent();this.mountContainer.style.right=`${U+(e?32:0)}px`}}triggerSearch(){var e;const t=C("input[id='su']");null===(e=t.click)||void 0===e||e.call(t)}reset(){var e,t;null===(e=this.getInputEl())||void 0===e||e.removeEventListener("input",this.onInputChange),this.unSubscribers.forEach((e=>null==e?void 0:e())),this.unSubscribers=[],null===(t=this.mountContainer)||void 0===t||t.remove(),this.mountContainer=null}},z=()=>C("#s_wrap"),q=()=>C("#s_main");const V=[new class{constructor(){(0,y.A)(this,"mount",((e,t)=>{const n=C("#head_wrapper #s-hotsearch-wrapper");if(n){const i=z(),o=C("#form");if("auto"===getComputedStyle(n).zIndex&&(n.style.zIndex="1"),o&&(o.style.zIndex="2"),i){i.insertBefore(e,i.firstElementChild);const n=t||e;return n.style.marginTop="32px",n.style.marginBottom="50px",!0}}return!1}))}},new class{constructor(){(0,y.A)(this,"unSubscribers",[]),(0,y.A)(this,"innerNodeStyle",{}),(0,y.A)(this,"mount",((e,t)=>{const n=z(),i=q();if(n&&i){n.insertBefore(e,n.firstElementChild);const o=getComputedStyle(i),s=i.scrollWidth||800;return(t||e).style.width=`${s}px`,this.innerNodeStyle={marginBottom:"50px",padding:"14px 32px",borderRadius:o.borderRadius,background:o.background},!0}return!1}))}destroy(){this.unSubscribers.forEach((e=>null==e?void 0:e())),this.unSubscribers=[]}onMount(e,t){const n=q(),i=t||e;if(t&&n){const e=(0,T.A)((()=>{const e=n.scrollWidth||800;i.style.width=`${e}px`}),500);window.addEventListener("resize",e),this.unSubscribers.push((()=>{window.removeEventListener("resize",e)}))}}getInnerNodeStyle(){return this.innerNodeStyle}}];const $=new class{constructor(){(0,y.A)(this,"mountContainer",null),(0,y.A)(this,"contentContainer",document.createElement("div")),(0,y.A)(this,"mountStrategy",null),(0,y.A)(this,"getThemeMode",(()=>"light"))}getAndSubscribeContainerStyle(e){var t,n;e((null===(t=this.mountStrategy)||void 0===t||null===(n=t.getInnerNodeStyle)||void 0===n?void 0:n.call(t))||{})}getMountContainer(){try{const{mountNode:e,contentNode:t}=w(!0);for(let n=0;n<V.length;n++){const i=V[n];if(i.mount(e,t))return this.mountStrategy=i,this.mountContainer=e,this.contentContainer=t,e}}catch(e){A.vF.persist.error({message:"save memo error",error:e})}return null}reset(){var e,t,n;null===(e=this.mountContainer)||void 0===e||e.remove(),this.mountContainer=null,null===(t=this.mountStrategy)||void 0===t||null===(n=t.destroy)||void 0===n||n.call(t),this.mountStrategy=null}onMountNode(){var e,t;this.mountStrategy&&this.mountContainer&&(null===(e=this.mountStrategy)||void 0===e||null===(t=e.onMount)||void 0===t||t.call(e,this.mountContainer,this.contentContainer))}},W={brand:x.baidu,search:H,feed:$},K=e=>(0,r.A)({unmount:()=>{e.feed.reset(),e.search.reset()}},e),Y=e=>{switch(e){case x.baidu:return K(W);case x.bing:return K(F);case x.google:return K(E);default:return null}},G=e=>""===e.replace(/\//g,""),Q=()=>{const{hostname:e,pathname:t}=window.location;switch(!0){case((e,t)=>e.endsWith("www.baidu.com")&&G(t))(e,t):return Y(x.baidu);case((e,t)=>["www.bing.com","cn.bing.com"].includes(e)&&G(t)||t.includes("chrome/newtab"))(e,t):return Y(x.bing);case((e,t)=>e.includes("www.google.com")&&(G(t)||t.endsWith("webhp")))(e,t):return Y(x.google);default:return null}},Z=(0,m.createContext)({engine:{}});var X=n(29019),J=n.n(X),ee=n(53354);const te=e=>{const{card_type:t}=e;if(t===ee.L.WebCard)return e.web_card};var ne=n(91689),ie=n(9012);const oe={[ee.L.WebCard]:"web_card"};var se=n(77591),re=n(29988),ae=n(44969),le=n(77191);const ce=[{card_type:ee.L.WebCard,content_type:ee.E.Podcast,expect_cnt:3}],de=(ee.L.WebCard,ee.E.Youtube,()=>{var e;const t=null===(e=(0,se.tl)("search_addons"))||void 0===e?void 0:e.feed_card_config,n=null==t?void 0:t.reduce(((e,t)=>3===(null==t?void 0:t.length)?[...e,{card_type:t[0],content_type:t[1],expect_cnt:Math.max(t[2],3)}]:e),[]);return null!=n&&n.length?n:ce}),ue=(e,t)=>{const n=[],i=new Set;return e.forEach((({card_type:e,content_type:o,expect_cnt:s})=>{for(let r=0;r<s;r++){const s=t.find((t=>t.card_type===e&&(0,ie.A)(t,oe[e]).content_type===o&&!i.has(t.card_id)));(null==s?void 0:s.card_id)&&i.add(s.card_id),n.push(s||{card_type:e,card_id:"",web_card:{content_type:o}})}})),n},he="feedcard-latest-data",me=function(){var e=(0,a.A)((function*(e){try{e(yield re.A.get(he))}catch(t){}}));return function(t){return e.apply(this,arguments)}}(),pe=()=>{const[e,t]=(0,m.useState)(!0),[n,i]=(0,m.useState)(!1),[o,s]=(0,m.useState)(ue(de(),[])),r=(0,m.useRef)({}),l=(0,m.useRef)(!1),c=(0,m.useMemo)((()=>de()),[]),d=(0,m.useCallback)((0,a.A)((function*(){if(e&&l.current)return;l.current=!0,t(!0);const n=Object.keys(r.current);s(ue(c,[]));try{const e=yield(0,le.C$)({expect_cards:c,exposed_card_ids:n}),t=(null==e?void 0:e.card_list)||[];if(t.length){t.forEach((e=>{r.current[e.card_id]=e}));const e=ue(c,t);s(e),o=e,re.A.set(he,o).catch(h.A)}else if(e instanceof Error){`${(0,R.O)(e.message,{code:0}).code}`==`${ae.Be}`?(i(!0),me((t=>{(0,ne.A)(t)?s(t):A.vF.persist.error({eventName:"[feed-card] recover fail",error:e})}))):A.vF.persist.error({eventName:"[feed-card] fetch error",error:e})}}catch(a){}finally{t(!1)}var o})),[e,c]);return(0,m.useEffect)((()=>{d()}),[]),{cards:o,loading:e,refreshCards:d,isLimited:n}};var ge=n(95541),ve=n(30701),fe=n(58980),_e=n(21811),xe=n(86785);const ye="header-iBbDgU",be="tips-x3jam8",we="action-lbte1y",Ce="login-action-dChWjT",Ae="change-action-Utd8Su",Se="divider-YqrKLH",ke="close-wrapper-J4iZGH",Ee="close-btn-PLjZ7k";var Te=n(63159);const Ie=({onSwitch:e,onCloseOnce:t,needLogin:n=!1,onClickCloseBtn:i})=>{const o=(0,v.B)(),[s,r]=(0,m.useState)(!1);return(0,Te.jsxs)("div",{className:ye,children:[(0,Te.jsx)("div",{className:be,children:o("flow_web_ext_newtab_title2")}),(0,Te.jsxs)("div",{className:we,children:[n?(0,Te.jsx)("div",{className:Ce,onClick:()=>{(0,_e.DT)({})},children:o("flow_web_ext_recommend_login")}):(0,Te.jsxs)("div",{className:Ae,onClick:e,children:[(0,Te.jsx)(ge.A,{}),o("flow_web_ext_newtab_change")]}),(0,Te.jsx)("span",{className:Se}),(0,Te.jsx)(xe.A,{className:ke,disableKey:fe.lf.searchAddons,position:"bottomRight",show:s,optionPageSection:"recommend-feed",setShow:r,renderChildren:({onTriggerClick:e})=>(0,Te.jsx)("span",{className:Ee,onClick:t=>{null==i||i(),e(t)},children:(0,Te.jsx)(ve.A,{})}),onDisableOnceClick:t,disabledScene:[fe.iI.page]})]})]})};var je=n(34944);const Ne="card-XVyaSJ",Re="body-VqQqC5",Me=({className:e,children:t,onClick:n})=>(0,Te.jsx)("div",{className:J()(Ne,e),"data-testid":"feed-card-item",children:(0,Te.jsx)("div",{className:Re,onClick:n,children:t})});var Pe=n(66351);const Le="multiple-line-XLxX3K",Be="shadow-e0FdJb",De=({content:e,lineHeight:t,className:n,enableShadow:i=!0})=>{const o=(0,m.useRef)(null),[s,a]=(0,m.useState)(!0),[l,c]=(0,m.useState)({lineHeight:`${t}px`});return(0,m.useEffect)((()=>{var e,n;if("undefined"!=typeof ResizeObserver){const e=()=>{const e=o.current;let n=-1;e&&(e.scrollHeight>e.offsetHeight?(a(!0),n=Math.floor(e.offsetHeight/t)):a(!1)),c((e=>(0,r.A)((0,r.A)({},e),{},{lineClamp:n,WebkitLineClamp:n})))};e();const n=new ResizeObserver((0,T.A)((()=>{e()}),200));return n.observe(o.current,{box:"border-box"}),()=>n.disconnect()}a(Number(null===(e=o.current)||void 0===e?void 0:e.scrollHeight)>Number(null===(n=o.current)||void 0===n?void 0:n.offsetHeight))}),[t,i]),(0,Te.jsxs)("div",{style:l,ref:o,className:J()(n,Le),children:[e,i&&s?(0,Te.jsx)("span",{className:Be}):null]})},Oe="image-container-F46MzX",Fe="image-rnJKOz",Ue="time-oB1Yv3",He="desc-R4w_wU",ze="title-dFfE1y",qe="content-tkkwmO",Ve="loading-I4jb9s";var $e=n(58484),We=n(73717),Ke=n(53884);const Ye="container-kX1lVz",Ge="card-item-Pkn52b",Qe={[ee.L.WebCard]:({data:e,className:t,onClick:n,loading:i=!0})=>{const{title:o="",cover_url:s="",summary:r="",duration_str:a="",content_type:l}=e||{};return(0,Te.jsx)(Me,{type:l===ee.E.Podcast?"audio":"video",className:t,onClick:n,children:i?(()=>{const e=(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(je.EA.Image,{className:Oe}),(0,Te.jsx)(je.EA.Paragraph,{className:He,rows:3})]});return(0,Te.jsx)(je.EA,{className:Ve,loading:!0,active:!0,placeholder:e})})():(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("div",{className:Oe,children:(0,Te.jsxs)("div",{className:Fe,children:[(0,Te.jsx)("img",{src:s,referrerPolicy:"no-referrer"}),(0,Te.jsx)("span",{className:Ue,children:a})]})}),(0,Te.jsxs)("div",{className:He,children:[(0,Te.jsx)("div",{className:ze,children:o}),(0,Te.jsx)(De,{className:qe,content:(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(Pe.yK,{style:{verticalAlign:"sub",marginRight:4}}),r.replace(/\n/g,"")]}),lineHeight:18})]})]})})}},Ze=()=>{var e,t,n;const{engine:i}=(0,m.useContext)(Z),o=(0,m.useRef)(null),[s,r]=(0,m.useState)(!1),{refreshCards:a,loading:l,cards:c,isLimited:d}=pe(),u=null===(e=(0,f.Y)("authInfo")[0])||void 0===e?void 0:e.isAuthenticated;(0,m.useEffect)((()=>{var e,t;null===(e=i.feed)||void 0===e||null===(t=e.getAndSubscribeContainerStyle)||void 0===t||t.call(e,(e=>{o.current&&(0,b.A)(o.current.style,e)})),A.vF.persist.info({eventName:"[feed-card]-mounted",meta:{engine:null==i?void 0:i.brand}})}),[]),(0,m.useEffect)((()=>{l||c.forEach((e=>{const t=te(e);e.card_id&&t&&((0,Ke.s)("show_suggested_content",{title:t.title,url:t.jump_link,content_type:t.content_type===ee.E.Podcast?"podcast":"video",current_page:i.brand}),(0,$e.M7)({current_page:`${i.brand}`,show_from:"search_engine_suggested_content"}))}))}),[l,c]);const h=(null==c?void 0:c.map(((e,t)=>{const n=Qe[e.card_type];return n?(0,Te.jsx)(n,{data:te(e),loading:l||Boolean(!e.card_id),className:Ge,onClick:()=>(e=>{const t=te(e);t&&((0,Ke.s)("click_suggested_content",{title:t.title,url:t.jump_link,content_type:t.content_type===ee.E.Podcast?"podcast":"video",current_page:i.brand}),(0,$e.dn)({current_page:`${i.brand}`,click_from:"search_engine_suggested_content"}),t.jump_link&&window.open(`${t.jump_link}${We.pi}`))})(e)},e.card_id||t):null})).filter(Boolean))||[];return s?null:(0,Te.jsxs)("div",{ref:o,className:J()(Ye,"cici-ext-container",i.brand),"theme-mode":null==i||null===(t=i.feed)||void 0===t||null===(n=t.getThemeMode)||void 0===n?void 0:n.call(t),"data-testid":"feed-card-container",children:[(0,Te.jsx)(Ie,{onSwitch:()=>{(0,Ke.s)("click_suggested_content_button",{current_page:i.brand,button_name:"change"}),a(),A.vF.persist.info({eventName:"[feed-card]-refresh",meta:{engine:null==i?void 0:i.brand}})},onCloseOnce:()=>{var e;null===(e=i.unmount)||void 0===e||e.call(i),r(!0)},needLogin:!u&&d,onClickCloseBtn:()=>{A.vF.persist.info({eventName:"[feed-card]-click-close-btn",meta:{engine:null==i?void 0:i.brand}}),(0,Ke.s)("click_suggested_content_button",{current_page:i.brand,button_name:"close"})}}),c.length?(0,Te.jsx)("div",{className:"flex gap-12 mt-8","data-testid":"feed-card-body",children:h}):null]})},Xe=()=>{var e;const t=null===(e=(0,f.Y)("authInfo")[0])||void 0===e?void 0:e.isAuthenticated;return(0,Te.jsx)(Ze,{},t?"login":"unlogin")};var Je=n(17411),et=n(80459);const tt=()=>{const e=(0,Je.Uk)(),t=(()=>{const[e]=(0,f.Y)("disableSearchAddonsGlobal");return!e})(),{engine:n}=(0,m.useContext)(Z);return(0,m.useEffect)((()=>{var e;if(null!=n&&null!==(e=n.feed)&&void 0!==e&&e.mountContainer){n.feed.mountContainer.style.display=t?"flex":"none"}}),[t]),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t:e,children:t&&(0,Te.jsx)(Xe,{})})})},nt=function(){var e=(0,a.A)((function*(e){const t=e.feed,n=u.m.getInstance().getHostId()||"",i=(e=>`new-recommend-card-${e}`)(n);if(document.body.querySelector(`#${i}`))return;t.reset();const o=yield t.getMountContainer();if(o){o.id=i,o.dataset.buttonHostId=n;const s=(o.firstElementChild||o).attachShadow({mode:"open"}),r=(0,p.createRoot)(s);(0,et.NR)(s,ae.QN).then((()=>{var n;null===(n=t.onMountNode)||void 0===n||n.call(t),r.render((0,Te.jsx)(Z.Provider,{value:{engine:e},children:(0,Te.jsx)(tt,{})}))}))}else A.vF.persist.error({eventName:"FeedCard mount card not found",error:new Error("feed card container not found"),meta:{engine:e.brand}})}));return function(t){return e.apply(this,arguments)}}(),it=()=>{const e=Q(),t=null==e?void 0:e.feed;let n=h.A;if(e){var i;if(null!=t&&t.watchMountStatusChange)n=null===(i=t.watchMountStatusChange)||void 0===i?void 0:i.call(t,(()=>nt(e)));nt(e)}return()=>{null==t||t.reset(),n()}};var ot=n(91376);const st=new class{constructor(){(0,y.A)(this,"unsubscribers",[]),(0,y.A)(this,"rootEl",null)}init(e){const t=new MutationObserver((t=>{for(const i of t){var n;null==i||null===(n=i.addedNodes)||void 0===n||n.forEach((t=>{const n=t,{className:i}=n;if(null!=i&&i.includes("docx-menu-wrapper")){const t=null==i?void 0:i.includes("menu-align-vertical"),o=n.querySelector(".docx-menu-container");if(t)return this.rootEl=this.rootEl||document.createElement("div"),this.rootEl.style.display="block",void(!o||null!=o&&o.contains(this.rootEl)||setTimeout((()=>{o.appendChild(this.rootEl),e(this.rootEl)}),100));this.rootEl&&(this.rootEl.style.display="none")}}))}}));t.observe(document,{childList:!0,subtree:!0}),this.unsubscribers.push((()=>t.disconnect()))}hideBar(){const e=document.querySelector(".docx-menu-wrapper");e&&(e.style.visibility="hidden",e.style.pointerEvents="none")}showBar(){const e=document.querySelector(".docx-menu-wrapper");e&&(e.style.visibility="",e.style.pointerEvents="")}destroy(){this.rootEl=null,this.unsubscribers.forEach((e=>e()))}getThemeMode(){var e,t;return(null===(e=document.documentElement)||void 0===e||null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"data-theme"))||"light"}},rt=(0,m.createContext)({provider:null});var at,lt=n(27658),ct=n(30020),dt=n(14411),ut=n(68692),ht=n(97946),mt=n(35065),pt=n(70593),gt=n(62881),vt=n(85563);const ft=e=>{let t=e;return"zh-CN"===e&&(t="zh"),"es-ES"===e&&(t="es"),t};let _t=0;class xt{constructor(){var e=this;(0,y.A)(this,"isTranslating",!1),(0,y.A)(this,"id",0),(0,y.A)(this,"texts",[]),(0,y.A)(this,"translatePromise",void 0),(0,y.A)(this,"resolveTranslate",void 0),(0,y.A)(this,"translateFinished",!1),(0,y.A)(this,"startTime",void 0),(0,y.A)(this,"endTime",void 0),(0,y.A)(this,"addText",((e,t,n)=>{(void 0===this.startTime||this.startTime>t)&&(this.startTime=t);const i=t+n;(void 0===this.endTime||this.endTime<i)&&(this.endTime=i),this.texts.push(e);const o=40===this.texts.length?new xt:this,s=this.texts.length-1,r=this.translatePromise.then((t=>[e,t[s]]));return this.triggerTranslate(),{nextThread:o,translateResult:r}})),(0,y.A)(this,"detectLang",(e=>e?new Promise((t=>{chrome.i18n.detectLanguage(e,(e=>{var n;const i=null==e||null===(n=e.languages[0])||void 0===n?void 0:n.language;t(ft(i))}))})).catch((e=>"en")):"en")),(0,y.A)(this,"handleTranslateFinished",void 0),(0,y.A)(this,"onReady",(e=>{this.handleTranslateFinished=e})),(0,y.A)(this,"translate",(0,a.A)((function*(){const t="system"===xt.translateTargetLang?ft(chrome.i18n.getUILanguage()):xt.translateTargetLang;if(0===e.texts.length)return yield(n=300,new Promise((e=>{setTimeout((()=>{e(!0)}),n)}))),e.translate();var n;const i=e.texts[0]+(e.texts[1]||"")+(e.texts[2]||"")+(e.texts[3]||"");var o,s;return(yield e.detectLang(i))===t?(null===(o=e.resolveTranslate)||void 0===o||o.call(e,e.texts),e.translateFinished=!0,void(null===(s=e.handleTranslateFinished)||void 0===s||s.call(e,e.id))):yt(e.texts,t).then((t=>{var n,i;null===(n=e.resolveTranslate)||void 0===n||n.call(e,t),e.translateFinished=!0,null===(i=e.handleTranslateFinished)||void 0===i||i.call(e,e.id)})).catch((e=>{A.vF.persist.error({error:e})}))}))),(0,y.A)(this,"triggerTranslate",(()=>{this.isTranslating||(this.isTranslating=!0,xt.doTheTranslate(this))})),this.id=_t,_t+=1,xt.translateThreads.push(this),this.translatePromise=new Promise((e=>{this.resolveTranslate=e}))}}at=xt,(0,y.A)(xt,"translateTargetLang","system"),(0,y.A)(xt,"onThreadReady",((e,t)=>{const n=at.translateThreads.find((t=>t.id===e));n&&n.onReady(t)})),(0,y.A)(xt,"setTranslateTargetLang",(e=>{at.translateTargetLang=e})),(0,y.A)(xt,"translateTasks",[]),(0,y.A)(xt,"resetTranslateTasks",(()=>{at.translateTasks=[]})),(0,y.A)(xt,"sortTranslateThreads",(e=>{const t=(0,pt.A)(at.translateTasks,(t=>Boolean(t.startTime&&t.endTime&&t.startTime<=e&&e<=t.endTime)));if(t<=0)return;const n=at.translateTasks.splice(t);at.translateTasks=[...n,...at.translateTasks]})),(0,y.A)(xt,"doTheTranslate",(e=>{at.translateTasks.push(e),at.loopTasks()})),(0,y.A)(xt,"isLooping",!1),(0,y.A)(xt,"loopTasks",(0,a.A)((function*(){if(!at.isLooping){for(;at.translateTasks.length>0;){at.isLooping=!0;const e=at.translateTasks.shift();e&&(yield e.translate())}at.isLooping=!1}}))),(0,y.A)(xt,"translateThreads",[]),(0,y.A)(xt,"findTranslateReady",(e=>{if(void 0===e||e<0)return!1;const{translateFinished:t}=at.translateThreads.find((t=>t.id===e))||{};return!!t}));const yt=function(){var e=(0,a.A)((function*(e,t="zh"){const n=(0,gt.xp)(t);if(void 0===n)return e;return(yield(0,le.Pt)(e,n)).items.map((e=>e.res))}));return function(t){return e.apply(this,arguments)}}(),bt=(e,t)=>{if(!t)return!1;const n=`${e.text} ${t.text}`;return n.length<(/[\u4e00-\u9fff]/.test(n)?40:80)},wt=e=>{if(!(0,vt.w)())return[];const t=[];let n=new xt;const i=(e=>{let t=0;const n=e.length,i=[];for(;t<n;){const n=e[t],o=e[t+1],s=e[t+2];let r;if(bt(n,o)){const e={offset:n.offset,duration:o.offset+o.duration-n.offset,text:`${n.text} ${o.text}`};i.push(e),r=s,t+=2}else i.push(n),r=o,t+=1;if(r){const e=i[i.length-1],t=r.offset-(e.offset+e.duration);e.duration+=.8*t>800?800:.8*t}}return i})(e);return i.forEach((e=>{const{text:i,offset:o,duration:s}=e,{nextThread:r,translateResult:a}=n.addText(i,o,s);t.push({text:{threadId:n.id,originalText:i,getTranslate:()=>a},offset:o,duration:s}),n=r})),t};var Ct=n(6601),At=n(71679),St=n(55388);const kt=(e,t=3)=>e().catch((n=>{if(0===t)throw n;return kt(e,t-1)}));const Et=new class{constructor(){var e=this;(0,y.A)(this,"youtubeVideoManager",new Ct.q),(0,y.A)(this,"uiStore",void 0),(0,y.A)(this,"cursorOverVideo",!1),(0,y.A)(this,"currentSubtitle",void 0),(0,y.A)(this,"lastLang",void 0),(0,y.A)(this,"currentVideoId",""),(0,y.A)(this,"fetchingVideoId",""),(0,y.A)(this,"subtitleButtonContainer",null),(0,y.A)(this,"getVideoIdFromUrl",(()=>new URL(window.location.href).searchParams.get("v")||"")),(0,y.A)(this,"urlChangeHandler",(e=>{var t;const n=null==e||null===(t=e.detail)||void 0===t||null===(t=t.response)||void 0===t||null===(t=t.playerResponse)||void 0===t?void 0:t.videoDetails;if(this.currentVideoId=(null==n?void 0:n.videoId)||"",this.currentVideoId||(this.currentVideoId=this.getVideoIdFromUrl()),this.watchSettingLang(),this.currentVideoId){this.preloadSubtitles();try{re.A.get("autoTranslateSubtitles").then((e=>{e&&this.openBilingualSubtitle()}))}catch(i){}}})),(0,y.A)(this,"measureRightControls",(()=>{const e=document.querySelector(".ytp-right-controls");return e?e.getBoundingClientRect().height:0})),(0,y.A)(this,"computeButtonHeight",(()=>{var e,t;const{height:n}=(null===(e=this.subtitleButtonContainer)||void 0===e?void 0:e.getBoundingClientRect())||{height:0};null===(t=this.uiStore)||void 0===t||t.setButtonHeight(n)})),(0,y.A)(this,"pauseVideo",(()=>{this.youtubeVideoManager.pause()})),(0,y.A)(this,"computePopoverPosition",(()=>{var e,t;const{left:n}=(null===(e=this.subtitleButtonContainer)||void 0===e?void 0:e.getBoundingClientRect())||{left:0},{left:i}=this.youtubeVideoManager.getBoundingClientRect(),o=n-i+20,s=this.measureRightControls()+16-72;null===(t=this.uiStore)||void 0===t||t.setPopoverPosition({left:o,bottom:s})})),(0,y.A)(this,"preloadSubtitles",(()=>{this.fetchSubtitles()})),(0,y.A)(this,"fetchSubtitles",(0,a.A)((function*(){e.currentVideoId=e.currentVideoId||e.getVideoIdFromUrl();const t=e.getSubtitleLang();if(!e.currentVideoId)return;if(e.fetchingVideoId===e.currentVideoId&&e.lastLang===t)return;e.lastLang=t,e.fetchingVideoId=e.currentVideoId;const n=yield kt((()=>(0,St.S)({videoID:e.currentVideoId,useUILang:!t,lang:t})),10),i=null==n?void 0:n.subtitles;var o;(i&&(e.currentSubtitle=i),e.currentVideoId===e.fetchingVideoId)&&(null===(o=e.uiStore)||void 0===o||o.setSubtitleReady(!0));return i}))),(0,y.A)(this,"restart",(()=>{this.reset(),this.fetchSubtitles()})),(0,y.A)(this,"reset",(()=>{var e,t;null===(e=this.uiStore)||void 0===e||e.setSubtitleReady(!1),this.stopWatchingSubtitles(),null===(t=this.uiStore)||void 0===t||t.setResetVideoUI((new Date).getTime()),xt.resetTranslateTasks()})),(0,y.A)(this,"getCurrentSubtitles",(()=>this.currentSubtitle)),(0,y.A)(this,"setSubtitleButtonContainer",(e=>{this.subtitleButtonContainer=e})),(0,y.A)(this,"watchButtonPosition",(()=>{this.youtubeVideoManager.onVideoResizeHandler((()=>{this.computePopoverPosition(),this.computeButtonHeight()}))})),(0,y.A)(this,"watchCursorOverVideo",(()=>this.youtubeVideoManager.onCursorOverVideo((e=>{this.cursorOverVideo=e})))),(0,y.A)(this,"bindVideoOnclickHandler",this.youtubeVideoManager.bindVideoOnclickHandler),(0,y.A)(this,"onBottomVisibilityToggle",this.youtubeVideoManager.onBottomVisibilityToggle),(0,y.A)(this,"closeBilingualSubtitle",(()=>{(0,At.W)()})),(0,y.A)(this,"openBilingualSubtitle",(0,a.A)((function*(){(yield re.A.get("autoTranslateSubtitles"))&&((0,At.l)(),yield e.fetchSubtitles())}))),(0,y.A)(this,"reopenTranslate",(e=>{xt.setTranslateTargetLang(e),this.openBilingualSubtitle()})),(0,y.A)(this,"stopWatchingSubtitles",(()=>{this.youtubeVideoManager.onTimeUpdated(null),this.youtubeVideoManager.onTimeJump(null)})),(0,y.A)(this,"watchCurrentSubtitle",((e,t)=>{if(null==e||!e.length||0===e.length)return;const n=this.currentVideoId;let i=e[0],o=e[1];this.youtubeVideoManager.onTimeUpdated((s=>{if(n!==this.currentVideoId)return;if(s>i.offset&&s<i.offset+i.duration)return;if(o&&s>=o.offset&&s<o.offset+o.duration)return t(o.text),i=o,void(o=e[e.indexOf(i)+1]);xt.sortTranslateThreads(s);const r=e.find((e=>e.offset<=s&&s<e.offset+e.duration));r?(i=r,t(r.text)):t({threadId:-1,originalText:"",getTranslate:()=>Promise.resolve(["",""])})})),setTimeout((()=>{this.youtubeVideoManager.fireTimeUpdateEvent()}))})),(0,y.A)(this,"getSubtitleLang",(()=>{let e="en";const t=localStorage.getItem("yt-player-caption-sticky-language");if(t){const n=JSON.parse(t);e=(null==n?void 0:n.data)||""}return e})),(0,y.A)(this,"updateSubtitlesIfLangChange",(()=>{this.getSubtitleLang()!==this.lastLang&&this.restart()})),(0,y.A)(this,"watchSettingLang",(()=>{this.youtubeVideoManager.watchSettingChange(this.updateSubtitlesIfLangChange)})),(0,y.A)(this,"onVideoToggleFullscreen",this.youtubeVideoManager.onYoutubeToggleFullscreen),(0,y.A)(this,"makeSureOriginalSubtitleHide",(()=>{(0,At.l)()})),(0,y.A)(this,"onTimeJump",this.youtubeVideoManager.onTimeJump),(0,y.A)(this,"getCurrentVideoId",(()=>this.currentVideoId)),(0,y.A)(this,"toggleBilingualSubtitle",(0,a.A)((function*(){if(!e.cursorOverVideo)return;(0,se.TK)("autoTranslateSubtitles")?(e.closeBilingualSubtitle(),(0,se.vE)("autoTranslateSubtitles",!1)):(yield e.openBilingualSubtitle(),(0,se.vE)("autoTranslateSubtitles",!0))}))),(0,y.A)(this,"getIsCurrentSubtitle",(()=>this.cursorOverVideo)),this.urlChangeHandler(),"navigation"in window?window.navigation.addEventListener("navigate",(()=>{this.reset(),this.urlChangeHandler()})):window.addEventListener("yt-navigate-start",this.reset),window.addEventListener("yt-navigate-finish",this.urlChangeHandler),window.addEventListener("yt-navigate-cache",this.reset),this.uiStore=mt.wT.getState()}},Tt=Et;var It=n(12038),jt=n(33451);const Nt=["message_id","click_from","skill_name"],Rt=["message_id","click_from","skill_name"],Mt=["message_id","click_from","skill_name"],Pt=e=>{let{message_id:t,click_from:n,skill_name:i}=e,o=(0,jt.A)(e,Nt);(0,It.z8)(_.Ur.copy,(0,r.A)({message_id:t,button_name:_.Ur.copy,click_from:n,skill_name:i},o))},Lt=e=>{let{message_id:t,click_from:n,skill_name:i}=e,o=(0,jt.A)(e,Rt);(0,It.z8)(_.Ur.continueInChat,(0,r.A)({message_id:t,button_name:_.Ur.continueInChat,click_from:n,skill_name:i},o))},Bt=e=>{let{message_id:t,click_from:n,skill_name:i}=e,o=(0,jt.A)(e,Mt);(0,It.z8)(_.Ur.retry,(0,r.A)({message_id:t,button_name:_.Ur.retry,click_from:n,skill_name:i},o))},Dt=(e=0)=>{(0,It.z8)(_.Ur.showSelectAssistantMenu,{is_subtitle:e})},Ot=({button_name:e,show_from:t,isSubtitle:n})=>{(0,It.z8)(_.Ur.showSelectAssistantBtn,{button_name:e,show_from:t,is_subtitle:n?1:0})},Ft=({button_name:e,click_from:t=_.Z5.selectAssistantMenu,isSubtitle:n})=>{(0,It.z8)(_.Ur.clickSelectAssistantMenuBtn,{button_name:e,click_from:t,is_subtitle:n?1:0})},Ut=({message_id:e,skill_name:t})=>{(({message_id:e,click_from:t,skill_name:n})=>{(0,It.z8)(_.Ur.regenerate,{message_id:e,button_name:_.Ur.regenerate,click_from:t,skill_name:n})})({message_id:e,click_from:_.Z5.selectAssistantResult,skill_name:t})},Ht=e=>{const{assistantBotId:t}=(0,se.ue)();(0,It.z8)(_.Ur.showSearchAssistantSuggestQuestion,(0,r.A)((0,r.A)({bot_id:t},e),{},{current_page:_.g6.webOther,suggested_type:_.Ld.select_explain}))};var zt=n(36700),qt=n(86855),Vt=n(64353);const $t={};function Wt(){const e="zh",[t,n]=(0,m.useState)();return(0,m.useEffect)((()=>{$t[e]||($t[e]=(0,le.M$)(e)),$t[e].then((e=>{var t;return n(null==e||null===(t=e.input_config)||void 0===t?void 0:t.write_assistant)})).catch((()=>{delete $t[e]}))}),[e]),t}var Kt=n(48485),Yt=n(59585),Gt=n.n(Yt),Qt=n(58447),Zt=n(10484),Xt=n(45577),Jt=n(5842),en=n(15965),tn=n(39779);var nn=n(38523),on=n(23362);let sn=window.location.href,rn=window.location.href;const an=e=>/^https:\/\/www\.xiaoyuzhoufm\.com\/episode\/\w+/.test(e),ln=e=>/^https:\/\/podcasts\.apple\.com\/\w+\/podcast\/.+\/id\w+\?i=\w+/.test(e),cn=(0,m.createContext)(null),dn=e=>an(e)||(e=>{const t=/^https:\/\/www\.xiaoyuzhoufm\.com\/podcast\/\w+/.test(e),n=/^https:\/\/www\.xiaoyuzhoufm\.com\/collection\/episode\/\w+/.test(e);return t||n})(e)?{name:"xiaoyuzhou",buttonContainerNodeQuery:".podcast-title",headerNodeQuery:"header",audioQuery:"audio",checkPodcastDetail:e=>an(e),watchRouteChange(e){const t=setInterval((function(){window.location.href!==sn&&(sn=window.location.href,an(window.location.href)&&e())}),1e3);return()=>{window.clearInterval(t)}}}:ln(e)||(e=>/^https:\/\/podcasts\.apple\.com\/\w+\/podcast\/.+\/id\w+/.test(e))(e)?{name:"applepodcast",headerNodeQuery:"picture",audioQuery:"audio",checkPodcastDetail:e=>ln(e),watchRouteChange(e){const t=setInterval((function(){window.location.href!==rn&&(rn=window.location.href,ln(window.location.href)&&e())}),1e3);return()=>{window.clearInterval(t)}}}:null,un=()=>{const e=document.querySelector("embed");return"EMBED"===(null==e?void 0:e.nodeName)&&"application/pdf"===(null==e?void 0:e.type)},hn=(0,m.createContext)(null),mn=e=>(e=>/^https:\/\/arxiv\.org\/abs\/\d+\.\d+/.test(e))(e)?{name:"arxiv",prevNodeQuery:"a.download-pdf"}:un()?{name:"pdf"}:null;var pn=n(2573),gn=n(13464),vn=n(89124),fn=n(64802),_n=n(98767),xn=n(13162),yn=n(67976),bn=n(67685),wn=n(3310),Cn=n(23835),An=n(60296),Sn=n(5099),kn=n(88090),En=n(98847),Tn=n(98830),In=n(77259),jn=n(16409),Nn=n(70405);const Rn=new Map;function Mn(e){var t;return{id:-1,tags:[],language:null!==(t=(0,kn.wz)((0,se.TK)("uiLanguage")))&&void 0!==t?t:navigator.language,collection_type:e,source_url:location.href}}function Pn(e){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,a.A)((function*(e){const t=yield(0,Nn.S6)({method:"POST",url:`${bn.kD}/collection/create`,data:e});if(t instanceof Error)throw t;return t}))).apply(this,arguments)}function Bn(e,t){return Dn.apply(this,arguments)}function Dn(){return(Dn=(0,a.A)((function*(e,t){const n=t?`${t}`:void 0,i={collection:(0,r.A)((0,r.A)({},Mn(nn.e.TextFragment)),{},{parent_collection_id:n,text_fragment:{ctx_text:e.contextText,selection_text:e.selectionText,anchor_offset:e.anchorOffset,selection_context:e.selectionContext}})};return yield Pn(i)}))).apply(this,arguments)}function On(){return(On=(0,a.A)((function*(e,t,n){const i=n?`${n}`:void 0,o={collection:(0,r.A)((0,r.A)({},Mn(nn.e.TranslateResult)),{},{summary:t.translatedText,summary_msg_id_str:e,parent_collection_id:i,translate_result:{selection_text:t.selectionText,translate_language:t.translate_lang,translate_service:t.translate_service,dict:t.dict,selection_context:t.selectionContext}})};return yield Pn(o)}))).apply(this,arguments)}function Fn(){return(Fn=(0,a.A)((function*(e,t,n){const i=n?`${n}`:void 0,o={collection:(0,r.A)((0,r.A)({},Mn(nn.e.ExplainResult)),{},{summary:t.explainedText,summary_msg_id_str:e,parent_collection_id:i,explain_result:{selection_text:t.selectionText,selection_context:t.selectionContext}})};return yield Pn(o)}))).apply(this,arguments)}function Un(){return(Un=(0,a.A)((function*(e,t,n){const i=n?`${n}`:void 0,o={collection:(0,r.A)((0,r.A)({},Mn(nn.e.CustomSkillResult)),{},{parent_collection_id:i,summary:t.result_text,summary_msg_id_str:e,custom_skill_result:t})};return yield Pn(o)}))).apply(this,arguments)}function Hn(){return(Hn=(0,a.A)((function*(e,t){const n={collection:(0,r.A)((0,r.A)({},Mn(nn.e.SearchResult)),{},{summary:t.generatedText,summary_msg_id_str:e,search_result:{search_text:t.searchText}})};return yield Pn(n)}))).apply(this,arguments)}function zn(){return zn=(0,a.A)((function*(e,t,n){const i={collection:(0,r.A)((0,r.A)({},Mn(nn.e.Web)),{},{fingerprint:t,web:(0,r.A)({},e)})};if(n&&(i.collection.source_url=n),!t)return yield Pn(i);const o=Rn.get(t);if(o)return o;const s=new Promise(((e,t)=>Pn(i).then(e).catch(t))).finally((()=>Rn.delete(t)));return Rn.set(t,s),s})),zn.apply(this,arguments)}function qn(){return qn=(0,a.A)((function*(e){const t={collection:(0,r.A)((0,r.A)({},Mn(nn.e.Pdf)),{},{fingerprint:yield(0,Tn.K)(nn.e.Pdf),pdf:e})};return yield Pn(t)})),qn.apply(this,arguments)}function Vn(){return(Vn=(0,a.A)((function*(e,t){const n={collection:(0,r.A)((0,r.A)({},Mn(nn.e.SocialWebCard)),{},{social_web_card:e})};return t&&(n.collection.source_url=t),yield Pn(n)}))).apply(this,arguments)}function $n(e,t,n,i){return Wn.apply(this,arguments)}function Wn(){return Wn=(0,a.A)((function*(e,t,n,i){const o=yield(0,Tn.K)(nn.e.VideoSummary),s=n.transcript?yield(0,En.xj)():void 0,a={collection:(0,r.A)((0,r.A)({},Mn(nn.e.VideoSummary)),{},{fingerprint:o,summary:e,memos:i,summary_msg_id_str:t||void 0,video_summary:(0,r.A)((0,r.A)({},n),{},{video_shots:s})})},l=Rn.get(o);if(l)return l;const c=new Promise(((e,t)=>Pn(a).then(e).catch(t))).finally((()=>Rn.delete(o)));return Rn.set(o,c),c})),Wn.apply(this,arguments)}function Kn(e){return Yn.apply(this,arguments)}function Yn(){return(Yn=(0,a.A)((function*(e){if(!(0,se.TK)("authInfo").isAuthenticated)return;const t=yield(0,Nn.S6)({method:"GET",url:`${bn.kD}/collection/fingerprint/get/${e}`,preventDefaultAuthAction:!0});return t instanceof Error||null==t?void 0:t.id}))).apply(this,arguments)}function Gn(){return Qn.apply(this,arguments)}function Qn(){return(Qn=(0,a.A)((function*(){return Kn(yield(0,Tn.K)(nn.e.VideoSummary))}))).apply(this,arguments)}function Zn(){return Xn.apply(this,arguments)}function Xn(){return(Xn=(0,a.A)((function*(){return Kn(yield(0,Tn.K)(nn.e.PodcastSummary))}))).apply(this,arguments)}function Jn(){return(Jn=(0,a.A)((function*(e){return!((yield(0,Nn.S6)({method:"POST",url:`${bn.kD}/collection/delete`,data:{id:`${e}`}}))instanceof Error)}))).apply(this,arguments)}function ei(e){return ti.apply(this,arguments)}function ti(){return(ti=(0,a.A)((function*(e){const t=yield(0,Nn.S6)({method:"GET",url:`${bn.kD}/collection/get/${e}`});if(t instanceof Error)throw t;return t}))).apply(this,arguments)}function ni(){return(ni=(0,a.A)((function*(e){const t={id:`${e.id}`,data:{summary:e.summary,summary_msg_id:e.summary_msg_id,video_summary:{timeline:e.timeline}}},n=yield(0,Nn.S6)({method:"POST",url:`${bn.kD}/collection/update`,data:t});if(n instanceof Error)throw n;return{id:`${e.id}`}}))).apply(this,arguments)}function ii(){return(ii=(0,a.A)((function*(e){const t={id:`${e.id}`,data:{summary:e.summary,summary_msg_id:e.summary_msg_id,podcast_summary:{timeline:e.timeline}}},n=yield(0,Nn.S6)({method:"POST",url:`${bn.kD}/collection/update`,data:t});if(n instanceof Error)throw n;return{id:`${e.id}`}}))).apply(this,arguments)}function oi(e){return si.apply(this,arguments)}function si(){return si=(0,a.A)((function*(e){const t=yield(0,Tn.K)(nn.e.PodcastSummary);e.podcastParams.cover_file_token||(e.podcastParams.cover_file_token="");const n=yield e.getHtmlContent(),i={collection:(0,r.A)((0,r.A)({},Mn(nn.e.PodcastSummary)),{},{fingerprint:t,summary:e.summary,summary_msg_id_str:e.summary_msg_id||void 0,memos:e.memos,podcast_summary:(0,r.A)((0,r.A)({},e.podcastParams),{},{html_content:n})})},o=Rn.get(t);if(o)return o;const s=new Promise(((e,t)=>Pn(i).then(e).catch(t))).finally((()=>Rn.delete(t)));return Rn.set(t,s),s})),si.apply(this,arguments)}function ri(){return ri=(0,a.A)((function*(e){var t;const n=yield(0,Tn.K)(nn.e.Image,e.url);let i="";const o=yield(0,_n.n_)(e.url);if(null!=o&&o.blob){i=yield(0,xn.r)(o.blob)}const s={collection:(0,r.A)((0,r.A)({},Mn(nn.e.Image)),{},{fingerprint:n,image:(0,r.A)((0,r.A)({},null!==(t=e.url)&&void 0!==t&&t.startsWith("data")?(0,Sn.A)(e,["url"]):e),{},{file_token:i})})},a=Rn.get(n);if(a)return a;const l=new Promise(((e,t)=>Pn(s).then(e).catch(t))).finally((()=>Rn.delete(n)));return Rn.set(n,l),l})),ri.apply(this,arguments)}var ai=n(52833);let li=function(e){return e.recommendVideo="recommendvideo_list_click",e.playNext="next_button",e.recommendVideoEnding="recommendvideo_ending_click",e}({});const ci=new class{constructor(){(0,y.A)(this,"_isImmersionMode",!1),(0,y.A)(this,"_lastEntryFullScreenFrom",void 0),(0,y.A)(this,"_shouldSummaryVideoDefault",!1),(0,y.A)(this,"_lastRelayBtnType",li.playNext),(0,y.A)(this,"_lastRelayBtnTime",Date.now()),(0,y.A)(this,"_currentTranscript",void 0),(0,y.A)(this,"_videoSummaryMsgBlock",{}),(0,y.A)(this,"_moduleClickFrom",void 0)}isImmersionMode(){return this._isImmersionMode}setImmersionMode(e){this._isImmersionMode=e}getLastEntryFullScreenFrom(){return this._lastEntryFullScreenFrom}updateEntryFullScreenFrom(e){this._lastEntryFullScreenFrom=e}updateTranscriptData(e){if(this._currentTranscript=e,null!=e&&e.length){const t=(0,yn.qf)(e||[]);setTimeout((()=>{ai.on.getState().updateWebContext({type:ai.e6.videoTranscript,content:t})}),1e3)}else ai.on.getState().updateWebContext({type:ai.e6.default,content:""})}getTranscriptData(){return this._currentTranscript}hasTranscript(){var e;return Boolean(null===(e=this._currentTranscript)||void 0===e?void 0:e.length)}shouldSummaryVideoDefault(){return this._shouldSummaryVideoDefault}updateShouldSummaryVideoDefault(e){this._shouldSummaryVideoDefault=e}getLastClickRelayBtnType(){return this._lastRelayBtnType}recordClickRelayBtnType(e){this._lastRelayBtnType=e,this._lastRelayBtnTime=Date.now()}resetClickRelayBtnType(e){if(e)return this._lastRelayBtnType=li.playNext,void(this._lastRelayBtnTime=Date.now());Date.now()-this._lastRelayBtnTime>1e4&&(this._lastRelayBtnType=li.playNext,this._lastRelayBtnTime=Date.now())}updateVideoSummaryId(e){this._videoSummaryMsgBlock.videoSummaryId=e}getVideoSummaryMsgBlock(){return this._videoSummaryMsgBlock}updateModuleClickFrom(e){this._moduleClickFrom||(this._moduleClickFrom=e)}getModuleClickFrom(){return this._moduleClickFrom}resetVideoSummaryStatus(){this._moduleClickFrom=void 0,this.updateTranscriptData(),this.updateVideoSummaryId()}};var di=n(9216),ui=n(48869),hi=n(51402),mi=n(41967),pi=n(85371),gi=n(2633),vi=n(19730);const fi=(e,t)=>{const n=Number(e),i=Math.floor(n/3600),o=Math.floor(n%3600/60),s=Math.floor(n%3600%60),r=o<10?`0${o}`:o,a=s<10?`0${s}`:s;return 0!==i||t?`${i<10?`0${i}`:i}:${r}:${a}`:`${r}:${a}`},_i=e=>{const t=e.split(":");let n=0;for(let i=t.length-1;i>=0;i--){const e=parseInt(t[i],10);n+=isNaN(e)?0:e*Math.pow(60,t.length-1-i)}return n};var xi=n(36897);const yi=e=>{if("string"==typeof e)try{const t=JSON.parse(e);return!("object"!=typeof t||!t)}catch(t){return!1}return!1},bi=()=>{var e;let t="",n="";if(!(0,xi.jB)("bilibili"))return{videoId:t,title:n};let i=location.pathname;i=i.endsWith("/")?i.slice(0,-1):i;const o=i.split("/");t=o[o.length-1],n=(null===(e=document.querySelector(".video-title"))||void 0===e?void 0:e.innerHTML)||"";return{videoId:t,partId:new URL(location.href).searchParams.get("p")||"0",title:n}},wi=e=>{var t;if(!yi(e))return"";const n=JSON.parse(e);return null==n||null===(t=n.filter((e=>Ci(null==e?void 0:e.timestamp)&&e.chapter)))||void 0===t?void 0:t.map((e=>{var t;const n=e.chapter,i=e.timestamp/1e3;if(e.bullet_points&&(null===(t=e.bullet_points)||void 0===t?void 0:t.length)>0){const t=e.bullet_points.filter((e=>Ci(null==e?void 0:e.timestamp)&&e.point)),o=(0,hi.A)(t,(e=>(0,r.A)((0,r.A)({},e),{},{timestamp:e.timestamp/1e3}))),s=(0,ui.A)(o,"timestamp",["asc"]);return(0,r.A)((0,r.A)({},e),{},{section:n,timestamp:i,bullet_points:s})}return(0,r.A)((0,r.A)({},e),{},{section:n,timestamp:i})}))},Ci=e=>Number(e)>=0,Ai=e=>{const t=e[e.length-1];return t.bullet_points&&t.bullet_points.length>0?t.bullet_points[t.bullet_points.length-1].timestamp:t.timestamp},Si=()=>{const e=document.querySelector("#wxwork-share-pic");if(!e)return"";const t=e.getAttribute("src");if(!t)return"";const n=t.lastIndexOf("@");return n<=0?"":`https:${t.slice(0,n)}`},ki=e=>`https://img.youtube.com/vi/${e}/maxresdefault.jpg`;function Ei(){return/youtube/.test(location.hostname)?"youtube":/bilibili/.test(location.hostname)?"bilibili":"youtube"}function Ti(e){return Ii.apply(this,arguments)}function Ii(){return(Ii=(0,a.A)((function*(e){const t=Ei();let n=window.location.href;return"bilibili"===t&&(n=yield(0,di.Z)(e)),n}))).apply(this,arguments)}function ji(e){return"bilibili"===Ei()?Si():ki(e)}function Ni(){var e;var t;return"bilibili"===Ei()?(null===(t=document.querySelector(".bpx-player-ctrl-time-duration"))||void 0===t?void 0:t.innerText)||"":(null===(e=document.querySelector(".ytp-time-duration"))||void 0===e?void 0:e.innerText)||""}const Ri=e=>{let t=[];return(0,vi.A)(e,(e=>{if(-5===e.type){const n=(0,R.O)(e.info,{}).final;(0,gi.A)(n.section)||(t=n.section);const i=n.timeline;(0,vi.A)(i,(e=>{(0,mi.A)(null==e?void 0:e.section_index)&&!t[e.section_index].bullet_points&&(t[e.section_index].bullet_points=e.bullet_points,t[e.section_index].tags=e.tags)}))}})),JSON.stringify(t)};function Mi(){const e=document.querySelector("#danmukuBox .fake-danmaku");return Boolean(e)}var Pi=n(69456);const Li=new Map,Bi=new Set;function Di(e,t,n){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,a.A)((function*(e,t,n){const i=Li.get(e);if(i)return i;const o=yield(0,Nn.S6)({method:"POST",url:`${bn.C1}/samantha/plugin/podcast/transcript`,data:{url:e,type:t,resource_url:n}});return"success"===(null==o?void 0:o.status)&&Li.set(e,o),o}))).apply(this,arguments)}function Fi(e,t){return Ui.apply(this,arguments)}function Ui(){return(Ui=(0,a.A)((function*(e,t){if(Bi.has(e))return!1;const n=yield(0,Nn.S6)({method:"POST",url:`${bn.C1}/samantha/plugin/podcast/should_upload`,data:{url:e,type:t}});return n||Bi.add(e),n}))).apply(this,arguments)}var Hi=n(23427),zi=n(42101),qi=n(10895);const Vi=je.EY.create();function $i(){return`popup-${u.m.getInstance().getHostId()}`}function Wi(e){const t=$i(),n=document.getElementById(t);n&&e.prepend(n)}const Ki=e=>{const t=$i();let n=document.getElementById(t);if(n)return null==e||e(),()=>{var e;return(null===(e=document.getElementById(t))||void 0===e||null===(e=e.shadowRoot)||void 0===e?void 0:e.querySelector("body"))||document.body};n=document.createElement("div"),n.style.width="0",n.style.height="0",n.style.position="absolute",n.id=t,n.style.zIndex="200000";const i=n.attachShadow({mode:"open"}),o=document.createElement("body");o.classList.add("cici-ext-container"),i.appendChild(o),document.body.prepend(n),Vi.config({getPopupContainer:()=>{var e;const n=null===(e=document.getElementById(t))||void 0===e||null===(e=e.shadowRoot)||void 0===e?void 0:e.querySelector("body");return setTimeout((()=>{const e=null==n?void 0:n.querySelector('div.semi-toast-wrapper[id^="toast"]');e&&(e.id=`_${e.id}`)})),n||document.body}});const s=()=>{document.fullscreenElement?Wi(document.fullscreenElement):Wi(document.body)};return document.addEventListener("fullscreenchange",s),(0,et.NR)(i,ae.QN).finally((()=>null==e?void 0:e())),(0,u.A)((()=>{var e;document.removeEventListener("fullscreenchange",s),null===(e=document.getElementById(t))||void 0===e||e.remove()})),()=>{var e;return(null===(e=document.getElementById(t))||void 0===e||null===(e=e.shadowRoot)||void 0===e?void 0:e.querySelector("body"))||document.body}},Yi=e=>{const t=(0,Je.Uk)(),n=(0,m.useCallback)((()=>{window.open(e.infoUrl)}),[e]);return(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsxs)("div",{className:J()(qi.A.toastContainer),"data-testid":"collect-toast-success",children:[(0,Te.jsx)("div",{className:J()(qi.A.text),children:t("flow_web_ext_bookmarks_saved")}),(0,Te.jsx)("div",{className:J()(qi.A.linkToInfo),onClick:n,children:t("flow_web_ext_bookmarks_saved_view")})]})})},Gi=e=>{const t=(0,Je.Uk)(),n=(0,m.useCallback)((()=>{window.open(e.infoUrl)}),[e]);return(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsxs)("div",{className:J()(qi.A.toastContainer),children:[(0,Te.jsx)("div",{className:J()(qi.A.text),children:t("flow_web_ext_youtube_take_notes_saved")}),(0,Te.jsx)("div",{className:J()(qi.A.linkToInfo),onClick:n,children:t("flow_web_ext_youtube_take_notes_saved_view")})]})})},Qi=({message:e})=>(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)("div",{className:J()(qi.A.toastContainer),children:(0,Te.jsx)("div",{className:J()(qi.A.text),children:e})})}),Zi=()=>{const e=(0,Je.Uk)();return(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)("div",{className:J()(qi.A.toastContainer),"data-testid":"collect-toast-remove-success",children:(0,Te.jsx)("div",{className:J()(qi.A.text),children:e("bookmarks_remove_complete")})})})},Xi=()=>{const e=(0,Je.Uk)();return(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)("div",{className:J()(qi.A.toastContainer),"data-testid":"collect-toast-loading",children:(0,Te.jsx)("div",{className:J()(qi.A.loadingText),children:e("flow_web_ext_bookmarks_saving")})})})},Ji=()=>{const e=(0,Je.Uk)();return(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)("div",{className:J()(qi.A.toastContainer),children:(0,Te.jsx)("div",{className:J()(qi.A.errorText),children:e("flow_web_ext_bookmarks_failed")})})})};function eo(){const e={content:(0,Te.jsx)(Xi,{}),duration:0,showClose:!1,className:J()(qi.A.toastLoadingCard),stack:!1,icon:(0,Te.jsx)(je.tK,{}),id:"1",zIndex:99999};Vi.close("1"),Ki((()=>Vi.info(e)))}function to(){const e={content:(0,Te.jsx)(Ji,{}),duration:3,showClose:!1,className:J()(qi.A.toastErrorCard),stack:!1,id:"3",zIndex:99999};Vi.close("1"),Ki((()=>Vi.error(e)))}function no(e){const t={content:(0,Te.jsx)(Qi,{message:e}),duration:3,showClose:!1,className:J()(qi.A.toastCard),stack:!1,id:"10",zIndex:99999};Vi.close("1"),Ki((()=>Vi.success(t)))}function io(e,t){return eo(),e().then((e=>(function(e){const t={content:(0,Te.jsx)(Yi,{infoUrl:e.infoUrl}),duration:3,showClose:!1,className:J()(qi.A.toastCard),stack:!1,id:"2",zIndex:99999};Vi.close("1"),Ki((()=>Vi.success(t)))}({infoUrl:t(e)}),e))).catch((e=>(A.vF.persist.error({eventName:"\u6536\u85cf\u5185\u5bb9\u5931\u8d25\uff01",error:e}),to(),e)))}function oo(e){return e().then((()=>{!function(){const e={content:(0,Te.jsx)(Zi,{}),duration:3,showClose:!1,className:J()(qi.A.toastCard),stack:!1,id:"2",zIndex:99999};Vi.close("1"),Ki((()=>Vi.success(e)))}()}))}var so=n(96638);function ro(e){if((0,se.TK)("authInfo").isAuthenticated)switch(e.collectionType){case wn.X.TranslateResult:case wn.X.ExplainResult:case wn.X.TextFragment:case wn.X.CustomSkillResult:!function(e){lo.apply(this,arguments)}(e);break;case wn.X.SearchResult:!function(e){const t=e.messageId;if(void 0===t||void 0===e.localMessageId)return;(0,zt.o2)(e.collectFrom,zt.p6.searchresult);const n=An.P.getState().messages[e.localMessageId],{text:i=""}=n||{},o={searchText:e.userInput||"",generatedText:i};io((()=>function(e,t){return Hn.apply(this,arguments)}(t,o)),(e=>`${bn.Vl}/${e.id}`)).then((t=>{var n;pn.A.emit("onWebpageSaved",t.id),null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.searchresult,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.searchresult)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}(e);break;case wn.X.Web:ho(e);break;case wn.X.Pdf:mo(e);break;case wn.X.VideoSummary:fo(e);break;case wn.X.SocialWebCard:!function(e){const{getSocialWebCardContent:t}=e;if(!t)return;(0,zt.o2)(e.collectFrom,zt.p6.web),io((0,a.A)((function*(){const e=yield t();if(!e)throw new Error("\u83b7\u53d6\u793e\u4ea4\u5361\u7247\u6536\u85cf\u4fe1\u606f\u51fa\u9519");const{text_content:n,html_content:i,cover_image_url:o="",source_url:s,content_height:r,content_width:a,body_content:l,content_img_key:c=""}=e,d=yield function(e,t){return Vn.apply(this,arguments)}({text_content:n,html_content:(0,gn.NS)(i,r,a),cover_image_url:o,body_content:l.substr(0,500),content_img_key:c},s);return d})),(e=>_o(e.id.toString()))).then((t=>{var n;null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.web,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.web)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}(e);break;case wn.X.PodcastSummary:yo(e);break;case wn.X.Image:!function(e){const{image_result:t,collectType:n,collectFrom:i}=e;if(!t)return;(0,zt.o2)(i,n||zt.p6.Image),io((0,a.A)((function*(){return yield function(e){return ri.apply(this,arguments)}(t)})),(e=>_o(e.id.toString()))).then((t=>{var o;t.id&&(null===(o=e.onSuccess)||void 0===o||o.call(e,t.id)),(0,zt.mL)(i,void 0!==t.id,n||zt.p6.Image,`${t.id}`)})).catch((()=>{(0,zt.mL)(i,!1,n||zt.p6.Image)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}(e)}else(0,_e.DT)({trackMeta:{previous_page:"web",login_entrance:"web"}})}function ao(e,t,n){(0,zt.o2)(t,n,"cancel_collect"),oo((()=>function(e){return Jn.apply(this,arguments)}(e))).finally((()=>{pn.A.emit("onWebpageSaved",void 0)}))}function lo(){return lo=(0,a.A)((function*(e){const t=(qt.t_.getState().simpleSelectionBaseInfo||{}).selectContext,{actionMessages:n,currentAction:i,messageCursor:o,boxVisible:s}=qt.t_.getState();if(e.ocr_result)return function(e){const{ocr_result:t}=e;if(!t)return;(0,zt.o2)(e.collectFrom,zt.p6.ExtractText),io((()=>Bn({contextText:"",selectionText:t.text,anchorOffset:0})),(e=>`${bn.Vl}/${e.id}`)).then((t=>{var n;null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.ExtractText,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.ExtractText)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}(e);const r=yield Kn(yield(0,Tn.K)(nn.e.Web));if(s){var l,c,d;const{messages:s}=An.P.getState(),u=null!==(c=(null!==(l=n[i])&&void 0!==l?l:[])[o])&&void 0!==c?c:"",{text:h="",body:m,originParam:p}=s[u]||{};if(void 0===(null==m||null===(d=m.message)||void 0===d?void 0:d.message_id))return;i===so.EU.explain?((0,zt.o2)(e.collectFrom,zt.p6.ExplainResult),io((0,a.A)((function*(){return function(e,t,n){return Fn.apply(this,arguments)}(m.message.message_id,{selectionText:(null==p?void 0:p.text)||"",explainedText:(0,fn.q4)(h),selectionContext:t},r)})),(e=>`${bn.Vl}/${r?`${r}?mark_child=${e.id}`:e.id}`)).then((t=>{var n;null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.ExplainResult,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.ExplainResult)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))):i===so.EU.translate?((0,zt.o2)(e.collectFrom,zt.p6.TranslateResult),io((0,a.A)((function*(){var n,i,o;return function(e,t,n){return On.apply(this,arguments)}(m.message.message_id,{selectionText:(null==p?void 0:p.text)||"",translate_lang:(null==m||null===(n=m.message)||void 0===n||null===(n=n.ext)||void 0===n?void 0:n.translate)||(0,yn.XQ)(),translatedText:(0,fn.q4)(h),translate_service:null===(i=e.translate_result)||void 0===i?void 0:i.translate_service,dict:null===(o=e.translate_result)||void 0===o?void 0:o.dict,selectionContext:t},r)})),(e=>`${bn.Vl}/${r?`${r}?mark_child=${e.id}`:e.id}`)).then((t=>{var n;null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.TranslateResult,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.TranslateResult)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))):function(e,t){var n,i,o;const{actionMessages:s,currentAction:r,messageCursor:l,simpleSelectionBaseInfo:{selectContext:c}}=qt.t_.getState(),{messages:d}=An.P.getState(),u=null!==(n=s[r])&&void 0!==n?n:[],h=null!==(i=u[l])&&void 0!==i?i:"",{text:m="",body:p,originParam:g}=d[h]||{};if(void 0===(null==p||null===(o=p.message)||void 0===o?void 0:o.message_id))return;(0,zt.o2)(zt.vP.highlight_result_card_custom_skill,zt.p6.CustomSkillResult);const v=co(r);if(!v)return;const f=Boolean(v.confId);io((0,a.A)((function*(){return function(e,t,n){return Un.apply(this,arguments)}(p.message.message_id,{selection_text:(null==g?void 0:g.text)||"",result_text:(0,fn.q4)(m),skill_name:v.name,icon_key:f?"":v.icon,icon_url:f?v.icon:"",is_discover_skill:(0,so._8)(v.id)||f,selection_context:c},t)})),(e=>_o(`${t?`${t}?mark_child=${e.id}`:e.id}`))).then((t=>{var n;null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(zt.vP.highlight_result_card_custom_skill,void 0!==t.id,zt.p6.CustomSkillResult,`${t.id}`)})).catch((()=>{(0,zt.mL)(zt.vP.highlight_result_card_custom_skill,!1,zt.p6.CustomSkillResult)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}(e,r)}else!function(e,t){const n=qt.t_.getState().simpleSelectionBaseInfo;if(void 0===n.anchorOffset)return;const i=n.selectContext,o={contextText:n.contextText,selectionText:n.text,anchorOffset:n.anchorOffset,selectionContext:i};io((()=>Bn(o,t)),(e=>`${bn.Vl}/${t?`${t}?mark_child=${e.id}`:e.id}`)).then((t=>{var n;null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.textfragment,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.textfragment)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}(e,r)})),lo.apply(this,arguments)}const co=e=>{const t=(0,se.TK)("readingPopupActions"),n=(0,se.TK)("editingPopupActions");return t.actionList.find((t=>t.id===e))||t.moreActionList.find((t=>t.id===e))||n.actionList.find((t=>t.id===e))||n.moreActionList.find((t=>t.id===e))};const uo=function(){var e=(0,a.A)((function*(){try{if(an(location.href)){var e,t;const n=Hi.x.getStatus(),{summaryId:i,podcastType:o,coverUrl:s,audioUrl:r,title:a,duration:l,summaryStatus:c}=n;if("xiaoyuzhou"!==o||!r||c===zi.t.exceedSizeFailed||c===zi.t.commonFailed)return;let{transcript:d}=n;if(!d){const e=yield Di(location.href,o);if("success"!==e.status||!e.transcript)return!1;d=e.transcript,Hi.x.setVideoSummaryStatus({transcript:e.transcript})}eo();const{messages:u}=An.P.getState();let h="",m="";const{isDone:p,text:g=""}=u[i||""]||{},v=(null===(e=u[i||""])||void 0===e||null===(e=e.body)||void 0===e||null===(e=e.message)||void 0===e?void 0:e.meta_infos)||[],f=Ri(v);h=g,m=wi(f);const _=i&&p&&(null===(t=u[i])||void 0===t||null===(t=t.body)||void 0===t||null===(t=t.message)||void 0===t?void 0:t.message_id)||"";return yo({collectFrom:zt.vP.podcast_collect,collectionType:nn.e.PodcastSummary,podcastSummaryResult:{summary:h,summary_msg_id:_||"",podcastParams:{podcast_type:o,audio_url:r,title:a||"",timeline:m||[],cover_url:s||"",transcript:d?JSON.stringify(d):"",podcast_duration:l||"",theme_color:(0,Pi.lE)(o)},getHtmlContent:Hi.x.getHtmlContentFunc()}}),!0}}catch(n){return!1}return!1}));return function(){return e.apply(this,arguments)}}(),ho=function(){var e=(0,a.A)((function*(e){(0,zt.o2)(e.collectFrom,zt.p6.web);if((yield uo())||(e=>{if((0,tn.OM)())return vo(e),!0;if((0,tn.ax)()){const t=new URL(location.href),{setVideoId:n,setVideoTitle:i}=Cn.e.getState(),o=t.searchParams.get("bvid");return n(o||""),i(document.title),ci.updateVideoSummaryId(""),o?(0,di.S)({videoId:o}).then((e=>ci.updateTranscriptData.bind(ci)(e.subtitles))).finally((()=>vo(e))):vo(e),!0}return!1})(e))return;if((()=>{const e=(0,on.Ay)(location.href);return e&&(eo(),pn.A.emit("trigger-search-assistant-summary"),setTimeout((()=>pn.A.emit("trigger-search-assistant-collection")),500)),Boolean(e)})())return;const t={text_content:"",html_content:"",title:"",dir:"",description:"",cover_image_url:"",cover_file_token:""};let n;if(e.getWebContent||(n=yield(0,vn.q)(document),n))io((0,a.A)((function*(){let i,o;if(e.getWebContent){const n=yield e.getWebContent();if(!n)throw new Error("\u83b7\u53d6\u7f51\u7ad9\u6536\u85cf\u4fe1\u606f\u51fa\u9519");t.text_content=n.text_content,t.html_content=(0,gn.NS)(n.html_content,n.content_height,n.content_width),t.title=n.title,t.dir=n.dir,t.cover_image_url=n.cover_image_url,t.description=n.description,i=n.source_url}else if(n){const{imageUrl:e,desc:i}=(0,_e.l_)();t.text_content=n.textContent,t.html_content=n.content,t.title=n.title,t.dir=n.dir,t.cover_image_url=e,t.description=i}if(t.cover_image_url)try{const e=(yield(0,_n.n_)(t.cover_image_url)).blob;t.cover_file_token=yield(0,xn.r)(e)}catch(a){t.cover_image_url="",A.vF.persist.error({eventName:"\u83b7\u53d6\u5c01\u9762\u5931\u8d25\uff01",error:a})}o=yield(0,Tn.K)(nn.e.Web,t.text_content);const s=((e,t="",n=512)=>{var i;const o=null!==(i=e.split(",")[1])&&void 0!==i?i:e,s=atob(o),r=[];for(let a=0;a<s.length;a+=n){const e=s.slice(a,a+n),t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);const i=new Uint8Array(t);r.push(i)}return new Blob(r,{type:t})})(yield function(e=!0){return new Promise(((t,n)=>{const i=In.j.getAssistantContainer(),{display:o}=(null==i?void 0:i.style)||{};let s;e&&i&&(i.style.display="none",s=setTimeout((()=>{i.style.display=o,s=void 0}),2e3)),setTimeout((()=>{(0,jn.cs)("capture-visible-tab").then((n=>{t(n.data),e&&i&&(i.style.display=o),void 0!==s&&clearTimeout(s)})).catch((e=>{void 0!==s&&clearTimeout(s),n(e)}))}),100)}))}(),"image/jpeg"),r=yield(0,xn.r)(s);return t.snapshot_img_key=r,yield function(e,t,n){return zn.apply(this,arguments)}(t,o,i)})),(e=>`${bn.Vl}/${e.id}`)).then((t=>{var n;pn.A.emit("onWebpageSaved",t.id),null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.web,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.web)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}));else{mn(location.href)&&un()&&!window.location.protocol.startsWith("file:")&&mo(e)}}));return function(t){return e.apply(this,arguments)}}();function mo(e){(0,zt.o2)(e.collectFrom,zt.p6.pdf),io((0,a.A)((function*(){const e=window.location.pathname.split("/").pop(),t=yield function(e){return qn.apply(this,arguments)}({url:window.location.href,filename:e||"pdf"});return t})),(e=>_o(e.id.toString()))).then((t=>{var n;null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),pn.A.emit("onWebpageSaved",t.id),(0,zt.mL)(e.collectFrom,void 0!==t.id,zt.p6.pdf,`${t.id}`)})).catch((()=>{(0,zt.mL)(e.collectFrom,!1,zt.p6.pdf)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}function po(){const e=ci.getVideoSummaryMsgBlock(),t=ci.getTranscriptData()||[],{videoSummaryId:n="",videoHighlightsId:i=""}=e,{videoId:o,title:s}=Cn.e.getState();return{transcript:t,videoId:o,title:s,videoSummaryId:n,videoHighlightsId:i}}const go=function(){var e=(0,a.A)((function*(e,t,n){var i,o;const{transcript:s,videoId:r,title:a,videoSummaryId:l}=e,{messages:c}=An.P.getState();let d="",u="";const{isDone:h,text:m=""}=c[l||""]||{},p=(null===(i=c[l||""])||void 0===i||null===(i=i.body)||void 0===i||null===(i=i.message)||void 0===i?void 0:i.meta_infos)||[];d=m,u=Ri(p);const g={summary:d,summary_msg_id:l&&h&&(null===(o=c[l])||void 0===o||null===(o=o.body)||void 0===o||null===(o=o.message)||void 0===o?void 0:o.message_id)||""||"",videoParams:{video_type:Ei(),video_url:yield Ti(r),title:a,timeline:wi(u)||[],cover_url:ji(r),cover_file_token:"",transcript:s&&s.length?JSON.stringify(s):"",video_duration:Ni()}};n({collectFrom:t,collectionType:wn.X.VideoSummary,videoSummaryResult:g})}));return function(t,n,i){return e.apply(this,arguments)}}();function vo(e){eo(),go(po(),e.collectFrom,fo)}function fo(e){if(!e.videoSummaryResult)return;const t=e.videoSummaryResult;(0,zt.o2)(zt.vP.video_page_summarize,zt.p6.videosummary),io((0,a.A)((function*(){var e;const n=yield(0,Tn.K)(nn.e.VideoSummary);let i;try{t.summary_msg_id&&(i=yield Kn(n))}catch(s){}if(i)return yield function(e){return ni.apply(this,arguments)}({id:`${i}`,summary:t.summary,summary_msg_id:t.summary_msg_id,timeline:t.videoParams.timeline});const o=null==t||null===(e=t.videoParams)||void 0===e?void 0:e.cover_url;if(null!=o&&o.startsWith("http"))try{let e;try{const{blob:t}=yield(0,_n.n_)(o);e=t}catch(s){const t=document.querySelector("video");t&&(e=(yield(0,_n.CU)(t))||void 0)}if(e){const n=yield(0,xn.r)(e);t.videoParams.cover_file_token=n}}catch(s){}return Mi()&&(t.videoParams.transcript=""),yield $n(t.summary,t.summary_msg_id,t.videoParams)})),(e=>_o(e.id.toString()))).then((t=>{var n;pn.A.emit("onWebpageSaved",t.id),null===(n=e.onSuccess)||void 0===n||n.call(e,t.id),(0,zt.mL)(zt.vP.video_page_summarize,void 0!==t.id,zt.p6.videosummary,`${t.id}`)})).catch((()=>{(0,zt.mL)(zt.vP.video_page_summarize,!1,zt.p6.videosummary)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)}))}const _o=e=>`${bn.Vl}/${e}`;const xo=(e,t,n)=>{(0,zt.o2)(t,n,"see_collection_page");const i=_o(e);window.open(i)};function yo(e){const{podcastSummaryResult:t}=e;t&&((0,zt.o2)(zt.vP.podcast_collect,zt.p6.Podcast),io((0,a.A)((function*(){const e=yield(0,Tn.K)(nn.e.PodcastSummary);let n;try{t.summary_msg_id&&(n=yield Kn(e))}catch(o){}if(n)return yield function(e){return ii.apply(this,arguments)}({id:`${n}`,summary:t.summary,summary_msg_id:t.summary_msg_id,timeline:t.podcastParams.timeline});const i=yield(0,_n.n_)(t.podcastParams.cover_url);if(null!=i&&i.blob){const e=yield(0,xn.r)(i.blob);t.podcastParams.cover_file_token=e}return yield oi(t)})),(e=>_o(e.id.toString()))).then((t=>{var n;t.id&&(null===(n=e.onSuccess)||void 0===n||n.call(e,t.id)),(0,zt.mL)(zt.vP.podcast_collect,void 0!==t.id,zt.p6.Podcast,`${t.id}`)})).catch((()=>{(0,zt.mL)(zt.vP.podcast_collect,!1,zt.p6.Podcast)})).finally((()=>{var t;null===(t=e.onFinally)||void 0===t||t.call(e)})))}var bo=n(97311),wo=n(90747),Co=n(93476),Ao=n(25218),So=n(47881),ko=n(37424);const Eo=(0,l.jc)(),To=function(){var e=(0,a.A)((function*(e,t){var n;Co.l.getState().setIsShowSidebar(!0,(null==t?void 0:t.enterMethod)||_.cz.selectAssistantMenu);let i="";const o=Qt.K9.Search;try{var s;const[e]=yield Promise.all([(0,Xt.Rf)((0,le.M$)(),1500,(()=>{A.vF.persist.error({eventName:"[SELECT_BAR] - SEARCH",error:new Error("get skill res timeout")})})),(0,ko.Z)()]);if(i=(null===(s=(0,Kt.A)(e.latest_skills,(e=>(null==e?void 0:e.skill_type)===o)))||void 0===s?void 0:s.skill_id)||"",""===i)throw new Error("search skill id is empty")}catch(u){A.vF.persist.error({message:"get skill failed",error:u})}let r={textContent:""};try{r=yield(0,en.B9)()}catch(u){A.vF.persist.error({message:"get doc failed when search",error:u})}const{convId:a,convType:l,mainBotId:c}=(0,Jt.IK)(),d={text:e||qt.t_.getState().inputText,extraExt:{input_skill:JSON.stringify({skill_id:i,skill_type:o,variables:{}}),earlier_search_result:"1",send_from_skill_guidance_or_suggestion:(0,se.TK)("authInfo").isAuthenticated?"0":"1",samantha_context:JSON.stringify((0,Ao.k)({query_context:{web_content:(null===(n=r)||void 0===n?void 0:n.textContent)||""}})),need_create_thread:l===Zt.H.NewThread?"1":"0"},reportParams:{scene:(null==t?void 0:t.scene)||bo.sJ.highlight_search_result_tool,sec_scene:(null==t?void 0:t.secScene)||bo._o.highlight_search_result_ask,use_skill:!0,skill_name:i},ctx:(0,So.Pe)(l,a,c)};yield(0,So.Bc)(l,[d])}));return function(t,n){return e.apply(this,arguments)}}(),Io=function(){var e=(0,a.A)((function*(e,t,n=!1){Ft({button_name:Ro(e),click_from:t,isSubtitle:Tt.getIsCurrentSubtitle()});const{setCurrentAction:i,setBarVisible:o,setBarFakeHide:s,setBoxVisible:r,inputText:a,setSceneId:l}=qt.t_.getState();if(!a)return;ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1);const c=(0,wo.BB)({action:(0,wo.OB)(e),triggerLogin:e===so.EU.ask,loginParams:{}});if(o(!1),e===so.EU.ask){if(c)return;const e=qt.t_.getState().inputText;return Eo?(s(!0),void To(e)):void To(t===_.Z5.shortcut?e:void 0)}if(i(e),e!==so.EU.copy)if(e!==so.EU.collect){if(e===so.EU.explain){const e=yield(0,ai.nx)(ae.Vn);null!=e&&e.textContent&&qt.t_.setState({contextText:e.textContent})}l(e===so.EU.translate?fe.Fc.ChooseWordsTranslate:void 0),n?jo(e,a):r(!0)}else ro({collectFrom:zt.vP.highlight_function_bar,collectionType:wn.X.TextFragment});else Gt()(a)}));return function(t,n){return e.apply(this,arguments)}}(),jo=function(){var e=(0,a.A)((function*(e,t){if((0,wo.BB)({action:(0,wo.OB)(e,"web"),loginParams:{trackMeta:{login_entrance:"sidebar_float"}}}))return;qt.t_.getState().clearMessages(),Co.l.getState().setIsShowSidebar(!0,_.cz.other);try{yield(0,ko.Z)()}catch(l){A.vF.persist.error({message:"page load failed",error:l})}const{convId:n,convType:i,mainBotId:o}=(0,Jt.IK)(),s={text:t,reportParams:{scene:bo.sJ.highlight_in_siderbar_chat},ctx:(0,So.Pe)(i,n,o)},r=(0,se.TK)("uiLanguage"),a=(0,se.TK)("translateLanguage");if([so.EU.translate,so.EU.explain].includes(e)){const t={[e]:"{}",browser_language:r,flag_browser_plugin:"1"};e===so.EU.translate&&(t[e]=a||"{}"),s.extraExt=t,s.reportParams.sec_scene=e===so.EU.translate?"highlight_in_siderbar_chat_translate":"highlight_in_siderbar_chat_explain"}else{const t=No(e);s.extraExt={flag_browser_plugin:"1",browser_plugin_info:JSON.stringify({frontend_source:"plugin",custom_prompt_skill_id:e,lang:a||r,custom_ref_show_variable:{title:(null==t?void 0:t.name)||"",icon:(null==t?void 0:t.icon)||""}}),need_create_thread:i===Zt.H.NewThread?"1":"0"}}yield(0,So.Bc)(i,[s])}));return function(t,n){return e.apply(this,arguments)}}(),No=e=>{const t=(0,se.TK)("readingPopupActions"),n=(0,se.TK)("editingPopupActions");return t.actionList.find((t=>t.id===e))||t.moreActionList.find((t=>t.id===e))||n.actionList.find((t=>t.id===e))||n.moreActionList.find((t=>t.id===e))},Ro=e=>{var t;return(0,so.em)(e)?(null===(t=No(e))||void 0===t?void 0:t.name)||"customized_button":e};var Mo=n(27609);function Po(e,t,n){const i=n=>{var i;const o=null===(i=n.composedPath)||void 0===i?void 0:i.call(n);o&&!t.some((e=>!!e.current&&o.includes(e.current)))&&e()};return(0,m.useEffect)((()=>(document.addEventListener("pointerdown",i),()=>{document.removeEventListener("pointerdown",i)})),[...t,...n||[]]),t}const Lo={"cici-ext-container":"cici-ext-container-rHktgd",ciciExtContainer:"cici-ext-container-rHktgd","inactivelink-hover-animation":"inactivelink-hover-animation-bsDtJw",inactivelinkHoverAnimation:"inactivelink-hover-animation-bsDtJw","notactivelink-hover-animation":"notactivelink-hover-animation-mWP6z9",notactivelinkHoverAnimation:"notactivelink-hover-animation-mWP6z9","light-click-animation":"light-click-animation-GPX_a3",lightClickAnimation:"light-click-animation-GPX_a3","click-animation":"click-animation-h3Ddrd",clickAnimation:"click-animation-h3Ddrd","semi-animation-rotate":"semi-animation-rotate-f09XQ1",semiAnimationRotate:"semi-animation-rotate-f09XQ1","inactive-btn-hover-animation":"inactive-btn-hover-animation-N6PjHc",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-N6PjHc","cici-ext-always-dark":"cici-ext-always-dark-_ihuvp",ciciExtAlwaysDark:"cici-ext-always-dark-_ihuvp","cici-ext-always-light":"cici-ext-always-light-jaQijK",ciciExtAlwaysLight:"cici-ext-always-light-jaQijK",ellipsis:"ellipsis-E3jYqE",configBtnContainer:"configBtnContainer-PyLLM0",isOpen:"isOpen-nUJVGv",configBtn:"configBtn-PHODxg",moreIconContainer:"moreIconContainer-O4DZxj",name:"name-rkPj8K",dropdownContainer:"dropdownContainer-sjKguw",dropdownItem:"dropdownItem-hFsOSP",moreArrow:"moreArrow-drLkaI","activelink-hover-animation":"activelink-hover-animation-PQUMN2",activelinkHoverAnimation:"activelink-hover-animation-PQUMN2"};var Bo=n(79309),Do=n(66714),Oo=n(79724);const Fo={"cici-ext-container":"cici-ext-container-ZXIrSN",ciciExtContainer:"cici-ext-container-ZXIrSN","inactivelink-hover-animation":"inactivelink-hover-animation-rw7qIp",inactivelinkHoverAnimation:"inactivelink-hover-animation-rw7qIp","notactivelink-hover-animation":"notactivelink-hover-animation-ybLE6S",notactivelinkHoverAnimation:"notactivelink-hover-animation-ybLE6S","light-click-animation":"light-click-animation-pnkngZ",lightClickAnimation:"light-click-animation-pnkngZ","click-animation":"click-animation-biWpBI",clickAnimation:"click-animation-biWpBI","semi-animation-rotate":"semi-animation-rotate-mQlH3b",semiAnimationRotate:"semi-animation-rotate-mQlH3b","inactive-btn-hover-animation":"inactive-btn-hover-animation-ryMlR1",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-ryMlR1","cici-ext-always-dark":"cici-ext-always-dark-Ms9LjO",ciciExtAlwaysDark:"cici-ext-always-dark-Ms9LjO","cici-ext-always-light":"cici-ext-always-light-RjPqkd",ciciExtAlwaysLight:"cici-ext-always-light-RjPqkd",ellipsis:"ellipsis-oS6yYX",container_mac:"container_mac-Zkbzgm",containerMac:"container_mac-Zkbzgm",container:"container-XWDV0F","action-container":"action-container-IZGz9g",actionContainer:"action-container-IZGz9g",actions:"actions-CriGMt",btnArea:"btnArea-SqnOyh",dropdownRight:"dropdownRight-kAsuSU",btnActive:"btnActive-bdZkh2",askBtn:"askBtn-LyFDUw",dropDown:"dropDown-coUCnI",dropItem:"dropItem-COx823",icon:"icon-edhNJn",name:"name-VSTPWY",divider:"divider-Og5Pde",extra:"extra-nu7DvO",closeBtnContainer:"closeBtnContainer-DOn6ux",closeBtn:"closeBtn-yuxJN3",closeBtnVisible:"closeBtnVisible-YjzwHn",closeBtnActive:"closeBtnActive-Lc6OPB",changeTone:"changeTone-lO7I5p","activelink-hover-animation":"activelink-hover-animation-UNXOi0",activelinkHoverAnimation:"activelink-hover-animation-UNXOi0"},Uo=e=>{const t=e.size;return(0,Te.jsx)(Pe.wv,{style:{fontSize:t}})},Ho=(0,l.jc)(),zo=e=>{const t=(0,v.B)(),{selectBarOnlyIcon:n,getPopupContainer:i}=e,{inputText:o}=(0,qt.t_)(),{audioStatus:s,togglePlay:r}=(0,Bo.$)(o),a=s.loading?Do.L:s.playing?Oo.d:Uo;let l;const c=t("flow_web_ext_tts_start","\u5f00\u59cb\u6717\u8bfb"),d=t("flow_web_ext_tts_stop","\u505c\u6b62\u6717\u8bfb");l=n?s.loading||s.playing?d:c:s.loading||s.playing?d:void 0,Ho&&(l=void 0);const u=(0,Te.jsx)(je.$n,{className:J()(Fo.btnArea,{[Fo.btn_area_mac]:Ho}),onPointerUp:r,icon:(0,Te.jsx)(a,{size:16}),"data-testid":`select-bar-${so.EU.pronounce}-action`,children:!n&&(0,Te.jsx)("span",{className:J()(Fo.name,{[Fo.isCustomkill]:!0}),children:"\u6717\u8bfb"})});return(0,Te.jsx)("div",{children:l?(0,Te.jsx)(je.m_,{content:l,spacing:16,getPopupContainer:i,children:u}):u},so.EU.pronounce)},qo=()=>{const{inputText:e}=(0,qt.t_)(),{audioStatus:t,togglePlay:n}=(0,Bo.$)(e),i=t.loading?Do.L:t.playing?Oo.d:Uo;return(0,Te.jsxs)(je.ms.Item,{onClick:e=>{e.preventDefault(),e.stopPropagation(),n()},"data-testid":`select-bar-more-${so.EU.pronounce}-action`,className:Lo.dropdownItem,children:[(0,Te.jsx)("div",{className:J()(Lo.moreIconContainer,"menu-item-icon"),children:(0,Te.jsx)(i,{size:16})}),(0,Te.jsx)("span",{className:J()(Lo.name,"menu-item-name"),children:"\u6717\u8bfb"})]},so.EU.pronounce)},Vo=({className:e,customMenus:t,onHideMenu:n})=>{const i=(0,v.B)(),o=(0,m.useCallback)(((e,t={})=>{Ft({button_name:e,click_from:_.Z5.selectAssistantMoreMenu,isSubtitle:Tt.getIsCurrentSubtitle()}),(0,Vt.I)((0,r.A)((0,r.A)({},t),{},{enter_method:_.cz.selectAssistantMenu,settting_key:"toolbar-configuration"}))}),[]),s=(0,m.useMemo)((()=>[{title:i("flow_web_ext_setting_toolbar_discover"),icon:(0,Te.jsx)(ct.A,{}),btnName:_.Yd.discoverSkill,handleClick:()=>o(_.Yd.discoverSkill,{discover_skill:"true"})},{title:i("flow_web_ext_setting_toolbar_addskill"),icon:(0,Te.jsx)(dt.A,{}),btnName:_.Yd.addASkill,handleClick:()=>o(_.Yd.addASkill,{add_prompt:"true"})},{title:i("flow_web_ext_action_settings"),icon:(0,Te.jsx)(ut.A,{}),btnName:_.Yd.setting,handleClick:()=>o(_.Yd.setting)}]),[i]);return(0,m.useEffect)((()=>{s.forEach((e=>{Ot({button_name:e.btnName,show_from:_.Z5.selectAssistantMoreMenu,isSubtitle:Tt.getIsCurrentSubtitle()})}))}),[]),(0,Te.jsxs)(je.ms.Menu,{style:{padding:0},className:e,children:[s.map((e=>(0,Te.jsxs)(je.ms.Item,{onClick:()=>{null==n||n(),e.handleClick()},"data-testid":`select-bar-more-setting-${e.btnName}-action`,className:Lo.dropdownItem,children:[(0,Te.jsx)("div",{className:J()(Lo.moreIconContainer,"menu-item-icon"),children:e.icon}),(0,Te.jsx)("span",{className:J()(Lo.name,"menu-item-name"),children:e.title})]},e.title))),t]})},$o=({actions:e,onClickItem:t,getPopupContainer:n,menuClassName:i,subDropdownClassName:o,subDropdownSpacing:s})=>{var r;const a=Wt(),l=(null==a||null===(r=a.compose)||void 0===r?void 0:r.tone)||[],c=(0,v.B)();(0,m.useEffect)((()=>{e.forEach((e=>{Ot({button_name:Ro(e.id),show_from:_.Z5.selectAssistantMoreMenu,isSubtitle:Tt.getIsCurrentSubtitle()})}));e.find((e=>e.id===so.EU.collect))&&(0,zt.ae)(zt.vP.highlight_function_bar,zt.p6.textfragment)}),[e]);return(0,Te.jsx)(je.ms.Menu,{style:{padding:0},className:i,children:e.map((e=>(e=>{const r=e.id===so.EU.adjust_skill,a=e.id===so.EU.pronounce,d=(0,Te.jsxs)(je.ms.Item,{onClick:r||a?void 0:n=>t(e,n),"data-testid":`select-bar-more-${e.id}-action`,className:Lo.dropdownItem,children:[(0,Te.jsx)("div",{className:J()(Lo.moreIconContainer,"menu-item-icon"),children:(0,Pe.I)(e.icon)}),(0,Te.jsx)("span",{className:J()(Lo.name,"menu-item-name"),children:c(e.name,e.options)}),r&&(0,Te.jsx)("span",{className:J()(Lo.moreArrow,"menu-item-right-arrow"),children:(0,Te.jsx)(lt.A,{})})]},e.id);return a?(0,Te.jsx)(qo,{}):r?(0,Te.jsx)(je.ms,{className:J()(Lo.dropdownContainer,o),getPopupContainer:n,trigger:"hover",position:"rightTop",spacing:s,render:(0,Te.jsx)("div",{onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:(0,Te.jsx)(je.ms.Menu,{className:i,children:l.map((n=>(0,Te.jsx)(je.ms.Item,{className:Lo.dropdownItem,onClick:i=>{qt.t_.getState().setTone(n),t(e,i)},children:n.show_name},n.value)))})}),children:d},e.id):d})(e)))})},Wo=e=>{var t;const{setMoreBtnVisible:n,handleClickBtn:i,setDisableMenuVisible:o,disableMenuVisible:s,moreActionList:r=[],isDemo:a=!1}=e,[l,c]=(0,m.useState)(!1),d=null===(t=(0,Mo.A)())||void 0===t?void 0:t.getPopupContainer,[u]=(0,f.Y)("isSelectbarMoreMenuClicked"),h=(0,m.useRef)(null),p=(0,m.useRef)(null);Po((()=>{c(!1)}),[h,p]);const g=(0,m.useCallback)((()=>{c(!l),o(!1),(0,se.vE)("isSelectbarMoreMenuClicked",!0)}),[l]);return(0,m.useEffect)((()=>{s&&c(!1)}),[s]),(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)(je.ms,{visible:l,trigger:"custom",getPopupContainer:d,spacing:6,position:"bottomRight",onClickOutSide:()=>c(!1),className:Lo.dropdownContainer,render:(0,Te.jsxs)("div",{ref:h,onMouseEnter:()=>{n(!1)},onPointerUp:()=>{n(!1)},children:[r.length>0&&(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)($o,{actions:r,onClickItem:(...e)=>{i(...e),c(!1)},getPopupContainer:d}),(0,Te.jsx)("div",{style:{paddingLeft:10,paddingRight:10},children:(0,Te.jsx)(je.cG,{margin:5})})]}),(0,Te.jsx)(Vo,{onHideMenu:()=>{c(!1)}})]}),children:(0,Te.jsx)("div",{ref:p,className:J()(Lo.configBtnContainer,{[Lo.isOpen]:l}),children:(0,Te.jsx)("button",{type:"button",className:Lo.configBtn,onPointerUp:g,"data-testid":"select-bar-more-action",children:a||l||u?(0,Te.jsx)(ht.A,{}):(0,Te.jsx)(je.Ex,{dot:!0,type:"danger",children:(0,Te.jsx)(ht.A,{})})})})})})};var Ko=n(56642),Yo=n(41354),Go=n(45041),Qo=n(20309);function Zo(e){var t;const{getPopupContainer:n,onItemClick:i}=e,o=(0,v.B)(),s=Wt(),r=(null==s||null===(t=s.compose)||void 0===t?void 0:t.tone)||[],[a,l]=(0,m.useState)(!1),c=(0,m.useRef)(null),d=(0,m.useRef)(null);return Po((()=>{l(!1)}),[c,d]),(0,Te.jsx)("div",{className:Fo.changeTone,children:(0,Te.jsx)(je.ms,{className:Lo.dropdownContainer,spacing:2,trigger:"custom",visible:a,getPopupContainer:n,render:(0,Te.jsx)("div",{ref:c,children:(0,Te.jsx)(je.ms.Menu,{children:r.map(((e,t)=>(0,Te.jsx)(je.ms.Item,{className:Lo.dropdownItem,"data-testid":`writing-change-tone-${t}`,onClick:t=>{e.value&&i(e,t)},children:e.show_name},e.value)))})}),children:(0,Te.jsx)("div",{ref:d,children:(0,Te.jsxs)(je.$n,{"data-testid":e["data-testid"],onClick:()=>{l(!a)},className:J()(Fo.btnArea,{[Fo.btnActive]:a}),icon:(0,Te.jsx)(Go.A,{}),children:[(0,Te.jsx)("span",{children:o("modify_change_tone")}),(0,Te.jsx)("span",{className:Fo.dropdownRight,children:a?(0,Te.jsx)(Qo.A,{}):(0,Te.jsx)(ht.A,{})})]})})})})}var Xo=n(4252),Jo=n(64123),es=n(10242);const ts=e=>{const[t,n]=(0,f.Y)("shortcutsConfig"),i=t[e]||es.A[e];return{shortcutKey:i.key,setShortcutKey:o=>{n(Object.assign(t,{[e]:(0,r.A)((0,r.A)({},i),{},{key:o})}))}}},ns=(0,l.jc)();function is(e){const{item:t,selectBarOnlyIcon:n,onClick:i,getPopupContainer:o}=e,s=(0,v.B)(),r=(0,so.em)(t.id),a=t.id===so.EU.ask,{shortcutKey:l}=ts(Xo.e.OpenSide);if(t.id===so.EU.pronounce)return(0,Te.jsx)(zo,{selectBarOnlyIcon:n,getPopupContainer:o});if(t.id===so.EU.adjust_skill)return(0,Te.jsx)(Zo,{"data-testid":`select-bar-${t.id}-action`,onItemClick:(e,n)=>{qt.t_.getState().setTone(e),i(t,n)},getPopupContainer:o});const c=(0,Te.jsx)(je.$n,{className:J()(Fo.btnArea,{[Fo.btn_area_mac]:ns}),onPointerUp:e=>i(t,e),icon:(0,Pe.I)(t.icon),"data-testid":`select-bar-${t.id}-action`,children:!n&&(0,Te.jsx)("span",{className:J()(Fo.name,{[Fo.isCustomSkill]:r}),children:s(t.name,t.options)})}),d=(n||a)&&!ns,u=d?(e=>{let t="";return n?(t=s(e),a&&l&&(t+=` (${(0,Jo.o)(l)})`),t):(a&&l&&(t=(0,Jo.o)(l)),t)})(t.name):"";return(0,Te.jsx)("div",{children:d&&u?(0,Te.jsx)(je.m_,{content:u,spacing:16,getPopupContainer:o,children:c}):c},t.id)}var os=n(78503);const ss=(0,l.jc)();function rs(e){var t;const{selectBarOnlyIcon:n,availableActionList:i,moreActionList:o=[],isDemo:s}=e,[r,a]=(0,m.useState)(!1),[l,c]=(0,m.useState)(!1),d=null===(t=(0,Mo.A)())||void 0===t?void 0:t.getPopupContainer,u=(0,qt.t_)((e=>e.setBarVisible)),h=(0,Co.l)((e=>e.setIsShowQuick)),p=null==i?void 0:i.map((e=>e.id)).join("");(0,m.useEffect)((()=>{i.forEach((e=>{Ot({button_name:Ro(e.id),show_from:_.Z5.selectAssistantMenu,isSubtitle:Tt.getIsCurrentSubtitle()})}))}),[p]);const g=(0,yn.kW)(),v=()=>{h(!1),u(!1)},f=(e,t,n=!1)=>{e.id===so.EU.ask&&(t.preventDefault(),t.stopPropagation()),Io(e.id,n?_.Z5.selectAssistantMoreMenu:_.Z5.selectAssistantMenu,"sidebar"===e.displayMode)},x=e=>{e.preventDefault(),e.stopPropagation()},y=r||g||ss,b=(0,m.useCallback)(((e,t)=>f(e,t,!0)),[]);(0,m.useEffect)((()=>{i.find((e=>e.id===so.EU.collect))&&(0,ot.ku)()&&(0,zt.ae)(zt.vP.highlight_function_bar,zt.p6.textfragment)}),[]);return(0,Te.jsx)("div",{className:ss?Fo.container_mac:Fo.container,"data-testid":"select-bar-container",children:(0,Te.jsxs)("div",{onMouseDown:x,className:Fo["action-container"],children:[(0,Te.jsx)("div",{className:Fo.actions,children:i.map((e=>(0,Te.jsx)(is,{item:e,selectBarOnlyIcon:n,getPopupContainer:d,onClick:f},e.id)))}),(0,Te.jsx)(je.cG,{margin:2,layout:"vertical",style:{height:12}}),(0,Te.jsxs)("div",{className:Fo.extra,onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{l||a(!1)},children:[(0,Te.jsx)(Wo,{setMoreBtnVisible:a,handleClickBtn:b,disableMenuVisible:l,setDisableMenuVisible:c,moreActionList:o,isDemo:s}),(0,Te.jsx)(xe.A,{cssStyle:{position:"relative",height:"100%"},optionPageSection:"toolbar-configuration",position:"bottomRight",spacing:0,onDisableOnceClick:v,disableKey:os.lf.selectAssistant,show:l,setShow:c,renderChildren:({onTriggerClick:e})=>(0,Te.jsx)("div",{className:Fo.closeBtnContainer,children:(0,Te.jsx)(Pe.gz,{className:J()(Fo.closeBtn,{[Fo.closeBtnVisible]:y,[Fo.closeBtnActive]:l}),onClick:t=>{l?c(!l):e(t)}})})})]})]})})}var as=n(93804);const ls="rootContainer-W2lELf",cs="contentContainer-Iw2rQe",ds="popover-container-uaJ7XT",us=e=>{const{selectBarOnlyIcon:t,availableActionList:n,moreActionList:i,isDemo:o,setRePosKeyInner:s}=e,r=(0,m.useRef)(null),{height:a}=(0,Yo.w)({ref:r});return(0,m.useEffect)((()=>{setTimeout((()=>{if(!r.current)return;const{clientWidth:e,clientHeight:t}=r.current,{parentElement:n}=r.current;n&&(n.style.height=`${Math.round(t)}px`,n.style.width=`${Math.round(e)+Math.round(e)%2}px`),s(Date.now())}),0)}),[n,r.current,a]),(0,Te.jsx)("div",{className:ls,children:(0,Te.jsx)("div",{className:J()(cs),ref:r,children:(0,Te.jsx)(rs,{selectBarOnlyIcon:t,availableActionList:n,moreActionList:i,isDemo:o})})})},hs=e=>{var t;const n=null===(t=(0,m.useContext)(as.A))||void 0===t?void 0:t.getPopupContainer,{children:i,visible:o,rePosKey:s,autoAdjustOverflow:a,style:l={},selectBarOnlyIcon:c,availableActionList:d,moreActionList:u=[],position:h="top",getPopupContainer:p=n,isDemo:g}=e,[v,f]=(0,m.useState)(s);return(0,m.useEffect)((()=>{f(s)}),[s]),(0,Te.jsx)(je.AM,{position:h,showArrow:!1,content:(0,Te.jsx)(us,{selectBarOnlyIcon:c,availableActionList:d,moreActionList:u,isDemo:g,setRePosKeyInner:f}),trigger:"custom",visible:o,getPopupContainer:p,style:(0,r.A)((0,r.A)({},{boxShadow:"none",padding:"0",backgroundColor:"transparent"}),l),rePosKey:v,autoAdjustOverflow:a,children:i})};var ms=n(55322),ps=n(22074);const gs=()=>{const e=(0,qt.t_)((e=>e.writeEnabled),Ko.x),[t]=(0,f.Y)("editingPopupActions"),[n]=(0,f.Y)("readingPopupActions"),{availableActionList:i,moreActionList:o}=(0,m.useMemo)((()=>({availableActionList:[...[...so.y3].map((e=>so.YN[e])),...e?t.actionList:n.actionList],moreActionList:e?t.moreActionList:n.moreActionList})),[e,t,n]);return{moreActionList:o,availableActionList:i}},vs=e=>{const[t,n]=(0,qt.t_)((e=>[e.barVisible,e.barFakeHide]),Ko.x),{top:i,left:o,width:s,height:a}=e.selectionData,c=(0,ps.Im)()||(0,l.UP)()||(0,ms.m)()||(0,ps.L8)(),d=c?5:-5,u=c?"bottom":"top",h={top:`${i+window.scrollY+d}px`,left:`${o+window.scrollX}px`,height:`${a}px`,width:`${s}px`};(0,m.useEffect)((()=>{t&&Dt(Tt.getIsCurrentSubtitle()?1:0)}),[t]);const[p]=(0,f.Y)("selectBarOnlyIcon"),{availableActionList:g,moreActionList:v}=gs();return(0,Te.jsx)(hs,{selectBarOnlyIcon:p,availableActionList:g,moreActionList:v,visible:t,position:u,rePosKey:JSON.stringify(h),autoAdjustOverflow:!0,style:{visibility:n?"hidden":"visible"},children:(0,Te.jsx)("span",{style:(0,r.A)({position:"absolute",pointerEvents:"none"},h)})})};var fs=n(76360);const _s={"bar-container":"bar-container-n6ANkw",barContainer:"bar-container-n6ANkw",dropdown:"dropdown-GFFKYw",subDropdown:"subDropdown-eKKQE3"},xs=({onClickItem:e=h.A,getPopupContainer:t})=>{const n=(0,v.B)(),{moreActionList:i,availableActionList:o}=gs(),s=(0,m.useMemo)((()=>[...o,...i].map((e=>"browser_ask"===e.id?(0,r.A)((0,r.A)({},e),{},{icon:"searchAI"}):e))),[o,i]);return(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)($o,{actions:s,getPopupContainer:t,onClickItem:t=>{e(t),Io(t.id,_.Z5.selectAssistantMoreMenu,"sidebar"===t.displayMode)},subDropdownSpacing:{x:9,y:0},subDropdownClassName:_s.subDropdown}),(0,Te.jsx)(je.cG,{margin:5}),(0,Te.jsx)(Vo,{customMenus:(0,Te.jsx)(je.ms,{className:_s.subDropdown,spacing:{x:9,y:0},getPopupContainer:t,trigger:"hover",position:"rightTop",content:(0,Te.jsx)("div",{onMouseDown:e=>e.stopPropagation(),children:(0,Te.jsx)(xe.u,{optionPageSection:"toolbar-configuration",disableKey:fe.lf.selectAssistant,onDisableOnceClick:()=>{qt.t_.getState().setBarVisible(!1),Co.l.getState().setIsShowQuick(!1)}})}),children:(0,Te.jsxs)(je.ms.Item,{children:[(0,Te.jsx)("div",{className:"menu-item-icon",children:(0,Te.jsx)(Pe.Hx,{className:"menu-item-icon"})}),(0,Te.jsx)("div",{className:"menu-item-name",children:n("flow_web_ext_action_disable")}),(0,Te.jsx)(lt.A,{className:"menu-item-right-arrow"})]})})})]})},ys=()=>{const e=(0,m.useRef)(null),{barVisible:t,boxVisible:n}=(0,qt.t_)(),{provider:i}=(0,m.useContext)(rt),o=(0,v.B)();return(0,m.useEffect)((()=>{i&&(!t&&n?i.hideBar():i.showBar())}),[t,n,i]),(0,m.useEffect)((()=>{t&&Dt()}),[t]),(0,Te.jsxs)("div",{"theme-mode":null==i?void 0:i.getThemeMode(),className:J()("cici-ext-container",_s["bar-wrapper"]),children:[(0,Te.jsx)("div",{ref:e,style:{position:"absolute",top:40,right:0}}),(0,Te.jsx)(je.ms,{spacing:{x:0,y:12},className:_s.dropdown,trigger:"click",getPopupContainer:()=>e.current,content:(0,Te.jsx)(xs,{getPopupContainer:()=>e.current}),children:(0,Te.jsxs)("div",{className:_s["bar-container"],children:[(0,Te.jsx)("img",{src:(0,fs.Nf)()}),(0,Te.jsx)("span",{children:o("flow_web_ext_newtab_ask",{brandName:(0,fs.L2)()})})]})})]})};var bs=n(5440),ws=n(25478);function Cs(e,t,n,i=!1){try{const i=!(t.length>0)||(0,ws.A)(t)(e),o=n.length>0&&(0,ws.A)(n)(e);return i&&!o}catch(o){return i}}var As=n(93042);const Ss=()=>{const e=(0,qt.t_)((e=>e.inputText)),[t,n]=(0,m.useState)(!1),i=(0,As.A)("feishu_select_toolbar").enable;return(0,m.useEffect)((()=>{(0,ps.Im)()&&n((()=>Boolean((0,bs.GT)(["docx-page-block","editor-container"]))))}),[e]),t&&i};function ks(){const[e,t]=(0,m.useState)(!1),n=(0,qt.t_)((e=>e.inputText)),i=(0,Co.l)((e=>e.isShowQuick)),[o]=(0,f.Y)("quickDisabledHosts"),[s]=(0,f.Y)("quickDisabledAll"),r=null==o?void 0:o.includes(window.location.host),a=function(){const{disabled_urls:e=[]}=(0,As.A)("selection_bar"),t=window.location.href.replace(/^http?s:\/\//i,"");return(0,m.useMemo)((()=>!Cs(t,[],e,!0)),[e,t])}();return(0,m.useEffect)((()=>{t(!!n&&(0,bs.GT)(["flow-ext-disable-select-bar"]))}),[n]),!i||r||s||e||a}const Es=()=>{const e=(0,Je.Uk)(),t=ks(),n=Ss();return!t&&n?(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t:e,children:(0,Te.jsx)(ys,{})})}):null},Ts=()=>(0,ps.Im)()?(st.init((e=>(e=>{const t=u.m.getInstance().getHostId()||"",n=(e=>`flow-ext-feishu-toolbar-${e}`)(t);if(document.body.querySelector(`#${n}`))return;e.id=n,e.dataset.buttonHostId=t;const i=(e.firstElementChild||e).attachShadow({mode:"open"}),o=(0,p.createRoot)(i);(0,et.NR)(i,ae.QN).then((()=>{o.render((0,Te.jsx)(rt.Provider,{value:{provider:st},children:(0,Te.jsx)(Es,{})}))}))})(e))),()=>st.destroy()):h.A;var Is=n(6693);var js=n(18935);const Ns=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M17.38 9.558a3.113 3.113 0 0 1-3.113-3.111v-.001a3.113 3.113 0 1 1 3.112 3.112m1.55-4.7a.4.4 0 0 1 .15.32q-.001.09-.037.174l-.002.003a1 1 0 0 1-.067.13l-.001.002-1.527 2.424a.54.54 0 0 1-.185.173.498.498 0 0 1-.473.005.6.6 0 0 1-.191-.166l-.8-.991a.6.6 0 0 1-.085-.151.5.5 0 0 1-.032-.174.446.446 0 0 1 .647-.402.6.6 0 0 1 .172.154l.499.645 1.239-2.017c.087-.144.216-.24.386-.24q.174 0 .307.112m-5.33-.83H8.753c-.232 0-.489 0-.712.017-.254.019-.595.067-.949.234a2.4 2.4 0 0 0-1.085 1.009c-.18.328-.232.646-.252.881a8 8 0 0 0-.019.662v11.484c0 .034 0 .138.01.236v.006c.008.085.044.474.363.832a1.68 1.68 0 0 0 1.319.545c.499-.019.835-.254.908-.305l.005-.004c.085-.059.168-.129.195-.151l.006-.006 3.366-2.815 3.367 2.815.006.006c.027.022.11.092.195.151l.005.004c.073.05.409.286.908.305a1.68 1.68 0 0 0 1.319-.546c.318-.357.355-.747.363-.831v-.006c.01-.098.01-.202.01-.236v-7.562s-.403.201-.784.201c-.42 0-.745-.201-.745-.201v7.554c0 .101 0 .152-.022.177a.1.1 0 0 1-.077.032c-.035-.002-.075-.036-.156-.103l-3.366-2.816c-.362-.302-.542-.453-.747-.51-.18-.05-.372-.05-.552 0-.204.057-.384.208-.746.51L7.52 18.413c-.081.067-.122.101-.156.103a.1.1 0 0 1-.078-.032c-.022-.025-.022-.076-.022-.177V6.867c0-.496 0-.745.105-.935a.92.92 0 0 1 .417-.387c.204-.097.472-.097 1.007-.097h3.874c0-.115.086-1.169.933-1.42",clipRule:"evenodd"})})),Rs=(0,js.a)((0,Te.jsx)(Ns,{}));var Ms=n(27398);const Ps="collectBtnSpin-XQUUP9",Ls="collectBtnIcon-qeRZ02",Bs=e=>{const t=(null==e?void 0:e.iconSize)||16,[n,i]=(0,m.useState)(Boolean(null==e?void 0:e.collectId)&&!(null!=e&&e.enableRepeatCollect)),[o,s]=(0,m.useState)(!1),[l,c]=(0,m.useState)((null==e?void 0:e.collectId)||""),d=(0,m.useMemo)((()=>o?(0,Te.jsx)(je.tK,{wrapperClassName:J()(Ps),style:{width:t,height:t}}):(0,Te.jsx)("div",{className:J()(Ls),style:{fontSize:t},children:n?(0,Te.jsx)(Rs,{}):(0,Te.jsx)(Ms.A,{})})),[n,o]);return(0,m.useEffect)((()=>{void 0!==(null==e?void 0:e.collectId)&&(i(Boolean(null==e?void 0:e.collectId)&&!e.enableRepeatCollect),c(e.collectId))}),[null==e?void 0:e.collectId]),{onCollectionClick:(u=(0,a.A)((function*(){if(o)return;if(!e)return;const{getCollectionParam:t,click_from:a,collect_type:d,enableRepeatCollect:u,onSuccess:h,onRemove:m}=e;if(n)return ao(l,a,d),c(""),i(!1),void(null==m||m());s(!0);const p=yield t();ro((0,r.A)((0,r.A)({},p),{},{onSuccess:e=>{i(!u),c(e),null==h||h(e)},onFinally:()=>{s(!1)}}))})),function(){return u.apply(this,arguments)}),collected:n,loading:o,collectionIcon:d,collectionId:l};var u},Ds="savedTipContainer-b9ZrP2",Os="collectDivider-VCkruX",Fs="savedTipCheckBtn-jqlczO",Us="tipContainer-oCCxst",Hs=({savedId:e,collected:t,parentCollectionId:n,savedCollectionText:i="",waitCollectionText:o="",clickFrom:s,collectType:r})=>{const a=(0,v.B)();return e&&t?((0,zt.NP)(s),(0,Te.jsxs)("div",{className:Ds,children:[(0,Te.jsx)("div",{children:i||a("flow_web_ext_pdf_page_bookmarked")}),(0,Te.jsx)(je.cG,{layout:"vertical",margin:9,className:Os}),(0,Te.jsx)("div",{onClick:t=>{xo(n?`${n}?mark_child=${e}`:`${e}`,s,r),t.stopPropagation()},onPointerUp:e=>{e.stopPropagation()},className:Fs,"data-testid":"collection-tooltip-check",children:a("flow_web_ext_bookmarks_saved_view")})]})):(0,Te.jsx)("div",{className:Us,children:o||a("flow_web_ext_pdf_page_bookmarks",{brandName:(0,fs.L2)()})})};var zs=n(20881),qs=n.n(zs);const Vs="collectionImgBtnContainer-TMhC6C",$s="collectionImgBtn-dLkhgp",Ws="collectionImgBtnContent-O8wjlF",Ks="text-K8iY38",Ys="disableOptions-ERwATX",Gs="closeBtn-_RGmky",Qs="closeIcon-C6XumU",Zs="disableIconMask-osO9Bj",Xs=new Map,Js=({position:e,target:t,url:n,disableOptionsShow:i,setDisableOptionsShow:o,onDisableOnceClick:s})=>{const r=(0,Je.Uk)(),[l,c]=(0,m.useState)(void 0),[d,u]=(0,m.useState)(!1),h=(0,m.useRef)(null),p=(0,m.useRef)(null),{onCollectionClick:g,collectionIcon:v,collected:f,collectionId:_}=Bs({getCollectionParam:(x=(0,a.A)((function*(){const e=yield(e=>new Promise((t=>{if(!e)return void t({width:0,height:0});const n=new Image;n.src=e,n.onload=()=>{t({width:n.naturalWidth,height:n.naturalHeight})},n.onerror=()=>{t({width:0,height:0})},setTimeout((()=>{t({width:0,height:0})}),1e3)})))(n),{width:i,height:o}=t.getBoundingClientRect();return{collectFrom:zt.vP.webimage_collect,collectionType:wn.X.Image,image_result:{url:n,width:e.width||i,height:e.height||o}}})),function(){return x.apply(this,arguments)}),click_from:zt.vP.webimage_collect,collect_type:zt.p6.Image,collectId:l,onSuccess:e=>Xs.set(n,e),onRemove:()=>Xs.delete(n)});var x;const y=function(){var e=(0,a.A)((function*(){const e=Xs.get(n);if(e)c(e);else{c(void 0);try{const e=yield(0,Tn.K)(nn.e.Image,n),t=yield Kn(e);t&&(c(t),Xs.set(n,t))}catch(t){(0,zs.error)("check image collect fingerprint error",t),c("")}}}));return function(){return e.apply(this,arguments)}}();return(0,m.useEffect)((()=>{y(),(0,zt.ae)(zt.vP.webimage_collect,zt.p6.Image)}),[t,n]),(0,m.useEffect)((()=>{d&&p.current&&h.current&&(p.current.style.width=`${h.current.getBoundingClientRect().width}px`)}),[f,_]),(0,Te.jsxs)("div",{className:J()(Vs,"cici-ext-container","cici-ext-always-light","semi-always-light"),style:{left:e.x,top:e.y,zIndex:ae.Ow},onMouseEnter:()=>{u(!0),p.current&&h.current&&(p.current.style.width=`${h.current.getBoundingClientRect().width}px`)},onMouseLeave:()=>{u(!1),p.current&&(p.current.style.width=""),o(!1)},onClick:g,ref:p,children:[(0,Te.jsx)("div",{className:$s,children:(0,Te.jsxs)("div",{className:Ws,ref:h,children:[v,(0,Te.jsx)("div",{className:Ks,children:(0,Te.jsx)(Hs,{collected:f,savedId:_,collectType:zt.p6.Image,clickFrom:zt.vP.webimage_collect,waitCollectionText:r("flow_ext_web_img_bookmark_btn")})})]})}),(0,Te.jsxs)("div",{className:Ys,children:[(0,Te.jsx)(xe.A,{disableKey:fe.lf.collectionImage,onDisableOnceClick:s,show:i,setShow:o,className:J()(Gs),optionPageSection:"collection",position:"right",renderChildren:({onTriggerClick:e})=>(0,Te.jsx)(ve.A,{className:Qs,onClick:t=>{t.preventDefault(),t.stopPropagation(),i?o(!i):e(t)}})}),(0,Te.jsx)("div",{className:Zs,style:{display:i?"unset":"none"}})]})]})},er=["doubao.com","ciciai.com","youtube.com","bilibili.com"],tr=()=>{const[e,t]=(0,m.useState)(void 0),[n,i]=(0,m.useState)(!0),[o,s]=(0,m.useState)(!1),[r]=(0,f.Y)("collectImageDisabledAll"),[a]=(0,f.Y)("collectImageDisabledHosts"),{image_enabled:l,image_collection_disable_hosts:c,image_enabled_size:d}=(0,As.A)("collection_assistant"),u=(0,m.useMemo)((()=>{const e=[...a,...er,...c].find((e=>window.location.host.includes(e)));return n&&l&&!r&&!e}),[r,a,l,n]);(0,m.useEffect)((()=>{if(!u)return;const e=(0,Is.A)((e=>{const{target:n}=e;if(n instanceof HTMLElement&&n.closest(`div[id*=${ae.EN}]`))return;let i;if(n instanceof HTMLElement){const{width:e,height:t}=n.getBoundingClientRect();if(e>d.width&&t>d.height)if("IMG"===n.nodeName){const{src:e}=n;e&&(i={element:n,url:e})}else{const{backgroundImage:e}=window.getComputedStyle(n);if(e.includes("url")){i={element:n,url:e.substring(5,e.length-2)}}}}t(i)}),100);return document.addEventListener("mouseover",e,!0),()=>{document.removeEventListener("mouseover",e,!0)}}),[u,d]);const h=(0,m.useMemo)((()=>{if(!e||!u)return s(!1),null;const{x:t,y:n}=e.element.getBoundingClientRect();return{x:t+window.scrollX+10,y:n+window.scrollY+10}}),[e,u]);return(0,Te.jsx)(Te.Fragment,{children:h&&e&&(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)(Js,{position:h,target:e.element,url:e.url,onDisableOnceClick:()=>i(!1),disableOptionsShow:o,setDisableOptionsShow:s})})})};var nr=n(75022);const ir=()=>{var e;const t=(0,Je.Uk)();return(0,nr.A)(null===(e=document.querySelector(`[id*=${ae.EN}]`))||void 0===e?void 0:e.shadowRoot),(0,Te.jsx)(v.C,{t,children:(0,Te.jsx)(tr,{})})},or=()=>{const e=(0,se.tl)("collection_assistant");if(!(0,ot.ku)()||!e.image_enabled)return()=>"";const t=(()=>{const e=u.m.getInstance().getHostId();if(void 0===e)return;const t=`${ae.EN}${e}`;if(document.querySelector(`#${t}`))return;const n=document.createElement("div");n.id=t,n.dataset.collectionImgHostId=u.m.getInstance().getHostId(),n.style.order="-99999",document.body.appendChild(n);const i=n.attachShadow({mode:"open"}),o=(0,p.createRoot)(i);return(0,et.NR)(i,ae.QN).then((()=>{o.render((0,Te.jsx)(ir,{}))})),()=>{n.remove(),o.unmount()}})();return()=>{null==t||t()}};var sr=n(77793),rr=n(49299),ar=n(24337);class lr{constructor(){(0,y.A)(this,"getInsertContainerSelectors",(()=>[])),(0,y.A)(this,"getMutationObserverDelay",(()=>0))}}class cr extends lr{constructor(...e){super(...e),(0,y.A)(this,"getCollectionType",(()=>wn.X.Web))}}class dr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("zhihu.com"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){const t=(0,gn.cQ)(e,e.closest(".MoreAnswers")?".List-item .ContentItem":".Card .ContentItem");if(!t)return null;const n=location.pathname.includes("/question"),i=yield(0,gn.dp)(t),o=i.querySelector(".ContentItem-actions");o&&(o.style.position="unset");const s=n?document.querySelector("h1.QuestionHeader-title"):i.querySelector(".ContentItem-title");let r=(0,gn.gs)(),a=location.href;if(s){r=(null==s?void 0:s.innerText)||"",s.remove();const e=s.querySelector("a");e&&(a=e.href)}if(n){var l;const e=null===(l=t.querySelector('.ContentItem > meta[itemprop="url"]'))||void 0===l?void 0:l.getAttribute("content");e&&(a=e)}const{desc:c,imageUrl:d}=yield(0,_e.l_)(),{width:u,height:h}=t.getBoundingClientRect();return{text_content:i.innerText,html_content:i.innerHTML,dir:"",title:r,description:c,cover_image_url:d,source_url:a,content_height:h,content_width:u}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...[...document.querySelectorAll(t)].filter((e=>!(0,gn.cQ)(e,t))))})),e.map((e=>{const t=(0,gn.cQ)(e,".List-item")||(0,gn.cQ)(e,".Card");return{containerElement:e,getCollectionData:()=>this.getCollectionData(e),style:{width:"24px",height:"24px","font-size":"16px","margin-left":"auto"},insertIndex:6,hoverListenerElement:t}}))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".Card .ContentItem-actions"]))}}class ur extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("onlinelibrary.wiley.com")&&t.includes("doi/")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector("#article__content");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector(".citation__title");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({insertIndex:0,containerElement:e,getCollectionData:this.getCollectionData,style:{width:"28px",height:"28px",display:"inline-block","z-index":"1",float:"left",margin:"-4px 24px 0 0"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".coolBar__wrapper .coolBar__second"]))}}class hr extends lr{constructor(...e){super(...e),(0,y.A)(this,"getCollectionType",(()=>wn.X.SocialWebCard))}}class mr extends hr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("weibo.com"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){var t,n,i,o,s;const r=(0,gn.cQ)(e,"article.woo-panel-main");if(!r)return null;const a=document.createElement("div");let l=r.getBoundingClientRect().width;const c=r.querySelector("header");c&&(l=c.getBoundingClientRect().width);const d=(null===(t=r.querySelector('a[class*="head-info_time"]'))||void 0===t?void 0:t.href)||location.href,u=(0,gn.hj)(l);a.appendChild(u);const h=[r],m=document.querySelector("body > svg");m&&u.appendChild(m.cloneNode(!0));const p=null===(n=r.parentElement)||void 0===n?void 0:n.querySelector('div[class*="Detail_box"]');if(p){const e=p.querySelector("#composerEle");e&&h.push(e);const t=p.querySelector('div[class*="wbpro-tab"]');t&&h.push(t);const n=p.querySelectorAll('div[class*="wbpro-list"]');for(const i of n)h.push(i)}let g=0;h.forEach((e=>g+=e.getBoundingClientRect().height));const v=yield(0,gn.l5)(h,!1);if(!v.length)return null;const f=v[0];v.forEach(((e,t)=>{0===t?u.appendChild(e):f.appendChild(e)})),(0,gn.vg)(f),f.querySelectorAll(".woo-avatar-icon .woo-icon-main .woo-icon-frames").forEach((e=>e.remove()));const _=f.innerText,x=(null===(i=f.querySelector('div[class*="detail_wbtext"]'))||void 0===i?void 0:i.innerText)||_,y=(null===(o=f.querySelector(".woo-picture-main"))||void 0===o||null===(o=o.querySelector("img"))||void 0===o?void 0:o.getAttribute("data-img-tos-key"))||(null===(s=f.querySelector(".wbp-video .wbpv-poster"))||void 0===s?void 0:s.getAttribute("data-img-tos-key"))||"";return{text_content:_,html_content:a.innerHTML,body_content:x,content_img_key:y,content_height:g,content_width:l,source_url:d}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))}));const t=e.length>1;return e.map((e=>{let n=null;const i={"margin-right":e.childElementCount?"8px":"0px"};var o;t&&(n=null===(o=(0,gn.cQ)(e,"article.woo-panel-main"))||void 0===o?void 0:o.parentElement);return{containerElement:e,getCollectionData:()=>this.getCollectionData(e),insertIndex:0,style:i,hoverListenerElement:n}}))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".woo-panel-main header.woo-box-flex > .woo-box-flex"]))}}const pr=()=>location.pathname.includes("/status/");class gr extends hr{constructor(...e){var t;super(...e),t=this,(0,y.A)(this,"match",(()=>"https:"===location.protocol&&(location.host.endsWith("x.com")||location.host.endsWith("twitter.com")))),(0,y.A)(this,"getCollectionContent",(e=>{const t=(0,gn.cQ)(e,'div[data-testid="cellInnerDiv"]');return pr()?null==t?void 0:t.parentElement:t})),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){var n,i,o;const s=t.getCollectionContent(e);if(!s)return null;const r=document.createElement("div");let a=location.href,l=s.getBoundingClientRect().width,c=0;const d=s.querySelector("article > div");if(d){const{width:e}=d.getBoundingClientRect();l=e}const u=document.body.style.backgroundColor,h=(0,gn.hj)(l);u&&(h.style.backgroundColor=u),r.appendChild(h);const m=[];if(pr())m.push(...s.querySelectorAll('div[data-testid="cellInnerDiv"]'));else{var p;m.push(s);const e=null===(p=s.querySelector('a[href*="status"]'))||void 0===p?void 0:p.href;e&&(a=e)}m.forEach((e=>c+=e.getBoundingClientRect().height));(yield(0,gn.l5)(m,!1)).forEach((e=>{e.style.position="unset",e.style.transform="none",h.appendChild(e)}));const g=h.querySelector("article");g&&(g.style.backgroundColor="unset");const v=r.innerText,f=(null===(n=s.querySelector('div[data-testid="tweetText"]'))||void 0===n?void 0:n.innerText)||v,_=null===(i=r.querySelector('div[aria-label="Image"]'))||void 0===i?void 0:i.querySelector("img"),x=null===(o=r.querySelector('button[aria-label="Play Video"]'))||void 0===o?void 0:o.querySelector("img"),y=r.querySelector("video[poster]"),b=(null==_?void 0:_.getAttribute("data-img-tos-key"))||(null==x?void 0:x.getAttribute("data-img-tos-key"))||(null==y?void 0:y.getAttribute("data-img-tos-key"))||"";return{text_content:v,html_content:r.innerHTML,body_content:f,content_height:c,content_width:l,content_img_key:b,source_url:a}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];this.getInsertContainerSelectors().forEach((t=>{if(pr()){const n=document.querySelector(t);n&&e.push(n)}else e.push(...document.querySelectorAll(t))}));const t=e.length>1;return e.map((e=>{var n;let i=null;const o={};return t&&(o.visibility="hidden",i=this.getCollectionContent(e)),{containerElement:null===(n=e.parentElement)||void 0===n||null===(n=n.parentElement)||void 0===n||null===(n=n.parentElement)||void 0===n?void 0:n.parentElement,getCollectionData:()=>this.getCollectionData(e),insertIndex:0,style:o,hoverListenerElement:i}}))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>['main section [data-testid="cellInnerDiv"] article [data-testid="caret"]']))}}class vr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("www.tandfonline.com")&&t.includes("doi/full/")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector("article.article");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=document.querySelector(".NLM_article-title");i&&(n=i.innerText);const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({insertIndex:0,containerElement:e,getCollectionData:this.getCollectionData,style:{width:"24px",height:"30px",display:"inline-block","z-index":"1",float:"left","margin-right":"2px"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".general-bookmark-share .a2a_share_target"]))}}class fr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("stackoverflow.com"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){const t=(0,gn.cQ)(e,".post-layout");if(!t)return null;const n=document.createElement("div"),i=[t],o=document.querySelector("#content .inner-content .question .post-layout");o&&i.unshift(o);let s=100;i.forEach((e=>s+=e.getBoundingClientRect().height));(yield(0,gn.l5)(i)).forEach(((e,t)=>{if(1===t){const e=document.createElement("h2");e.innerText="Answer",e.style.paddingTop="20px",n.appendChild(e)}n.appendChild(e)}));const{desc:r,imageUrl:a}=yield(0,_e.l_)(),{width:l}=t.getBoundingClientRect(),{width:c}=o.getBoundingClientRect();return{text_content:n.innerText,html_content:n.innerHTML,dir:"",title:(0,gn.gs)(),description:r,cover_image_url:a,source_url:location.href,content_height:s,content_width:Math.max(l,c)}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:()=>this.getCollectionData(e),style:{width:"24px",height:"24px","font-size":"16px","margin-top":e.childElementCount?"4px":"0px",visibility:"hidden"},hoverListenerElement:(0,gn.cQ)(e,".post-layout")})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>["#content .inner-content .answer .js-voting-container"]))}}class _r extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("link.springer.com")&&t.includes("article/")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector('article[id="main"]');if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector(".c-article-title");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:this.getCollectionData,style:{width:"28px",height:"28px",display:"inline-block","z-index":"1","margin-left":"12px"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".c-article-header .app-article-metrics-bar"]))}}class xr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("www.sciencedirect.com")&&t.includes("science/article/abs/pii")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector(".article-wrapper article");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector("#screen-reader-main-title");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:this.getCollectionData,style:{width:"21px",height:"21px",display:"inline-block","z-index":"1","margin-left":"16px","vertical-align":"text-top"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>["#banner .banner-options"]))}}class yr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("journals.sagepub.com")&&t.includes("doi/abs/")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector('article div[data-core-wrapper="content"]');if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=document.querySelector("article header .core-container h1");i&&(n=i.innerText);const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:this.getCollectionData,style:{width:"30px",height:"40px",display:"inline-block","z-index":"1","margin-left":"1.75rem"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>["#article_collateral_menu ul"]))}}class br extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("reddit.com"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){var t;const n=!location.pathname.includes("comments")?e:(0,gn.cQ)(e,"main.main"),i=yield(0,gn.dp)(n);null===(t=i.querySelector("shreddit-comments-page-ad"))||void 0===t||t.remove();const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=n.getBoundingClientRect();return{text_content:i.innerText,html_content:i.innerHTML,dir:"",title:(0,gn.gs)(),description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>{const t=!location.pathname.includes("comments");let n,i=e;const o={width:"32px",height:"32px","font-size":"22px"};let s=null;if(t){var r;const t=null===(r=e.shadowRoot)||void 0===r||null===(r=r.querySelector('slot[name="share-button"]'))||void 0===r?void 0:r.firstElementChild;t&&(o.position="absolute",o.left=`${t.getBoundingClientRect().width+t.offsetLeft}px`,o.visibility="hidden",s=e)}else{var a;const t=null===(a=e.shadowRoot)||void 0===a?void 0:a.querySelector('slot[name="share-button"]');if(null!=t&&t.parentElement)for(let e=0;e<t.parentElement.children.length;e++)if(t.parentElement.children[e]===t){n=e+1;break}i=null==t?void 0:t.parentElement}return{containerElement:i,getCollectionData:()=>this.getCollectionData(e),style:o,insertIndex:n,hoverListenerElement:s}}))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>["shreddit-post","shreddit-ad-post"])),(0,y.A)(this,"getMutationObserverDelay",(()=>60))}}class wr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("quora.com"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){if(!e)return null;const t=(0,gn.cQ)(e,e.closest(".dom_annotate_multifeed_bundle_QuestionsBundle")?".dom_annotate_multifeed_bundle_QuestionsBundle > .q-box":"div.q-box.qu-borderAll.qu-borderRadius--small");if(!t)return null;const n=yield(0,gn.dp)(t);let i=(0,gn.gs)();const o=n.querySelector('div[class*="QuestionTitle"]');var s;o&&(i=o.innerText,null===(s=(0,gn.cQ)(o,"div.q-box"))||void 0===s||s.remove());const{desc:r,imageUrl:a}=yield(0,_e.l_)(),{width:l,height:c}=t.getBoundingClientRect();return{text_content:n.innerText,html_content:n.innerHTML,dir:"",title:i,description:r,cover_image_url:a,source_url:location.href,content_height:c,content_width:l}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>{const t=e.querySelector(".qu-zIndex--action_bar .qu-py--tiny"),n=t?(0,gn.cQ)(t,t.closest(".dom_annotate_multifeed_bundle_QuestionsBundle")?".dom_annotate_multifeed_bundle_QuestionsBundle > .q-box":"div.q-box.qu-borderAll.qu-borderRadius--small"):null;return{containerElement:t?t.children[0]:null,getCollectionData:()=>this.getCollectionData(t),style:{width:"24px",height:"24px","font-size":"16px","margin-left":null!=t&&t.childElementCount?"10px":"0px",visibility:"hidden"},hoverListenerElement:n}}))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".dom_annotate_multifeed_home > div > div",".dom_annotate_multifeed_bundle_QuestionsBundle > .q-box",'div[class*="dom_annotate_question_answer_item"]',".spacing_log_question_page_ad"]))}}class Cr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("www.nature.com")&&t.includes("articles/")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector(".c-article-main-column");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector(".c-article-title");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:this.getCollectionData,style:{width:"22px",height:"22px",display:"inline-block","font-size":"12px","z-index":"1","vertical-align":"top","margin-left":"auto"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".c-article-header .c-article-identifiers"]))}}class Ar extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("juejin.cn"))),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector(".main-area.article-area");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector(".article-title");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:this.getCollectionData,style:{width:"48px",height:"48px","font-size":"24px"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".main-container .article-suspended-panel"]))}}class Sr extends hr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("okjike.com"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){var t,n,i,o;const s=(0,gn.cQ)(e,"article.items-start");if(null==s||null===(t=s.parentElement)||void 0===t||!t.parentElement)return null;const r=s.parentElement.parentElement.getBoundingClientRect();let{width:a}=r;const l=window.getComputedStyle(s),c=parseFloat(l.paddingLeft),d=parseFloat(l.paddingRight);isNaN(c)||(a-=c),isNaN(d)||(a-=d);const u=document.createElement("div"),h=(0,gn.hj)(a);u.appendChild(h);const m=yield(0,gn.dp)(s.parentElement.parentElement,!1),p=m.querySelector("article.items-start"),g=document.querySelector('div[class*="NavBar"]');p&&g&&(p.style.backgroundColor=window.getComputedStyle(g).backgroundColor),h.appendChild(m);const v=m.innerText,f=(null===(n=m.querySelector('div[class*="content_"]'))||void 0===n?void 0:n.innerText)||v,_=m.querySelector('div[class*="MessagePictureGrid"]'),x=(null==_||null===(i=_.querySelector("img"))||void 0===i?void 0:i.getAttribute("data-img-tos-key"))||(null==_||null===(o=_.querySelector('div[class*="MessagePictureGrid__Cell"]'))||void 0===o?void 0:o.getAttribute("data-img-tos-key"))||"";return{text_content:v,html_content:u.innerHTML,body_content:f,content_height:r.height,content_width:a,content_img_key:x}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))}));const t=e.length>1;return e.map((e=>{const n={width:"24px",height:"24px","font-size":"16px","margin-right":"18px"};let i=null;return t&&(n.visibility="hidden",i=(0,gn.cQ)(e,"article.items-start")),{containerElement:e.lastElementChild,getCollectionData:()=>this.getCollectionData(e),insertIndex:e.lastElementChild?e.lastElementChild.childElementCount-1:0,style:n,hoverListenerElement:i}}))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".items-stretch"]))}}class kr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("jianshu.com"))),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector('div[role="main"] > div > section');if(!e)return null;let{width:t}=e.getBoundingClientRect();const n=e.firstElementChild;n&&(t=n.getBoundingClientRect().width);const i=document.createElement("div"),o=(0,gn.hj)(t);i.appendChild(o);const s=[e],r=e.getBoundingClientRect(),a=document.querySelector('div[role="main"] > div #note-page-comment > section');a&&s.push(a);let l=0,c=(0,gn.gs)();s.forEach((e=>l+=e.getBoundingClientRect().height));(yield(0,gn.l5)(s,!1)).forEach((e=>{o.appendChild(e),e.style.paddingTop="0",e.style.paddingBottom="0",e.style.paddingBlock="unset";const t=e.querySelector('div[role="main"]>div>section>h1');t&&(c=t.innerText,t.remove())}));const{desc:d,imageUrl:u}=yield(0,_e.l_)();return{text_content:i.innerText,html_content:i.innerHTML,dir:"",title:c,description:d,cover_image_url:u,source_url:location.href,content_height:l,content_width:r.width}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e.lastElementChild,getCollectionData:this.getCollectionData,style:{width:"48px",height:"48px","font-size":"24px",margin:"auto"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>location.pathname.startsWith("/p/")?["#__next"]:[]))}}class Er extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("ieeexplore.ieee.org")&&t.includes("document/")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector(".document .document-main");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector(".document-title");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({insertIndex:0,containerElement:e,getCollectionData:this.getCollectionData,style:{width:"25px",height:"40px",display:"inline-block","z-index":"1"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".document-main-subheader .action-item-container .stats-document-lh-actions"]))}}class Tr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("huggingface.co"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){const t=(0,gn.cQ)(e,"body > div.flex");if(!t)return null;const n=yield(0,gn.dp)(t),{desc:i,imageUrl:o}=yield(0,_e.l_)(),{width:s,height:r}=t.getBoundingClientRect();return{text_content:n.innerText,html_content:n.innerHTML,dir:"",title:(0,gn.gs)(),description:i,cover_image_url:o,source_url:location.href,content_height:r,content_width:s}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:()=>this.getCollectionData(e),style:{width:"23px",height:"23px","font-size":"14px","margin-left":"8px"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>['div[data-target="DatasetHeader"] div.container > h1','div[data-target="ModelHeader"] div.container > h1']))}}class Ir extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("github.com"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){const t=(0,gn.cQ)(e,"div[data-turbo-body]");if(!t)return null;const n=yield(0,gn.dp)(t),{desc:i,imageUrl:o}=yield(0,_e.l_)(),{width:s,height:r}=t.getBoundingClientRect();return{text_content:n.innerText,html_content:n.innerHTML,dir:"",title:(0,gn.gs)(),description:i,cover_image_url:o,source_url:location.href,content_height:r,content_width:s}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:()=>this.getCollectionData(e),insertIndex:0,style:{"margin-right":e.childElementCount?"8px":"0px",float:"left"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>["#repository-container-header ul.pagehead-actions"]))}}class jr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("www.frontiersin.org")&&/journals\/.*\/articles/.test(t)})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector(".ArticleDetails__main__content");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector(".JournalAbstract__titleWrapper h1");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({insertIndex:0,containerElement:e,getCollectionData:this.getCollectionData,style:{width:"32px",height:"32px",display:"inline-block","z-index":"1",float:"right","margin-top":"10px"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".JournalAbstract .authors"]))}}class Nr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>"https:"===location.protocol&&location.host.endsWith("csdn.net"))),(0,y.A)(this,"getCollectionData",function(){var e=(0,a.A)((function*(e){const t=(0,gn.cQ)(e,"main");if(!t)return null;const n=t.querySelector(".blog-content-box");if(!n)return null;let{width:i}=n.getBoundingClientRect();const o=n.querySelector(".blog-content-box  #article_content");o&&(i=o.getBoundingClientRect().width);const s=document.createElement("div"),r=(0,gn.hj)(i);s.appendChild(r);const a=[n],l=t.querySelector("#toolBarBox > div");l&&a.push(l);let c=0,d=(0,gn.gs)();a.forEach((e=>c+=e.getBoundingClientRect().height));(yield(0,gn.l5)(a,!1)).forEach(((e,t)=>{if(r.appendChild(e),1===t)e.style.position="unset";else{const t=e.querySelector(".article-title-box");t&&(d=t.innerText,t.remove())}}));const{desc:u,imageUrl:h}=yield(0,_e.l_)();return{text_content:s.innerText,html_content:s.innerHTML,dir:"",title:d,description:u,cover_image_url:h,source_url:location.href,content_height:c,content_width:i}}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({containerElement:e,getCollectionData:()=>this.getCollectionData(e),insertIndex:0,style:{width:"24px",height:"24px","font-size":"16px","margin-right":e.childElementCount?"8px":"0px"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>["#mainBox #toolBarBox .toolbox-middle ul.toolbox-list"]))}}class Rr extends cr{constructor(...e){super(...e),(0,y.A)(this,"match",(()=>{const{hostname:e,pathname:t}=location;return e.endsWith("kns.cnki.net")&&t.includes("kcms2/article/abstract")})),(0,y.A)(this,"getCollectionData",(0,a.A)((function*(){const e=document.querySelector(".container .doc");if(!e)return null;const t=yield(0,gn.dp)(e);let n=(0,gn.gs)();const i=t.querySelector(".brief .wx-tit h1");i&&(n=i.innerText,i.remove());const{desc:o,imageUrl:s}=yield(0,_e.l_)(),{width:r,height:a}=e.getBoundingClientRect();return{text_content:t.innerText,html_content:t.innerHTML,dir:"",title:n,description:o,cover_image_url:s,source_url:location.href,content_height:a,content_width:r}}))),(0,y.A)(this,"getCollectionInsertInfo",(()=>{const e=[];return this.getInsertContainerSelectors().forEach((t=>{e.push(...document.querySelectorAll(t))})),e.map((e=>({insertIndex:0,containerElement:e,getCollectionData:this.getCollectionData,style:{width:"25px",height:"25px",display:"inline-block","font-size":"12px","z-index":"1","vertical-align":"top","margin-left":"14px"}})))})),(0,y.A)(this,"getInsertContainerSelectors",(()=>[".btn-tool .other-btns"]))}}class Mr{constructor(){(0,y.A)(this,"_collectionProviderList",void 0),(0,y.A)(this,"getCollectionProvider",(()=>this._collectionProviderList.find((e=>e.match())))),this._collectionProviderList=[new mr,new gr,new dr,new br,new wr,new Ir,new Tr,new fr,new Nr,new Ar,new kr,new Sr,new Rr,new Cr,new _r,new xr,new Er,new ur,new vr,new jr,new yr]}}const Pr="cici-collection-button-container-style",Lr="cici-collection-button-tooltip",Br=e=>{const t=document.createElement("style");return t.id=Pr,t.innerHTML=`\n    ${e} {\n      box-sizing: border-box;\n      cursor: pointer;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 28px;\n      width: 28px;\n      outline: none;\n      border-radius: 999px;\n      overflow: hidden;\n      background: transparent;\n      svg {\n        width: 100%;\n        height: 100%;\n      }\n    }\n    @keyframes doubao-animation-rotate {\n      0% {\n        transform: rotate(0);\n      }\n\n      100% {\n        transform: rotate(1turn);\n      }\n    }\n  `,t},Dr=(e=(0,sr.A)(),t=(0,sr.A)())=>`<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#${e})">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M22.5429 15.7918C22.6194 15.8603 22.7077 15.8946 22.8079 15.8946C22.9134 15.8946 23.003 15.8603 23.0769 15.7918C23.1534 15.7232 23.1995 15.6362 23.2153 15.5307C23.276 15.1246 23.3406 14.7818 23.4091 14.5023C23.4777 14.2254 23.566 13.9973 23.6742 13.818C23.7823 13.6386 23.9234 13.4962 24.0974 13.3908C24.2741 13.2853 24.4969 13.2022 24.7659 13.1416C25.0349 13.0783 25.3645 13.0242 25.7548 12.9794C25.8655 12.9688 25.9565 12.9253 26.0277 12.8489C26.0989 12.7697 26.1345 12.6761 26.1345 12.568C26.1345 12.4652 26.0989 12.3755 26.0277 12.299C25.9591 12.2226 25.8695 12.1751 25.7587 12.1566C25.3684 12.1013 25.0401 12.0419 24.7738 11.9786C24.5101 11.9153 24.2925 11.831 24.1211 11.7255C23.9497 11.62 23.81 11.4802 23.7019 11.3062C23.5937 11.1322 23.5028 10.908 23.4289 10.6338C23.3577 10.3569 23.2865 10.0154 23.2153 9.60927C23.1969 9.50115 23.1494 9.41413 23.0729 9.34821C22.9991 9.27964 22.9107 9.24536 22.8079 9.24536C22.7051 9.24536 22.6154 9.27964 22.5389 9.34821C22.4651 9.41413 22.4203 9.50115 22.4044 9.60927C22.3438 10.0154 22.2792 10.3582 22.2106 10.6377C22.1421 10.9146 22.0524 11.1427 21.9416 11.322C21.8335 11.4987 21.6924 11.6411 21.5184 11.7492C21.3444 11.8547 21.1228 11.9378 20.8539 11.9984C20.5849 12.0591 20.2539 12.1118 19.861 12.1566C19.7529 12.1698 19.6633 12.216 19.5921 12.2951C19.5209 12.3716 19.4853 12.4625 19.4853 12.568C19.4853 12.6735 19.5195 12.7645 19.5881 12.8409C19.6593 12.9174 19.749 12.9636 19.8571 12.9794C20.25 13.0374 20.5783 13.0981 20.842 13.1613C21.1083 13.2246 21.3272 13.309 21.4986 13.4145C21.67 13.52 21.8085 13.6597 21.914 13.8338C22.0221 14.0078 22.113 14.232 22.1869 14.5062C22.2607 14.7831 22.3332 15.1246 22.4044 15.5307C22.4229 15.6362 22.469 15.7232 22.5429 15.7918ZM19.8332 10.6923H15.0234C14.8107 10.6922 14.5754 10.6922 14.3709 10.7077C14.1383 10.7253 13.8253 10.7694 13.5013 10.9228C13.073 11.1256 12.7248 11.4492 12.5066 11.8472C12.3415 12.1483 12.2941 12.4392 12.2751 12.6553C12.2584 12.8453 12.2584 13.064 12.2585 13.2617L12.2584 23.7818V23.7888C12.2583 23.82 12.2579 23.9154 12.2666 24.0053L12.2671 24.0105C12.2744 24.0882 12.308 24.4449 12.5999 24.7729C12.8966 25.1062 13.3439 25.2913 13.8088 25.2732C14.2665 25.2555 14.5743 25.04 14.6413 24.9931L14.6458 24.99C14.7235 24.9359 14.7995 24.8718 14.8244 24.8508L14.83 24.8461L17.9161 22.265L21.0022 24.8461L21.0078 24.8508C21.0327 24.8718 21.1087 24.9359 21.1864 24.99L21.1909 24.9931C21.2579 25.04 21.5657 25.2555 22.0234 25.2732C22.4884 25.2913 22.9356 25.1062 23.2323 24.7729C23.5242 24.4449 23.5578 24.0882 23.5651 24.0105L23.5656 24.0053C23.5743 23.9154 23.5739 23.82 23.5738 23.7888V23.7818V16.8568C23.5738 16.8568 23.2047 17.0416 22.8553 17.0416C22.4709 17.0416 22.1731 16.8568 22.1731 16.8568L22.173 23.7818C22.173 23.8744 22.173 23.9207 22.1529 23.9432C22.1355 23.9628 22.1092 23.9737 22.0818 23.9727C22.0503 23.9715 22.0133 23.9405 21.9392 23.8786L18.8532 21.2975C18.522 21.0205 18.3563 20.882 18.1691 20.8295C18.0041 20.7832 17.8281 20.7832 17.6631 20.8295C17.4759 20.882 17.3102 21.0205 16.9791 21.2975L13.893 23.8785C13.8189 23.9405 13.7819 23.9715 13.7504 23.9727C13.723 23.9737 13.6967 23.9628 13.6793 23.9432C13.6592 23.9207 13.6592 23.8744 13.6592 23.7818V13.2957C13.6592 12.84 13.6592 12.6122 13.7547 12.4382C13.8386 12.2851 13.9725 12.1606 14.1373 12.0826C14.3245 11.994 14.5697 11.994 15.06 11.994H18.0876C18.4582 11.1251 19.0564 10.9228 19.8332 10.6923Z" fill="url(#paint0_radial_1455_299)"/>\n<mask id="${t}" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M18 36C27.9411 36 36 27.9411 36 18C36 8.05887 27.9411 0 18 0C8.05887 0 0 8.05887 0 18C0 27.9411 8.05887 36 18 36ZM18 34C26.8366 34 34 26.8366 34 18C34 9.16344 26.8366 2 18 2C9.16344 2 2 9.16344 2 18C2 26.8366 9.16344 34 18 34Z" fill="white"/>\n</mask>\n<g mask="url(#${t})">\n<path d="M34 18C34 26.8366 26.8366 34 18 34V38C29.0457 38 38 29.0457 38 18H34ZM18 2C26.8366 2 34 9.16344 34 18H38C38 6.9543 29.0457 -2 18 -2V2ZM2 18C2 9.16344 9.16344 2 18 2V-2C6.9543 -2 -2 6.9543 -2 18H2ZM18 34C9.16344 34 2 26.8366 2 18H-2C-2 29.0457 6.9543 38 18 38V34ZM32 18C32 25.732 25.732 32 18 32V36C27.9411 36 36 27.9411 36 18H32ZM18 4C25.732 4 32 10.268 32 18H36C36 8.05887 27.9411 0 18 0V4ZM4 18C4 10.268 10.268 4 18 4V0C8.05887 0 0 8.05887 0 18H4ZM18 32C10.268 32 4 25.732 4 18H0C0 27.9411 8.05887 36 18 36V32Z" fill="url(#paint1_linear_1455_299)"/>\n</g>\n</g>\n<defs>\n<radialGradient id="paint0_radial_1455_299" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(15.1905 17.2599) rotate(22.3884) scale(11.8361 17.7711)">\n<stop stop-color="#0057FF"/>\n<stop offset="0.819404" stop-color="#5A91FC"/>\n</radialGradient>\n<linearGradient id="paint1_linear_1455_299" x1="38.8636" y1="30.2727" x2="1.94345e-06" y2="6.95455" gradientUnits="userSpaceOnUse">\n<stop offset="0.25" stop-color="#75A4FF"/>\n<stop offset="1" stop-color="#0057FF"/>\n</linearGradient>\n<clipPath id="${e}">\n<rect width="36" height="36" fill="white"/>\n</clipPath>\n</defs>\n</svg>\n`;let Or;const Fr=(e=!1)=>{var t;(clearTimeout(Or),e)?null===(t=document.querySelector(`#${Lr}`))||void 0===t||t.remove():Or=setTimeout((()=>{const e=document.querySelector(`#${Lr}`);e&&"mouseenter"!==e.getAttribute("mouse-state")&&e.remove()}),60)},Ur=e=>{Fr(!0);const t=document.createElement("span");t.setAttribute("data-testid","tripartite-web-collect-tooltip"),t.id=Lr,t.onmouseenter=()=>{e.style.visibility&&(e.style.visibility="visible"),t.setAttribute("mouse-state","mouseenter")},t.onmouseleave=()=>{e.style.visibility&&(e.style.visibility="hidden"),t.setAttribute("mouse-state","mouseleave"),t.remove()},t.innerHTML='<svg aria-hidden="true" class="semi-tooltip-icon-arrow" width="24" height="7" viewBox="0 0 24 7"\n    fill="rgb(65, 70, 76)" xmlns="http://www.w3.org/2000/svg" style="fill: rgb(65, 70, 76);">\n    <path d="M24 0V1C20 1 18.5 2 16.5 4C14.5 6 14 7 12 7C10 7 9.5 6 7.5 4C5.5 2 4 1 0 1V0H24Z"></path>\n  </svg>';const n=t.querySelector("svg");if(!n)return;((e,t,n)=>{const{x:i,y:o,width:s,height:r}=e.getBoundingClientRect();let a=o+window.scrollY-46;n.style.cssText="position: absolute;left: 50%;bottom: -6px;transform: translateX(-50%);",o-46<0&&(a=o+window.scrollY+r+10,n.style.cssText="position: absolute;top: -6px;left: 50%;transform: translateX(-50%) rotate(180deg)"),t.style.cssText=`z-index: 9999;display: flex;position: absolute;left: ${i+s/2+window.scrollX}px;top: ${a}px;transform: translateX(-50%);`})(e,t,n);const i=document.createElement("span");t.insertBefore(i,t.firstChild),i.style.cssText="padding: 8px 12px;\n    background-color: rgb(65, 70, 76);\n    border-radius: 6px;\n    color: #fff;\n    white-space: nowrap;\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: 400;\n    font-family: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Helvetica Neue, Helvetica, Arial, sans-serif;\n    display: flex;\n    gap: 3px;";const o=e.getAttribute("data-collection-id");if(i.innerText=Je.F2.t(o?"flow_web_ext_pdf_page_bookmarked":"flow_web_ext_pdf_page_bookmarks").replace(/{?{brandName}}?/,"\u8c46\u5305"),o){(0,zt.NP)(zt.vP.web_other);const e=document.createElement("span");e.setAttribute("data-testid","tripartite-web-collect-check"),e.innerText=Je.F2.t("flow_web_ext_bookmarks_saved_view"),e.style.cursor="pointer",e.onclick=()=>{xo(o,zt.vP.web_other,zt.p6.web)};const t=document.createElement("span");t.innerText="\uff5c",t.style.color="#FFFFFF59",i.appendChild(t),i.appendChild(e)}document.body.appendChild(t)},Hr=(e,t)=>{const n=document.createElement("div");n.setAttribute("data-testid","tripartite-web-collect-btn"),n.innerHTML=Dr(),n.onmouseenter=()=>{Ur(n)},n.onmouseleave=()=>{Fr()};const i=()=>{n.removeAttribute("data-collection-id"),n.removeAttribute("data-in-collection"),n.innerHTML=Dr()},o=e=>{e?(n.setAttribute("data-collection-id",e),n.removeAttribute("data-in-collection"),n.innerHTML=((e=(0,sr.A)(),t=(0,sr.A)())=>`<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#${e})">\n<mask id="${t}" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M18 36C27.9411 36 36 27.9411 36 18C36 8.05887 27.9411 0 18 0C8.05887 0 0 8.05887 0 18C0 27.9411 8.05887 36 18 36ZM18 34C26.8366 34 34 26.8366 34 18C34 9.16344 26.8366 2 18 2C9.16344 2 2 9.16344 2 18C2 26.8366 9.16344 34 18 34Z" fill="white"/>\n</mask>\n<g mask="url(#${t})">\n<path d="M34 18C34 26.8366 26.8366 34 18 34V38C29.0457 38 38 29.0457 38 18H34ZM18 2C26.8366 2 34 9.16344 34 18H38C38 6.9543 29.0457 -2 18 -2V2ZM2 18C2 9.16344 9.16344 2 18 2V-2C6.9543 -2 -2 6.9543 -2 18H2ZM18 34C9.16344 34 2 26.8366 2 18H-2C-2 29.0457 6.9543 38 18 38V34ZM32 18C32 25.732 25.732 32 18 32V36C27.9411 36 36 27.9411 36 18H32ZM18 4C25.732 4 32 10.268 32 18H36C36 8.05887 27.9411 0 18 0V4ZM4 18C4 10.268 10.268 4 18 4V0C8.05887 0 0 8.05887 0 18H4ZM18 32C10.268 32 4 25.732 4 18H0C0 27.9411 8.05887 36 18 36V32Z" fill="url(#paint0_linear_1455_299)"/>\n</g>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M22.9328 15.7664C21.3574 15.7664 20.0802 14.4896 20.0796 12.9144V12.9133C20.0796 11.3375 21.3571 10.0601 22.9328 10.0601C24.5086 10.0601 25.786 11.3375 25.786 12.9133C25.786 14.489 24.5086 15.7664 22.9328 15.7664ZM24.3539 11.4584C24.4447 11.5327 24.4912 11.6342 24.4912 11.7512C24.4912 11.8061 24.4785 11.8597 24.4573 11.9109L24.4563 11.9133C24.4381 11.9551 24.4173 11.995 24.3941 12.0328L24.3933 12.0341L22.9941 14.2561C22.9488 14.3227 22.8926 14.3774 22.8244 14.4153C22.7578 14.4534 22.6846 14.4717 22.6076 14.4717C22.5308 14.4717 22.4574 14.4554 22.3906 14.4199C22.3245 14.3848 22.2666 14.3316 22.2154 14.2676L21.4815 13.3587C21.449 13.3155 21.4229 13.2693 21.4041 13.2202C21.3846 13.169 21.3746 13.1156 21.3746 13.0608C21.3746 12.951 21.4128 12.8526 21.4882 12.7728C21.5658 12.6908 21.6647 12.6465 21.7779 12.6465C21.8448 12.6465 21.9094 12.6609 21.9684 12.6925C22.0282 12.7246 22.0802 12.7752 22.1261 12.8336L22.5832 13.425L23.7187 11.5763C23.7991 11.4437 23.9171 11.3552 24.0729 11.3552C24.1781 11.3552 24.2733 11.3907 24.3539 11.4584ZM19.4684 10.6968L15.025 10.6968C14.8123 10.6967 14.577 10.6967 14.3725 10.7122C14.1399 10.7298 13.827 10.7739 13.5029 10.9273C13.0746 11.1301 12.7264 11.4537 12.5082 11.8517C12.3431 12.1528 12.2957 12.4437 12.2767 12.6598C12.26 12.8498 12.26 13.0685 12.2601 13.2662L12.2601 23.7863L12.26 23.7933C12.2599 23.8245 12.2595 23.9199 12.2682 24.0098L12.2687 24.015C12.276 24.0927 12.3096 24.4494 12.6015 24.7774C12.8982 25.1107 13.3455 25.2958 13.8105 25.2777C14.2681 25.26 14.5759 25.0445 14.6429 24.9976L14.6475 24.9945C14.7251 24.9404 14.8012 24.8763 14.8261 24.8553L14.8316 24.8506L17.9177 22.2695L21.0038 24.8506L21.0094 24.8553C21.0343 24.8763 21.1103 24.9404 21.188 24.9945L21.1925 24.9976C21.2595 25.0445 21.5673 25.26 22.025 25.2777C22.49 25.2958 22.9373 25.1107 23.2339 24.7774C23.5258 24.4494 23.5594 24.0926 23.5667 24.015L23.5672 24.0098C23.5759 23.9199 23.5755 23.8245 23.5754 23.7933L23.5754 23.7863L23.5754 16.8613C23.5754 16.8613 23.2063 17.0461 22.8569 17.0461C22.4725 17.0461 22.1747 16.8613 22.1747 16.8613L22.1746 23.7863C22.1746 23.8789 22.1746 23.9252 22.1545 23.9477C22.1371 23.9673 22.1108 23.9782 22.0834 23.9772C22.0519 23.976 22.0149 23.945 21.9409 23.8831L18.8548 21.302C18.5236 21.025 18.358 20.8865 18.1707 20.834C18.0057 20.7877 17.8297 20.7877 17.6648 20.834C17.4775 20.8865 17.3119 21.025 16.9807 21.302L13.8946 23.883C13.8205 23.945 13.7835 23.976 13.752 23.9772C13.7247 23.9782 13.6983 23.9673 13.6809 23.9477C13.6608 23.9252 13.6608 23.8789 13.6608 23.7863L13.6609 13.3002C13.6609 12.8445 13.6609 12.6167 13.7563 12.4427C13.8402 12.2896 13.9741 12.1651 14.1389 12.0871C14.3261 11.9985 14.5713 11.9985 15.0616 11.9985H18.6128C18.6128 11.8933 18.6916 10.9273 19.4684 10.6968Z" fill="url(#paint1_radial_1455_299)"/>\n</g>\n<defs>\n<linearGradient id="paint0_linear_1455_299" x1="38.8636" y1="30.2727" x2="1.94345e-06" y2="6.95455" gradientUnits="userSpaceOnUse">\n<stop offset="0.25" stop-color="#75A4FF"/>\n<stop offset="1" stop-color="#0057FF"/>\n</linearGradient>\n<radialGradient id="paint1_radial_1455_299" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(15.1182 17.6695) rotate(21.8624) scale(11.4945 16.9359)">\n<stop stop-color="#0057FF"/>\n<stop offset="0.819404" stop-color="#5A91FC"/>\n</radialGradient>\n<clipPath id="${e}">\n<rect width="36" height="36" fill="white"/>\n</clipPath>\n</defs>\n</svg>\n`)()):i()};return n.onclick=s=>{s.preventDefault(),s.stopPropagation();try{const s=n.getAttribute("data-collection-id");if(s)return ao(s,zt.vP.web_other,zt.p6.web),void i();if(n.getAttribute("data-in-collection"))return;n.innerHTML=((e=(0,sr.A)(),t=(0,sr.A)(),n=(0,sr.A)())=>`\n<div style="position: relative;width: 100%;height: 100%">\n  <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <mask id="${e}" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="36"\n      height="36">\n      <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M18 36C27.9411 36 36 27.9411 36 18C36 8.05887 27.9411 0 18 0C8.05887 0 0 8.05887 0 18C0 27.9411 8.05887 36 18 36ZM18 34C26.8366 34 34 26.8366 34 18C34 9.16344 26.8366 2 18 2C9.16344 2 2 9.16344 2 18C2 26.8366 9.16344 34 18 34Z"\n        fill="white" />\n    </mask>\n    <g mask="url(#${e})">\n      <path\n        d="M34 18C34 26.8366 26.8366 34 18 34V38C29.0457 38 38 29.0457 38 18H34ZM18 2C26.8366 2 34 9.16344 34 18H38C38 6.9543 29.0457 -2 18 -2V2ZM2 18C2 9.16344 9.16344 2 18 2V-2C6.9543 -2 -2 6.9543 -2 18H2ZM18 34C9.16344 34 2 26.8366 2 18H-2C-2 29.0457 6.9543 38 18 38V34ZM32 18C32 25.732 25.732 32 18 32V36C27.9411 36 36 27.9411 36 18H32ZM18 4C25.732 4 32 10.268 32 18H36C36 8.05887 27.9411 0 18 0V4ZM4 18C4 10.268 10.268 4 18 4V0C8.05887 0 0 8.05887 0 18H4ZM18 32C10.268 32 4 25.732 4 18H0C0 27.9411 8.05887 36 18 36V32Z"\n        fill="url(#${t})" />\n    </g>\n    <defs>\n      <linearGradient id="${t}" x1="38.8636" y1="30.2727" x2="1.94345e-06" y2="6.95455"\n        gradientUnits="userSpaceOnUse">\n        <stop offset="0.25" stop-color="#75A4FF" />\n        <stop offset="1" stop-color="#0057FF" />\n      </linearGradient>\n    </defs>\n  </svg>\n  <div style="position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);width: 50%;height: 50%;display: flex;">\n    <svg style="animation: doubao-animation-rotate .6s linear infinite;animation-fill-mode: forwards;" width="100%"\n      height="100%" viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"\n      data-icon="spin" color="#0057FF">\n      <defs>\n        <linearGradient x1="0%" y1="100%" x2="100%" y2="100%" id="${n}">\n          <stop stop-color="currentColor" stop-opacity="0" offset="0%"></stop>\n          <stop stop-color="currentColor" stop-opacity="0.50" offset="39.9430698%"></stop>\n          <stop stop-color="currentColor" offset="100%"></stop>\n        </linearGradient>\n      </defs>\n      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <rect fill-opacity="0.01" fill="none" x="0" y="0" width="36" height="36"></rect>\n        <path d="M34,18 C34,9.163444 26.836556,2 18,2 C11.6597233,2 6.18078805,5.68784135 3.59122325,11.0354951"\n          stroke="url(#${n})" stroke-width="4" stroke-linecap="round"></path>\n      </g>\n    </svg>\n  </div>\n</div>\n`)(),n.setAttribute("data-in-collection","true"),t===wn.X.SocialWebCard?ro({collectFrom:zt.vP.web_other,collectionType:wn.X.SocialWebCard,getSocialWebCardContent:e,onSuccess:o}):t===wn.X.Web&&ro({collectFrom:zt.vP.web_other,collectionType:wn.X.Web,getWebContent:e,onSuccess:o})}catch(r){(0,ar.z3)(r),i()}},n},zr=(e,t,n,i=[])=>{const{containerElement:o,getCollectionData:s,style:r,insertIndex:a,hoverListenerElement:l}=e;if(!o)return;const c=`.${t}`;if(o.querySelector(c))return;const d=Hr(s,n.getCollectionType());if(d.className=t,r&&d.setAttribute("style",Object.keys(r).map((e=>`${e}: ${r[e]}`)).join(";")),o.insertBefore(d,isNaN(Number(a))?null:o.children[a||0]),o.getRootNode()instanceof ShadowRoot){const e=Br(c);o.insertBefore(e,o.firstElementChild),i.push((()=>{e.remove()}))}if(l){d.style.visibility="hidden";const e=()=>{d.style.visibility="visible"},t=()=>{d.style.visibility="hidden"};l.addEventListener("mouseenter",e),l.addEventListener("mouseleave",t),i.push((()=>{l.removeEventListener("mouseenter",e),l.removeEventListener("mouseleave",t)}))}i.push((()=>{d.remove()}))},qr=()=>{if((0,se.TK)("socialWebcollectDisabledAll"))return;const e=u.m.getInstance().getHostId();if(void 0===e)return;const t=(new Mr).getCollectionProvider();if(!t)return;const n=t.getInsertContainerSelectors(),i=[],o=`${ae.AC}-${e}`;(e=>{(0,rr.EY)(Br(e))})(`.${o}`);const s=()=>{const e=t.getCollectionInsertInfo();e.length&&((0,zt.ae)(zt.vP.web_other,zt.p6.web),e.forEach((e=>{zr(e,o,t,i)})))};if(s(),n.length){const e=new MutationObserver(function(){var e=(0,a.A)((function*(e){for(const i of e)if(t.getMutationObserverDelay()&&(yield new Promise((e=>setTimeout(e,t.getMutationObserverDelay())))),"childList"===i.type&&i.addedNodes.length>0)for(const e of i.addedNodes)if(e instanceof HTMLElement&&n.find((t=>e.matches(t)||e.querySelector(t))))return void s()}));return function(t){return e.apply(this,arguments)}}());e.observe(document.body,{childList:!0,subtree:!0}),i.push((()=>e.disconnect()))}return()=>{i.forEach((e=>e())),(()=>{if(!document.head)return;const e=document.head.querySelector(`#${Pr}`);e&&document.head.removeChild(e)})()}},Vr=({element:e,children:t})=>((0,m.useEffect)((()=>{const t=e.parentElement;let n=0;if(!t)return;const i=new MutationObserver((i=>{for(const o of i)o.addedNodes.length>0&&n<15&&t.firstChild!==e&&requestAnimationFrame((()=>{t.prepend(e),n++}))}));return i.observe(t,{childList:!0,subtree:!1}),()=>{i.disconnect()}}),[e]),(0,Te.jsx)(Te.Fragment,{children:t}));var $r=n(10080),Wr=n(76813),Kr=n(82770);const Yr=new Map;function Gr(e,t,n,i,o,s=[]){const r=Yr.get(e);void 0!==r&&clearInterval(r);const a=()=>{if(document.fullscreenElement)return;const e=t();if(!e)return void o();const r=e.attributes;let a=!1;const l=new Map;s.forEach((e=>{l.set(e[0],e[1])}));for(const t of r){const e=t.name;if("style"===e)continue;if(!l.has(e)){a=!0;break}if(t.value!==l.get(e)){a=!0;break}l.delete(e)}if(a=a||l.size>0,a){for(const t of r)e.removeAttribute(t.name);s.forEach((t=>{e.setAttribute(t[0],t[1])}))}const c=window.getComputedStyle(e);i(e,c)&&e.setAttribute("style",n)};a();const l=setInterval(a,5e3);return Yr.set(e,l),()=>{const t=Yr.get(e);void 0!==t&&clearInterval(t),Yr.delete(e)}}const Qr=({search_engine_name:e,show_from:t,result_type:n,show_type:i})=>{(0,It.z8)(_.Ur.showSearchAssistant,{search_engine_name:e,show_from:t,result_type:n,show_type:i})},Zr=({prompt_position:e,message_id:t,from_search_id:n,show_from:i,search_engine_name:o,suggested_type:s=_.Ld.search})=>{const{assistantBotId:r}=(0,se.ue)();(0,It.z8)(_.Ur.showSearchAssistantSuggestQuestion,{bot_id:r,suggested_type:s,prompt_position:e,message_id:t,from_search_id:n,show_from:i,search_engine_name:o})},Xr=({search_engine_name:e,button_name:t,whether_full_screen:n=0})=>{(0,It.z8)(_.Ur.searchResultCardClick,{search_engine_name:e,button_name:t,whether_full_screen:n})};var Jr=n(13680),ea=n(92474),ta=n(68632);function na(e,t,n=5,i=5){var o;const s=function(e,t){const n=1e3*t;return e.findIndex(((t,i)=>t.offset<=n&&(t.offset+t.duration>=n||(i===e.length-1||e[i+1].offset>n))))}(e,t);n*=1e3,i*=1e3;const r=1e3*t;let a=-1,l=-1;for(let m=s;m>=0;m--){const t=e[m];if(t.offset+t.duration<r-n){a=m;break}}for(let m=Math.max(s,0);m<e.length;m++){if(e[m].offset>r+i){l=m;break}}const c=[],d=[];for(let m=a;m>=0&&m<s;m++)c.push(e[m].text);for(let m=Math.max(s+1,0);m<=l;m++)d.push(e[m].text);if(!c.length){var u;const t=(null===(u=e[s-1])||void 0===u?void 0:u.text)||"";t&&c.push(t)}if(!d.length){var h;const t=(null===(h=e[s+1])||void 0===h?void 0:h.text)||"";t&&d.push(t)}return{pre:c,current:(null===(o=e[s])||void 0===o?void 0:o.text)||"",next:d}}const ia=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M16.65 3.903a2.437 2.437 0 0 1 3.447 3.446l-7.604 7.604-.046.046c-.23.23-.428.428-.666.574a2.3 2.3 0 0 1-.676.28c-.272.066-.552.066-.877.065H8.832a.75.75 0 0 1-.75-.75v-1.396c0-.325-.001-.605.064-.877a2.3 2.3 0 0 1 .28-.676c.146-.239.345-.436.575-.666l.046-.046zm2.386 1.06a.937.937 0 0 0-1.325 0l-7.604 7.605c-.3.3-.36.367-.402.434a.8.8 0 0 0-.1.243c-.019.077-.023.167-.023.592v.581h.581c.425 0 .515-.005.592-.023a.8.8 0 0 0 .242-.1c.068-.042.135-.102.435-.402l7.604-7.605a.937.937 0 0 0 0-1.324m-11.19-.087h3.371a.75.75 0 0 1 0 1.5h-3.34c-.68 0-1.145 0-1.505.03-.352.029-.537.081-.668.148a1.64 1.64 0 0 0-.715.715c-.067.132-.12.317-.148.668-.03.36-.03.825-.03 1.506v6.68c0 .68 0 1.145.03 1.505.028.352.08.536.148.668.157.308.407.558.715.715.131.067.316.12.668.148.36.03.825.03 1.505.03h6.68c.68 0 1.145 0 1.506-.03.351-.028.536-.08.668-.148.307-.157.558-.407.714-.715.068-.132.12-.316.149-.668.03-.36.03-.825.03-1.506v-3.34a.75.75 0 0 1 1.5 0v3.372c0 .641 0 1.168-.035 1.596-.037.444-.114.849-.307 1.227-.3.59-.78 1.07-1.37 1.37-.379.193-.783.27-1.227.307-.429.035-.955.035-1.597.035H7.846c-.641 0-1.168 0-1.596-.035-.445-.036-.849-.114-1.227-.306-.59-.301-1.07-.78-1.37-1.37-.194-.38-.271-.784-.307-1.228-.035-.428-.035-.955-.035-1.596V9.412c0-.642 0-1.169.035-1.597.036-.444.113-.848.306-1.227.3-.59.78-1.07 1.37-1.37.38-.193.783-.27 1.228-.307.428-.035.955-.035 1.596-.035",clipRule:"evenodd"})})),oa=(0,js.a)((0,Te.jsx)(ia,{})),sa={timeCapsuleWrapper:"timeCapsuleWrapper-PnZ6aI",timeCapsule:"timeCapsule-Kf1PTb",active:"active-Q2nuhJ"},ra=({timeLabel:e,active:t,width:n,activeTimeCapsuleStyle:i={}})=>(0,Te.jsx)("div",{className:J()(sa.timeCapsuleWrapper),children:(0,Te.jsx)("div",{className:J()(sa.timeCapsule,sa.normal,{[sa.active]:t}),style:(0,r.A)({width:n},t?i:{}),children:e})}),aa=(0,m.createContext)(null),la=aa,ca=()=>(0,m.useContext)(aa),da="memoEditorPanel-Tfyn_5",ua="memoBody-asWN6f",ha="iconPanel-SiuHr6",ma="noteIcon-v_qdat",pa="darkNoteIcon-FAou0s",ga="textPanel-nRjBHy",va="textArea-F_ZTNi",fa="darkTextArea-jBGos0",_a="memoFooter-oo34aD",xa="memoFooterLeft-zehkkf",ya="darkMemoFooterLeft-PjDYVx",ba="memoFooterRight-RTAROo",wa="btn-EZOgj4",Ca="cancelBtn-bJNuxV",Aa="darkCancelBtn-WKBfiP",Sa="okBtn-KjJe01",ka="darkOKBtn-Ok9Nll",Ea="okBtnDisable-kYSv3H",Ta="okDarkBtnDisable-lnGG3m",Ia="popover-GjV2HE",ja="simpleEditorPanel-mK1iQ1",Na="simpleTextarea-lRya08",Ra="simpleMemoBody-T_bKVC",Ma="simpleTextPanel-GUFfA5",Pa="darkPanel-bPrCDJ",La=(0,m.forwardRef)((({recoverFrom:e,darkPanel:t,onSimpleModeChange:n,defaultText:i,onTextInput:o,timeLabel:s,onEscape:r,onCancel:a,onConfirm:l,disableOkBtn:c,enableSimpleMode:d,autoWidth:u,editPadShow:h},p)=>{const g=(0,Je.Uk)(),[v,f]=(0,m.useState)(d),_=(0,m.useCallback)((e=>{f(!1),o(e.target.value),e.preventDefault(),e.stopPropagation()}),[o]),[x,y]=(0,m.useState)(!1),b=(0,m.useRef)(null),w=(0,m.useRef)(0),C=(0,m.useRef)(null),{takeSnapShot:A,getMediaCurrentTime:S}=ca()||{},k=(0,m.useCallback)((()=>{d&&f(!0),null==r||r()}),[d,r]),E=(0,m.useCallback)((()=>{d&&f(!0),null==a||a()}),[d,a]),T=(0,m.useCallback)((()=>{y(!0),l?l().then((e=>{d&&!1!==e&&f(!0)})).finally((()=>{y(!1)})):d&&(y(!1),f(!0))}),[d,l]);(0,m.useEffect)((()=>{setTimeout((()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.focus()}),500)}),[]);const I=(0,m.useCallback)((()=>{w.current=(null==S?void 0:S())||0,null==A||A().then((e=>{b.current=e}))}),[]),j=d&&v,N=(0,m.useCallback)((()=>{d&&f(!1),setTimeout((()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.focus()}),100)}),[d,C]);return(0,m.useEffect)((()=>{j||I(),setTimeout((()=>null==n?void 0:n(Boolean(j))),100)}),[j,n]),(0,m.useImperativeHandle)(p,(()=>({requestInput:()=>{f(!1),setTimeout((()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.focus()}),200)},getVideoSnapshot:()=>({currentTime:w.current,snapshot:b.current})})),[f,C,w,b]),(0,m.useEffect)((()=>{if(!e)return;const t=(t,{context:n,video_time:i,blob:s})=>{e===t&&(b.current=s,w.current=i,o(n),setTimeout((()=>{C.current&&(C.current.value=n)}),100),f(!1))};return pn.A.on("video-memo-save-failed",t),()=>{pn.A.off("video-memo-save-failed",t)}}),[e,b,w]),(0,m.useEffect)((()=>{!j&&(null==h||h())}),[j,h]),j?(0,Te.jsx)("div",{className:J()(da,ja),onClick:N,children:(0,Te.jsxs)("div",{className:J()(ua,Ra),children:[(0,Te.jsx)("div",{className:ha,children:(0,Te.jsx)(oa,{className:ma})}),(0,Te.jsx)("div",{className:J()(ga,Ma),children:(0,Te.jsx)("textarea",{maxLength:2e3,value:i,onClick:N,className:J()(va,Na),placeholder:`${g("flow_web_ext_youtube_take_notes")}...`,onKeyUpCapture:e=>e.stopPropagation(),onKeyDownCapture:e=>{e.stopPropagation(),"Escape"===e.code&&k()},onInputCapture:_})})]})}):(0,Te.jsxs)("div",{className:J()(da,{[Pa]:t}),style:{width:u?"100%":void 0},children:[(0,Te.jsxs)("div",{className:J()(ua),children:[(0,Te.jsx)("div",{className:ha,children:(0,Te.jsx)(oa,{className:J()(ma,{[pa]:t})})}),(0,Te.jsx)("div",{className:J()(ga),children:(0,Te.jsx)("textarea",{ref:C,maxLength:2e3,value:i,onClick:N,className:J()(va,{[fa]:t}),placeholder:`${g("flow_web_ext_youtube_take_notes")}...`,onKeyUpCapture:e=>e.stopPropagation(),onKeyDownCapture:e=>{e.stopPropagation(),"Escape"===e.code&&k()},onInputCapture:_})})]}),(0,Te.jsxs)("div",{className:J()(_a),children:[(0,Te.jsx)("div",{className:J()(xa,{[ya]:t}),children:(0,Te.jsx)(ra,{timeLabel:s||"00:00",active:!1})}),(0,Te.jsxs)("div",{className:ba,children:[(0,Te.jsx)(je.$n,{className:J()(wa,Ca,{[Aa]:t}),onClick:()=>E(),children:g("cancel")}),(0,Te.jsx)(je.$n,{className:J()(wa,Sa,{[Ea]:c,[Ta]:c&&t,[ka]:t}),type:"primary",theme:"solid",loading:x,disabled:c,onClick:T,children:g("flow_web_ext_youtube_take_notes_popup_save")})]})]})]})}));var Ba=n(80855),Da=n(12952);const Oa="wrapper-sNH30R",Fa="text-_qO9bA",Ua="btn-kcrew5",Ha="exp-AGzfpd",za=({text:e,wrapperClassName:t,expClassName:n,textClassName:i,btnClassName:o,expandText:s="\u5c55\u5f00\u66f4\u591a",collapseText:r="\u6536\u8d77"})=>{const[a,l]=(0,m.useState)(!1),c=(0,m.useCallback)((e=>{l(e.target.checked)}),[]),[d,u]=(0,m.useState)(!1),h=(0,m.useRef)(null),{width:p}=(0,Yo.w)({ref:h});(0,m.useEffect)((()=>{h.current?a||u(h.current.scrollHeight>h.current.getBoundingClientRect().height):u(!1)}),[p,a]);const g=(0,m.useMemo)((()=>(0,sr.A)()),[]);return(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsxs)("div",{className:J()(Oa,t),children:[(0,Te.jsx)("input",{checked:a,id:g,onChange:c,className:J()(Ha,n),type:"checkbox"}),(0,Te.jsxs)("div",{className:J()(Fa,i),ref:h,children:[d&&(0,Te.jsx)("label",{className:J()(Ua,o),"data-expand":"expand","data-collapse":"collapse",htmlFor:g,children:a?r:s}),e]})]})})},qa="memoRecordContainer-mbCRZR",Va="memoRecordCard-NYHQMK",$a="textContent-YOSRBa",Wa="coverImg-v3NBHf",Ka="timeLabel-zNAoWM",Ya="memoTranscript-coXI24",Ga="transcriptContent-F1a4AG",Qa="icon-PGixdJ",Za="text-DCXcu2",Xa="contextMenuContainer-v9VjMU",Ja="menuItem-_Jay5m",el="trashIcon-NK_ClM",tl="dialogPopover-f03jrW",nl="scrollbarHide-ILYlnc",il="transcriptTooltip-sFYXrh",ol="article-UdQ8Iy",sl="textModeTimeCapsule-Aqp0N5";let rl=function(e){return e.edit="edit",e.delete="delete",e}({});const al=({id:e,onItemClick:t})=>{const n=(0,Je.Uk)();return(0,Te.jsxs)("div",{className:Xa,children:[(0,Te.jsxs)("div",{className:Ja,onPointerDown:()=>null==t?void 0:t(e,rl.edit),children:[(0,Te.jsx)(Ba.A,{className:Qa}),(0,Te.jsx)("div",{children:n("flow_web_ext_youtube_notes_edit")})]}),(0,Te.jsxs)("div",{className:Ja,onPointerDown:()=>null==t?void 0:t(e,rl.delete),children:[(0,Te.jsx)(Da.A,{className:J()(Qa,el)}),(0,Te.jsx)("div",{style:{color:"var(--s-color-accents-red, rgba(249, 77, 77, 1))"},children:n("flow_web_ext_youtube_notes_delete")})]})]})},ll=({id:e,onContextMenuItemClick:t,textContent:n,imgUrl:i,timeLabel:o,transcript:s,onCoverImgClick:r,cardMode:a="CoverMode",onTimecapsuleClick:l})=>{const c=(0,Je.Uk)(),[d,u]=(0,m.useState)({x:0,y:0}),h=(0,m.useMemo)((()=>Ki()),[]),p=(0,m.useCallback)((e=>{const{pageX:t,pageY:n}=e.nativeEvent;u({x:t,y:n})}),[t,e]),g=(0,m.useCallback)((e=>{if(e){var t;const e=null===(t=h().querySelector(`.${tl}`))||void 0===t?void 0:t.parentElement;e&&(e.style.left=`${d.x}px`,e.style.top=`${d.y}px`,e.style.transform="")}}),[d]),v=(0,m.useRef)(null),f=(0,m.useRef)(null);(0,m.useEffect)((()=>{var e;if(!v.current)return;const t=new ResizeObserver((function(){if(!f.current||!v.current)return;f.current.style.marginRight="-12px";(f.current.scrollHeight||0)<(v.current.clientHeight||0)&&(f.current.style.marginRight="")}));t.observe(v.current);const n=(0,T.A)((()=>{f.current&&f.current.classList.remove(nl)}),1e3),i=(0,Is.A)((()=>{f.current&&f.current.classList.add(nl)}),1e3),o=()=>{n(),i()};return null===(e=f.current)||void 0===e||e.addEventListener("scroll",o),()=>{var e;t.disconnect(),null===(e=v.current)||void 0===e||e.removeEventListener("scroll",o)}}),[f,f]);const _="CoverMode"===a?(0,Te.jsxs)("div",{className:Wa,onClick:r,children:[(0,Te.jsx)("img",{src:i}),(0,Te.jsx)("div",{className:Ka,onClick:l,children:(0,Te.jsx)(ra,{timeLabel:o||"00:00",active:!1})})]}):null,x=(0,m.useMemo)((()=>s.current?s.current:s.pre.length?s.pre[s.pre.length-1]:s.next.length?s.next[0]:""),[s]),y=x&&(0,Te.jsxs)("div",{className:Ya,children:[(0,Te.jsx)(je.cG,{}),(0,Te.jsxs)("div",{className:Ga,onClick:l,children:[(0,Te.jsx)("div",{className:Qa}),(0,Te.jsx)(je.m_,{className:il,getPopupContainer:h,content:(0,Te.jsxs)("article",{className:ol,children:[s.pre.map((e=>(0,Te.jsx)("p",{children:e}))),s.current&&(0,Te.jsx)("p",{children:s.current}),s.next.map((e=>(0,Te.jsx)("p",{children:e})))]}),children:(0,Te.jsx)("div",{className:Za,children:x})}),"TextMode"===a&&(0,Te.jsx)("div",{onClick:l,className:sl,children:(0,Te.jsx)(ra,{timeLabel:o||"00:00",active:!1})})]})]});return(0,Te.jsx)(je.AM,{content:(0,Te.jsx)(al,{id:e,onItemClick:t}),trigger:"contextMenu",className:tl,getPopupContainer:h,onVisibleChange:g,style:{borderRadius:"16px"},children:(0,Te.jsxs)("div",{className:qa,children:[(0,Te.jsxs)("div",{className:Va,ref:v,onContextMenu:p,style:{paddingRight:"TextMode"===a?"22px":void 0},children:[(0,Te.jsx)("div",{className:$a,ref:f,children:(0,Te.jsx)(za,{text:n,expandText:c("flow_web_ext_youtube_notes_more"),collapseText:c("flow_web_ext_youtube_notes_collapse")})}),_]}),y]})})},cl=({editMode:e,id:t,onContextMenuItemClick:n,textContent:i,imgUrl:o,timeLabel:s,onTextInput:r,onEscape:a,onCancel:l,transcript:c,onConfirm:d,onCoverImgClick:u,onTimecapsuleClick:h,cardMode:p})=>{const[g,v]=(0,m.useState)(i),f=(0,m.useCallback)((e=>{v(e),r(e)}),[r]);return e?(0,Te.jsx)(La,{timeLabel:s,autoWidth:!0,defaultText:i,onTextInput:f,onEscape:a,onCancel:l,onConfirm:d,enableSimpleMode:!1,disableOkBtn:0===g.trim().length}):(0,Te.jsx)(ll,{id:t,transcript:c,onContextMenuItemClick:n,textContent:i,timeLabel:s,imgUrl:o,cardMode:p,onCoverImgClick:u,onTimecapsuleClick:h})};function dl(e){return ul.apply(this,arguments)}function ul(){return(ul=(0,a.A)((function*(e){const t=yield(0,Nn.S6)({method:"POST",url:`${bn.kD}/collection/memo/update`,data:e});if(t instanceof Error)throw t;return t}))).apply(this,arguments)}function hl(e){return ml.apply(this,arguments)}function ml(){return ml=(0,a.A)((function*(e){const t=(0,r.A)((0,r.A)({},e),{},{id:(0,sr.A)(),create_time:Date.now()});return new Promise(((e,n)=>{Gn().then((i=>{if(i)dl({id:`${i}`,upsert:[t],remove:[]}).then((()=>e(i))).catch(n);else{const i=po();go(i,zt.vP.video_memo_save,function(){var i=(0,a.A)((function*(i){const o=i.videoSummaryResult;if(o)try{var s;const n=null==o||null===(s=o.videoParams)||void 0===s?void 0:s.cover_url;if(null!=n&&n.startsWith("http")){let e;try{const{blob:t}=yield(0,_n.n_)(n);e=t}catch(a){const t=document.querySelector("video");t&&(e=(yield(0,_n.CU)(t))||void 0)}if(e){const t=yield(0,xn.r)(e);o.videoParams.cover_file_token=t}}const i=yield $n(o.summary,o.summary_msg_id,(0,r.A)({},o.videoParams),[t]);e(`${i.id}`)}catch(l){n(l)}else n(new Error("video summary is undefined"))}));return function(e){return i.apply(this,arguments)}}())}})).catch(n)}))})),ml.apply(this,arguments)}function pl(){return pl=(0,a.A)((function*(){const e=yield Gn();if(!e)return[];const t=yield ei(e);return(null==t?void 0:t.memos)||[]})),pl.apply(this,arguments)}function gl(){return(gl=(0,a.A)((function*(e){const t=yield Gn();if(t)return yield dl({id:`${t}`,upsert:[],remove:[e]})}))).apply(this,arguments)}function vl(){return(vl=(0,a.A)((function*(e){const t=yield Gn();if(t)return yield dl({id:`${t}`,upsert:[e],remove:[]})}))).apply(this,arguments)}function fl(){return fl=(0,a.A)((function*(){const e=yield Zn();if(!e)return[];const t=yield ei(e);return(null==t?void 0:t.memos)||[]})),fl.apply(this,arguments)}function _l(){return(_l=(0,a.A)((function*(e){const t=yield Zn();if(t)return yield dl({id:`${t}`,upsert:[e],remove:[]})}))).apply(this,arguments)}function xl(){return(xl=(0,a.A)((function*(e){const t=yield Zn();if(t)return yield dl({id:`${t}`,upsert:[],remove:[e]})}))).apply(this,arguments)}function yl(){return yl=(0,a.A)((function*(e,t){const n=(0,r.A)((0,r.A)({},e),{},{id:(0,sr.A)(),create_time:Date.now()});return new Promise(((e,i)=>{Zn().then((o=>{if(o)return void dl({id:`${o}`,upsert:[n],remove:[]}).then((()=>e(o))).catch(i);const{podcastSummaryResult:s}=t;if(!s)return i(new Error("podcastSummaryResult is undefined"));(0,zt.o2)(zt.vP.podcast_collect,zt.p6.Podcast);const l=function(){var e=(0,a.A)((function*(){const e=yield(0,_n.n_)(s.podcastParams.cover_url);if(null!=e&&e.blob){const t=yield(0,xn.r)(e.blob);s.podcastParams.cover_file_token=t}return yield oi((0,r.A)((0,r.A)({},s),{},{memos:[n]}))}));return function(){return e.apply(this,arguments)}}();l().then((n=>{var i;n.id&&(null===(i=t.onSuccess)||void 0===i||i.call(t,n.id)),(0,zt.mL)(zt.vP.podcast_collect,void 0!==n.id,zt.p6.Podcast,`${n.id}`),e(n.id)})).catch((()=>{(0,zt.mL)(zt.vP.podcast_collect,!1,zt.p6.Podcast),i(new Error("save podcast memo error"))})).finally((()=>{var e;null===(e=t.onFinally)||void 0===e||e.call(t)}))}))}))})),yl.apply(this,arguments)}let bl=function(e){return e.toolbar="toolbar",e.summaryCard="summaryCard",e}({});function wl(e,t){const[n]=(0,f.Y)("authInfo"),{insertMemo:i=hl,tracker:o={}}=ca()||{},{reportTakeNoteStatus:s}=o,r=(0,m.useCallback)(function(){var o=(0,a.A)((function*(o,r,a){if(!n.isAuthenticated)return void(0,_e.DT)({trackMeta:{previous_page:"web",login_entrance:"web"}});const l="toolbar"===e?"toolbar":"summary";try{let e="";try{e=yield(0,xn.r)(a)}catch(c){ar.z3({message:"upload videoshot error",error:c})}const n=yield i({content:o,video_time:Math.ceil(r),snapshot_img:e});return function(e){const t={content:(0,Te.jsx)(Gi,{infoUrl:e.infoUrl}),duration:4,showClose:!1,className:J()(qi.A.toastCard),stack:!1,id:"4",zIndex:99999};Vi.close("1"),Vi.close("2"),Vi.close("3"),Ki((()=>Vi.success(t)))}({infoUrl:`${bn.Vl}/${n}`}),pn.A.emit("video-memo-updated",n),null==s||s(l,"save","success"),n&&(null==t||t(n)),!0}catch(d){pn.A.emit("video-memo-save-failed",e,{context:o,video_time:r,blob:a}),ar.z3({message:"save memo error",error:d}),null==s||s(l,"save","fail"),to()}return!1}));return function(e,t,n){return o.apply(this,arguments)}}(),[t,e,n,s]);return r}const Cl={closeAssistant:"closeAssistant-kOkYEs",videoSummaryAssistantContainer:"videoSummaryAssistantContainer-akGg3K",tabContainer:"tabContainer-T52ATa","main-tabs":"main-tabs-DD8dEN",mainTabs:"main-tabs-DD8dEN",area:"area-pKRbkk",header:"header-Y1_yxW",controls:"controls-TriwIR",actionBtn:"actionBtn-h61pvg",iconBtn:"iconBtn-FwVKd8","content-visible":"content-visible-T7D5IW",contentVisible:"content-visible-T7D5IW",footer:"footer-Bs22z8",buttonItem:"buttonItem-DKpkLR",commonIcon:"commonIcon-zatgvP",actionFooterBtn:"actionFooterBtn-bfZlUX",content:"content-k93CU9",highlightPlaceholder:"highlightPlaceholder-DodOvW",highlightPlaceholderTitle:"highlightPlaceholderTitle-hScHbx",highlightLoadingContainer:"highlightLoadingContainer-D9SwcL",summary:"summary-C43f3d","no-transcript":"no-transcript-i7_Gk4",noTranscript:"no-transcript-i7_Gk4",gradientButton:"gradientButton-lSN9Xt",onboarding:"onboarding-j1o5b_",gradient_move:"gradient_move-YZnxFm",gradientMove:"gradient_move-YZnxFm",button:"button-zRpVJs",chatButton:"chatButton-uWBrKd",rightOperationButtons:"rightOperationButtons-PgKvtE","highlight-title":"highlight-title-bNWBMa",highlightTitle:"highlight-title-bNWBMa",streamMessage:"streamMessage-Ly4SZU",scrollContainer:"scrollContainer-ONDBtF",fadeIn:"fadeIn-rs4Pol",optionContainer:"optionContainer-Fm0DdW","first-time-use-summarize":"first-time-use-summarize-f2OC1h",firstTimeUseSummarize:"first-time-use-summarize-f2OC1h","no-subtitles-with-guidance":"no-subtitles-with-guidance-liS6JO",noSubtitlesWithGuidance:"no-subtitles-with-guidance-liS6JO","tab-inactive":"tab-inactive-Idddik",tabInactive:"tab-inactive-Idddik","transcript-container":"transcript-container-yUdlQL",transcriptContainer:"transcript-container-yUdlQL",timeline:"timeline-pM2KOH",time:"time-oHJzL8",text:"text-gY_g3D",memoListContainer:"memoListContainer-_40qBb",memoList:"memoList-AYasau",memoModal:"memoModal-So3MqA",deleteConfirmPopup:"deleteConfirmPopup-zJQ5RP",title:"title-sAoKsj",opt:"opt-JZHO5b",optBtn:"optBtn-K3Jv2_",confirmBtn:"confirmBtn-Q5ipxh",cancelBtn:"cancelBtn-yy2W8G","content-tabs":"content-tabs-Ogw4PL",contentTabs:"content-tabs-Ogw4PL","content-tab-bar":"content-tab-bar-gIeyIa",contentTabBar:"content-tab-bar-gIeyIa","content-tab-item":"content-tab-item-FFroym",contentTabItem:"content-tab-item-FFroym","tab-title-suffix":"tab-title-suffix-bririF",tabTitleSuffix:"tab-title-suffix-bririF",searchInput:"searchInput-O4276U",close:"close-TfmU6N",searchResult:"searchResult-vZLvPR",searchItem:"searchItem-yNYdHx",highlight:"highlight-7bkvX0",collpaseContainer:"collpaseContainer-OrtjUt",iconContainer:"iconContainer-Jh4OaB",chevronUpIcon:"chevronUpIcon-rrqKOy",expandContainer:"expandContainer-Ttta0l"},Al=({onCancel:e,onConfirm:t})=>{const n=(0,Je.Uk)();return(0,Te.jsxs)("div",{className:Cl.deleteConfirmPopup,children:[(0,Te.jsx)("div",{className:Cl.title,children:n("flow_web_ext_youtube_notes_delete_popup_desc")}),(0,Te.jsxs)("div",{className:Cl.opt,children:[(0,Te.jsx)(je.$n,{theme:"solid",onClick:t,type:"tertiary",className:J()(Cl.optBtn,Cl.confirmBtn),children:n("flow_web_ext_youtube_notes_delete")}),(0,Te.jsx)(je.$n,{theme:"solid",type:"tertiary",onClick:e,className:J()(Cl.optBtn,Cl.cancelBtn),children:n("flow_web_ext_youtube_notes_delete_popup_btn")})]})]})};let Sl=[],kl={};const El=({cardMode:e,getMemoListContainer:t,emptyNode:n})=>{var i,o;const{getMediaCurrentTime:s,getMediaDuration:l,seekMediaTo:c,updateMemo:d,removeMemo:u,queryMemoList:h,getMediaTranscript:p,tracker:g={}}=ca()||{},{reportTakeNoteShow:v,reportTakeNotePadClick:_,reportTakeNoteStatus:x,reportTakeNotePadShow:y}=g,b=(0,Je.Uk)(),w=(0,m.useRef)(null),[C,A]=(0,m.useState)(""),[S,k]=(0,m.useState)(!0),E=(0,m.useRef)(null),[T,I]=(0,m.useState)(""),[j,N]=(0,m.useState)(!1),[R,M]=(0,m.useState)(""),[P,L]=(0,m.useState)(""),[B,D]=(0,m.useState)(0),[O,F]=(0,m.useState)(Sl),[U,H]=(0,m.useState)({}),[z,q]=(0,m.useState)(!1);(0,m.useEffect)((()=>{const e=(null==l?void 0:l())||0;null==v||v("summary"),q(e>=3600);const t=(0,Is.A)((()=>{null==h||h().then((e=>{Sl=e.sort(((e,t)=>t.create_time-e.create_time)),F(Sl),(0,_n.hm)(e.map((e=>e.snapshot_img))).then((e=>{kl=e,H(kl)}))}))}),500);return pn.A.on("video-memo-updated",t),t(),()=>{pn.A.off("video-memo-updated",t)}}),[v]);const V=(0,m.useCallback)(((e,t,n)=>{if(L(e),"delete"===t){var i;setTimeout((()=>N(!0)),10);const t=null===(i=w.current)||void 0===i?void 0:i.querySelector(`[id='${e}']`);D(((null==t?void 0:t.getBoundingClientRect().height)||0)/2)}else"edit"===t&&(M(e),I(n))}),[]),$=(0,m.useCallback)((()=>{I(""),M(""),null==_||_("summary","cancel")}),[_]),W=(0,m.useCallback)(function(){var e=(0,a.A)((function*(e){const t="summary",n="edit";try{null==_||_(t,n);const i=T;return e.content=i,yield null==d?void 0:d((0,r.A)((0,r.A)({},e),{},{content:i})),I(""),M(""),no(b("flow_web_ext_youtube_notes_edit_success")),null==x||x(t,n,"success"),!0}catch(i){return null==x||x(t,n,"fail"),!1}}));return function(t){return e.apply(this,arguments)}}(),[T,_,x]),K=(0,m.useCallback)(function(){var e=(0,a.A)((function*(e){const t="summary",n="delete";try{null==_||_(t,n),N(!1),yield null==u?void 0:u(e),pn.A.emit("video-memo-updated",e),N(!1),no(b("flow_web_ext_youtube_notes_deleted")),null==x||x(t,n,"success")}catch(i){null==x||x(t,n,"fail")}}));return function(t){return e.apply(this,arguments)}}(),[_,x]),Y=wl(bl.summaryCard,(()=>A(""))),G=(0,m.useCallback)((e=>null==c?void 0:c(e)),[]),Q=null===(i=E.current)||void 0===i?void 0:i.getVideoSnapshot(),Z=(S?null==s?void 0:s():(null===(o=E.current)||void 0===o||null===(o=o.getVideoSnapshot())||void 0===o?void 0:o.currentTime)||(null==s?void 0:s()))||0,X=(0,m.useCallback)((()=>{null==y||y("summary")}),[y]),[J]=(0,f.Y)("authInfo"),ee=(0,m.useCallback)((e=>{A(e),J.isAuthenticated||(0,_e.DT)({trackMeta:{previous_page:"web",login_entrance:"web"}})}),[J]),te=(0,m.useRef)(null),ne=te.current&&te.current.scrollHeight>te.current.clientHeight;return(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsxs)("div",{className:Cl.memoListContainer,ref:w,children:[(0,Te.jsx)(La,{ref:E,recoverFrom:bl.summaryCard,autoWidth:!0,onTextInput:ee,defaultText:C,onSimpleModeChange:k,editPadShow:X,timeLabel:fi(`${Math.ceil(Z)}`,z),enableSimpleMode:!0,onCancel:()=>{null==_||_("summary","cancel"),A("")},onEscape:()=>A(""),onConfirm:()=>(null==_||_("summary","save"),Y(C,Z,(null==Q?void 0:Q.snapshot)||new Blob)),disableOkBtn:0===C.trim().length}),0===O.length&&n,(0,Te.jsx)("div",{className:Cl.memoList,ref:te,style:{height:ne?"100":"auto"},children:O.map((n=>(0,Te.jsx)(je.AM,{getPopupContainer:t,trigger:"custom",style:{marginTop:`-${B}px`,borderRadius:"16px"},visible:j&&n.id===P,content:(0,Te.jsx)(Al,{onCancel:()=>N(!1),onConfirm:()=>K(n.id)}),children:(0,Te.jsx)("div",{id:n.id,children:(0,Te.jsx)(cl,{id:n.id,cardMode:e,transcript:na((null==p?void 0:p())||[],n.video_time),editMode:R===n.id,onContextMenuItemClick:(e,t)=>V(e,t,n.content),textContent:R===n.id?T:n.content,timeLabel:fi(n.video_time,z),imgUrl:n.snapshot_img&&(null==U?void 0:U[n.snapshot_img])||"",onTextInput:I,onCancel:$,onEscape:$,onConfirm:()=>W(n),onCoverImgClick:()=>G(n.video_time),onTimecapsuleClick:()=>G(n.video_time)})},n.id)})))})]})})},Tl="memoEmptyContainer-zJsMMw",Il="textArea-kZH74L",jl="preview-img-JzTABe",Nl=()=>{const e=(0,Je.Uk)();return(0,Te.jsxs)("div",{className:Tl,children:[(0,Te.jsx)("div",{className:jl}),(0,Te.jsx)("div",{className:Il,children:e("flow_web_ext_youtube_notes_tips")})]})};let Rl=function(e){return e.videoToolBar="video_tool_bar",e.summary="summary",e}({}),Ml=function(e){return e.delete="delete",e.edit="edit",e.save="save",e.cancel="cancel",e}({});const Pl="video",Ll="podcast_summarize";function Bl(){return document.querySelector("video")}function Dl(){const e=(0,m.useCallback)((e=>"summary"===e?Rl.summary:Rl.videoToolBar),[]),t=(0,m.useCallback)((e=>{switch(e){case"cancel":return Ml.cancel;case"delete":return Ml.delete;case"edit":return Ml.edit;case"save":return Ml.save;default:return e}}),[]),n=(0,m.useMemo)((()=>({reportTakeNotePadShow:t=>{!function(e){(0,It.z8)(_.Ur.takeNotePadShow,{show_from:e,card_name:Pl,summary_message_id:ci.getVideoSummaryMsgBlock().videoSummaryId})}(e(t))},reportTakeNotePadClick:(n,i)=>{!function(e,t){const n=ci.getVideoSummaryMsgBlock();(0,It.z8)(_.Ur.takeNotePadClick,{click_from:e,button_name:t,card_name:Pl,summary_message_id:null==n?void 0:n.videoSummaryId,highlight_message_id:null==n?void 0:n.videoHighlightsId})}(e(n),t(i))},reportTakeNoteShow:t=>{!function(e){(0,It.z8)(_.Ur.takeNoteShow,{show_from:e,card_name:Pl})}(e(t))},reportTakeNoteStatus:(n,i,o)=>{!function(e,t,n){const i=ci.getVideoSummaryMsgBlock();(0,It.z8)(_.Ur.takeNoteStatus,{show_from:e,button_name:t,card_name:Pl,status:n,summary_message_id:null==i?void 0:i.videoSummaryId,highlight_message_id:null==i?void 0:i.videoHighlightsId})}(e(n),t(i),o)},reportTakeNoteBtnClick:()=>{var e;e=document.fullscreenElement?"immersive":"non_immersive",(0,It.z8)(_.Ur.takeNoteBtnClick,{click_from:e})}})),[]),i=(0,m.useMemo)((()=>{return{tracker:n,getMediaTarget:()=>Bl(),getMediaCurrentTime:()=>{var e;return(null===(e=Bl())||void 0===e?void 0:e.currentTime)||0},getMediaDuration:()=>{var e;return(null===(e=Bl())||void 0===e?void 0:e.duration)||0},getMediaTranscript:()=>ci.getTranscriptData(),seekMediaTo:e=>{const t=Bl();t&&(t.currentTime=e)},takeSnapShot:(e=(0,a.A)((function*(){const e=document.querySelector("video");return e?yield(0,_n.CU)(e):null})),function(){return e.apply(this,arguments)}),updateMemo:e=>function(e){return vl.apply(this,arguments)}(e),insertMemo:e=>hl(e),removeMemo:e=>function(e){return gl.apply(this,arguments)}(e),queryMemoList:()=>function(){return pl.apply(this,arguments)}()};var e}),[n]);return i}function Ol(){return In.j.getCommonPopupContainer()}const Fl=()=>{const e=Dl();return(0,Te.jsx)(la.Provider,{value:e,children:(0,Te.jsx)(El,{getMemoListContainer:Ol,emptyNode:(0,Te.jsx)(Nl,{})})})};var Ul=n(94870);const Hl="tabs-bD7J4T",zl="tab-item-emA2C7",ql="tab-icon-rope33",Vl="tab-text-INjVpq",$l="active-tab-text-t3v4X3",Wl="active-mfAmqD",Kl="loading-container-vxKfcs",Yl=({onSetPreviousActiveTabKey:e,onSetFirstShow:t,activeKey:n,webpageTabs:i,className:o,onChange:s,tabItemStyle:r})=>{const a=i.filter((e=>(e.itemTitle||e.icon)&&e.itemKey)),[l,c]=(0,m.useState)(n||a[0].itemKey);return(0,m.useEffect)((()=>{n&&a.find((e=>e.itemKey===n))&&c(n)}),[n]),(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)("div",{"data-testid":"tabs-container",className:J()(Hl,o),children:a.map((n=>{const{itemTitle:i,itemKey:o,icon:a,loading:d}=n;return(0,Te.jsxs)("div",{className:J()(zl,{[Wl]:l===o}),style:r,onClick:()=>{l!==o&&(null==e||e(l),c(o),null==t||t(!1),null==s||s(o))},"data-testid":`webpage-tab-${o}`,children:[a&&(0,Te.jsx)(Ul.Ay$,{className:ql,svg:a}),i&&(0,Te.jsx)("div",{className:J()(Vl,{[$l]:l===o}),children:i}),d&&(0,Te.jsx)(je.tK,{size:"small",wrapperClassName:Kl})]},o)}))})})};let Gl=function(e){return e.UPPER_RIGHT="upper_right",e.SUBSCRIBED="subscribed",e.ONBOARDING="onboarding",e.IMMERSION_FULLSCREEN_BTN="fullscreen_click",e.VIDEO_DB_CLICK="video_dbclick",e.IMMERSION_FULLSCREEN_SHORT_CUT="shortcut",e.IMMERSION_BTN="immersion_click",e.WATCH_RELAY="watch_relay",e.recommendVideo="recommendvideo_list_click",e.playNext="next_button",e.recommendVideoEnding="recommendvideo_ending_click",e.PODCAST_BUTTON="podcast_button",e}({}),Ql=function(e){return e.UPPER_RIGHT="upper_right",e.ONBOARDING="onboarding",e}({}),Zl=function(e){return e.BOTTOM_RIGHT="bottom_right",e.SHARE_MENU="share_menu",e}({}),Xl=function(e){return e.PAGE="page",e.CLIP="current_clip",e}({}),Jl=function(e){return e.TOOLBAR="video_toolbar",e.SHARE_PAGE="share_page",e.FULLSCREEN="fullscreen",e.SHORTCUT="shortcut",e.VIDEO_DB_CLICK="video_db_click",e}({}),ec=function(e){return e.TOOLBAR="video_toolbar",e.SHARE_PAGE="share_page",e}({}),tc=function(e){return e.EXPANDED="expanded",e.COLLAPSED="collapsed",e}({}),nc=function(e){return e.summary="to_summary",e.subtitle="subtitle",e.note="to_note",e.language="language",e.copy="copy",e.share="share",e.download="download",e.addFav="add_fav",e.continueToChat="continue_to_chat",e.clickHighlight="click_highlight",e.takeNote="take_note",e.fullscreen="fullscreen",e.read="read",e.toMindMap="to_mind_map",e}({});const ic=e=>{(0,It.z8)(_.Ur.showVideoAssistant,e)},oc=({click_from:e,button_name:t=_._h.summarizeVideo,whether_full_screen:n=0,content_title:i,content_duration:o})=>{(0,It.z8)(_.Ur.clickVideoAssistantSummarizeBtn,{click_from:e,button_name:t,whether_full_screen:n,content_title:i,content_duration:o})},sc=(e,t)=>{(0,It.z8)(e,t)},rc=e=>{(0,It.z8)(_.Ur.clickVideoImmersion,{click_from:e})},ac=e=>{(0,It.z8)(_.Ur.showVideoImmersion,{show_from:e})},lc=e=>{(0,It.z8)(_.Ur.immersionTimeLine,{mode:e})};const cc=()=>{(0,It.z8)(_.Ur.showVideoAssistantHighlightsTimeline,{show_type:5})},dc=e=>{(0,It.z8)(_.Ur.clickVideoAssistantHighlightsTimeline,{show_type:5,position:e,web_url:location.href,content_title:document.title})};let uc=function(e){return e.summary="summary",e.memo="memo",e.mindmap="mindmap",e}({});var hc=n(82275);var mc=n(38251);const pc="no-content-container-vpvLRc",gc="img-b_muJL",vc="no-content-with-guidance-C01QiO",fc=({text:e,customNode:t,imgSrc:n})=>(0,Te.jsxs)("div",{className:pc,"data-testid":"video-assistant-no-transcript-tips",children:[t,(0,Te.jsxs)("div",{className:vc,children:[n&&(0,Te.jsx)("img",{className:gc,src:n}),e]})]}),_c={"cici-ext-container":"cici-ext-container-eokF5t",ciciExtContainer:"cici-ext-container-eokF5t","inactivelink-hover-animation":"inactivelink-hover-animation-td8MgM",inactivelinkHoverAnimation:"inactivelink-hover-animation-td8MgM","notactivelink-hover-animation":"notactivelink-hover-animation-naiEz7",notactivelinkHoverAnimation:"notactivelink-hover-animation-naiEz7","light-click-animation":"light-click-animation-PzPBFY",lightClickAnimation:"light-click-animation-PzPBFY","click-animation":"click-animation-vqCoCt",clickAnimation:"click-animation-vqCoCt","semi-animation-rotate":"semi-animation-rotate-XbnXcn",semiAnimationRotate:"semi-animation-rotate-XbnXcn","inactive-btn-hover-animation":"inactive-btn-hover-animation-H3JXbe",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-H3JXbe","cici-ext-always-dark":"cici-ext-always-dark-yaMnSw",ciciExtAlwaysDark:"cici-ext-always-dark-yaMnSw","cici-ext-always-light":"cici-ext-always-light-si1vbH",ciciExtAlwaysLight:"cici-ext-always-light-si1vbH",ellipsis:"ellipsis-aItIY9","highlight-list-wrapper":"highlight-list-wrapper-xihFaP",highlightListWrapper:"highlight-list-wrapper-xihFaP","content-breakdown-wrapper":"content-breakdown-wrapper-ZO8UZw",contentBreakdownWrapper:"content-breakdown-wrapper-ZO8UZw","podcast-breakdown-wrapper":"podcast-breakdown-wrapper-CBrX8P",podcastBreakdownWrapper:"podcast-breakdown-wrapper-CBrX8P","highlight-title":"highlight-title-aEzmlu",highlightTitle:"highlight-title-aEzmlu",breakdownContainer:"breakdownContainer-hE5NKx","no-hover":"no-hover-krW7_E",noHover:"no-hover-krW7_E",breakdownExpand:"breakdownExpand-eXdPNP",breakdownTitle:"breakdownTitle-c4_spY",breakdownIsPlaying:"breakdownIsPlaying-nx8qEe",breakdownTag:"breakdownTag-wncJGJ",activeTag:"activeTag-SApbRQ",breakdownContentContainer:"breakdownContentContainer-kJyNZ5",breakdownSectionContainer:"breakdownSectionContainer-oZtSm0",breakdownContent:"breakdownContent-NHj0oy",expandIconContainer:"expandIconContainer-cezszg",expandText:"expandText-OO5QcP",expandIconBg:"expandIconBg-lnivJk",foldIconContainer:"foldIconContainer-Z2N7dL",foldIconButton:"foldIconButton-Q8019v",isExpanding:"isExpanding-s5YPFu",bulletPointContainer:"bulletPointContainer-bmPPeT",pointTimestamp:"pointTimestamp-XpceP1",pointContent:"pointContent-Tui7tV",currentActiveBulletPoint:"currentActiveBulletPoint-MnWa2i",activeBreakdownContainer:"activeBreakdownContainer-CjiZNA",progressBarContainer:"progressBarContainer-c3vF1o",progressBar:"progressBar-mU8Ne9",divider:"divider-UjNdQT",keywordTagsContainer:"keywordTagsContainer-hr964W",loadingTips:"loadingTips-ZaRdjo",tagContainer:"tagContainer-pSL9D9",arrowIcon:"arrowIcon-SYcXGG",canClick:"canClick-VvKj2N","activelink-hover-animation":"activelink-hover-animation-C9h4bh",activelinkHoverAnimation:"activelink-hover-animation-C9h4bh"},xc=["tag","className","content","contentClassName","contentTooltip","active"];function yc(e){let{tag:t,className:n,content:i,contentClassName:o,contentTooltip:s,active:a}=e,l=(0,jt.A)(e,xc);return(0,Te.jsxs)("div",(0,r.A)((0,r.A)({className:J()(n,_c.bulletPointContainer,{[_c.currentActiveBulletPoint]:a})},l),{},{children:[(0,Te.jsx)(je.vw,{className:_c.pointTimestamp,children:t}),(0,Te.jsx)("div",{title:s,className:J()(_c.pointContent,o),children:i})]}))}const bc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQUAAADYCAYAAADiQfbUAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAsXSURBVHgB7d3tcRNZFsbxB9d8X2ewvRGAI6AdwZgIEBHgicByBEAEeCIAIkBEYE8E7olgvQnYe4/7qPB14bHUUt+X7v+v6labwjNg0Xp07mtLAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGOKFEru8vDwMl1feXoa2/rX860MBu7sJrfOrtb9CW4V2dXR0dCM8KUkoeBAsQvtdfQDwxkdOVwcHB6vb29tvISBWQmTUUAhh0IbLWWitgDJ1oZ2HcLgQ7o0SCiEMmnD5LMIA9ehEONzbeyiEQHgfLkvRRUCdLtSHQ6eZ2msohECw6mAhoG5daMdzDYYD7QmBgAlpQvse7ulXmqG9VArhxfsQLqcCpqXTDCuGnSuFEAg2u0AgYIqa0L74lPps7BQKPsuwFDBd1oWY1YferpXCBwHTd+YfgLMwOBR8YdKJgHn4rJnYpVI4EzAf7VzGFn7TAF5KtdoP25xyFdoP9aO9nYDdrTfdvVY/YLgPNraw1MQNCgXtJxC60D6FdsGuNYxgtf7Cu7qL0N5qN+vVupM2aJ1CeJG/a7dgsDBYEgZIKdy3C/Xd3kbDhdv26EoTtvWYgverWg1n68pPCQSk5pudjrVbF7XVxA0ZaNxl6een8A+zFJCJr058o+FaTVzKUOjEQicUwMv/cw3zUhM3JBQaDXNOlwEF+ah+5mtbzdSnJoeEwtCkXAkohH9A/alhCIVHhrwgqzkfWoFirTRMowlL1X34IaA8Kw3TaMJSVQqTntdFnbwLwTjXI3s7eekZvPAoFffmI6lCAShVJ0QIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAECEUAEQIBQCR3wTM25vQmtAO/deHD3790q+vHvz+5BEKmLWjo6ObcLl67vsuLy8tGKy1oXWaMEIB2EAIDwsOaxeaOMYUAEQIBQARQgFAhFAAECEUAEQIBQARQgFAhFAAEGHxEibt8vJyvWzZViM2BwcH/7q9vV0vWW782vn179DWKxxvfMHS7BAKmJQQAk24nKjft9Dq5xv/XggEbSr8v+4DIgTJVfjvvoWQWGkGCAVUL7x523B5HdpCj0JgR1ZRtCEQ2nA99ZBYhWYBcaGJIhRQJe8WWEXwVn1FkML6zzwJf/6Z+oA4DwHRaUIIBVTFw+B9aKfKu525UV+ZLMLf6UITCgdmH1CN8OazMLgObamyzjdYhHYd/n6ffUyjaoQCimdjBqFdhi8/quzDThbqw+FMFaP7gGJ5V8HeYKeqyzL83Rfhelxjl4JKAUXyMtyqg9oCYa1RpVUDoYDihDeSzShYIDSq39LHGqo545FQQFH8k/VC0zoodaH7H62OQUhCAcUIb5oP6mcWpqgJ7XsNwUAooAhWYqve8YNNNaogGAgFZOcVwkLz0KjwYCAUkJWPIUy9QnisUcHBQCggG1+huNQ8NaF9KXFWglBAFv7EpY+aN3sNilvHQCggOS+bvwjGtmQX1X0iFJDcixcv7NOxEdbOShpfIBSQlO0JuLu7WwgP2bjCZxWCUEAy/mlY9Q7CEbW+iSo7QgEp2WxDo3GtQjv3tlJdPpQwG8HWaSThVcLYA2rvHp+d6LMcNqjZqHwWCPYaLZURlQKS8MHFMV386jBVO6Y9tP+EL9/p51HuJXufu1ogFDA6qxISDC7++U+/6YFx/Nz3FWBdLWRDKGB0CaqEjdgpSKEtwpdWOZT8oJes1QKhgFHZzR2qhBMVxMPhSOV2KSwQFsqEUMDYLBCKPDDFuxQWDucqz+/KhFDA2N6qYCEY7JmRS/VdipLGG9pcqxwJBYzGb+pWFXgw3lBSl2KhDAgFjKlVZaxL4VOYJXQpXisDQgFjytYv3lUhXYo2xywEoYAxvVLFHnQp3ihfl6JVYoQCRuHLixtNQAiGr96l+EPpw6FVYoQCxtJoYkIw2ElRqVdFNkqMUMBYqu46POXRqshO43upxAgFjCX5zZySh0OKjVZN6sFGtk5vqZZHf41hyycoT+mxb0+yKcxwT6zUb3cea6GWvZY3SoRQ2FD4h2/DxR5aMsmyeAOd+pJ5U41mwsNyEe6RZbh+1/5/9kYJBzjpPmzAqwP7x55rIAzRaGY8HGwgstN+NUqIUNhAKVt/M+uEZ3kwfFLFUoVCo4rd3d01AjZ3oYoNCYUhAx61l93JBnmA3FKFQu3TU98EbK5VxYaEQqftvSrxQZqb8sM4qu4nZjDL6srv8w/ar6Sv5ZApyb+1vfXxUtU+UDQEgz3z76sq/xTYwbY3pn3/LNYqrPm0tT3pqdF+FR8KduDlkEUadhil7VWv9hMk/N1Xqu8BI7nMplLwKWsLg1bjSPpapuo+mEY8MmxO/tLEWVchNLunLzViBWnPrlBCQ0JhpeFO/UXE9HWaMO8qWBgsNW43KflR9FuHgpf/Kw23JBhmodMEWVchNFvdOsZy5l8ZMoa3k6GLl35oNxYM16U8ZRejWGlCHnQVrpV2sDl5pfBCA/jAyrX2Y115WB/0SiwUKtnNNv3bcJ/8V+lmII59IHjv/MPLphlzzKaM9nM9ZdAuSVvf7dtFW+3OXugTbyjbSv2Gn03Zoq+in/vwT3zcwKqDVpmkDgSzy96HEp+qg3Ftu1w9eem7D95VsMrAxg1a5bNSBoNDgTn7WTr0A1k3daHKhJ/vvfqu8anyy3K8/K67JO10W8YA5qXd9Bv3MFOVjHUVQrMpRlt1W8pKzJUy2CkUfNCJbsS8bPuAl6I3k/kU4xeVd4jOasvj7/Zm5/MU/Njrkh7MiXFtu7ntQgVWk49WI5Y4yJ3tPbWXQ1b8yGuCYR4sEDb+RPUuRFE7TBOuRhyq8525Wezt5CUPBrYXz8O204wXGt+zb+4MqxGHytol3+txbLa9WP3gI6btZJsuhPeNx64knxzryLgacYisVYLZ+xmNPsaQ+2m9GNf6fIxtLDWuxa/21PhqxOsEf/6+ZB+4H7TMeVM+p23VQ7Wr2vAkGx3fZnWj/LkIY2+G6/RzubwNINZ00Mv6qVNZjRoKa75XolUfDq0wFVuty/cuh31q1/RGTSn5PodfSRIKj/no7/pR5S/9eihultoMqRbs0/uL8JidSvZOBcgSCpg3XyzEBrifOvVVQqcC8IQo5DD2k5pr86aUQDCEApLzBU1vBHOe+gzG5xAKyMLfCHNf0/IpvA5LFYYxBWSVaJqyRFchEI5UICoFZOWflHNbHm9V0lazNilRKaAI9qAgzWORmwVCUQOLj1EpoAi+oW7qZ3PcVwglB4IhFFAM70pMNRhsL9BxDY9NpPuA4mQ+Un0M5yXOMjyFUECRfL9M6ecePOd+PUYJ+xm2QSigaBVPWa7UB0J1BxsTCiheZVVDF9ofIQy+qlKEAqrhYw1WNTQqz/osyo81VgcPEQqoTmHhMJkwWCMUUC0Ph1wH99iaA3umxWTCYI1QQPV8zMHOZ7CAGPOBLvbmt/UGX2ubUdgGoYBJeXD0nzU71WuXkOjUVwQ/1J8yVdQW57EQCpg8P0C40c9j//79i2/7n/oQsGrA3vzd1LoFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA2If/A27hONTUbzEAAAAAAElFTkSuQmCC";function wc({subtitles:e,query:t,onVisible:n,onItemClick:i}){const o=(0,v.B)(),s=(0,m.useMemo)((()=>{let t=!1;return{result:e.map(((e,n)=>{const i=e.offset/1e3;return i>3600&&(t=!0),{offset:i,textLowerCase:e.text.toLowerCase(),data:e,id:n}})),overHour:t}}),[e]);(0,m.useEffect)((()=>{null==n||n()}),[]);const r=(0,m.useMemo)((()=>{const e=t.toLowerCase();return s.result.filter((t=>t.textLowerCase.indexOf(e)>=0)).map((e=>({tag:fi(e.offset,s.overHour),data:e.data,id:e.id})))}),[s,t]);return r.length<=0?(0,Te.jsx)(fc,{text:o("flow_web_ext_subtitle_search_no_result","\u672a\u641c\u7d22\u5230\u5b57\u5e55\u5185\u5bb9"),imgSrc:bc}):(0,Te.jsx)(mc.Y1,{itemCount:r.length,height:Math.min(36*r.length,720),width:"100%",itemSize:36,children:({index:e,style:n})=>{const o=r[e];return(0,Te.jsx)(yc,{style:n,tag:o.tag,className:Cl.searchItem,contentClassName:Cl.content,contentTooltip:o.data.text,content:(0,Te.jsx)(je.f4,{sourceString:o.data.text,searchWords:[t],highlightClassName:Cl.highlight}),active:!1,onClick:()=>null==i?void 0:i(o.data,e)},`${o.id}`)}})}const Cc=(0,m.memo)(wc);var Ac=n(9388),Sc=n(94083),kc=n(64462),Ec=n(38080);class Tc{constructor(){var e=this;(0,y.A)(this,"videoId",""),(0,y.A)(this,"videoTitle",""),(0,y.A)(this,"videoThumbnail",""),(0,y.A)(this,"shareLink","https://www.doubao.com"),(0,y.A)(this,"shareAll",!1),(0,y.A)(this,"shareContent",[]),(0,y.A)(this,"currentClipIndex",-1),(0,y.A)(this,"qrCodeUrl",""),(0,y.A)(this,"loadThumbnail",(()=>new Promise((e=>{const t=document.createElement("img");t.onload=()=>{e(!0)},t.onerror=()=>{e(!0)},t.src=this.getVideoThumbnailUrl()})))),(0,y.A)(this,"loadQRCode",(0,a.A)((function*(){const t=yield Tc.url2QRCodeSVG(e.shareLink);e.qrCodeUrl=t}))),(0,y.A)(this,"init",(0,a.A)((function*(){yield Promise.all([e.loadThumbnail(),e.loadQRCode()])}))),(0,y.A)(this,"resetVideoData",(e=>{const{videoId:t,shareAll:n,shareLink:i,shareContent:o,videoTitle:s,currentClipIndex:r,videoThumbnail:a=""}=e;this.videoThumbnail=a,this.videoId=t,this.shareAll=n,this.shareLink=i,this.videoTitle=s,this.shareContent=o,this.currentClipIndex=r})),(0,y.A)(this,"getVideoThumbnailUrl",(()=>this.videoThumbnail||Tc.getYoutubeCoverImageUrl(this.videoId))),(0,y.A)(this,"getQRCodeUrl",(()=>this.qrCodeUrl)),(0,y.A)(this,"copyCard",function(){var e=(0,a.A)((function*(e){yield(0,Ec.sW)(e)}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"downloadCard",function(){var e=(0,a.A)((function*(e){return yield(0,Ec._i)(e,"share_video.png"),!0}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"getShareContent",(()=>this.shareContent)),(0,y.A)(this,"getCurrentClipIndex",(()=>this.currentClipIndex)),(0,y.A)(this,"getVideoTitle",(()=>this.videoTitle)),(0,y.A)(this,"getIfShareClip",(()=>!this.shareAll))}}(0,y.A)(Tc,"getYoutubeCoverImageUrl",(e=>`https://img.youtube.com/vi/${e}/maxresdefault.jpg`)),(0,y.A)(Tc,"url2QRCodeSVG",((e,t)=>new Promise((n=>{const i={errorCorrectionLevel:"H",type:"image/jpeg",margin:1,color:{dark:(null==t?void 0:t.colorDark)||"#FFF",light:(null==t?void 0:t.colorLight)||"#844B38"}},o=document.createElement("canvas");Sc.toDataURL(o,e,i,((e,t)=>{n(e?"":t)}))})))),(0,y.A)(Tc,"domNode2Canvas",function(){var e=(0,a.A)((function*(e){let t=null;try{t=yield(0,kc.mo)(e)}catch(n){}return t}));return function(t){return e.apply(this,arguments)}}());const Ic=new Tc;var jc=n(59980),Nc=n(99664),Rc=n(59107);const Mc="video_clip_container-AwCP0c",Pc="video_clip_item-MzbEid",Lc="video_clip_time-wKZkPO",Bc="active-OcuxR4",Dc="time-BQXF9X",Oc="video_clip_section-Gnp4gF",Fc=e=>{const{content:t,currentClipIndex:n}=e;return(0,Te.jsx)("div",{className:Mc,children:t.map(((e,t)=>{const i=n===t,{timestamp:o,section:s}=e;return(0,Te.jsxs)("div",{className:Pc,children:[(0,Te.jsx)("div",{className:J()({[Lc]:!0,[Bc]:i}),children:(0,Te.jsx)("span",{className:J()({[Dc]:!0,[Bc]:i}),children:fi(o)})}),(0,Te.jsx)("span",{className:J()({[Oc]:!0,[Bc]:i}),children:s})]})}))})};var Uc=n(92806);const Hc="share_card_video_summary-lz7MJv",zc=e=>{const{content:t}=e;return(0,Te.jsx)("div",{className:Hc,children:(0,Te.jsx)(Uc.FH,{markDown:t,style:{color:"var(--s-color-text-invert-intact-secondary, rgba(255, 255, 255, 0.85))"}})})},qc="logo_with_description-oEC1b0",Vc="logo-_0H7zm",$c="description-yn1RWx",Wc="name-yWTHAK",Kc="slogan-qhJPuD",Yc=e=>{const{iconUrl:t,brandName:n,slogan:i}=e;return(0,Te.jsxs)("div",{className:qc,children:[(0,Te.jsx)("img",{src:t,alt:"avatar",className:Vc}),(0,Te.jsxs)("div",{className:$c,children:[(0,Te.jsx)("span",{className:Wc,children:n}),(0,Te.jsx)("span",{className:Kc,children:i})]})]})},Gc="share_card_wrapper-sgCYh0",Qc="share_card-pBhLRQ",Zc="share_card_close_button-pe0HYM",Xc="share_card_main-wti6Cg",Jc="share_card_main_image_container-RNx0jU",ed="share_card_main_image-vtzLbE",td="share_card_main_image_overlay-AbPF3P",nd="share_card_main_content-eF8pPX",id="share_card_content_header-Rvc9ga",od="share_card_content_summary-H2das6",sd="share_card_content_summary_title-Ji2TRv",rd="sum_title_icon-4drIQa",ad="sum_title_text-A1_1CA",ld="share_card_content_summary_main-py1JqY",cd="share_card_content_bottom-iD2sLS",dd="qr_code-FsvqaO",ud="share_card_action_buttons-yl0HI6",hd="share_card_download_button-owcQ1W",md="share_card_copy_button-vMZWSg",pd="icon-m56oEh",gd="text-BVHIbw",vd=e=>{var t;const{extName:n,extIconUrl:i,onClose:o,t:s,onCopy:r=h.A,onDownload:l=h.A}=e,[c,d]=(0,m.useState)(!1),[u,p]=(0,m.useState)(!1),[g,v]=(0,m.useState)(!1),f=(0,m.useRef)(null);(0,m.useEffect)((()=>{Ic.init().then((()=>d(!0)))}),[]);const _=function(){var e=(0,a.A)((function*(){g||f.current&&(r(),v(!0),yield Ic.copyCard(f.current),v(!1))}));return function(){return e.apply(this,arguments)}}(),x=function(){var e=(0,a.A)((function*(){if(u)return;if(!f.current)return;l(),p(!0);(yield Ic.downloadCard(f.current))?setTimeout((()=>{p(!1)}),500):p(!1)}));return function(){return e.apply(this,arguments)}}(),y=Ic.getIfShareClip();return(0,Te.jsx)("div",{className:Gc,onClick:o,children:c?(0,Te.jsxs)("div",{className:Qc,onClick:e=>e.stopPropagation(),children:[(0,Te.jsx)("div",{className:Zc,onClick:o,children:(0,Te.jsx)(jc.A,{})}),(0,Te.jsxs)("div",{className:Xc,ref:f,children:[(0,Te.jsxs)("div",{className:Jc,children:[(0,Te.jsx)("img",{className:ed,src:Ic.getVideoThumbnailUrl(),alt:"thumbnail"}),(0,Te.jsx)("div",{className:td})]}),(0,Te.jsxs)("div",{className:nd,children:[(0,Te.jsx)("div",{className:id,children:Ic.getVideoTitle()}),(0,Te.jsxs)("div",{className:od,children:[(0,Te.jsxs)("div",{className:sd,children:[(0,Te.jsx)(ct.A,{className:rd}),(0,Te.jsx)("span",{className:ad,children:s("flow_web_ext_youtube_share_summary")})]}),(0,Te.jsx)("div",{className:ld,children:y?(0,Te.jsx)(Fc,{content:Ic.getShareContent(),currentClipIndex:Ic.getCurrentClipIndex()}):(0,Te.jsx)(zc,{content:(null===(t=Ic.getShareContent()[0])||void 0===t?void 0:t.section)||""})})]}),(0,Te.jsxs)("div",{className:cd,children:[(0,Te.jsx)(Yc,{brandName:n,slogan:s("flow_web_ext_youtube_share_desc"),iconUrl:i}),(0,Te.jsx)("img",{className:dd,src:Ic.getQRCodeUrl(),alt:"qrcode"})]})]})]}),(0,Te.jsxs)("div",{className:ud,children:[(0,Te.jsx)("div",{className:hd,onClick:x,children:u?(0,Te.jsx)(je.tK,{spinning:!0}):(0,Te.jsx)(Nc.A,{})}),(0,Te.jsxs)("div",{className:md,onClick:_,children:[(0,Te.jsx)("div",{className:pd,children:g?(0,Te.jsx)(je.tK,{spinning:!0}):(0,Te.jsx)(Rc.A,{})}),(0,Te.jsx)("div",{className:gd,children:s("flow_web_ext_youtube_share_copy")})]})]})]}):(0,Te.jsx)(je.tK,{spinning:!0})})};var fd=n(68475),_d=n(53645),xd=n(93967);const yd="share_menu_container-lxmk1w",bd="share_item_container-hnykmx",wd="item_icon-SGwgZ2",Cd="item_text-iUrtDq",Ad="checkbox-c8t193",Sd="small_text-sTqlcx",kd="bottom_divider-PbdxTn",Ed="button-ttHrL3",Td="upload_icon-AJdpdr",Id=e=>{const{onClickShareLink:t,onClickShareCard:n,containerRef:i,onClickMainButton:o,isYtb:s,t:r}=e,[a,l]=(0,m.useState)(!1),[c,d]=(0,m.useState)(!1),u=()=>(null==i?void 0:i.current)||document.body;return(0,Te.jsx)(je.ms,{trigger:"custom",visible:c,onVisibleChange:d,onClickOutSide:()=>d(!1),className:yd,position:"topRight",spacing:{x:0,y:-48},getPopupContainer:u,render:(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsxs)("div",{className:bd,"data-testid":"video-assistant-shareSingleClipBtn",onClick:()=>{t(!a),d(!1)},children:[(0,Te.jsx)(fd.A,{className:wd}),(0,Te.jsx)("div",{className:Cd,children:"\u5206\u4eab\u94fe\u63a5"})]}),s?(0,Te.jsxs)("div",{className:bd,onClick:()=>{n(!a),d(!1)},children:[(0,Te.jsx)(_d.A,{className:wd}),(0,Te.jsx)("div",{className:Cd,children:r("flow_web_ext_youtube_share_image")})]}):null,(0,Te.jsx)("div",{className:kd}),(0,Te.jsxs)("div",{className:bd,onClick:()=>{l((e=>!e))},children:[(0,Te.jsx)("div",{className:Ad,children:(0,Te.jsx)(je.Sc,{checked:a})}),(0,Te.jsx)("div",{className:Sd,children:r("flow_web_ext_youtube_share_clip")})]})]}),children:(0,Te.jsx)(je.m_,{content:r("flow_web_ext_youtube_sharepage_share"),getPopupContainer:u,children:(0,Te.jsx)(je.$n,{className:Ed,size:"small",onClick:()=>{d(!c),null==o||o()},"data-testid":"video-assistant-share-btn",icon:(0,Te.jsx)(xd.A,{className:Td})})})})};var jd=n(60588);const Nd="MODAL_CONTENT_UPDATED",Rd=new jd.b,Md=e=>{const{modal:t}=e,n=(0,Je.Uk)(),[i,o]=m.useState();return(0,m.useEffect)((()=>(Rd.on(Nd,o),()=>{Rd.off(Nd)})),[]),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t:n,children:null!=i?i:t})})};const Pd=e=>{const{Modal:t,props:n}=e;return(0,Te.jsx)(t,(0,r.A)({onClose:()=>{Ld.removeModal("",!0)}},n||{}))},Ld=new class{constructor(){var e;(0,y.A)(this,"modalShadowRootContainer",void 0),(0,y.A)(this,"modalShadowRoot",void 0),(0,y.A)(this,"modalCompRootContainer",void 0),(0,y.A)(this,"modalCompRoot",void 0),(0,y.A)(this,"contextWrapperRendered",!1),(0,y.A)(this,"deleteKey",""),(0,y.A)(this,"hideModal",(()=>{Rd.emit(Nd,null),this.modalShadowRootContainer.style.display="none"})),(0,y.A)(this,"showModal",(()=>{this.modalShadowRootContainer.style.display="flex"})),(0,y.A)(this,"renderModalContextWrapper",(()=>{var e;null===(e=this.modalCompRoot)||void 0===e||e.render((0,Te.jsx)(Md,{modal:this.getModalContent()})),this.contextWrapperRendered=!0})),(0,y.A)(this,"contentRenderer",null),(0,y.A)(this,"addModal",(e=>{const t=(0,sr.A)();return this.deleteKey=t,this.showModal(),this.contentRenderer=e,this.contextWrapperRendered?Rd.emit(Nd,this.contentRenderer):this.renderModalContextWrapper(),t})),(0,y.A)(this,"removeModal",((e,t=!1)=>{(e===this.deleteKey||t)&&this.hideModal()})),(0,y.A)(this,"getModalContent",(()=>this.contentRenderer)),this.modalShadowRootContainer=document.createElement("div"),this.modalShadowRootContainer.style.cssText="position: fixed; top: 0; bottom: 0; left: 0; right: 0; z-index: 9999; display: flex; align-items: center; justify-content: center;",this.modalShadowRoot=this.modalShadowRootContainer.attachShadow({mode:"open"}),(0,et.NR)(this.modalShadowRoot,ae.QN),this.modalCompRootContainer=document.createElement("div"),this.modalCompRootContainer.style.cssText="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;",null===(e=this.modalShadowRoot)||void 0===e||e.appendChild(this.modalCompRootContainer),this.modalCompRoot=(0,p.createRoot)(this.modalCompRootContainer),document.body.appendChild(this.modalShadowRootContainer),this.hideModal()}},Bd=(0,m.createContext)(null),Dd=()=>(0,m.useContext)(Bd),Od=({visible:e})=>{const t=(0,v.B)();return e?(0,Te.jsxs)("div",{"data-testid":"video-assistant-share-successToast",style:{padding:"10px 14px 10px 10px",borderRadius:10,background:"rgba(15, 15, 15, 1)",fontSize:16,fontWeight:500,display:"flex",alignItems:"center",color:"rgba(255, 255, 255, 0.95)",boxShadow:"0px 6px 10px 0px rgba(0, 0, 0, 0.08), 0px 0px 1px 0px rgba(0, 0, 0, 0.15)"},children:[(0,Te.jsx)(Pe.wO,{style:{height:24,marginRight:4}}),(0,Te.jsx)("div",{children:t("flow_web_ext_action_popup_copy")})]}):null},Fd=({videoId:e,currentPlayingClip:t,summaryResult:n,highlightResult:i,trackShareEvent:o})=>{var s;const r=(0,v.B)(),l=(0,As.A)("video_assistant"),[c,d]=(0,m.useState)(!1),u=(0,m.useRef)(document.createElement("div")),h=(0,m.useRef)(null),[p,g]=(0,m.useState)(""),f=(null===(s=Dd())||void 0===s?void 0:s.meta.title)||"",_=l.video_sharing_enabled&&(0,xi.jB)("youtube")||(0,xi.jB)("bilibili");(0,m.useEffect)((()=>(u.current=document.createElement("div"),u.current.id="cici-toast-tag",u.current.style.position="fixed",u.current.style.top="100px",u.current.style.left="50%",u.current.style.transform="translateX(-50%)",u.current.style.zIndex="9999",document.body.appendChild(u.current),()=>{u.current&&document.body.removeChild(u.current)})),[]);const x=function(){var t=(0,a.A)((function*(){if(_)try{const t=(0,xi.jB)("bilibili");let o=window.location.href;t&&(o=yield(0,di.Z)(e));let s="";if(!t){const t=Tc.getYoutubeCoverImageUrl(e),n=yield(0,_n.n_)(t);null!=n&&n.blob&&(s=yield new Promise(((e,t)=>{const i=new FileReader;i.onload=()=>e(null==i?void 0:i.result),i.onerror=e=>t(e),i.readAsDataURL(n.blob)})))}const r=yield(0,Nn.S6)({method:"POST",url:`${bn.C1}/samantha/plugin/youtube_share`,data:{content:JSON.stringify({video_id:e,title:f.replace(/ - YouTube$/,""),share_clip_index:-1,summary:n,highlight:i,video_type:t?"bilibili":"youtube",video_url:o,video_thumbnail:s})}});if(null!=r&&r.share_id){const e=`https://${bn.FI}/summary/${t?"bilibili":"youtube"}/${r.share_id}`;g(e)}}catch(t){(0,ar.Rm)("[Rowan] share clip failed",t)}}));return function(){return t.apply(this,arguments)}}();(0,m.useEffect)((()=>{x()}),[]);const y=o=>{const s=o?[{timestamp:0,section:n}]:i,a=`${p}?share_clip=${o?-1:t}`;Ic.resetVideoData({videoId:e,shareAll:o,shareLink:a,videoTitle:f,shareContent:s,currentClipIndex:null!=t?t:-1}),Ld.addModal((0,Te.jsx)(Pd,{Modal:vd,props:{extName:(0,fs.L2)()||"",extIconUrl:(0,fs.Nf)(),t:r,onCopy:()=>(0,Ke.s)("share_card_result_click",{content_type:"video_card",button_name:"copy"}),onDownload:()=>(0,Ke.s)("share_card_result_click",{content_type:"video_card",button_name:"download"})}}))};return(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("div",{children:_&&(0,Te.jsx)("div",{ref:h,onMouseDown:e=>e.stopPropagation(),style:{position:"relative"},children:(0,Te.jsx)(Id,{onClickShareCard:y,onClickShareLink:e=>(({shareAll:e})=>{e?null==o||o(Zl.SHARE_MENU,Xl.PAGE):null==o||o(Zl.SHARE_MENU,Xl.CLIP),p&&(Gt()(`${p}?share_clip=${e?-1:t}`),d(!0),setTimeout((()=>{d(!1)}),3e3))})({shareAll:e}),onClickMainButton:()=>{null===Ke.s||void 0===Ke.s||(0,Ke.s)("show_button",{button_type:"share",current_page:"youtube",range:"page"}),null===Ke.s||void 0===Ke.s||(0,Ke.s)("show_button",{button_type:"share",current_page:"youtube",range:"current_clip"})},containerRef:h,t:r,isYtb:(0,Wr.tY)()})})}),Ac.createPortal((0,Te.jsx)(Od,{visible:c}),null==u?void 0:u.current)]})},Ud=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",d:"M4.281 10.938q0-1.314.492-2.461a6.5 6.5 0 0 1 1.375-2.032 6.237 6.237 0 0 1 4.492-1.867 6.2 6.2 0 0 1 2.47.492q1.155.493 2.03 1.375a6.4 6.4 0 0 1 1.368 2.032q.5 1.148.5 2.46 0 1.032-.32 1.961a6.3 6.3 0 0 1-.868 1.696l3.563 3.578q.165.156.242.367.086.211.086.445 0 .33-.148.594a1.122 1.122 0 0 1-1 .57q-.235 0-.454-.085a1.1 1.1 0 0 1-.382-.25l-3.586-3.586q-.75.5-1.641.789a6.1 6.1 0 0 1-1.86.28 6.2 6.2 0 0 1-2.468-.491 6.4 6.4 0 0 1-2.024-1.367 6.5 6.5 0 0 1-1.375-2.024 6.3 6.3 0 0 1-.492-2.476m1.664 0q0 .976.36 1.828a4.8 4.8 0 0 0 1.015 1.5q.65.64 1.5 1.007a4.55 4.55 0 0 0 1.82.368q.977 0 1.829-.368a4.75 4.75 0 0 0 2.508-2.507 4.6 4.6 0 0 0 .367-1.828q0-.97-.367-1.82a4.8 4.8 0 0 0-1.016-1.5 4.6 4.6 0 0 0-1.492-1.009 4.6 4.6 0 0 0-1.828-.367q-.97 0-1.82.367a4.7 4.7 0 0 0-1.5 1.008q-.65.648-1.016 1.5a4.6 4.6 0 0 0-.36 1.82"})})),Hd=(0,js.a)((0,Te.jsx)(Ud,{}));var zd=n(3206);function qd(e){const{getPopupContainer:t,onSearch:n}=e,[i,o]=(0,m.useState)(!1),{changeExpand:s}=(0,m.useMemo)((()=>({changeExpand:t=>{var n;o(t),null===(n=e.onSizeChange)||void 0===n||n.call(e,t)}})),[]);return i?(0,Te.jsx)(je.pd,{className:Cl.searchInput,prefix:(0,Te.jsx)(Hd,{}),autoFocus:!0,placeholder:e.tooltip,onKeyDown:e=>e.stopPropagation(),onKeyUp:e=>{"Escape"===e.code&&(s(!1),null==n||n("")),e.stopPropagation()},onChange:e=>{null==n||n(e.trim())},suffix:(0,Te.jsx)(ve.A,{className:Cl.close,onClick:()=>{s(!1),null==n||n("")}})}):(0,Te.jsx)(zd.S,{className:Cl.iconBtn,tooltip:e.tooltip,getPopupContainer:t,onClick:()=>s(!0),icon:(0,Te.jsx)(Hd,{})})}const Vd="container-j8RhVh",$d="button-XaY_FC",{Text:Wd}=je.o5,Kd=({className:e})=>{const t=(0,v.B)(),n=(0,m.useRef)(null);return(0,Te.jsx)("span",{ref:n,className:J()(Vd,e),children:(0,Te.jsx)(je.$n,{theme:"solid",size:"small",className:$d,icon:(0,Te.jsx)(Pe.oE,{}),onClick:()=>{const e=(0,xi.jB)("youtube");(0,_e.DT)({trackMeta:{previous_page:e?"youtube":"bilibili",login_entrance:e?"youtube":"bilibili"}})},type:"primary",children:(0,Te.jsx)(Wd,{ellipsis:{showTooltip:{opts:{getPopupContainer:()=>n.current}}},style:{maxWidth:125},size:"small",children:t("flow_web_ext_search_login",{brand:(0,fs.L2)()})})})})};var Yd=n(17933),Gd=n(99472);const Qd="dropdownVisible-SWmfYq",Zd="select-Kuv39i",Xd="selectTitle-Hz1y6B",Jd="selectDropdown-powb6o",eu="languageLocal-NvRcHY",tu="languageSetting-lYgbLl",nu="optionContainer-lVwcBY",iu=e=>{var t;const{scene:n,anchorRef:i,popContainerRef:o,translateLanguage:s,toolTipClassname:r,translateIconClassname:a,onLanguageChange:l,trackResultEvent:c}=e,d="podcast"===(null===(t=Dd())||void 0===t?void 0:t.scene),[u,h]=(0,m.useState)(!1),p=(0,se.TK)("uiLanguage"),[g,f]=(0,m.useState)(null!=s?s:p),x=(0,Gd.e)(!0),y=(0,v.B)();return(0,Te.jsx)(je.l6,{className:Zd,dropdownClassName:J()((d?"podcast":"video")+"-language-selector",Jd),position:"bottomRight",suffix:(0,Te.jsx)(Pe.vo,{}),showArrow:!1,value:g,getPopupContainer:()=>i.current,onDropdownVisibleChange:e=>{e||h(!1)},onChange:e=>{h(!1),f(e),null==l||l(e),(0,Yd.Su)({before_language_result:g,after_language_result:e,scene:n})},triggerRender:()=>(0,Te.jsx)(zd.S,{tooltip:y("flow_web_ext_youtube_respond"),getPopupContainer:()=>o.current,className:J()(r,{[Qd]:u}),icon:(0,Te.jsx)(Pe.GP,{className:a}),"data-testid":(d?"podcast":"video")+"-language-btn",onClick:()=>{h(!0),null==c||c(_._h.languageSettings)}}),outerTopSlot:(0,Te.jsx)("div",{className:Xd,children:y("flow_web_ext_youtube_respond")}),children:null==x?void 0:x.map((({language_loc:e,language_code:t,language:n})=>{const i=t===g;return(0,Te.jsx)(je.l6.Option,{showTick:!1,value:t,children:(0,Te.jsxs)("div",{className:nu,"data-lang-option":t,children:[(0,Te.jsxs)("div",{children:[(0,Te.jsx)("div",{className:J()(eu),children:e}),t!==kn.Aq&&(0,Te.jsx)("div",{className:tu,children:n})]}),(0,Te.jsx)("div",{children:i&&(0,Te.jsx)(Pe.Tf,{})})]})},n+t)}))})};var ou=n(71038);const su=({available:e,contentVisible:t,popContainerRef:n,isAllDone:i,noContent:o,hasTranscript:s,isTranscriptLoaded:r,summarizeTriggered:a,hideToolBtns:l,translateLanguage:c,renderActionBtnTabs:d,onTranslateLanguage:u,onSummarizeVideo:h,trackResultEvent:p,showSearch:g=!1,searchTooltip:f,onSearch:x})=>{var y;const b=(0,v.B)(),w=(0,m.useRef)((0,Wr.Z)()),[C,A]=(0,m.useState)(!1),S=(0,m.useRef)(null),k="podcast"===(null===(y=Dd())||void 0===y?void 0:y.scene),E=(0,m.useCallback)((()=>a||(s||r)&&!s?(0,Te.jsx)(Te.Fragment,{}):(0,Te.jsx)(je.$n,{className:J()({[Cl.gradientButton]:!w.current,[Cl.onboarding]:w.current}),size:"small",theme:"solid",onClick:()=>{ci.updateShouldSummaryVideoDefault(!0),null==h||h({clickFrom:w.current?Gl.ONBOARDING:Gl.UPPER_RIGHT})},"data-testid":(k?"podcast":"video")+"-assistant-summary-btn",children:b(k?"flow_web_ext_podcast_summarize":"flow_web_ext_youtube_summarize")})),[s,r,a]);return(0,Te.jsxs)("div",{className:J()(Cl.header,{[Cl["content-visible"]]:t}),ref:S,children:[(0,Te.jsx)(ou.A,{size:"large",disable:!0}),!l&&(0,Te.jsxs)("div",{className:Cl.controls,children:[e&&(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsxs)("div",{className:Cl.actionBtn,children:[g&&(0,Te.jsx)(qd,{getPopupContainer:()=>n.current,onSizeChange:e=>{e&&(0,It.z8)(_.Ur.clickVideoAssistantSummarizeBtn,{button_name:_._h.searchButton,web_url:location.href,content_title:document.title}),A(e)},onSearch:x,tooltip:f}),!(g&&C)&&(0,Te.jsxs)(Te.Fragment,{children:[E(),i&&!o&&(0,Te.jsx)(iu,{toolTipClassname:Cl.iconBtn,scene:Yd.jv.youtube_page_summary,anchorRef:S,translateLanguage:c,onLanguageChange:u,popContainerRef:n,trackResultEvent:p}),null==d?void 0:d()]})]})}),!e&&(0,Te.jsx)(Kd,{})]})]})};var ru=n(89254),au=n.n(ru),lu=n(46913),cu=n.n(lu);const du=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",d:"M6.672 20.203q-.454 0-.704-.227a.78.78 0 0 1-.272-.553q-.016-.333.227-.65.166-.212.393-.546.227-.325.447-.68.227-.364.393-.674a7.4 7.4 0 0 1-2.073-1.476 6.7 6.7 0 0 1-1.363-2.02 5.9 5.9 0 0 1-.484-2.362q0-1.46.673-2.74a7.2 7.2 0 0 1 1.877-2.248A9.1 9.1 0 0 1 8.58 4.514 10.5 10.5 0 0 1 12 3.969q1.824 0 3.413.545 1.597.545 2.8 1.513a7.05 7.05 0 0 1 1.878 2.248q.673 1.28.673 2.74 0 1.218-.454 2.293a6.5 6.5 0 0 1-1.294 1.96 8 8 0 0 1-1.99 1.514 10.2 10.2 0 0 1-2.566.961q-1.415.333-3.02.303-.795.575-1.703 1.06a13 13 0 0 1-1.733.794q-.818.303-1.332.303m.9-1.537q.334-.136.856-.439a17 17 0 0 0 1.074-.666q.56-.363 1.015-.696.219-.174.423-.25.206-.083.447-.083l.348.015H12q1.514 0 2.823-.431a7.7 7.7 0 0 0 2.308-1.188 5.8 5.8 0 0 0 1.552-1.764q.56-1.005.56-2.15 0-1.142-.56-2.141A5.8 5.8 0 0 0 17.13 7.11a7.6 7.6 0 0 0-2.308-1.196A9 9 0 0 0 12 5.482a9 9 0 0 0-2.823.432A7.6 7.6 0 0 0 6.869 7.11a5.8 5.8 0 0 0-1.552 1.763 4.36 4.36 0 0 0-.552 2.142q0 .99.423 1.884.431.885 1.25 1.628.817.733 1.975 1.279.363.174.431.439.075.257-.09.575a8 8 0 0 1-.584.885q-.37.507-.658.863-.053.06-.03.09.022.04.09.008m.878-6.455q-.469 0-.802-.333a1.1 1.1 0 0 1-.333-.803q0-.469.333-.802t.802-.333.803.333q.34.334.34.802t-.333.803a1.1 1.1 0 0 1-.81.333m3.55 0a1.1 1.1 0 0 1-.802-.333 1.1 1.1 0 0 1-.333-.803q0-.469.333-.802A1.1 1.1 0 0 1 12 9.94q.47 0 .802.333.333.334.333.802t-.333.803q-.333.333-.802.333m3.55 0q-.469 0-.803-.333a1.1 1.1 0 0 1-.333-.803q0-.469.333-.802t.803-.333q.476 0 .81.333.332.334.332.802t-.333.803a1.1 1.1 0 0 1-.81.333"})})),uu=(0,js.a)((0,Te.jsx)(du,{}));var hu=n(86012);const mu=({videoSummaryId:e,highlightResult:t})=>{const[n,i]=(0,m.useState)(!1),o=(0,Co.l)((e=>e.setIsShowSidebar)),s=(0,An.P)((e=>e.messages)),{text:r="",body:l}=s[e]||{},c=function(){var e=(0,a.A)((function*(){var e,t,o,s;if(n)return;i(!0);const r={messageIds:[null!==(e=null==l||null===(t=l.message)||void 0===t?void 0:t.reply_id)&&void 0!==e?e:"",null!==(o=null==l||null===(s=l.message)||void 0===s?void 0:s.message_id)&&void 0!==o?o:""]};yield(0,So.ci)(r)}));return function(){return e.apply(this,arguments)}}();return{handleClickContinueInChat:function(){var e=(0,a.A)((function*(){var e;if(null!==(e=(0,se.TK)("authInfo"))&&void 0!==e&&e.isAuthenticated)ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),o(!0,_.cz.videoAssistant),yield(0,ko.Z)(),yield c();else{const e=(0,xi.jB)("youtube");(0,_e.DT)({trackMeta:{previous_page:e?"youtube":"bilibili",login_entrance:e?"youtube":"bilibili"}})}}));return function(){return e.apply(this,arguments)}}(),handleCopy:()=>{const e=(e=>{let t="";const n=wi(e);return n&&0!==n.length?(n.map((e=>{var n;const i=fi(e.timestamp);t+=`\n[${i}] ${e.section}`,t+="\n",e.bullet_points&&(null===(n=e.bullet_points)||void 0===n?void 0:n.length)>0&&e.bullet_points.map(((n,i)=>{const o=fi(n.timestamp);t+=`\t[${o}] ${n.point}`,i!==e.bullet_points.length-1&&(t+="\n")}))})),t):""})(t);return Gt()(`${r}${e}`)}}},pu=["onCopyClick","onMouseEnter","onMouseLeave","className","isButtonWithText","containerClassName"],gu=(0,m.forwardRef)(((e,t)=>{let{onCopyClick:n,onMouseEnter:i,onMouseLeave:o,className:s,isButtonWithText:a,containerClassName:l}=e,c=(0,jt.A)(e,pu);const d=(0,v.B)(),{onCopyClick:u,onMouseEnter:h,onMouseLeave:m,checked:p}=vu(n);if(!n)return null;const g=p?Pe.w_:Pe.jw,f=d(p?"flow_web_ext_action_popup_copy":"message_long_press_copy"),_=()=>(0,Te.jsxs)("div",{className:l,onClick:u,children:[(0,Te.jsx)(g,(0,r.A)((0,r.A)({},c),{},{ref:t,className:s})),(0,Te.jsx)("div",{children:f})]});return a?(0,Te.jsx)(_,{}):(0,Te.jsx)(g,(0,r.A)((0,r.A)({},c),{},{ref:t,className:s,onClick:u,onMouseEnter:()=>{null==i||i(),null==h||h()},onMouseLeave:()=>{null==o||o(),null==m||m()}}))})),vu=e=>{const[t,n]=(0,m.useState)(!1),[i,o]=(0,m.useState)(!1),s=(0,m.useRef)(-1);return(0,m.useEffect)((()=>{t&&(s.current=Number(setTimeout((()=>{n(!1)}),3e3)))}),[t]),{onCopyClick:()=>{e(),n(!0)},onMouseLeave:()=>{o(!0)},onMouseEnter:()=>{o(!1),i&&(n(!1),clearTimeout(s.current))},checked:t}};var fu=n(62098);const _u=({popContainerRef:e,summaryResult:t,transcript:n,videoSummaryId:i,onCopy:o=h.A,onClickContinueInChat:s=h.A,onClickAudio:a=h.A,enableDownload:l=!1,shareSlot:c,collectionData:d,highlightResult:u,disableCollection:p=!1})=>{var g,f,_;const x=(0,v.B)(),[y,b]=(0,m.useState)(!1),w=(null===(g=Dd())||void 0===g?void 0:g.meta.title)||"",C=(null===(f=Dd())||void 0===f?void 0:f.meta.duration)||0,{handleClickContinueInChat:A,handleCopy:S}=mu({videoSummaryId:i,highlightResult:u}),k="podcast"===(null===(_=Dd())||void 0===_?void 0:_.scene);(0,m.useEffect)((()=>{(0,Ke.s)("show_button",{button_type:"copy",current_page:(0,It.M5)(location.href)})}),[]);const{collectionIcon:E,onCollectionClick:T,collected:I,collectionId:j}=Bs(d?(0,r.A)((0,r.A)({},d),{},{iconSize:18}):void 0),N=!p&&d&&(0,ot.ku)();return(0,m.useEffect)((()=>{N&&(0,zt.ae)(zt.vP.video_page_summarize,zt.p6.videosummary)}),[]),(0,Te.jsx)("div",{className:Cl.footer,children:(0,Te.jsxs)("div",{className:Cl.actionFooterBtn,children:[(0,Te.jsx)(je.$n,{className:Cl.chatButton,size:"small",icon:(0,Te.jsx)(uu,{"data-testid":"media-continue-in-chat",style:{fontSize:16}}),onClick:()=>{s(),A()},children:x("flow_web_ext_action_translate_chat")}),(0,Te.jsxs)("div",{className:Cl.rightOperationButtons,children:[(0,Te.jsx)(fu.T,{text:t,className:Cl.buttonItem,getPopupContainer:()=>e.current,style:{fontSize:18},onClick:a}),l&&(0,Te.jsx)(je.m_,{content:x(y?"flow_web_ext_podcast_downloaded_hover":"flow_web_ext_podcast_download_hover"),getPopupContainer:()=>e.current,children:(0,Te.jsx)("div",{className:Cl.buttonItem,children:(0,Te.jsx)("div",{children:y?(0,Te.jsx)(hu.A,{className:Cl.commonIcon}):(0,Te.jsx)(Nc.A,{className:Cl.commonIcon,onClick:()=>{if(oc({click_from:Gl.UPPER_RIGHT,button_name:nc.download,content_title:w,content_duration:C}),y)return;const e=new(au()),i=(e=>{var t;if(!e||e.length<=0)return;const n=(null===(t=e[e.length-1])||void 0===t?void 0:t.offset)/1e3>3600||!1;return"Time,Transcript\n"+e.map((e=>{if(!(0,pi.A)(null==e?void 0:e.offset)&&Ci(null==e?void 0:e.offset)&&e.text)return`${fi(e.offset/1e3,n)},${e.text}`})).join("\n")})(n);i&&e.file("timeline.csv",i),e.file("summary.txt",t),e.generateAsync({type:"blob"}).then((e=>{var t;null===(t=cu().saveAs)||void 0===t||t.call(cu(),e,"doubao-summary-transcript.zip"),b(!0)}))},"data-testid":"podcast-assistant-download-btn"})})})}),(0,Te.jsx)(je.m_,{content:x("message_long_press_copy"),getPopupContainer:()=>e.current,children:(0,Te.jsx)("div",{className:Cl.buttonItem,children:(0,Te.jsx)(gu,{style:{fontSize:18},onCopyClick:()=>{o(),S()},"data-testid":(k?"podcast":"video")+"-assistant-copy-button"})})}),N&&(0,Te.jsx)(je.m_,{content:(0,Te.jsx)(Hs,{collected:I,savedId:j,collectType:zt.p6.videosummary,clickFrom:zt.vP.video_page_summarize}),getPopupContainer:()=>e.current,children:(0,Te.jsx)("div",{className:Cl.buttonItem,children:(0,Te.jsx)("div",{className:Cl.commonIcon,onClick:()=>{T(),oc({click_from:Gl.UPPER_RIGHT,button_name:nc.addFav,content_title:w,content_duration:C})},"data-testid":(k?"podcast":"video")+"-summary-assistant-collect-button",children:E})})}),c]})]})})},xu="video-list-container-YAQus8",yu="video-list-T4L7XE",bu="video-list-item-mWeA4z",wu="video-item-title-ikTskv",Cu="playing-icon-zw8Egh",Au="video-item-time-nE7CSL",Su="active-Sjphg9",ku=({model:e,onChange:t=h.A,visible:n})=>{const{type:i,data:o,currentTarget:s}=e,r=null==s?void 0:s.info,a=(0,m.useRef)(null);return(0,m.useEffect)((()=>{if(null!=o&&o.length&&a.current&&n){const e=a.current,t=e.querySelector(`div[data-id='${null==r?void 0:r.cid}']`);if(t&&t.offsetTop>0&&e.offsetHeight){const n=Math.max(0,t.offsetTop-e.offsetHeight/2+t.offsetHeight/2);e.scrollTo({top:n,behavior:"instant"})}}}),[o,n]),(0,Te.jsx)("div",{className:xu,ref:a,children:(0,Te.jsx)("div",{className:yu,children:null==o?void 0:o.map((e=>(0,Te.jsxs)("div",{"data-id":e.cid,onClick:()=>(e=>{if(e.cid!==(null==r?void 0:r.cid)){t(e);let s=!1;if("page"===i){const t=`?p=${e.page}`;try{var n;const e=[...document.body.querySelectorAll("#multi_page li a")||[]].find((e=>{var n;return null===(n=e.href)||void 0===n?void 0:n.includes(t)})),i=(null==e?void 0:e.querySelector(".clickitem"))||(null==e||null===(n=e.children)||void 0===n?void 0:n[0]);"function"==typeof(null==i?void 0:i.click)&&(i.click(),s=!0)}catch(o){(0,ar.z3)("trigger video switch error",o)}finally{s||(window.location.href=`${location.pathname}${t}`)}}else try{const t=[...document.body.querySelectorAll(".video-sections-content-list .video-episode-card")||[]].find((t=>t.querySelector(`div[title='${e.part}']`)||t.querySelector(`p[title='${e.part}']`)));t&&"function"==typeof t.click&&(t.click(),s=!0)}catch(o){(0,ar.z3)("trigger video switch error",o)}finally{s||(window.location.href=`${location.origin}/video/${e.bvid}`)}}})(e),className:J()(bu,{[Su]:(null==r?void 0:r.cid)===e.cid}),children:[(null==r?void 0:r.cid)===e.cid?(0,Te.jsx)(Oo.d,{size:16,className:Cu}):null,(0,Te.jsx)("div",{className:wu,title:e.part,children:e.part}),(0,Te.jsx)("span",{className:Au,children:fi(e.duration)})]})))})})},Eu={type:"page",data:[]};var Tu=n(39625),Iu=n(67191);const ju=({breakdownIndex:e,tags:t})=>{var n,i;const o=(0,v.B)(),s="podcast"===(null===(n=Dd())||void 0===n?void 0:n.scene),r=(null===(i=Dd())||void 0===i?void 0:i.meta.title)||"",l=function(){var t=(0,a.A)((function*(t){var n;if(null===(n=(0,se.TK)("authInfo"))||void 0===n||!n.isAuthenticated)return void(0,_e.DT)({trackMeta:{previous_page:"video_assistant_card",login_entrance:"highlight_tag_click"}});(({highlight_module_position:e,content_title:t,suggested_type:n})=>{(0,It.z8)(_.Ur.clickSearchAssistantSuggest,{suggested_type:n,highlight_module_position:e,content_title:t})})({highlight_module_position:e,content_title:r,suggested_type:s?_.Ld.podcast_summary_card:_.Ld.video_summary_card}),ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),Co.l.getState().setIsShowSidebar(!0,s?_.cz.podcastAssistant:_.cz.videoAssistant),yield(0,ko.Z)();const{convId:i,convType:o,mainBotId:a}=(0,Jt.IK)(),l={text:t,reportParams:{scene:s?_.Z5.podcastAssistant:_.Z5.videoAssistant,sec_scene:s?bo._o.podcast_highlight_tag_click:bo._o.video_highlight_tag_click},extraExt:{need_create_thread:o===Zt.H.NewThread?"1":"0",browser_language:(0,kn.wz)((0,se.TK)("uiLanguage"))},ctx:(0,So.Pe)(o,i,a)};yield(0,So.Bc)(o,[l])}));return function(e){return t.apply(this,arguments)}}();return(0,m.useEffect)((()=>{(({prompt_cnt:e,highlight_module_position:t,content_title:n,suggested_type:i})=>{(0,It.z8)(_.Ur.showSearchAssistantSuggest,{suggested_type:i,prompt_cnt:e,highlight_module_position:t,content_title:n})})({prompt_cnt:t.length,highlight_module_position:e,content_title:r,suggested_type:s?_.Ld.podcast_summary_card:_.Ld.video_summary_card}),(0,hi.A)(t,(t=>{(({highlight_module_position:e,content_title:t,suggested_type:n})=>{(0,It.z8)(_.Ur.showSearchAssistantSuggestQuestion,{suggested_type:n,highlight_module_position:e,content_title:t})})({highlight_module_position:e,content_title:r,suggested_type:s?_.Ld.podcast_summary_card:_.Ld.video_summary_card})}))}),[]),(0,gi.A)(t)?(0,Te.jsx)("div",{className:_c.keywordTagsContainer,children:(0,Te.jsx)("div",{className:_c.loadingTips,children:o("flow_web_ext_video_keywords_loading","\u65f6\u95f4\u7ebf\u5df2\u603b\u7ed3\u5b8c\u6210\uff0c\u5173\u952e\u8bcd\u751f\u6210\u4e2d...")})}):(0,Te.jsx)("div",{className:_c.keywordTagsContainer,children:(0,hi.A)(t,(e=>(0,Te.jsxs)("div",{className:_c.tagContainer,onClick:()=>l(e),children:[(0,Te.jsx)("div",{children:e}),(0,Te.jsx)(Iu.A,{className:_c.arrowIcon})]})))})};var Nu=n(9064);const Ru=({timestamp:e,section:t,bulletPoints:n,tags:i,trackResultEvent:o=h.A,trackHighlightEvent:s,isCurrentActiveBreakdown:r,progress:a=0,currentActiveBulletPointIndex:l,isLastTimestampOverHour:c,onChangeVideoState:d,breakdownIndex:u,calcProgress:p,highlightContainerRef:g,videoElement:v,isImmersionMode:f=!1,handleUserInteract:x,userInteracting:y,activeScroll:b,onClickHighlight:w,summarizeLanguage:C})=>{var A;const S="podcast"===(null===(A=Dd())||void 0===A?void 0:A.scene),k=(0,m.useRef)(null),[E,T]=(0,m.useState)(!0),{value:I}=(0,Kr.Tu)(Kr.FM.enableHighlightTag,!1),j=!f&&I&&E&&i&&(null==i?void 0:i.length)>0&&"zh"===(0,kn.wz)(C||"");(0,m.useEffect)((()=>{s(_.Ur.showVideoAssistantHighlightsTimeline,Number(e),u,f)}),[]),(0,m.useEffect)((()=>{r&&T(!0)}),[r]);const N=(0,m.useCallback)((0,Is.A)((()=>{const e=g.current,t=k.current;if(e&&t){var n,i,o,s,r,a,l;const c=null==e?void 0:e.getBoundingClientRect(),d=null==t?void 0:t.getBoundingClientRect(),u=(null!==(n=null==e?void 0:e.scrollTop)&&void 0!==n?n:0)+(null!==(i=null==d?void 0:d.top)&&void 0!==i?i:0)-(null!==(o=null==c?void 0:c.top)&&void 0!==o?o:0),h=(null!==(s=null==t?void 0:t.offsetTop)&&void 0!==s?s:0)-40,m=(null!==(r=null==t?void 0:t.offsetHeight)&&void 0!==r?r:0)+(null!==(a=null==t?void 0:t.offsetTop)&&void 0!==a?a:0)-(null!==(l=null==e?void 0:e.offsetHeight)&&void 0!==l?l:0)+40;if(d.top>=c.top&&d.bottom<=c.bottom)return;if(f)(null==d?void 0:d.top)<(null==c?void 0:c.top)?null==e||e.scrollTo({top:h,behavior:"smooth"}):(null==c?void 0:c.bottom)<(null==d?void 0:d.bottom)&&(null==e||e.scrollTo({top:m,behavior:"smooth"}));else{const n=t.clientHeight>400?0:40;null==e||e.scrollTo({top:u-n,behavior:"smooth"})}}}),f?600:100),[g,f]);(0,m.useEffect)((()=>{b&&r&&!y&&N()}),[y,r,b]);const R=(e,t,n)=>{n&&(d({currentActiveBulletPointIndex:e.bulletPointIdx,currentActiveBreakdownIndex:e.breakdownIdx,progress:e.progress}),n.currentTime=t,n.play(),o(_._h.highlightSelectionBar),s(_.Ur.clickVideoAssistantHighlightsTimeline,t,e.breakdownIdx,f),T(!0),N())};return(0,Te.jsxs)("div",{className:J()(_c.breakdownContainer,Nu.rA,{[_c.breakdownExpand]:E,[_c.activeBreakdownContainer]:r}),ref:k,children:[(0,Te.jsxs)("div",{style:{zIndex:1},"data-testid":`${S?"podcast":"video"}-assistant-highlight-item-${u}`,className:J()(_c.breakdownTitle,{[_c.breakdownIsPlaying]:r}),onClick:t=>{null==w||w(R.bind(null,{bulletPointIdx:0,breakdownIdx:u,progress:0},Number(e))),R({bulletPointIdx:0,breakdownIdx:u,progress:0},Number(e),v),t.stopPropagation()},children:[(0,Te.jsx)(je.vw,{className:J()(_c.breakdownTag,{[_c.activeTag]:r}),children:fi(e,c)}),(0,Te.jsxs)("div",{className:_c.breakdownContentContainer,children:[(0,Te.jsxs)("div",{className:_c.breakdownSectionContainer,children:[(0,Te.jsx)("div",{className:_c.breakdownContent,"data-testid":`${S?"podcast":"video"}-assistant-breakdown-content-${u}`,children:t}),(r||E)&&(0,Te.jsx)("div",{className:_c.progressBarContainer,children:(0,Te.jsx)("div",{style:{width:r?100*a+"%":0},className:_c.progressBar})})]}),n&&(null==n?void 0:n.length)>0&&(0,Te.jsx)("div",{className:J()(_c.expandIconContainer,{[_c.isExpanding]:E}),onClick:e=>{T(!E),x(),o(E?_._h.fold:_._h.expand),e.stopPropagation()},"data-testid":`${S?"podcast":"video"}-assistant-dropdownArrow-${u}`,children:(0,Te.jsx)("div",{className:_c.expandIconBg,children:(0,Te.jsx)(Pe.Pl,{})})})]})]}),(0,Te.jsx)("div",{children:E&&n&&(null==n?void 0:n.length)>0&&(0,Te.jsx)(Te.Fragment,{children:n.map(((e,t)=>{if(!Ci(null==e?void 0:e.timestamp)||!e.point)return null;const n=fi(e.timestamp,c);return(0,Te.jsx)(yc,{content:e.point,tag:n,active:l===t&&r,onClick:n=>{var i;const o=p(u,null!==(i=Number(e.timestamp))&&void 0!==i?i:0);null==w||w(R.bind(null,{bulletPointIdx:t,breakdownIdx:u,progress:o},Number(e.timestamp))),R({bulletPointIdx:t,breakdownIdx:u,progress:o},Number(e.timestamp),v),n.stopPropagation()},"data-testid":`${S?"podcast":"video"}-assistant-bullet-points-${u}-${t}`})}))})}),j&&(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(je.cG,{className:_c.divider}),(0,Te.jsx)(ju,{tags:i,breakdownIndex:u})]})]})};const Mu=({text:e,mediaElement:t,trackResultEvent:n,trackHighlightEvent:i,videoDuration:o=0,videoState:s,setVideoState:a,isImmersionMode:l,handleUserInteract:c,userInteracting:d,activeScroll:u,onClickHighlight:h,title:p,summarizeLanguage:g})=>{var v;const f=(0,m.useRef)(null),_="podcast"===(null===(v=Dd())||void 0===v?void 0:v.scene),x=(0,m.useMemo)((()=>t||((0,xi.jB)("youtube")?document.querySelector(".video-stream"):document.querySelector("video"))),[t]),y=wi(e),b=(e,t)=>{var n,i,s,r,a;return e===y.length-1?(t-(null===(r=y[e])||void 0===r?void 0:r.timestamp))/(o-(null===(a=y[e])||void 0===a?void 0:a.timestamp)):(t-(null===(n=y[e])||void 0===n?void 0:n.timestamp))/((null===(i=y[e+1])||void 0===i?void 0:i.timestamp)-(null===(s=y[e])||void 0===s?void 0:s.timestamp))};(0,m.useEffect)((()=>{const e=(0,ie.A)(f,"current"),t=()=>{c()};if(e)return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}}),[]),(0,m.useEffect)((()=>{y&&y.length>0&&x&&(x.ontimeupdate=(0,T.A)((()=>{x.currentTime<Number(y[0].timestamp)&&a((()=>({currentActiveBreakdownIndex:-1,currentActiveBulletPointIndex:-1,progress:0}))),y.map(((e,t)=>{var n;if(x.currentTime>=Number(null==e?void 0:e.timestamp)&&(x.currentTime<Number(null===(n=y[t+1])||void 0===n?void 0:n.timestamp)||t===y.length-1)){a((e=>(0,r.A)((0,r.A)({},e),{},{currentActiveBreakdownIndex:t,currentActiveBulletPointIndex:0,progress:b(t,x.currentTime)})));const n=null==e?void 0:e.bullet_points;null==n||n.map(((e,t)=>{var i;x.currentTime>=Number(null==e?void 0:e.timestamp)&&(x.currentTime<Number(null==n||null===(i=n[t+1])||void 0===i?void 0:i.timestamp)||t===(null==n?void 0:n.length)-1)&&a((e=>(0,r.A)((0,r.A)({},e),{},{currentActiveBulletPointIndex:t})))}))}}))}),300))}),[x]);const w=(0,Tu.wR)(y.length,{from:{opacity:0,maxHeight:0},to:{opacity:1,maxHeight:1e3},config:{duration:200}});if(function(e){(0,m.useEffect)((()=>{if(!e)return;let t=!0;const n=(0,Is.A)((()=>{t=!1}),300),i=i=>{const{deltaY:o}=i,s=e.scrollHeight-e.scrollTop<=e.clientHeight,r=0===e.scrollTop;s&&o>=0||r&&o<=0?t&&(i.preventDefault(),n()):(t=!0,e.scrollBy({behavior:"instant",top:o}),i.preventDefault()),i.stopPropagation()},o={passive:!1,capture:!0};return e.addEventListener("wheel",i,o),()=>{e.removeEventListener("wheel",i,o)}}),[e])}(f.current),y&&y.length>0){const e=(e,t)=>(0,Te.jsx)(Ru,{timestamp:e.timestamp,section:e.section,bulletPoints:e.bullet_points,tags:null==e?void 0:e.tags,trackResultEvent:n,trackHighlightEvent:i,isCurrentActiveBreakdown:t===s.currentActiveBreakdownIndex,currentActiveBulletPointIndex:s.currentActiveBulletPointIndex,progress:Number(s.progress),breakdownIndex:t,isLastTimestampOverHour:Ai(y)>=3600,onChangeVideoState:({currentActiveBreakdownIndex:e,currentActiveBulletPointIndex:t,progress:n})=>a((i=>(0,r.A)((0,r.A)({},i),{},{currentActiveBreakdownIndex:null!=e?e:i.currentActiveBreakdownIndex,currentActiveBulletPointIndex:null!=t?t:i.currentActiveBulletPointIndex,progress:null!=n?n:i.progress}))),calcProgress:b,highlightContainerRef:f,videoElement:x,isImmersionMode:l,handleUserInteract:c,userInteracting:d,activeScroll:u,onClickHighlight:h,summarizeLanguage:g},t);return(0,Te.jsxs)("div",{id:"cici-assistant-highlights",className:_c["highlight-list-wrapper"],"data-testid":_?"podcast-assistant-highlights":l?"video-assistant-immersionHighlights":"video-assistant-highlights",children:[p,(0,Te.jsx)("div",{className:J()(_c["content-breakdown-wrapper"]),ref:f,children:l?w.map(((t,n)=>(0,Te.jsx)(Tu.CS.div,{style:(0,r.A)((0,r.A)({},t),{},{overflow:"hidden",marginBottom:"10px"}),children:e(y[n],n)},n))):y.map(((t,n)=>Ci(null==t?void 0:t.timestamp)&&t.section?e(t,n):null))})]})}return(0,Te.jsx)(Te.Fragment,{})};var Pu=n(16380),Lu=n.n(Pu),Bu=n(16462);const Du=Lu().bind({"cici-ext-container":"cici-ext-container-cHKkaZ",ciciExtContainer:"cici-ext-container-cHKkaZ","inactivelink-hover-animation":"inactivelink-hover-animation-cI1oFG",inactivelinkHoverAnimation:"inactivelink-hover-animation-cI1oFG","notactivelink-hover-animation":"notactivelink-hover-animation-OwGmzQ",notactivelinkHoverAnimation:"notactivelink-hover-animation-OwGmzQ","light-click-animation":"light-click-animation-uLAyJ8",lightClickAnimation:"light-click-animation-uLAyJ8","click-animation":"click-animation-TXvTAL",clickAnimation:"click-animation-TXvTAL","semi-animation-rotate":"semi-animation-rotate-GHrtgv",semiAnimationRotate:"semi-animation-rotate-GHrtgv","inactive-btn-hover-animation":"inactive-btn-hover-animation-D_DftX",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-D_DftX","cici-ext-always-dark":"cici-ext-always-dark-z_3gqK",ciciExtAlwaysDark:"cici-ext-always-dark-z_3gqK","cici-ext-always-light":"cici-ext-always-light-HTNkT5",ciciExtAlwaysLight:"cici-ext-always-light-HTNkT5",ellipsis:"ellipsis-tW3jMv",wrapper:"wrapper-dd4lUG","has-more":"has-more-_fO3cj",hasMore:"has-more-_fO3cj",inner:"inner-Ve1jl9","enable-scroll":"enable-scroll-t0C3zh",enableScroll:"enable-scroll-t0C3zh","activelink-hover-animation":"activelink-hover-animation-Ufh8M6",activelinkHoverAnimation:"activelink-hover-animation-Ufh8M6"}),Ou=(0,m.forwardRef)(((e,t)=>{const{className:n,styles:i,children:o,enableScroll:s=!0,containerClassName:r,showShadow:a=!0}=e,[l,c]=(0,m.useState)(!1),d=(0,m.useCallback)((0,T.A)((e=>{const{scrollHeight:t,clientHeight:n,scrollTop:i}=e;c(t-n-i>=2)}),200,{leading:!0}),[]);return(0,m.useEffect)((()=>{const e=(0,ie.A)(t,"current"),n=()=>{d(e)};if(e){e.addEventListener("scroll",n);const t=new MutationObserver((()=>d(e)));return t.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeFilter:["class","style"]}),()=>{e.removeEventListener("scroll",n),t.disconnect()}}}),[]),(0,Te.jsx)("div",{className:Du("wrapper",r,{"has-more":l&&a}),children:(0,Te.jsx)("div",{className:Du(n,"inner",{"enable-scroll":s}),ref:t,style:i,children:o})})})),Fu=Ou,Uu=e=>{const{isDone:t,autoScrollToEnd:n,children:i,message:o,style:s,className:a,containerClassName:l,showShadow:c}=e,[d,u]=(0,m.useState)(!1),h=(0,m.useRef)(null);return(0,m.useEffect)((()=>{if(h.current){let e=0;const t=()=>{var n;const i=null===(n=h.current)||void 0===n?void 0:n.scrollTop;var o;i<e&&(u(!0),null===(o=h.current)||void 0===o||o.removeEventListener("scroll",t));e=i};return h.current.addEventListener("scroll",t),()=>{var e;null===(e=h.current)||void 0===e||e.removeEventListener("scroll",t)}}}),[]),(0,m.useLayoutEffect)((()=>{const e=h.current;e&&n&&!d&&e.scrollTo({top:e.scrollHeight})}),[o]),(0,m.useLayoutEffect)((()=>{const e=h.current;e&&t&&n&&!d&&setTimeout((()=>e.scrollTo({top:e.scrollHeight})),300)}),[t]),(0,Te.jsx)(Fu,{className:a,containerClassName:l,styles:(0,r.A)({},s),enableScroll:!0,ref:h,showShadow:c,children:i})};var Hu=n(85335);const zu="msg_container-YT508_",qu="failureMsg-CQv3Nt",Vu="go_to_solutions-YvpGKB",$u=e=>{const t=(0,v.B)();return(0,Te.jsxs)("div",{className:zu,children:[(0,Te.jsxs)("div",{className:qu,children:[(0,Te.jsx)(Pe.o0,{}),"fail"===e.type&&(0,Te.jsx)("span",{children:(0,Te.jsxs)(Hu.x,{i18nKey:"flow_web_ext_search_fail_x",children:["Generate failed",(0,Te.jsx)("a",{href:"#",onClick:t=>{var n;t.preventDefault(),null===(n=e.onRetry)||void 0===n||n.call(e)},children:"retry"})]})}),"overload"===e.type&&(0,Te.jsxs)("span",{children:[" ",t("flow_web_ext_search_overload")]})]}),(0,Te.jsx)("div",{className:Vu,onClick:()=>{window.open("https://bytedance.larkoffice.com/wiki/F8KGwFLjeiKfTIk76LYc9Ezdnrb")},children:(0,Te.jsx)("span",{children:t("flow_web_ext_check_solution")})})]})};var Wu=n(59879);const Ku={"stream-container":"stream-container-gzUKQC",streamContainer:"stream-container-gzUKQC",message:"message-AguzyJ",placeholder:"placeholder-lfssXU"},Yu=Lu().bind(Ku),Gu=(0,l.jc)(),Qu=({className:e,style:t,id:n,type:i,enableScroll:o=!1,autoScrollToEnd:s=!0,onRetry:a,containerClassName:l,showShadow:c=!0,textFormatter:d,loadingStyle:u="skeleton",MDBoxProps:h={},smooth:p=!0,loadingSlot:g})=>{const v=(0,An.P)((e=>e.messages[n])),{isDone:f,isError:_,isAborted:x,text:y="",jsonData:b}=v||{},w=!(y||_||f||x),C=!_&&Boolean(y);(0,m.useEffect)((()=>{if(_||x){const e="search"===i?"search_card_show":"highlight_function_click";(0,Ke.s)("generation_failure",{err_code:null==b?void 0:b.code,err_tips:null==b?void 0:b.msg,scene:e})}}),[_,x]);const A=w?"loading":_||x?"failed":f?"done":"init",S=()=>(0,Te.jsxs)(Te.Fragment,{children:[C&&(0,Te.jsx)(Bu.Bk,(0,r.A)((0,r.A)({markDown:d?d(v):y,showIndicator:!f,smooth:{enable:!!p&&!f},autoFitRTL:!0},h),{},{style:Gu?{fontSize:16}:{}}),n),(_||x)&&(0,Te.jsx)($u,{type:"fail",onRetry:a})]}),k=void 0!==g?g:(e=>"dot-flashing"===e?(0,Te.jsx)(Wu.c,{}):(0,Te.jsx)(je.EA,{loading:!0,active:!0,placeholder:(0,Te.jsx)("div",{className:Ku.placeholder,children:(0,Te.jsx)(je.EA.Paragraph,{rows:3})})}))(u);return(0,Te.jsx)("div",{"data-testid":`stream-message-${A}`,children:w?k:o?(0,Te.jsx)(Uu,{isDone:f,autoScrollToEnd:s,className:e,containerClassName:l,style:t,showShadow:c,message:v,children:S()}):(0,Te.jsx)("div",{className:Yu(Ku["stream-container"],e),style:t,children:S()})})},Zu=({available:e,hasNoSubtitles:t,noContent:n,contentVisible:i,videoSummaryId:o,mediaElement:s,onRetry:a,paymentContent:l,isHighlightsDone:c,transcript:d,highlightsResult:u,trackResultEvent:h,trackHighlightEvent:p,videoState:g,setVideoState:f,handleUserInteract:_,onClickHighlight:x,userInteracting:y,isNotLoginBilibili:b,isContentOnRisk:w,videoListInfo:C,summarizeLanguage:A,isSummaryDone:S})=>{var k;const E=(0,v.B)(),T="podcast"===(null===(k=Dd())||void 0===k?void 0:k.scene),{videoListModel:I,handleChangeTargetVideo:j,showVideoList:N}=((e,t)=>{var n,i;const[o,s]=(0,m.useState)(Eu),a=(null===(n=(0,As.A)("video_assistant"))||void 0===n?void 0:n.video_list)&&t&&(0,xi.jB)("bilibili");return(0,m.useEffect)((()=>{if(a&&null!=e&&e.data){const{pages:n=[],ugc_season:i}=e.data,{videoId:o}=bi(),a=new URL(location.href).searchParams.get("p")||1;if(n.length>1)s({type:"page",data:n,currentTarget:{index:a,info:null==n?void 0:n.find((e=>`${e.page}`==`${a}`))}});else{var t;let e=[];null==i||null===(t=i.sections)||void 0===t||t.forEach((t=>{var n;e=e.concat(null===(n=t.episodes)||void 0===n?void 0:n.map((e=>(0,r.A)((0,r.A)({},e.page),{},{part:e.title,bvid:e.bvid}))))})),s({type:"season",data:e,currentTarget:{index:e.findIndex((e=>e.bvid===o))+1,info:e.find((e=>e.bvid===o))}})}}}),[a,e]),{videoListModel:a?o:Eu,showVideoList:a&&(null==o||null===(i=o.data)||void 0===i?void 0:i.length)>1,handleChangeTargetVideo:e=>{s((t=>{var n;return(0,r.A)((0,r.A)({},t),{},{currentTarget:{index:(null===(n=t.data)||void 0===n?void 0:n.findIndex((t=>t.cid===e.cid)))+1,info:e}})}))}}})(C,!T&&e),[R,M]=(0,m.useState)("highlight"),P=e=>(0,Te.jsxs)("div",{className:Cl.highlightPlaceholder,children:[e?(0,Te.jsx)("div",{className:Cl.highlightPlaceholderTitle,children:E("flow_web_ext_youtube_highlights")}):null,(0,Te.jsx)(je.EA.Paragraph,{rows:3,className:Cl.highlightLoadingContainer})]});if(b)return(0,Te.jsx)("div",{className:Cl.content,children:(0,Te.jsx)("div",{className:Cl.summary,style:{marginTop:"14px"},children:E("flow_web_ext_youtube_nologin",{brand:(0,fs.L2)()})})});if(l)return(0,Te.jsx)(fc,{text:E("flow_web_ext_video_summary_fail_paid",{brandName:(0,fs.L2)()}),imgSrc:bc});if(t)return(0,Te.jsx)(fc,{text:E("flow_web_ext_youtube_nosubtitles",{brand:(0,fs.L2)()}),imgSrc:bc});if(w)return(0,Te.jsx)(fc,{text:E("flow_web_ext_video_summary_fail","\u62b1\u6b49\uff0c\u6211\u65e0\u6cd5\u56de\u7b54\u4f60\u7684\u95ee\u9898"),imgSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVwAAAEgCAYAAAD49suWAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAA38SURBVHgB7d1dkh3FmQbgr2VDEMPFtM2ML2YmgmIFqFfAYQVIK6C1AsQK1FoBYgVqVoC0Ah1W0OLWMQQ198YjX+AgIJAmUyd7aBRCqPtUZWVVPU9Euo4tB+j8vSfry78IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABacxALdnZ21qVLbocvNFi7/oXr46OjoyfBqBYRuClYc4hev3bt2kdPnz7t8uPYBS3w+nLg9qV9FbsQ3gaDmW3glt7rx6ltSgOGl0N4m9rD1B7oBe9ndoGbgnaTLndCyMIUTlO7m4K3Dy5tNoGbgvY4XT4LNVhowTa1W4L3cpoP3NKjzUF7PYDWnIYe72trOnBT2OagvR1Ay/rYhe5p8EpNBm4ZELsf6rQwJycpdO8Gv6m5wC1h+yhM64I5Ok2heyt4qaYCV9jCIgjd39BM4JbFC2chbGEJ7qXQ/TT4lWvRji9D2MJS3E6dKAPeL2gicNMbYyEDLM+d9N02nfOCyQO31G1PAliaXCb8LPh/LfRwvSGwXBulhV9MOmhWVpE9CmDJ8oY379n4Zvoe7p0Ali6XFvRyY8LALbXbTQBr8HEQf4yJHBwc3Hn27FlU8Dh2myn3F5o9PVmzLna9znz9IOps2N/lEuLaNzSfLHBT2G5iPDlQP4/d5GvhCr/WX3h8L/9HGU85jnF7ojdit63jak0yaDbiYFkO17xr0b0ALu3CNM0xgvdJ+m7+KVZsqhrujRheLh0cCVu4uryvbWrH6WHeC2Hou8PD0tlarakC94MYVg7bD22CDMMoe9t+GMOH7iZWrHrgnp+wG8PpU7upVgvDSt+p3JG5GcMaurM1K1P0cIdeW61nCyMpswo+j+Gsem+FuQfuqbCF0Z3EcKWFwzIwt0pTBG4Xw3GcB4yslOv0cgcwReC+H8PY6t1CNUPO/jmMlZoicId6sb8IoIrSy93GMLpYqTmXFLYB1PQwhvFurNRce7hPlBOgusfBXlo60+wyvPFQ31Dfuy5WqmrgDjgdpA+gqlLHtcBoD3Pt4f4jgCkI3D3MNXC96cDszDVwAWZH4AJUInABKhG4AJUIXIBKBC5AJQIXoBKBC1CJwAWoROACVCJwASoRuACVCFyASgQuQCUCF6ASgQtQicAFqETgAlQicAEqEbgAlQhcgEoELkAlAhegEoELUInABahE4AJUInABKhG4AJUIXIBKBC5AJQIXoBKBC1CJwAWoROACVCJwASoRuACVCFyASgQuQCUCF6ASgQtQicAFqETgAlQicAEqEbgAlQhcgEoELkAlAhegEoELUInABahE4AJUInABKhG4AJUIXIBKBC5AJQIXoBKBC1CJwAWoROACVCJwASoRuACVCFyASgQuQCUCF6ASgQtQicAFqOSPAfD6HqfWl8eHLzR+h8AFXtvR0dHN3/qzs7OzLl1yy+F7PbV3y3+/HgL5OYELDCKFcR+/9H4fXPyzFMY5dHP7KLUnsVICFxhdCuNcisjtNFbMoBlAJQIXoBKBC1CJwAWoROACVCJwASoRuACVCFyASgQuQCUCF6ASgQtQib0UgF8pu36db7nYveL/2p9fy8Y1/A6BCyuVgjUH6iZ2u3i9H79so3jprRTTPytfzvfK/bo8fiyIf03gwkqcB+y1a9c+ePr06Y14de/1Ks63YLxx4d/Zp8s2tYf5mgJ4tVszZgIXFqyE7HHs9qHd5P8thW1U1JV//3H5+2zT5YvYhW8fKyNwYYFSsG3S5ZPYhWxLpy1sSst/x9N0+SIF7zZWQuDCgqQQO06Xj6OEWuOOcytlh7speE9j4UwLgwXIQZvat+nh/ZhH2F7UpXY///3LD8ZiCVyYsVw6uBC0XcxbFwsPXoELM5QPZUztUXqYWxfL0sUueM/KnODFELgwI3nWQWp38sOYX+ngsvIUs2/L810EgQszUY4azz3ak1iXk1Jm6GLmBC7MQAqbPMUr92qvxzp1sYDermlh0LCycOGzKAsHeN7b7dL10zmuWtPDhUaVYMm92uPgouN4/vLMr8QgcKFBF+q1XfAyXWqPyus0GwIXGlOW5Qrb39fFLnRvxEwIXGhICo+8LDeHbUv7H7Qsv05flteteQIXGlFC4zS4itM5hK7AhQaUWuRpsI/TUo5plsCFiZXR9kfBEL5seSBN4MKELoStmu0wzmu6XTRI4MK0zEYYXhe70G3uR0zgwkRSIOQVZF0whlxWaG4ZsMCFCZS9EW4HY7qdXuemXmOBC5WV+uJJUMOdluq5AhfqM0hWT36d70cjBC5UVEoJXVDTppXSgsCFSpQSJnWnhVkLAhcqOTg4yKPmSgnTON9XeFICFyrIvdtnz54dB1M6nnrpr8CFOpoZuFm5SefmClwYWelVbYIWbKbs5QpcGN9ijvleiMneD4ELI9K7bdJkvVyBCyM6ODiYxUkEK/RJTEDgwkjMTGjajSnm5QpcGM9x0LLqq88ELoxHOaFtH0VlAhdGUAZluqBl12sPnglcGMeNYA42UZHAhXFUv13lSqq+TwIXBlZ2BeuCObhec7aCwIXhbYI5qVb+EbgwPOWEefkgKhG4MLzrwZxsohKBCwMq9cAumJOuVh1X4MKw9G7nqcr7JnBhWAJ3ngQuzFAXzFEXFfwxgCG9HxVc+8Mf4p0/vxNvv/12/EtqS/TDDz/E37/7Wzx58iQq6KICgbsAqeCfb4fcyg7nwdHR0VW/5aMPvrzx5pvRdV288cabsWRvvfVW/Md//lf8+1/+En3fx08//hgjejcqELgzloI2b6J8Eo7eHtqDuLouRraGsL0oP9f8nL/55pt4+vPPMRKzFPhtJWzvhbAd3B6922zU9+Pw8HBVYXsuP+dcQhlRFxUI3Bkqa/VPgqbUmMv553f+Ldbq7QXUqucauFXqLQ3L9Vo92/aM/p7kuuZajT04WDoyo5pr4P4p1s0A2Xj6gJHUDtyh5ndUmXrTsCrzZGjPP7//PtYqTxObu6qBu+dgxEXd2QQnbjbkcbBK3/9zvYGb5+TO3RQlhT6Gsdrb6vTDtU2XbbA6f//uu/jxp1HnozYpP+exF0Ck71UfI5sicId61dZ+ZtStUG9sSo0v7M8//xz/822/qtDNzzU/5yWYYuHD1zFM7/TjVFY4GbBMMSv5y52e/1HsfnjycdxdMITmP08/pQD677/+9fmc3DxNbKkzF3K9OpdQvvvbd/H06WgLHs5Ved+nCNyhnliu4d6OFc9HLT82p6XRhj4q/fjlW+xK+wysQR8VTFFSGHLA55OVD57RHgk4T1XetykCdxvDyWF7J6AdXwdzVOV9qx64ZWBhyF+T26mXK3RpRR/MUR8VTLXS7GEM60To0og+mKMqc9unCtwxnlwO3fs11kPDK2yDOaoSuAcxgTLQ9b8xjj52o/Zf1JgXCS9Kn+/82TaYOx99yor3ooJJerhlOtM2xtHFbqrYt+mD/yi12+VEBKjF0ut5qTbQOeWJD5+ntolxbUrLvY586UONjddza487pK9i/M82w3kQlUwZuNvYzVaoeevVhRVZvJ58V9TH1WzDdMU5qXZHMtl+uKWs8HlAmzZxRWVzIQsg5iHXb5cfuMW98MGkTfvuuTz01EfGsY2KJg3c0sv9NKA9+w60boM5+CIqmvyInRS6p+HDSXsO00DrJq4uD8S4e2tbX8o/1bRyplne29WHk9Zs4orK3VvV3hOXVr3s00Tgluk3Hwa05YPYT7XpRlzJvaismVN7y0jh3YB2bPbZ/tNRSE17OMVK1KaOSU8vwEkIXdpyHPsxW6FN1Xu3WVOBmwldGvNR7Oc0jE+0pvpg2bnmAjcroZvP6+oDprVvWcECn/ZM1qFrMnCzUtPNA2lGepna7diPBT7t6MtU1Ek0G7hZLmqndhy74O0DpvFJ7KH0cpXJ2nArJjTJfrhXlW7tjmNXU7sRUNeH+9b90uf327B50pRO03s4aeA23cN9Ub4VSO1mepg3C851sT6gjiF2/5r0y870dxmz6uG+TNlcfBO7Ser5aqd9xjJEL/fLcIc2hbtlMH5Ssw/cF5UR5RzCXWl516fDCw2uarvvLWn5fObSgs9iPdWO0Pk9iwtcaF0Zi7gf1PJeK+cbzqqGC0tQpiWZ7ljH3ZYOkxW4MI08t7cPxnTaQt32IoELEyhzc/P8cgsixtFHg3OfBS5MpNzqOvFkeM9/zFoqJZwTuDChUs+1Cm1YTYZtJnBhYnbIG9StmqfwXpZpYdCIs7Oz03T5OLiqJhY3vIrAhYYI3StrPmwzJQVoSNkdT3nhcj6dQ9hmerjQoNTTPYlhNsxZsjwb4dMp97e9LIELjUqhmxdHfBa8TJ/azZYHyF5G4ELDym54eYexLjiXQ/Zmq1O/XkUNFxp24aipWfXkRpT3wW52nu3v0cOFmVh5XTfXa/Mc2wcxYwIXZiSFbpcuj2JdJYZt7MK2j5kTuDBDK+nt9rGbhTDrXu1FAhdmqvR2T2J5CyVy+SDXau+VXdUWQ+DCzJXgzdPHlnBW2mnserWL3LZS4MJClClkee7u3Hq85z3a0yXUaV9F4MLCXCg15JOsu2jXYksHv0XgwoKVAys/inbKDTlY83luD/Y9cn6OBC6sQDmefRO74K3d8+1Te5hanm3weC292ZcRuLBCpd573t4v18PYXw7TPrWvYrc6brv0uuxlCFzguVL7vdhyAP9r+eOuXJ/ELwdf/iN+CdjnTbgCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKvxf88Fug+MVXOiAAAAAElFTkSuQmCC"});if(n)return(0,Te.jsx)("div",{className:Cl.content,children:(0,Te.jsx)("div",{className:Cl.summary,style:{marginTop:"14px"},children:E("flow_web_ext_youtube_error")})});const L=e=>{var t,n;return(0,Te.jsx)(je.EA,{placeholder:P(e),loading:!c,active:!0,children:(0,Te.jsx)(Mu,{videoDuration:((null==d||null===(t=d[(null==d?void 0:d.length)-1])||void 0===t?void 0:t.offset)+(null==d||null===(n=d[(null==d?void 0:d.length)-1])||void 0===n?void 0:n.duration))/1e3,mediaElement:s,text:u,trackResultEvent:h,trackHighlightEvent:p,videoState:g,setVideoState:f,handleUserInteract:_,userInteracting:y,activeScroll:!0,onClickHighlight:x,title:e?(0,Te.jsx)("div",{className:Cl["highlight-title"],children:E("flow_web_ext_youtube_highlights")}):null,summarizeLanguage:A})})},B=()=>{const{data:e,currentTarget:t}=I;return(0,Te.jsxs)("div",{children:[E("flow_web_ext_video_summary_playlist"),(0,Te.jsx)("span",{style:{display:"video-list"===R?"inline-block":"none"},className:Cl["tab-title-suffix"],children:`${null==t?void 0:t.index}/${null==e?void 0:e.length}`})]})};return e&&i?(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("div",{className:Cl.content,children:(0,Te.jsx)("div",{className:Cl.summary,"data-testid":(T?"podcast":"video")+"-assistant-summary-container",children:(0,Te.jsx)(Qu,{id:S?o:"",onRetry:a,type:"summary",autoScrollToEnd:!1,enableScroll:!0,className:Cl.streamMessage,containerClassName:Cl.scrollContainer})})}),N?(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsxs)("div",{className:Cl["content-tab-bar"],children:[(0,Te.jsx)("div",{className:Cl["content-tab-item"],"data-active":"highlight"===R,onClick:()=>M("highlight"),children:E("flow_web_ext_youtube_highlights")}),(0,Te.jsx)("div",{className:Cl["content-tab-item"],"data-active":"video-list"===R,onClick:()=>M("video-list"),children:B()})]}),(0,Te.jsxs)(je.tU,{className:Cl["content-tabs"],activeKey:R,onChange:e=>M(e),renderTabBar:()=>null,children:[(0,Te.jsx)(je.mF,{itemKey:"highlight",children:L(!1)}),(0,Te.jsx)(je.mF,{itemKey:"video-list",children:(0,Te.jsx)(ku,{visible:"video-list"===R,model:I,onChange:j})})]})]}):L(!0)]}):null};let Xu=function(e){return e.copy="copy",e.copy_picture="copy_picture",e.copy_rich_text="copy_rich_text",e.download="download",e.fullscreen="fullscreen",e.zoom_in="zoom_in",e.zoom_out="zoom_out",e.zoom_fit="zoom_fit",e}({});var Ju=n(83310);const eh=({t:e,isActive:t,getPopupContainer:n,onFirstShow:i,onCopy:o,onCopyHtml:s,onCopyImg:a,onDownload:l,onEnterFullscreen:c,onZoomIn:d,onZoomOut:h,onZoomFit:p,getSendMessageParams:g,translateLanguage:v,className:f})=>{const[_,x]=(0,m.useState)(""),y=(0,m.useRef)(),[b,w]=(0,m.useState)(!0),C=(0,As.A)("mindmap_options"),[A,S]=(0,m.useState)(""),k=(0,An.P)((e=>e.sendMessage)),E=()=>{const e=k((0,r.A)((0,r.A)({},g()),{},{sec_scene:bo._o.mind_note}));S(e)},T=()=>{x(""),S(""),L(!1)},I=(0,An.P)((e=>e.messages[A])),{isDone:j,text:N="",isError:R,isOpen:M}=I||{},[P,L]=(0,m.useState)(!1);(0,m.useEffect)((()=>{v&&(T(),t&&E())}),[v]),(0,m.useEffect)((()=>{var e;t&&(b&&(null==i||i(),w(!1)),A||E(),P?null===(e=y.current)||void 0===e||e.fit():(N!==_&&x(N),j&&L(!0)))}),[N,t,j]);return(0,Te.jsx)(Ju.A,{t:e,value:_,isDone:Boolean(j),isError:M&&(R||j&&!_),getPopupContainer:(()=>{var e;if(n)return n;const t=null===(e=In.j.getAssistantShadowContent())||void 0===e?void 0:e.querySelector(".cici-popup-container");return t?()=>t:void 0})(),onCopy:o,onZoomIn:d,onZoomOut:h,onZoomFit:p,onCopyImg:a,onCopyHtml:s,onDownload:l,onEnterFullscreen:c,handleRetry:()=>{T(),E()},markmapRef:y,registerRecyclable:u.A,iconUrl:(0,fs.Nf)(),extName:(0,fs.L2)()||"",className:f,fullscreenRootElement:null===(B=In.j.getAssistantShadowContent())||void 0===B?void 0:B.querySelector('div[class*="assistant"]'),markmapOptions:C});var B},th="videoMindmap-Csi4J8",nh=({isActive:e,getPopupContainer:t,transcript_list:n=[],translateLanguage:i,onFirstShow:o,onCopy:s,onCopyImg:r,onCopyHtml:a,onDownload:l,onEnterFullscreen:c,onZoomIn:d,onZoomOut:u,onZoomFit:h})=>{var m,p;const g=(0,v.B)(),f=(null===(m=Dd())||void 0===m?void 0:m.meta.title)||"",_=(null===(p=Dd())||void 0===p?void 0:p.meta.duration)||0;return(0,Te.jsx)(eh,{className:th,t:g,isActive:e,getPopupContainer:t,getSendMessageParams:()=>({text:location.href,answerWithSuggest:!1,current_page:(0,It.M5)(location.href),scene:bo.sJ.video_click,replyLang:null!=i?i:(0,kn.wz)((0,se.TK)("uiLanguage")),prompt:so.EU.browser_plugin_info,browser_plugin_info:JSON.stringify({skill_name:"text_to_mindnote",mindnote_source:"transcript",transcript_list:n})}),translateLanguage:i,onZoomIn:e=>{d?d(e):oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.zoom_in,whether_full_screen:e?1:0,content_title:f,content_duration:_})},onZoomOut:e=>{u?u(e):oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.zoom_out,whether_full_screen:e?1:0,content_title:f,content_duration:_})},onZoomFit:e=>{h?h(e):oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.zoom_fit,whether_full_screen:e?1:0,content_title:f,content_duration:_})},onFirstShow:()=>{o?o():ic({show_from:(0,Wr.Z)()?Ql.ONBOARDING:Ql.UPPER_RIGHT,result_type:"mind_map",content_title:f,content_duration:_})},onCopy:e=>{s?s(Boolean(e)):oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.copy,whether_full_screen:e?1:0,content_title:f,content_duration:_})},onCopyImg:e=>{r?r(Boolean(e)):oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.copy_picture,whether_full_screen:e?1:0,content_title:f,content_duration:_})},onCopyHtml:e=>{a?a(Boolean(e)):oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.copy_rich_text,whether_full_screen:e?1:0,content_title:f,content_duration:_})},onDownload:e=>{l?l(Boolean(e)):oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.download,whether_full_screen:e?1:0,content_title:f,content_duration:_})},onEnterFullscreen:()=>{c?c():oc({click_from:Gl.UPPER_RIGHT,button_name:Xu.fullscreen,content_title:f,content_duration:_})}})},ih=()=>{ci.recordClickRelayBtnType(li.playNext)},oh=()=>{ci.recordClickRelayBtnType(li.recommendVideo)},sh=()=>{ci.recordClickRelayBtnType(li.recommendVideoEnding)};var rh=n(84755);const ah=function(){var e=(0,a.A)((function*({videoId:e}){return(0,xi.jB)("youtube")?yield(0,St.S)({videoID:e}):(0,xi.jB)("bilibili")?yield(0,di.S)({videoId:e}):void 0}));return function(t){return e.apply(this,arguments)}}();function lh(){return(lh=(0,a.A)((function*(e){const t=yield(0,Nn.S6)({method:"POST",url:`${bn.kD}/plugin/web_meta_upload`,data:{source_url:location.href,web_meta:e}});if(t instanceof Error)throw t;return t}))).apply(this,arguments)}const ch=function(){var e=(0,a.A)((function*(e){try{yield function(e){return lh.apply(this,arguments)}(e)}catch(t){A.vF.persist.error({message:"upload media data to cache failed",error:t})}}));return function(t){return e.apply(this,arguments)}}();var dh=n(74232),uh=n(4297),hh=n(20318);const mh=e=>{var t;const n=(0,An.P)((e=>e.messages)),{isDone:i,text:o="",isUnAuthorized:s,body:a,isError:l}=n[e]||{},c=(null===(t=n[e])||void 0===t||null===(t=t.body)||void 0===t||null===(t=t.message)||void 0===t?void 0:t.meta_infos)||[],d=(0,m.useRef)({id:e,timelineRes:[]});(0,m.useEffect)((()=>{e!==d.current.id&&(d.current.id=e,d.current.timelineRes=[]),(0,vi.A)(c,(e=>{if(-5===e.type){const t=(0,R.O)(e.info,{});!(0,gi.A)(t.inc.section)&&(0,gi.A)(d.current.timelineRes)&&(d.current.timelineRes=t.inc.section);const n=t.inc.timeline;(0,vi.A)(n,(e=>{var t;if((0,mi.A)(null==e?void 0:e.section_index)&&(null===(t=d.current.timelineRes[e.section_index])||void 0===t||!t.bullet_points)){const t=null==e?void 0:e.bullet_points,n=e.tags;d.current.timelineRes[e.section_index]=(0,r.A)((0,r.A)({},d.current.timelineRes[e.section_index]),{},{bullet_points:t,tags:n})}}))}}))}),[e,c]);return{highlightsResult:JSON.stringify(d.current.timelineRes),isAllDone:i,summaryResult:o,isHighlightsDone:(()=>{if((0,gi.A)(d.current.timelineRes))return!1;return!(0,hh.A)(d.current.timelineRes,(e=>!(e.bullet_points&&e.bullet_points.length>0)))||i})(),isUnAuthorized:s,body:a,isError:l}};let ph;const gh="has_showed_user_guidance",vh=function(){var e=(0,a.A)((function*(e){var t;const n=yield re.A.get(gh);ph=void 0!==n&&Boolean(n),e(null!==(t=Boolean(n))&&void 0!==t&&t)}));return function(t){return e.apply(this,arguments)}}(),fh=({videoParamId:e,videoTitle:t,isImmersionMode:n})=>{var i;const o=(0,m.useRef)((0,Wr.Z)()),[s,l]=(0,m.useState)(""),[c,d]=(0,f.Y)("mediaCardTranslateLanguage"),u=(0,An.P)((e=>e.sendMessage)),h=(0,An.P)((e=>e.messages));(0,m.useEffect)((()=>{rh.A.on("SUMMARIZE VIDEO",rh.x.PAGE,(()=>{G({clickFrom:Gl.ONBOARDING})}))}),[]);const p=(0,m.useMemo)((()=>dh.Qz.create("cici_video_summary_action_perf")),[]),[g,v]=(0,m.useState)(!1),[x,y]=function(){const[e,t]=(0,m.useState)(ci.shouldSummaryVideoDefault());return[e,t]}(),[b,w]=(0,m.useState)(!1),[C,A]=(0,m.useState)(!1),[S,k]=(0,m.useState)(ph),[E,T]=(0,uh.r)(gh),[I,j]=(0,m.useState)(!0),[N,R]=(0,m.useState)({}),{value:M}=(0,Kr.Tu)(Kr.FM.enableHighlightTag,!1),P=(0,m.useRef)(""),[L,B]=(0,m.useState)({isSummaryLoading:!1,isHighlightsLoading:!1}),{isAllDone:D,summaryResult:O,highlightsResult:F,isHighlightsDone:U,isUnAuthorized:H}=mh(s),z=h[s],q="1"===(null==z||null===(i=z.body)||void 0===i||null===(i=i.message)||void 0===i||null===(i=i.ext)||void 0===i?void 0:i.browser_plugin_risk_flag),V=ci.hasTranscript(),{setIsLoadingDone:$}=(0,Cn.e)();(0,m.useEffect)((()=>{$(!(!U||!F))}),[U,F]);const W=C&&V&&D&&!F&&!O,K=!V&&g&&!b;(0,m.useEffect)((()=>{P.current===s&&B({isSummaryLoading:!1,isHighlightsLoading:!0}),D&&B({isSummaryLoading:!1,isHighlightsLoading:!1})}),[s,D]);const Y=function(){var t=(0,a.A)((function*(){try{const t=yield ah({videoId:e}),n=null==t?void 0:t.subtitles;return j(!(null==t||!t.isUserLogin)),R({data:null==t?void 0:t.videoListInfo}),ci.updateTranscriptData(n),n}catch(t){ci.updateTranscriptData([])}finally{v(!0),w(!1)}}));return function(){return t.apply(this,arguments)}}(),G=function(){var i=(0,a.A)((function*({clickFrom:i,translateLang:o}){var a;if(B({isSummaryLoading:!0,isHighlightsLoading:!0}),oc({click_from:i,content_title:t,content_duration:_i(Ni())}),a={summary_message_id:O?s:"",language:(0,kn.wz)(c),is_immersion:n,click_from:i,content_title:t,content_duration:_i(Ni())},(0,It.z8)(_.Ur.showVideoAssistantSummarizeResult,a),ci.updateModuleClickFrom(i),A(!0),y(!0),k(!0),(0,wo.BB)({action:"web_video_summary",loginParams:{}}))return;null==p||p.start(),null==p||p.mark("request_transcript_start");const d=yield Y(),h=ji(e),m=Ni();null==p||p.mark("request_start");const g={title:t,url:location.href,transcript_list:d,with_tag:M,skill_name:"video_summary"};if(d&&d.length>0){((e,t)=>{const n=u((0,r.A)((0,r.A)({},e),{},{browser_language:(0,kn.wz)(null!=t?t:c),current_page:(0,It.M5)(location.href),scene:bo.sJ.video_click,sec_scene:bo._o.video_click_summarize,preventDefaultAuthAction:!0}));l(n),P.current=n,ci.updateVideoSummaryId(n)})({text:location.href,prompt:so.EU.youtube,browser_youtube_transcript:{browser_plugin_info:JSON.stringify(g)}},o),ch({cover_url:h,title:t,duration:m,timeline_transcript:JSON.stringify(d)})}}));return function(e){return i.apply(this,arguments)}}();(0,m.useEffect)((()=>{if(ci.resetVideoSummaryStatus(),x||(0,Wr.Z)()||(0,Wr.$Z)()){const e=ci.getLastClickRelayBtnType()||Gl.UPPER_RIGHT;e&&G({clickFrom:e})}}),[]),(0,m.useEffect)((()=>{vh((e=>{k(e)}))}),[]),(0,m.useEffect)((()=>{ic({show_from:o.current?Ql.ONBOARDING:Ql.UPPER_RIGHT,result_type:"summary",content_title:t,content_duration:_i(Ni())}),e&&(w(!0),Y()),T(!0)}),[]),(0,m.useEffect)((()=>{D&&(null==p||p.mark("response_summary_done"))}),[D]),(0,m.useEffect)((()=>{D&&(null==p||p.end("response_end"))}),[D,n]);const Q=(0,m.useMemo)((()=>({isAllDone:!!D,videoSummaryId:s,translateLanguage:c,transcript:ci.getTranscriptData(),isTranscriptLoaded:g,isHighlightsDone:Boolean(U),hasTranscript:V,summarizeTriggered:x,summaryResult:O,highlightsResult:F||"",hasNoSubtitles:K})),[D,s,c,g,U,V,x,O,F,K]),Z=(0,m.useMemo)((()=>({setMediaCardTranslateLanguage:d,handleSummarizeVideo:G})),[d,G]);return{contentVisible:C,noContent:W,hasNoSubtitles:K,hasShowedUserGuidance:S,isMessageUnAuthorized:H,isLoginBilibili:I,controlller:Z,videoSummaryInfo:Q,isContentOnRisk:q,videoListInfo:N,isLoading:L}};function _h(e,t,n,i,o){if(!e)return;if(!t)return;if(n)return;o({clickFrom:ci.getLastEntryFullScreenFrom()||Gl.IMMERSION_FULLSCREEN_BTN,translateLang:i})}class xh{constructor(){(0,y.A)(this,"ytNavigateEnd",void 0),(0,y.A)(this,"ytNavigatedStart",void 0)}canPlay(){return(0,Wr.Wh)()}getClassNameList(){return["style-scope","ytd-menu-renderer"]}waitingForReady(){return(0,a.A)((function*(){try{const[e,t]=yield Promise.all([(0,et.V6)(".ytp-right-controls",{maxWait:1e4}),(0,et.V6)("#container .html5-video-player",{maxWait:1e4})]);if(!e||!t)return!1}catch(e){return qs().error("waiting for youtube ready Error ",e),!1}return!0}))()}clearScreen(){const e=document.querySelector("div.html5-video-player");if(!e)return;const t=e.querySelector(".ytp-chrome-top");t&&(t.style.display="none");const n=e.querySelector(".ytp-chapter-container");n&&(n.style.display="none")}enterImmersionMode(e){this.ytNavigateEnd=t=>{var n;if(e.isImmersionMode)return void _h(e.isImmersionMode,e.videoSummaryInfo.hasTranscript,e.videoSummaryInfo.summarizeTriggered,e.videoSummaryInfo.translateLanguage,e.handleSummarizeVideo);"watch"!==(null==t||null===(n=t.detail)||void 0===n?void 0:n.pageType)&&(ci.resetClickRelayBtnType(!0),ci.updateShouldSummaryVideoDefault(!1))},this.ytNavigatedStart=e=>{ci.resetClickRelayBtnType()},document.addEventListener("yt-navigate-start",this.ytNavigatedStart),document.addEventListener("yt-navigate-finish",this.ytNavigateEnd)}exitImmersionMode(){this.ytNavigatedStart&&document.removeEventListener("yt-navigate-start",this.ytNavigatedStart),this.ytNavigateEnd&&document.removeEventListener("yt-navigate-finish",this.ytNavigateEnd)}getFullScreenBtnSelector(){return"button.ytp-fullscreen-button"}getVideoElementSelector(){return".html5-main-video"}getVideoContainerSelector(){return"div.html5-video-container"}getFullScreenShortKey(){return"f"}getCustomImmersionBtnStyleStr(){return"\n    .immersion-btn-container {\n      height: 36px !important;\n      align-items: center;\n      margin-right: 8px;\n      border-radius: 18px;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      min-width: 96px;\n      }\n    "}onImmersionBtnClick(){var e;null===(e=document.querySelector("html"))||void 0===e||e.requestFullscreen()}getImmersionBtnContainer(){return document.querySelector("#actions-inner ytd-menu-renderer")}}function yh(){return/bilibili/.test(location.href)?{toolbar:document.getElementById("arc_toolbar_report"),minWidth:870}:/youtube/.test(location.href)?{toolbar:document.getElementById("top-row"),minWidth:900}:{toolbar:null,minWidth:0}}function bh(){const{toolbar:e,minWidth:t}=yh(),n=null==e?void 0:e.getBoundingClientRect();return!!n&&n.width<=t}function wh(){const[e,t]=(0,m.useState)(bh());return(0,m.useEffect)((()=>Ch((()=>{t(bh())}))),[]),e}function Ch(e){const{toolbar:t}=yh();if(!t)return;const n=(0,T.A)((()=>e(bh())),200),i=new ResizeObserver(n);return i.observe(t),()=>{i.disconnect()}}const Ah="container-n3KWJg",Sh="tooltipAnchor-QGwCf7",kh=()=>{const e=(0,Je.Uk)(),t=(0,m.useMemo)((()=>Ki()),[]),n=wh(),i=(0,Te.jsx)("div",{className:Sh});return(0,Te.jsx)("body",{className:J()("cici-ext-container",Ah),children:n?(0,Te.jsx)(je.m_,{content:e("flow_web_ext_youtube_sharepage_immersionbutton"),getPopupContainer:t,position:"top",style:{marginLeft:"15px"},children:i}):i})},Eh={width:"350px",position:"absolute",right:"10px",top:"100px",pointerEvents:"none"},Th="\n.immersion-btn-container {\n  height: 33px !important;\n  width: auto !important;\n  border-radius: 16px;\n  padding: 0 14px 0 10px !important;\n  background-blend-mode: lighten;\n  vertical-align: top;\n  color: #ffffff;\n  position: relative;\n  overflow: hidden;\n\n  span, div {\n    z-index: 1;\n  }\n\n  &::before {\n    content: '';\n    left: 50%;\n    top: 50%;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    transform: translate(-50%, -50%);\n    background:\n      radial-gradient(115.45% 162.76% at 19.33% 22.04%, #0057FF 0%, #4298FD 50%);\n  }\n}\n  .immersion-btn-container:hover::before {\n    animation: inactive-btn-hover-animation 3s linear infinite;\n  }\n\n  @keyframes inactive-btn-hover-animation {\n    0% {\n      transform: translate(-50%, -50%) rotate(0);\n    }\n    100% {\n      transform: translate(-50%, -50%) rotate(1turn);\n    }\n  }\n",Ih='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M4.10976 14.9508C3.60569 14.9508 3.21138 14.8085 2.92683 14.5239C2.64228 14.2394 2.5 13.8451 2.5 13.341V5.35658C2.5 4.85658 2.64228 4.46431 2.92683 4.17976C3.21138 3.89521 3.60569 3.75293 4.10976 3.75293H15.8841C16.3923 3.75293 16.7886 3.89521 17.0732 4.17976C17.3577 4.46431 17.5 4.85658 17.5 5.35658V13.341C17.5 13.8451 17.3577 14.2394 17.0732 14.5239C16.7886 14.8085 16.3923 14.9508 15.8841 14.9508H12.0366V15.9935H12.061C12.2236 15.9935 12.3638 16.0524 12.4817 16.1703C12.5996 16.2882 12.6585 16.4264 12.6585 16.5849C12.6585 16.7475 12.5996 16.8878 12.4817 17.0056C12.3638 17.1235 12.2236 17.1825 12.061 17.1825H7.93902C7.77642 17.1825 7.63618 17.1235 7.51829 17.0056C7.40041 16.8878 7.34146 16.7475 7.34146 16.5849C7.34146 16.4264 7.40041 16.2882 7.51829 16.1703C7.63618 16.0524 7.77642 15.9935 7.93902 15.9935H7.96341V14.9508H4.10976ZM4.21951 13.6398H15.7805C15.9065 13.6398 16.0061 13.6032 16.0793 13.53C16.1524 13.4569 16.189 13.3573 16.189 13.2313V5.47244C16.189 5.34236 16.1524 5.24276 16.0793 5.17366C16.0061 5.10049 15.9065 5.0639 15.7805 5.0639H4.21951C4.0935 5.0639 3.9939 5.10049 3.92073 5.17366C3.84756 5.24276 3.81098 5.34236 3.81098 5.47244V13.2313C3.81098 13.3573 3.84756 13.4569 3.92073 13.53C3.9939 13.6032 4.0935 13.6398 4.21951 13.6398ZM10.4516 12.481C10.3724 12.481 10.3026 12.4539 10.2421 12.3997C10.1838 12.3455 10.1473 12.2767 10.1327 12.1934C10.0764 11.8724 10.0191 11.6025 9.96075 11.3837C9.9024 11.1669 9.83049 10.9898 9.74504 10.8522C9.66167 10.7146 9.55226 10.6042 9.41678 10.5208C9.28131 10.4375 9.10833 10.3708 8.89783 10.3207C8.68941 10.2707 8.42993 10.2228 8.11939 10.1769C8.03394 10.1644 7.96308 10.128 7.9068 10.0675C7.85261 10.0071 7.82552 9.93517 7.82552 9.8518C7.82552 9.76844 7.85366 9.69653 7.90993 9.63609C7.9662 9.57357 8.03706 9.53709 8.12251 9.52667C8.43306 9.49124 8.69462 9.44956 8.90721 9.40162C9.11979 9.35369 9.29486 9.28804 9.43242 9.20467C9.56997 9.11922 9.68147 9.00667 9.76693 8.86703C9.85446 8.72531 9.92532 8.54503 9.97951 8.32619C10.0337 8.10527 10.0848 7.83433 10.1327 7.51336C10.1452 7.42791 10.1806 7.35914 10.239 7.30703C10.2994 7.25284 10.3703 7.22575 10.4516 7.22575C10.5329 7.22575 10.6027 7.25284 10.661 7.30703C10.7215 7.35914 10.759 7.42791 10.7736 7.51336C10.8299 7.83433 10.8861 8.10423 10.9424 8.32306C11.0008 8.53982 11.0727 8.71697 11.1581 8.85453C11.2436 8.99208 11.354 9.10254 11.4895 9.18591C11.625 9.26928 11.7969 9.33597 12.0053 9.38599C12.2158 9.43601 12.4753 9.48291 12.7838 9.52667C12.8713 9.54126 12.9422 9.57878 12.9963 9.63922C13.0526 9.69966 13.0808 9.77052 13.0808 9.8518C13.0808 9.93725 13.0526 10.0112 12.9963 10.0738C12.9401 10.1342 12.8682 10.1686 12.7806 10.1769C12.4722 10.2124 12.2117 10.2551 11.9991 10.3051C11.7865 10.353 11.6104 10.4187 11.4707 10.5021C11.3332 10.5854 11.2217 10.698 11.1362 10.8397C11.0508 10.9814 10.981 11.1617 10.9268 11.3805C10.8726 11.6015 10.8215 11.8724 10.7736 12.1934C10.7611 12.2767 10.7246 12.3455 10.6642 12.3997C10.6058 12.4539 10.5349 12.481 10.4516 12.481ZM7.70725 8.65414C7.74115 8.68453 7.78031 8.69973 7.82474 8.69973C7.8715 8.69973 7.91125 8.68453 7.94398 8.65414C7.97788 8.62374 7.99834 8.58516 8.00536 8.5384C8.03225 8.35837 8.06089 8.20639 8.09128 8.08247C8.12168 7.95972 8.16084 7.85859 8.20877 7.7791C8.2567 7.6996 8.31925 7.63647 8.39641 7.58971C8.47473 7.54295 8.57352 7.50612 8.69276 7.47924C8.81201 7.45118 8.95814 7.42721 9.13116 7.40734C9.18026 7.40266 9.22059 7.38337 9.25216 7.34947C9.28372 7.3144 9.2995 7.2729 9.2995 7.22497C9.2995 7.17937 9.28372 7.13962 9.25216 7.10572C9.22176 7.07182 9.18201 7.05078 9.13291 7.04259C8.95989 7.01804 8.81435 6.99174 8.69627 6.96368C8.57936 6.93562 8.48292 6.89821 8.40693 6.85145C8.33094 6.80469 8.26898 6.74273 8.22105 6.66557C8.17312 6.58841 8.13278 6.48904 8.10005 6.36746C8.06849 6.24471 8.03692 6.09332 8.00536 5.91328C7.99717 5.86535 7.97613 5.82677 7.94223 5.79755C7.90949 5.76715 7.87033 5.75195 7.82474 5.75195C7.77914 5.75195 7.7394 5.76715 7.70549 5.79755C7.67276 5.82677 7.65289 5.86535 7.64587 5.91328C7.61898 6.09332 7.59034 6.2453 7.55995 6.36922C7.52955 6.49197 7.4898 6.59309 7.4407 6.67259C7.39277 6.75091 7.33023 6.81404 7.25307 6.86197C7.17591 6.90874 7.07771 6.94556 6.95847 6.97245C6.83922 6.99934 6.69251 7.02272 6.51832 7.04259C6.47038 7.04844 6.43064 7.0689 6.39907 7.10397C6.36751 7.13787 6.35173 7.1782 6.35173 7.22497C6.35173 7.27173 6.36692 7.31206 6.39732 7.34596C6.42888 7.37987 6.46863 7.40032 6.51656 7.40734C6.69075 7.43306 6.8363 7.45995 6.95321 7.488C7.07128 7.51606 7.16831 7.55347 7.2443 7.60023C7.32029 7.647 7.38167 7.70896 7.42843 7.78611C7.47636 7.86327 7.51669 7.96264 7.54943 8.08422C7.58216 8.20697 7.61431 8.35837 7.64587 8.5384C7.65406 8.58516 7.67451 8.62374 7.70725 8.65414Z" fill="white"/>\n</svg>';var jh=n(76021),Nh=n(93772),Rh=n(59517);const Mh="subtitles_container-XYzb2H",Ph="has_corner-d1Ibbw",Lh="original_subtitle-vSPrki",Bh="half_round-N4gpW_",Dh="translated_subtitle-RT8XdR",Oh=()=>document.querySelector(`#${Nh.$}`);let Fh="";const Uh=e=>{const[t]=(0,f.Y)("subtitleTranslateLang"),[n]=(0,f.Y)("autoTranslateSubtitles"),[i,o]=(0,m.useState)(1),[s,r]=(0,m.useState)(""),[a,l]=(0,m.useState)(["",""]),[c,d]=(0,m.useState)(!1),[u,h]=(0,m.useState)(),[p,g]=(0,m.useState)(),[v,_]=(0,m.useState)(),{subtitleReady:x,resetVideoUI:y}=(0,mt.wT)(),[b]=(0,f.Y)("videoSubtitleDisableHosts"),[w]=(0,f.Y)("videoSubtitleDisableAll"),C=b.includes(window.location.host)||w,A=(0,m.useRef)(null),S=(0,m.useRef)(null);(0,m.useEffect)((()=>{_(void 0),g(void 0),r(""),l(["",""])}),[y]),(0,m.useEffect)((()=>{t&&n&&(o((new Date).getTime()),Tt.reopenTranslate(t),g(void 0),l(["",""]))}),[t,n]),(0,m.useEffect)((()=>{if(x||i){const e=Tt.getCurrentSubtitles();if(!e)return;const t=wt(e);t&&_(t)}}),[x,i]),(0,m.useEffect)((()=>(v&&(Tt.watchCurrentSubtitle(v,(e=>{g(e),h(e.threadId),r(e.originalText)})),Tt.onTimeJump((()=>{l(["",""])}))),()=>{Tt.stopWatchingSubtitles()})),[v]),(0,m.useEffect)((()=>{if(void 0===u||u<0)return;xt.findTranslateReady(u)?d(!0):(d(!1),xt.onThreadReady(u,(e=>{e===u&&d(!0)})))}),[u]);const k=s===a[0]?a[1]:"...",E=s!==k;if((0,m.useEffect)((()=>{if(!c)return;const{getTranslate:e}=p||{};null==e||e().then((([e,t])=>{l([e,t])}))}),[c,p]),(0,m.useEffect)((()=>{if(E&&k&&A.current&&S.current){const e=A.current.offsetWidth,t=S.current.offsetWidth,n={has_corner:!1,half_round:!1},i={has_corner:!1,half_round:!1};e>t+16?(i.half_round=!0,i.has_corner=e>t+32):e<t-16&&(n.half_round=!0,n.has_corner=e<t-32),A.current.className=J()(Lh,{[Ph]:n.has_corner,[Bh]:n.half_round}),S.current.className=J()(Dh,{[Ph]:i.has_corner,[Bh]:i.half_round})}}),[s,k,E]),!p||!x||!n||-1===(null==p?void 0:p.threadId)||!s||C)return null;Tt.makeSureOriginalSubtitleHide(),(()=>{const e=Tt.getCurrentVideoId();e!==Fh&&((0,It.z8)("video_subtitle_generate"),(0,It.z8)("active_dau",{click_from:"subtitle_click"}),Fh=e)})();const T=()=>{const e=Oh();e&&(e.style.pointerEvents="none")};return(0,Te.jsxs)("div",{className:Mh,"data-testid":"video-assistant-subtitle-container",onPointerDown:()=>{(()=>{const e=Oh();e&&(e.style.pointerEvents="auto")})();In.j.getAssistantContainer().style.display="block"},onPointerUp:()=>{T();const e=document.querySelector(".html5-main-video");if(!e)return;e.pause();const t=()=>{var n;null===(n=window.getSelection())||void 0===n||n.removeAllRanges(),e.removeEventListener("pointerup",t)};e.addEventListener("pointerup",t)},onPointerLeave:T,children:[(0,Te.jsx)("div",{ref:A,className:Lh,style:{fontSize:e.fontSize},children:s}),E?(0,Te.jsx)("div",{ref:S,className:Dh,style:{fontSize:e.fontSize},children:k}):null]})},Hh="translate_target-YPSdRA",zh="translate_target_names-MzTahw",qh="translate_target_lang_name-Zx5GGz",Vh="selected-CN1cnk",$h="dark-MZOLTG",Wh="translate_target_lang_translated_name-OtoxsR",Kh="translate_target_selected_icon_container-msUmt5",Yh=e=>{const{code:t,langTranslatedName:n,langLocName:i,selected:o,onSelect:s,theme:r="light"}=e;return(0,Te.jsxs)("div",{className:Hh,onClick:()=>{s(t)},children:[(0,Te.jsxs)("div",{className:zh,children:[(0,Te.jsx)("div",{className:J()({[qh]:!0,[Vh]:o,[$h]:"dark"===r}),children:i}),(0,Te.jsx)("div",{className:J()({[Wh]:!0,[$h]:"dark"===r}),children:n})]}),(0,Te.jsx)("div",{className:Kh,children:o&&(0,Te.jsx)(Pe.Tf,{})})]})},Gh="subtitle_setting_wrapper-kvmobz",Qh="mask-e7zwtJ",Zh="subtitle_target_lang_title-zPumr7",Xh="subtitle_target_lang_list-_zVVpf",Jh="disable-setting-TOuOKD",em="disable-options-uQYAtc",tm="disable-options-menus-VaMtAW",nm=()=>{const{setShowSubtitleTranslation:e}=(0,mt.wT)(),[t,n]=(0,m.useState)(!1),[i,o]=(0,f.Y)("subtitleTranslateLang"),s=(0,Je.Uk)(),r=(0,Gd.e)(),a=e=>{(0,It.z8)("video_subtitle_setting_click",{language:e}),(0,It.z8)("active_dau",{click_from:"subtitle_click"}),o(e)};return(0,Te.jsxs)("div",{className:J()(Gh),onClick:e=>{e.stopPropagation()},children:[(0,Te.jsx)(xe.A,{className:em,dropdownClassName:tm,show:t,setShow:n,position:"rightTop",disableKey:os.lf.videoSubtitle,optionPageSection:"video-summary",onDisableOnceClick:()=>e(!1),children:(0,Te.jsx)("div",{className:Qh})}),(0,Te.jsxs)("div",{className:"p-12",children:[(0,Te.jsxs)("div",{className:"flex items-center",children:[(0,Te.jsx)("span",{className:J()(Zh,"flex-1"),children:s("flow_web_youtube_subtitles_setting_language")}),(0,Te.jsx)("span",{className:J()(Jh,"flex-initial"),onClick:()=>n(!0),children:s("flow_web_ext_setting")})]}),(0,Te.jsxs)("div",{className:Xh,children:[(0,Te.jsx)(Yh,{theme:"dark",selected:"system"===i,code:"system",langTranslatedName:s("flow_web_youtube_subtitles_setting_systemlanguage"),langLocName:s("background_follow_system"),onSelect:()=>{o("system")}},"system"),null==r?void 0:r.map((e=>(0,Te.jsx)(Yh,{theme:"dark",selected:i===e.language_code,code:e.language_code,langTranslatedName:e.language,langLocName:e.language_loc,onSelect:a},e.language_code)))]})]})]})},im="subtitle_window-r78hdZ",om="subtitle_container-l66tBz",sm="subtitle_popover-VcCs4b",rm=()=>{const{popoverPosition:e,setShowSetting:t,showSetting:n,showSubtitleTranslation:i}=(0,mt.wT)(),o=(0,m.useRef)(null),s=(e=>{const[t,n]=(0,m.useState)(0);return(0,m.useEffect)((()=>{const t=new ResizeObserver((()=>{var t;const i=(null==e||null===(t=e.current)||void 0===t?void 0:t.clientWidth)||0;n(i/48)}));return null!=e&&e.current&&t.observe(null==e?void 0:e.current),()=>{t.disconnect()}}),[e]),t})(o),r=(0,Rh.A)((()=>{t(!1)}));return i?((0,m.useEffect)((()=>{n&&(0,It.z8)("video_subtitle_setting_show")}),[n]),(0,Te.jsx)("div",{className:J()(im,"cici-ext-container"),ref:o,children:(0,Te.jsxs)("div",{className:"cici-ext-always-dark semi-always-dark",children:[(0,Te.jsx)("div",{className:om,children:(0,Te.jsx)(Uh,{fontSize:s})}),(0,Te.jsx)("div",{ref:r,className:sm,style:{left:e.left,bottom:e.bottom},children:n?(0,Te.jsx)(nm,{}):null})]})})):null},am=()=>{var e;const t=(0,Je.Uk)();return(0,nr.A)(null===(e=(0,$r.A)())||void 0===e||null===(e=e.findAssistant())||void 0===e?void 0:e.shadowRoot),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t,children:(0,Te.jsx)(rm,{})})})},lm="subtitle_button-lmC4ch",cm="setting_part-S380fg",dm="setting_part_icon-y7_pqu",um="setting_part_text-w4VMKV",hm="subtitle_button_divider-KIxXhg",mm="toggle_part-iB9SjP",pm="toggle_part_icon-jX7JTa",gm="onboarding_subtitle_button-eElOf9",vm="disable_onboarding_subtitle_button-dNq7hU",fm=()=>{const[e]=(0,f.Y)("authInfo"),t=(null==e?void 0:e.isAuthenticated)||!1,[n,i]=(0,f.Y)("autoTranslateSubtitles"),o=(0,Je.Uk)(),{buttonHeight:s,setShowSetting:r,showSetting:l}=(0,mt.wT)(),[c,d]=(0,m.useState)((0,Wr.y)());(0,m.useEffect)((()=>{n?Tt.openBilingualSubtitle():Tt.closeBilingualSubtitle()}),[n]),(0,m.useEffect)((()=>{(0,Wr.y)()&&i(!0),setTimeout((()=>{d(!1)}),2e3)}),[]),(0,m.useEffect)((()=>{!t&&n&&(Tt.closeBilingualSubtitle(),i(!1))}),[t,n]);const u=function(){var e=(0,a.A)((function*(){if(n)(0,It.z8)("video_subtitle_entrance_click",{subtitle_status:"close"}),(0,It.z8)("active_dau",{click_from:"subtitle_click"}),yield Tt.closeBilingualSubtitle(),i(!1);else{if(!t)return void(0,_e.DT)({trackMeta:{login_entrance:"bilingual_subtitles"}});(0,It.z8)("video_subtitle_entrance_click",{subtitle_status:"open"}),yield Tt.openBilingualSubtitle(),i(!0)}}));return function(){return e.apply(this,arguments)}}();return(0,Te.jsxs)("div",{className:J()(lm,{[gm]:(0,Wr.y)(),[vm]:(0,Wr.y)()&&!c}),style:{height:33,marginTop:0},children:[(0,Te.jsxs)("div",{className:cm,onClick:()=>{l||(Tt.pauseVideo(),Tt.computePopoverPosition()),r(!l)},children:[(0,Te.jsx)("div",{className:dm,children:(0,Te.jsx)(Pe.eI,{})}),(0,Te.jsx)("div",{className:um,children:o("flow_web_youtube_subtitles_bilingual")})]}),(0,Te.jsx)("div",{className:hm}),(0,Te.jsx)("div",{className:J()(mm),style:{height:s},onClick:u,"data-testid":"video-assistant-subtitle-toggle",children:(0,Te.jsx)("div",{className:pm,children:n?c?(0,Te.jsx)(Pe.VA,{}):(0,Te.jsx)(Pe.$N,{}):c?(0,Te.jsx)(Pe.NK,{}):(0,Te.jsx)(Pe.JW,{})})})]})},_m="subtitle_assistant_container-_RjPH3",xm=()=>{const e=(0,m.useRef)(null),{showSubtitleTranslation:t}=(0,mt.wT)(),[n]=(0,f.Y)("videoSubtitleDisableHosts"),[i]=(0,f.Y)("videoSubtitleDisableAll"),o=n.includes(window.location.host)||i;return(0,m.useEffect)((()=>{const t=e.current;t&&(Tt.setSubtitleButtonContainer(t),Tt.watchButtonPosition())}),[e]),o||!t?null:(0,Te.jsx)("div",{ref:e,className:_m,children:(0,Te.jsx)(fm,{})})},ym=()=>{var e;const t=(0,Je.Uk)();return(0,nr.A)(null===(e=(0,$r.A)())||void 0===e||null===(e=e.findAssistant())||void 0===e?void 0:e.shadowRoot),(0,m.useEffect)((()=>{const e=Tt.watchCursorOverVideo();return()=>{null==e||e()}}),[]),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t,children:(0,Te.jsx)(xm,{})})})},bm=`${(0,fs.L2)()}_subtitle_assistant`,wm=(0,jh.A)((()=>{(0,It.z8)("video_subtitle_entrance_show")})),Cm=e=>{const t=document.createElement("div");t.id=bm,t.className="ytp-button",t.style.cssText="width: fit-content; height: 100%;";const n=u.m.getInstance().getHostId(),i=`${ae.tm}${n}`,o=e.querySelector(`[id='${i}']`);if(Boolean(document.querySelector(`#${bm}`)))return;null!=o&&o.nextSibling?e.insertBefore(t,o.nextSibling):e.prepend(t);const s=t.attachShadow({mode:"open"}),r=(0,p.createRoot)(s);(0,et.NR)(s,ae.QN).then((()=>{wm(),r.render((0,Te.jsx)(Vr,{element:t,children:(0,Te.jsx)(ym,{})}))})),(0,u.A)((()=>{var e;r.unmount(),null===(e=document.querySelector(`#${bm}`))||void 0===e||e.remove()}))},Am=e=>{const t=document.querySelector(`#${bm}`);t&&(t.style.display=e?"inline-block":"none")},Sm=e=>{const t=document.createElement("div");t.id=Nh.$,t.style.cssText="position: absolute; width: 100%; top: 0; bottom: 0; left: 0; z-index: 12; pointer-events: none;";if(Boolean(document.querySelector(`#${Nh.$}`)))return;e.appendChild(t);const n=t.attachShadow({mode:"open"}),i=(0,p.createRoot)(n);Tt.onBottomVisibilityToggle((e=>{t.style.bottom=e?"60px":"12px"})),(0,et.NR)(n,ae.QN).then((()=>{i.render((0,Te.jsx)(Vr,{element:t,children:(0,Te.jsx)(am,{})}))})),(0,u.A)((()=>{var e;i.unmount(),null===(e=document.querySelector(`#${Nh.$}`))||void 0===e||e.remove()}))},km=e=>{const t=document.querySelector(`#${Nh.$}`);t&&(t.style.display=e?"block":"none")},Em="immersion-button-container-style";let Tm=!1;function Im(e,t,n){return jm.apply(this,arguments)}function jm(){return jm=(0,a.A)((function*(e,t,n){if(!e)return;try{if(!(yield e.waitingForReady()))return}catch(h){return}const{videoSummaryInfo:{hasNoSubtitles:i},isMessageUnAuthorized:o,isSummaryAssistantClose:s}=n;Tm=Boolean(o);const r=yield(0,rr.NZ)((()=>e.getImmersionBtnContainer()));if(!r)return;!function(e){if(!e)return;let t=document.getElementById(Em);t||(t=document.createElement("style"),t.id=Em,t.innerHTML=`${Th} ${e.getCustomImmersionBtnStyleStr()}`,(0,rr.EY)(t))}(e);const a=u.m.getInstance().getHostId(),l=`${ae.tm}${a}`;let c=r.querySelector(`[id='${l}']`);if(c){s&&c.remove();const e=document.fullscreenElement;return c.style.display=e?"none":"inline-flex",void(i?(c.style.display="none",Tt.closeBilingualSubtitle(),Am(!1),km(!1)):(Tt.openBilingualSubtitle(),Am(!0),km(!0)))}c=function(e,t,n){const i=document.createElement("button");if(i.addEventListener("click",(()=>{Tm?(0,_e.DT)({trackMeta:{previous_page:(0,Wr.pQ)(),login_entrance:(0,Wr.pQ)()}}):(ci.updateEntryFullScreenFrom(Gl.IMMERSION_BTN),ci.updateShouldSummaryVideoDefault(!0),null==e||e.onImmersionBtnClick(),rc(Jl.TOOLBAR))})),i.id=t,i.className="ytp-button",i.classList.add("immersion-btn-container"),i.setAttribute("data-testid","video-assistant-immersionBtn"),null!=e&&e.getClassNameList){e.getClassNameList().forEach((e=>{i.classList.add(e)}))}const o=document.createElement("div"),s=document.createElement("span");s.style.marginRight="4px",s.style.display="inline-flex",s.innerHTML=Ih;const r=document.createElement("span");r.dataset.textId=t,r.textContent=n("flow_web_ext_youtube_sharepage_immersionbutton"),r.style.fontWeight="500",r.style.lineHeight="20px",r.style.fontSize="14px",re.A.watch({uiLanguage:()=>{r.textContent=n("flow_web_ext_youtube_sharepage_immersionbutton")}}),o.style.height="33px",o.style.lineHeight="initial",o.style.display="flex",o.style.alignItems="center",o.prepend(r),o.prepend(s);const a=document.createElement("div");a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",i.appendChild(o),i.appendChild(a);const l=a.attachShadow({mode:"open"});let c;return(0,et.NR)(l,ae.QN).then((()=>{c=(0,p.createRoot)(l),c.render(m.createElement(kh)),(0,u.A)((()=>{var e;null===(e=c)||void 0===e||e.unmount(),c=void 0}))})),i}(e,l,t),i?c.style.display="none":ac(ec.TOOLBAR),s||r.prepend(c);const d=Ch((e=>{var t;const n=null===(t=c)||void 0===t?void 0:t.querySelector(`span[data-text-id="${l}"]`);if(!n||!c)return;n.style.display=e?"none":"",c.style.minWidth=e?"40px":"";const i=c.firstChild;i&&(i.style.width=e?"17px":"")}));if((0,u.A)((()=>{var e;null==d||d(),null===(e=r.querySelector(`[id='${l}']`))||void 0===e||e.remove()})),(0,xi.jB)("youtube")){const e=document.querySelector(".ytp-right-controls");Cm(e);const t=document.querySelector("#container .html5-video-player");Sm(t)}})),jm.apply(this,arguments)}var Nm=n(99153),Rm=n(1948);const Mm="ytFullscreenContainer-iAvZg0",Pm="loadingContainer-N3dTT8",Lm="disable-options-quSXLy",Bm="autoLoading-IF5g74",Dm="loadingContent-sgcYBz",Om="loadingText-vo4h92",Fm="icon-qQ0HXm",Um="dotFlashingContainer-UAwJZz",Hm="guideTipsContainer-ga1OJ3",zm="divider-I_F_yj",qm="guideText-m5YbJh",Vm="openImmersionMode-rkXDIk",$m="iconBtnContainer-f0Fdke",Wm="noSubTitleTipsContainer-gYyhRs",Km="noSubTitleTips-RHSGvj",Ym="immersionExpandContainer-yAwhmC",Gm="immersionFoldIcon-uz017x",Qm="immersionExpandContent-kK5Nlq",Zm="immersionFold-x4jqlA",Xm="immersionExpandTooltip-ZpperL",Jm="login-button-puEXGC",ep="highlight-list-Dp_XNJ",tp="close-icon-SEw4g1",np="disable-options-menus-AUIv6R",ip=e=>{const{setSummaryAssistantClose:t}=e,n=(0,v.B)(),i=(0,m.useCallback)((()=>{null==t||t(!0)}),[t]);return(0,Te.jsx)("div",{className:Wm,children:(0,Te.jsxs)("div",{className:Km,children:[n("flow_web_ext_youtube_nosubtitles",{brand:(0,fs.L2)()}),(0,Te.jsx)(Rm.A,{style:{cursor:"pointer"},onClick:i})]})})},op=({loadingTextRef:e,loadingTextWidth:t,isAutoSummarize:n,onDisableOnceClick:i,disableOptionVisibleChange:o})=>{const s=(0,v.B)(),r=(0,m.useMemo)((()=>Ki()),[]),[a,l]=(0,m.useState)(!1),c=(0,Tu.zh)({from:{width:65},to:{width:t+32+33},config:{duration:300}}),d=(0,Tu.zh)({from:{opacity:0},to:{opacity:1},config:{duration:1500}}),u=(0,Te.jsx)(xe.A,{className:Lm,dropdownClassName:np,position:"bottomRight",getPopupContainer:r,disableKey:fe.lf.videoImmersion,onDisableOnceClick:i,show:a,setShow:e=>{l(e),null==o||o(e)},renderChildren:({onTriggerClick:e})=>(0,Te.jsxs)("div",{className:tp,children:[(0,Te.jsx)("div",{className:zm}),(0,Te.jsx)(ve.A,{onClick:t=>{t.preventDefault(),t.stopPropagation(),a?l(!a):e(t)}})]})});return(0,Te.jsx)("div",{className:J()(Pm,{[Bm]:n}),children:(0,Te.jsxs)(Tu.CS.div,{className:Dm,style:c,children:[(0,Te.jsx)(Tu.CS.div,{ref:e,className:Om,style:d,children:(0,Te.jsxs)(Te.Fragment,{children:[n&&(0,Te.jsx)(ct.A,{className:Fm}),s("flow_web_ext_youtube_summarizing")]})}),(0,Te.jsx)("div",{className:Um,children:(0,Te.jsx)(Wu.c,{})}),u]})})};var sp=function(e){return e.INDEPENDENT="independent",e.FOLD="fold",e.EXPAND="expand",e}(sp||{});const rp={[sp.INDEPENDENT]:(0,Te.jsx)(Pe.yZ,{}),[sp.FOLD]:(0,Te.jsx)(Pe.ut,{}),[sp.EXPAND]:(0,Te.jsx)(Pe.hk,{})},ap=({immersionHighlightExpand:e,onToggleExpand:t})=>{const n=(0,v.B)(),i=(0,Mo.A)(),[o,s]=(0,m.useState)(sp.INDEPENDENT),[r,a]=(0,m.useState)(!1);return(0,m.useEffect)((()=>{const e=setTimeout((()=>{a(!0)}),1e3);return()=>{clearTimeout(e)}}),[]),r?(0,Te.jsx)("div",{className:J()(Ym,{[Gm]:o===sp.FOLD,[Zm]:!e}),onMouseEnter:()=>{s(e?sp.FOLD:sp.EXPAND)},onMouseLeave:()=>s(sp.INDEPENDENT),children:(0,Te.jsx)(je.m_,{content:n(e?"flow_web_ext_youtube_sharepage_putaway":"flow_web_ext_youtube_sharepage_expand"),position:"left",getPopupContainer:null==i?void 0:i.getPopupContainer,className:Xm,children:(0,Te.jsx)("div",{className:Qm,onClickCapture:e=>{e.stopPropagation(),null==t||t()},children:(0,Te.jsx)("div",{children:rp[o]})})})}):null},lp=({text:e,trackResultEvent:t,trackHighlightEvent:n,videoDuration:i=0,videoState:o,setVideoState:s,loadingTextWidth:r,isNeedLoadingAnimation:a,handleUserInteract:l,userInteracting:c,activeScroll:d})=>{const[u,h]=(0,Tu.zh)((()=>({from:{width:r+44+32}})));return(0,m.useEffect)((()=>{h.start({to:{width:r+44+12},config:{duration:300}}),setTimeout((()=>{h.start({to:{width:300}})}),500)}),[]),(0,Te.jsx)(Te.Fragment,{children:a?(0,Te.jsx)(Tu.CS.div,{className:Pm,style:u}):(0,Te.jsx)(Mu,{videoDuration:i,text:e,trackResultEvent:t,trackHighlightEvent:n,videoState:o,setVideoState:s,isImmersionMode:!0,handleUserInteract:l,userInteracting:c,activeScroll:d})})};var cp=n(26069);const dp=({loadingTextWidth:e,onClickGuideBtn:t})=>{const n=(0,v.B)(),[i,o]=(0,m.useState)(!1),[s,{width:r}]=(0,cp.A)(),a=ci.getModuleClickFrom();(0,m.useEffect)((()=>{var e;e=a,(0,It.z8)(_.Ur.showVideoImmersionGuideTips,{click_from:e})}),[]),(0,m.useEffect)((()=>{setTimeout((()=>{o(!0)}),5e3)}),[]),(0,m.useEffect)((()=>{var e;i&&(e=a,(0,It.z8)(_.Ur.showVideoImmersionGuideIcon,{click_from:e}))}),[i]);const l=(0,Tu.zh)({from:{width:i?r+32:e+32},to:{width:i?40:r+32},config:{duration:300}}),c=(0,Tu.zh)({from:{opacity:0},to:{opacity:1},config:{duration:1500}});return(0,Te.jsx)(Tu.CS.div,{className:J()(Hm,{[$m]:i}),style:l,children:i?(0,Te.jsx)(ct.A,{className:Fm,onClick:()=>{var e;t(),e=a,(0,It.z8)(_.Ur.clickVideoImmersionGuideIcon,{click_from:e,button_name:_._h.immersionGuideIcon})}}):(0,Te.jsxs)(Tu.CS.div,{className:qm,ref:s,style:c,children:[(0,Te.jsx)("div",{children:n("flow_web_ext_youtube_summary_generated")}),(0,Te.jsx)(je.cG,{layout:"vertical",className:zm}),(0,Te.jsx)("div",{onClickCapture:e=>{var n;e.stopPropagation(),t(),n=a,(0,It.z8)(_.Ur.clickVideoImmersionGuideTips,{click_from:n,button_name:_._h.immersionGuideTips})},className:Vm,children:n("flow_web_ext_youtube_summary_view")})]})})},up=(0,m.forwardRef)(((e,t)=>{const n=(0,m.useRef)(null),[i,o]=(0,m.useState)(e),{videoSummaryInfo:s,trackers:{trackResultEvent:r,trackHighlightEvent:a},videoState:l,setVideoState:c,isSummaryAssistantClose:d,setSummaryAssistantClose:u,userInteracting:h,handleUserInteract:p,isImmersionMode:g,defaulTimmersionHighlightExpand:x=!1}=i,{transcript:y,highlightsResult:b,hasNoSubtitles:w,summarizeTriggered:C}=s,A=Boolean(!C&&y&&y.length>0),S=Boolean(s.isHighlightsDone&&b),{isActionLimited:k,limitedActionRecord:E}=(0,wo.cj)((e=>e)),T=(0,Je.Uk)(),[I,j]=(0,m.useState)(w),[N,R]=(0,m.useState)(!1),[M,P]=(0,m.useState)(!1),L=(0,m.useMemo)((()=>Ki()),[]),B=y&&(null==y?void 0:y.length)>0,[D,O]=(0,m.useState)(x),[F]=(0,f.Y)("videoImmersionDisableHosts"),[U]=(0,f.Y)("videoImmersionDisableAll"),{videoId:H,isLoadingDone:z,showImmersionSider:q,setShowImmersionSider:V}=(0,Cn.e)(),[$,W]=(0,m.useState)(!D&&!z);(0,m.useEffect)((()=>{W(!D&&!z)}),[H]);const[K,{width:Y}]=(0,Nm.A)();(0,m.useImperativeHandle)(t,(()=>({updateProps:e=>{o(e)}})),[o]);const[G,Q]=(0,m.useState)(!S&&!$);(0,m.useEffect)((()=>{S&&!$&&setTimeout((()=>{Q(!1)}),800)}),[S]);const Z=(0,m.useMemo)((()=>{var e,t;if(w)return I&&D?(0,Te.jsx)(ip,{setSummaryAssistantClose:()=>j(!1)}):null;if(k("web_video_summary"))return(0,Te.jsx)(Kd,{className:Jm});if(!S||M)return(0,Te.jsx)(op,{loadingTextRef:K,loadingTextWidth:Y,isAutoSummarize:$,disableOptionVisibleChange:P,onDisableOnceClick:()=>V(!1)});if($)return(0,Te.jsx)(dp,{loadingTextWidth:Y,onClickGuideBtn:()=>{W(!1),O(!0)}});const n=(null==y||null===(e=y[(null==y?void 0:y.length)-1])||void 0===e?void 0:e.offset)||0,i=(null==y||null===(t=y[(null==y?void 0:y.length)-1])||void 0===t?void 0:t.duration)||0,o=(0,Te.jsx)(xe.A,{className:Lm,dropdownClassName:np,position:"bottomRight",getPopupContainer:L,disableKey:fe.lf.videoImmersion,onDisableOnceClick:()=>V(!1),show:N,setShow:R,renderChildren:({onTriggerClick:e})=>(0,Te.jsx)("div",{children:(0,Te.jsx)(jc.A,{onClick:t=>{t.preventDefault(),t.stopPropagation(),N?R(!N):e(t)}})})});return(0,Te.jsxs)("div",{className:ep,children:[(0,Te.jsx)("div",{className:tp,children:o}),(0,Te.jsx)(lp,{videoDuration:(n+i)/1e3,text:b,trackResultEvent:r,trackHighlightEvent:a,videoState:l,setVideoState:c,loadingTextWidth:Y,isFirstSummarizing:A,isNeedLoadingAnimation:G,userInteracting:h,handleUserInteract:p,isImmersionMode:g,activeScroll:D&&g})]})}),[S,w,K,Y,u,y,b,r,a,l,c,B,A,G,I,j,D,h,p,$,W,V,N,M,E]),X=(0,m.useCallback)((()=>{lc(D?tc.COLLAPSED:tc.EXPANDED),r(D?_._h.collapsed:_._h.expanded),O(!D)}),[D,O,r,lc]);return!q||U||F.find((e=>e===location.host))||d?null:(0,Te.jsx)(v.C,{t:T,children:(0,Te.jsx)(as.A.Provider,{value:{getPopupContainer:()=>n.current||document.body},children:(0,Te.jsxs)("div",{ref:n,className:J()("cici-ext-container",Mm),children:[(0,Te.jsx)("div",{style:{pointerEvents:"all",transform:D||$?void 0:"translate(110%, 0px)"},children:Z}),S&&!$&&(0,Te.jsx)(ap,{immersionHighlightExpand:D,onToggleExpand:X})]})})})})),hp=up;let mp,pp;const gp=m.createRef();function vp(e,t){if(!e)return;const n=u.m.getInstance().getHostId(),i=document.querySelector(e.getVideoContainerSelector());if(!n||!i)return;const o=`${ae.M0}-${n}`;let s=document.getElementById(o);const a=()=>{var e,t;null===(e=document.getElementById(o))||void 0===e||e.remove(),null===(t=mp)||void 0===t||t.unmount(),s=null,mp=void 0,pp=void 0};var l;if(s)return null===(l=gp.current)||void 0===l||l.updateProps(t),a;s=document.createElement("div"),s.id=o;const c=s.attachShadow({mode:"open"}),d=document.createElement("div");return c.appendChild(d),(0,b.A)(d.style,Eh),i.appendChild(s),(0,et.NR)(c,ae.QN).then((()=>{mp=(0,p.createRoot)(d),pp=m.createElement(hp,(0,r.A)((0,r.A)({ref:gp},t),{},{defaulTimmersionHighlightExpand:ci.getLastEntryFullScreenFrom()===Gl.IMMERSION_BTN})),mp.render(pp)})),(0,u.A)(a),a}const fp=Object.entries(i).map((e=>e[1]));function _p(e){const t=(0,v.B)(),n=(0,m.useMemo)((()=>{var e;return null===(e=fp.map((e=>new e)).filter((e=>e.canPlay())))||void 0===e?void 0:e[0]}),[]);var i,o;i=n,o=e.videoSummaryInfo.hasNoSubtitles,(0,m.useEffect)((()=>{var e,t;if(o||!i)return;const n=e=>{!document.fullscreenElement&&e.key&&("f"===e.key&&rc(Jl.SHORTCUT),ci.updateEntryFullScreenFrom(Gl.IMMERSION_FULLSCREEN_SHORT_CUT))},s=e=>{document.fullscreenElement||(rc(Jl.FULLSCREEN),ci.updateEntryFullScreenFrom(Gl.IMMERSION_FULLSCREEN_BTN))},r=e=>{document.fullscreenElement||(rc(Jl.VIDEO_DB_CLICK),ci.updateEntryFullScreenFrom(Gl.VIDEO_DB_CLICK))};return document.addEventListener("keydown",n,!0),null===(e=document.querySelector(i.getFullScreenBtnSelector()))||void 0===e||e.addEventListener("click",s,!0),null===(t=document.querySelector(i.getVideoElementSelector()))||void 0===t||t.addEventListener("dblclick",r,!0),()=>{var e,t;document.removeEventListener("keydown",n,!0),null===(e=document.querySelector(i.getFullScreenBtnSelector()))||void 0===e||e.removeEventListener("click",s,!0),null===(t=document.querySelector(i.getVideoElementSelector()))||void 0===t||t.removeEventListener("dblclick",r,!0)}}),[o,i]);const s=function(e){const{isImmersionMode:t,videoSummaryInfo:{hasTranscript:n,summarizeTriggered:i,translateLanguage:o},handleSummarizeVideo:s}=e;return(0,m.useCallback)((()=>{_h(t,n,i,o,s)}),[t,n,i,o,s])}(e);(0,m.useEffect)((()=>{if(!n)return;let i;n.clearScreen(),Im(n,t,e);const o=()=>{var o;(Im(n,t,e),document.fullscreenElement)?(e.setImmersionMode(!0),s(),i=vp(n,e)):(e.setImmersionMode(!1),null===(o=i)||void 0===o||o(),i=void 0)};return document.addEventListener("fullscreenchange",o,!0),e.isImmersionMode&&(s(),i=vp(n,e)),()=>{document.removeEventListener("fullscreenchange",o,!0)}}),[e,t,n]),(0,m.useEffect)((()=>{if(n)return n.enterImmersionMode(e),()=>{n.exitImmersionMode()}}),[n,e])}const xp=({videoSummaryId:e,videoTitle:t})=>{const n=(0,An.P)((e=>e.messages)),{text:i=""}=n[e]||{},o=()=>({summary_message_id:i?e:""});return{trackResultEvent:(e,n,i)=>{var s;s=(0,r.A)((0,r.A)({},o()),{},{button_name:e,is_immersion:n,show_from:i,content_title:t,content_duration:_i(Ni())}),(0,It.z8)(_.Ur.clickVideoAssistantSummarizeResult,s)},trackHighlightEvent:(e,t,n,i)=>{sc(e,(0,r.A)((0,r.A)({},o()),{},{video_time:t,position:n,is_immersion:i?1:0,content_type:"video"}))},trackShareEvent:(e,t)=>{var n;n=(0,r.A)((0,r.A)({},o()),{},{click_from:e,range:t}),(0,It.z8)(_.Ur.share,n)},trackCopyEvent:()=>{var e;e=(0,r.A)({},o()),Pt((0,r.A)((0,r.A)({},e),{},{click_from:_.Z5.videoAssistant}))},trackContinueInChatEvent:()=>{var e;e=(0,r.A)({},o()),Lt((0,r.A)((0,r.A)({},e),{},{click_from:_.Z5.videoAssistant}))}}};function yp({videoParamId:e,videoTitle:t}){const[n,i]=function(){const[e,t]=(0,m.useState)(ci.isImmersionMode());return[e,(0,m.useCallback)((e=>{ci.setImmersionMode(e),t(e)}),[t])]}(),[o,s]=(0,m.useState)(!1),[r,l]=(0,m.useState)(void 0),[c,d]=(0,m.useState)(""),u=(0,An.P)((e=>e.messages)),{videoSummaryInfo:h,contentVisible:p,noContent:g,hasNoSubtitles:f,hasShowedUserGuidance:x,isLoginBilibili:y,controlller:{setMediaCardTranslateLanguage:b,handleSummarizeVideo:w},isMessageUnAuthorized:C,isContentOnRisk:A,videoListInfo:S,isLoading:k}=fh({videoParamId:e,videoTitle:t,isImmersionMode:n}),{isAllDone:E,videoSummaryId:T,translateLanguage:I,transcript:j,isTranscriptLoaded:N,summarizeTriggered:R,hasTranscript:M,summaryResult:P,highlightsResult:L}=h,{isActionLimited:B}=(0,wo.cj)((e=>e)),D=!B("web_video_summary"),{trackResultEvent:O,trackHighlightEvent:F,trackShareEvent:U,trackCopyEvent:H,trackContinueInChatEvent:z}=xp({videoSummaryId:T,videoTitle:t}),q=e=>{O(e,n,r||ci.getLastClickRelayBtnType())},V=(0,m.useCallback)(function(){var e=(0,a.A)((function*(e){void 0===r&&l(e.clickFrom),yield w(e)}));return function(t){return e.apply(this,arguments)}}(),[w,r,l]),[$,W]=(0,m.useState)(!1),[K,Y]=(0,m.useState)({currentActiveBreakdownIndex:-1,currentActiveBulletPointIndex:-1,progress:0}),[G,Q]=(0,m.useState)(!1),Z=(0,m.useRef)(),X=()=>{Q(!0),clearTimeout(Z.current),Z.current=setTimeout((()=>{Q(!1)}),1e4)};(0,m.useEffect)((()=>{G||clearTimeout(Z.current)}),[G]);_p((0,m.useMemo)((()=>({videoState:K,setVideoState:Y,handleSummarizeVideo:V,isSummaryAssistantClose:$,setSummaryAssistantClose:W,userInteracting:G,handleUserInteract:X,isImmersionMode:n,setImmersionMode:i,isMessageUnAuthorized:C,videoSummaryInfo:h,trackers:{trackResultEvent:q,trackHighlightEvent:F}})),[q,F,K,Y,V,$,W,G,X,n,i,C,h])),function(){if(!(0,Wr.tY)())return;const e=(0,m.useMemo)((()=>new MutationObserver((function(e){document.querySelectorAll("ytd-item-section-renderer").forEach((e=>{e.removeEventListener("click",oh,!0),e.addEventListener("click",oh,!0)}))}))),[]);(0,m.useEffect)((()=>{const t=document.querySelector("ytd-watch-next-secondary-results-renderer #contents");if(t)return e.observe(t,{childList:!0,subtree:!0}),()=>{e.disconnect()}}),[e]),(0,m.useEffect)((()=>{const e=document.querySelector(".ytp-next-button");if(e)return e.addEventListener("click",ih,!0),()=>{e.removeEventListener("click",ih,!0)}}),[]),(0,m.useEffect)((()=>{var e,t;return null===(e=document.querySelector(".ytp-autonav-endscreen-countdown-overlay"))||void 0===e||e.addEventListener("click",sh,!0),null===(t=document.querySelector(".html5-endscreen"))||void 0===t||t.addEventListener("click",sh,!0),()=>{var e,t;null===(e=document.querySelector(".ytp-autonav-endscreen-countdown-overlay"))||void 0===e||e.removeEventListener("click",sh,!0),null===(t=document.querySelector(".html5-endscreen"))||void 0===t||t.removeEventListener("click",sh,!0)}}),[])}(),(0,Wr.id)()&&((0,m.useEffect)((()=>{ci.resetClickRelayBtnType()}),[]),(0,m.useEffect)((()=>{var e,t;return null===(e=document.querySelector(".bpx-player-ctrl-next"))||void 0===e||e.addEventListener("click",ih,!0),null===(t=document.querySelector(".bpx-player-ctrl-prev"))||void 0===t||t.addEventListener("click",ih,!0),()=>{var e,t;null===(e=document.querySelector(".bpx-player-ctrl-prev"))||void 0===e||e.removeEventListener("click",ih,!0),null===(t=document.querySelector(".bpx-player-ctrl-next"))||void 0===t||t.removeEventListener("click",ih,!0)}}),[]),(0,m.useEffect)((()=>{const e=document.querySelector(".right-container");if(e)return e.addEventListener("click",oh,!0),()=>{e.removeEventListener("click",oh,!0)}}),[]),(0,m.useEffect)((()=>{const e=document.querySelector(".bpx-player-ending-panel");if(e)return e.addEventListener("click",sh,!0),()=>{e.removeEventListener("click",sh,!0)}}),[]));const ee=f?{customEnableTabs:[uc.summary,uc.memo]}:void 0,{activeTab:te,renderTab:ne,setActiveTab:ie,videoSetting:oe}=(e=>{const{customEnableTabs:t,videoTitle:n,defaultMediaTab:i,onActiveTabChange:o}=e||{},s=(0,Je.Uk)(),r=(0,As.A)("video_assistant"),[a,l]=(0,m.useState)(i||uc.summary),c=(0,m.useMemo)((()=>{const e=e=>!t||!!t.find((t=>t===e));return[{itemKey:uc.summary,itemTitle:s("flow_web_ext_youtube_summary"),enable:e(uc.summary)},{itemKey:uc.mindmap,itemTitle:s("flow_web_ext_search_mindmap"),enable:r.mindmap_show&&e(uc.mindmap)},{itemKey:uc.memo,itemTitle:s("flow_web_ext_youtube_notes"),enable:(0,ot.ku)()&&e(uc.memo)}]}),[r,t]),d=(0,m.useCallback)((()=>{const e=c.filter((e=>e.enable));return e.length<=1?(0,Te.jsx)(Te.Fragment,{}):(0,Te.jsx)(Yl,{webpageTabs:e,activeKey:a,onChange:e=>{let t;e===uc.memo?t=nc.note:e===uc.summary?t=nc.summary:e===uc.mindmap&&(t=nc.toMindMap),t&&oc({click_from:Gl.UPPER_RIGHT,button_name:t,content_title:n||"",content_duration:_i(Ni())}),l(e),null==o||o(e)}})}),[a,c]);return{activeTab:a,renderTab:d,setActiveTab:l,videoSetting:r}})({customEnableTabs:null==ee?void 0:ee.customEnableTabs,videoTitle:t}),[se,re]=(0,m.useState)(!1),ae=function(e,t,n,i,o){const s=e||t,[r,a]=(0,m.useState)(!1),l=(0,m.useRef)((0,Wr.Z)());(0,m.useEffect)((()=>{const e=()=>{r||(i(uc.memo),a(!0))};return pn.A.on("video-memo-updated",e),()=>{pn.A.off("video-memo-updated",e)}}),[i,r]);const c=s||r;return(0,m.useEffect)((()=>{e||!r||t||n!==uc.summary||o({clickFrom:l.current?hc.K.ONBOARDING:hc.K.UPPER_RIGHT})}),[n,o,e,r]),c}(R,f,te,ie,V),le=(0,m.useCallback)((()=>se?(0,Te.jsx)(ea.c,{type:"ai-secondary",icon:(0,Te.jsx)(ta.A,{}),size:"medium",className:J()(Cl.expandContainer),onClick:()=>re(!1),children:me("flow_web_ext_video_summary_unfold")}):(0,Te.jsxs)("div",{className:J()(Cl.collpaseContainer),children:[(0,Te.jsx)("div",{children:ne()}),(0,Te.jsx)("div",{className:J()(Cl.iconContainer),onClick:()=>re(!0),children:(0,Te.jsx)(Qo.A,{className:J()(Cl.chevronUpIcon)})})]})),[ne,se]),ce=(0,m.useMemo)((()=>(0,xi.jB)("youtube")?document.querySelector(".video-stream"):document.querySelector("video")),[]),de=(0,m.useRef)(null),ue=D&&p&&E&&!g&&te===uc.summary&&!A,he=(0,m.useMemo)((()=>_i(Ni())),[]),me=(0,v.B)(),pe=Mi(),ge=oe.subtitle_search_enabled&&D&&E&&j&&!se&&j.length>0,ve=function(){let e="0px";return e=(0,xi.jB)("bilibili")?"198px":"110px",`calc(100vh - ${e})`}(),fe=(0,m.useCallback)(((e,t)=>{dc(t),ce&&(ce.currentTime=e.offset/1e3,ce.play())}),[ce]);return(0,Te.jsx)(Bd.Provider,{value:{meta:{title:t,duration:he}},children:(0,Te.jsxs)("div",{className:J()(Cl.videoSummaryAssistantContainer,{[Cl.closeAssistant]:$}),ref:de,"data-testid":"video-assistant-container",style:{maxHeight:ve,paddingBottom:se?"10px":void 0},children:[!$&&(0,Te.jsx)(xe.A,{className:J()(Cl.area),show:o,optionPageSection:"video-summary",setShow:s,position:"bottomRight",disableKey:os.lf.videoSummary,getPopupContainer:()=>de.current,getPopupRootContainer:rr._0,onDisableOnceClick:()=>{W(!0)},children:(0,Te.jsx)("div",{className:Cl.closeIcon,"data-testid":"video-assistant-close-btn",onPointerDown:()=>s(!0),children:(0,Te.jsx)(Pe.gz,{className:Cl.icon})})}),(0,Te.jsx)(su,{available:D,contentVisible:p,popContainerRef:de,isAllDone:!!E&&!se,renderActionBtnTabs:ae?le:void 0,noContent:!!g,hasTranscript:!!M&&!pe,isTranscriptLoaded:N,summarizeTriggered:ae,hideToolBtns:A,translateLanguage:I,showSearch:ge,searchTooltip:me("flow_web_ext_subtitle_search_video"),onSearch:e=>d(e),onTranslateLanguage:e=>{b(e),V({translateLang:e,clickFrom:Gl.UPPER_RIGHT}),oc({click_from:Gl.UPPER_RIGHT,button_name:nc.language,content_title:t,content_duration:he})},onSummarizeVideo:({clickFrom:e,translateLang:t})=>V({clickFrom:e,translateLang:t}),onClickLogin:()=>{const e=(0,xi.jB)("youtube");(0,_e.DT)({trackMeta:{previous_page:e?"youtube":"bilibili",login_entrance:e?"youtube":"bilibili"}})},trackResultEvent:q},te),ge&&c&&!se&&(0,Te.jsx)(Cc,{subtitles:j,query:c,onVisible:cc,onItemClick:fe}),!se&&(0,Te.jsxs)("div",{className:Cl.tabContainer,style:{display:ge&&c?"none":"flex"},children:[(0,Te.jsxs)(je.tU,{activeKey:te,renderTabBar:()=>null,className:Cl["main-tabs"],children:[(0,Te.jsx)(je.mF,{itemKey:uc.summary,children:(0,Te.jsx)(Zu,{available:D,hasNoSubtitles:f,hasShowedUserGuidance:x,noContent:!!g,contentVisible:p,videoSummaryId:T,paymentContent:pe,onRetry:()=>V({translateLang:I,clickFrom:Gl.UPPER_RIGHT}),isSummaryDone:!k.isSummaryLoading,isHighlightsDone:!k.isHighlightsLoading,transcript:j,highlightsResult:L,trackResultEvent:q,trackHighlightEvent:(e,n,i,o)=>{e===_.Ur.clickVideoAssistantHighlightsTimeline&&oc({click_from:Gl.UPPER_RIGHT,button_name:nc.clickHighlight,content_title:t,content_duration:_i(Ni())}),F(e,n,i,o)},videoState:K,setVideoState:Y,handleUserInteract:X,userInteracting:G,isImmersionMode:n,isNotLoginBilibili:!y&&(0,xi.jB)("bilibili"),isContentOnRisk:A,videoListInfo:S,summarizeLanguage:I})}),(0,Te.jsx)(je.mF,{itemKey:uc.mindmap,children:(0,Te.jsx)(nh,{isActive:te===uc.mindmap,getPopupContainer:()=>de.current,transcript_list:j,translateLanguage:I})}),(0,Te.jsx)(je.mF,{itemKey:uc.memo,children:(0,Te.jsx)(Fl,{})})]}),ue&&(0,Te.jsx)(_u,{onClickContinueInChat:()=>{oc({click_from:Gl.UPPER_RIGHT,button_name:nc.continueToChat,content_title:t,content_duration:he}),z()},popContainerRef:de,onCopy:()=>{oc({click_from:Gl.UPPER_RIGHT,button_name:nc.copy,content_title:t,content_duration:he}),H()},onClickAudio:()=>{oc({click_from:Gl.UPPER_RIGHT,button_name:nc.read,content_title:t,content_duration:he})},summaryResult:P,highlightResult:L,transcript:j,videoSummaryId:T,shareSlot:(0,Te.jsx)(Fd,{videoId:e,currentPlayingClip:K.currentActiveBreakdownIndex,summaryResult:P,highlightResult:wi(L),trackShareEvent:(e,n)=>{oc({click_from:Gl.UPPER_RIGHT,button_name:nc.share,content_title:t,content_duration:_i(Ni())}),U(e,n)}}),collectionData:{getCollectionParam:(ye=(0,a.A)((function*(){var n;const i=(0,xi.jB)("bilibili");let o=window.location.href;return i&&(o=yield(0,di.Z)(e)),{collectFrom:zt.vP.video_page_summarize,collectionType:nn.e.VideoSummary,videoSummaryResult:{summary:P,summary_msg_id:(null===(n=u[T])||void 0===n||null===(n=n.body)||void 0===n||null===(n=n.message)||void 0===n?void 0:n.message_id)||"",videoParams:{video_type:i?"bilibili":"youtube",video_url:o,title:t,timeline:wi(L)||[],cover_url:i?Si():ki(e),transcript:j?JSON.stringify(j):"",video_duration:Ni()}}}})),function(){return ye.apply(this,arguments)}),click_from:zt.vP.video_page_summarize,collect_type:zt.p6.videosummary,enableRepeatCollect:!0}})]})]})});var ye}const bp=m.memo(yp);const wp=[new class{constructor(){(0,y.A)(this,"updateMenuRenderer",(0,Is.A)((()=>{const e=document.querySelector("#actions #menu ytd-menu-renderer");e&&(e.style.display="none",setTimeout((()=>e.style.display="flex"),200))}),1e3))}getMemoBtnStyle(){return document.fullscreenElement?{height:"21px"}:{background:"rgba(242, 242, 242, 1)",color:"var(--s-color-text-intact-primary, rgba(0, 0, 0, 1))",height:"20px",borderRadius:"24px",padding:"8px 12px",fontSize:"20px"}}getMemoBtnTextStyle(){return document.fullscreenElement?{}:{fontSize:"14px",lineHeight:"20px",fontWeight:"500"}}getMemoBtnIconStyle(){return document.fullscreenElement?{}:{fontSize:"20px",width:"20px",height:"20px"}}configMemoBtn(e){let t="width: fit-content;";document.fullscreenElement||(t+="height: 36px;"),e.style.cssText=t,e.classList.add("ytp-button"),e.dataset.memoId=u.m.getInstance().getHostId(),this.updateMenuRenderer()}getSiteHost(){return"youtube"}getVideoControlContainer(){return document.fullscreenElement?document.querySelector("div.ytp-chrome-controls div.ytp-right-controls"):document.querySelector("#actions-inner ytd-menu-renderer")}enterFullScreen(){const e=this.getVideoControlContainer();if(!e)return;const t=document.querySelector(`[data-memo-id='${u.m.getInstance().getHostId()}']`);t&&(t.style.height="",e.prepend(t))}exitFullScreen(){const e=this.getVideoControlContainer(),t=`${ae.tm}${u.m.getInstance().getHostId()}`,n=e.querySelector(`[id='${t}']`),i=document.querySelector(`[data-memo-id='${u.m.getInstance().getHostId()}']`);i&&(n?e.insertBefore(i,n.nextSibling):e.prepend(i))}}];let Cp;function Ap(){if(void 0!==Cp)return Cp;const{hostname:e}=location,t=wp.map((t=>{if(new RegExp(t.getSiteHost()).test(e))return t})).filter((e=>e));return Cp=(null==t?void 0:t[0])||null,Cp}const Sp="memoContainer-fXLFwH",kp="memoBtn-NBfIwK",Ep="memoBtnContent-WgPZu9",Tp="btnTxt-oOIJ5w",Ip=({onClick:e,btnContentStyle:t,textStyle:n,iconStyle:i={},iconMode:o,getPopupContainer:s})=>{const a=(0,Je.Uk)(),l=(0,m.useRef)(null);(0,m.useEffect)((()=>{if(!l.current)return;const e=(0,r.A)({display:"inline-block"},i);Object.assign(l.current.style,e)}),[l,i,o]);const c=()=>(0,Te.jsx)("div",{className:Sp,children:(0,Te.jsx)("button",{className:kp,onClick:e,children:(0,Te.jsxs)("div",{className:Ep,style:t,children:[(0,Te.jsx)(oa,{ref:l}),!o&&(0,Te.jsx)("span",{className:Tp,style:n,children:a("flow_web_ext_youtube_take_notes")})]})})});return o?(0,Te.jsx)(je.m_,{content:o?a("flow_web_ext_youtube_take_notes"):void 0,getPopupContainer:s,position:"top",style:{marginLeft:"15px"},children:c()}):c()},jp=()=>{var e,t,n;const i=(0,m.useMemo)((()=>Ki()),[]),[o,s]=(0,m.useState)(""),[r,a]=(0,m.useState)(!1),[l,c]=(0,m.useState)(!1),[d,u]=(0,m.useState)({}),[h,p]=(0,m.useState)({}),[g,v]=(0,m.useState)({}),[_,x]=(0,m.useState)(null===(e=Ap())||void 0===e||null===(t=e.isWideMode)||void 0===t?void 0:t.call(e)),y=wl(bl.toolbar,(()=>a(!1))),[b,w]=(0,m.useState)("bottom"),C=(0,m.useRef)(null),[A,S]=(0,m.useState)(""),k=(0,m.useRef)(null),E=wh(),{getMediaCurrentTime:I,getMediaDuration:j,tracker:N={}}=ca()||{},{reportTakeNotePadShow:R,reportTakeNotePadClick:M,reportTakeNoteShow:P,reportTakeNoteBtnClick:L}=N;(0,m.useEffect)((()=>null==P?void 0:P("toolbar")),[P]),(0,m.useEffect)((()=>{a(!1);const e=(null==j?void 0:j())||0;c(e>=3600);const t=()=>{(()=>{var e,t,n;const i=Ap();u((null==i||null===(e=i.getMemoBtnStyle)||void 0===e?void 0:e.call(i))||{}),p((null==i||null===(t=i.getMemoBtnTextStyle)||void 0===t?void 0:t.call(i))||{}),v((null==i||null===(n=i.getMemoBtnIconStyle)||void 0===n?void 0:n.call(i))||{})})();const e=Ap();var t,n;document.fullscreenElement?null==e||null===(t=e.enterFullScreen)||void 0===t||t.call(e):null==e||null===(n=e.exitFullScreen)||void 0===n||n.call(e)},n=(0,T.A)((()=>{var e,t;const n=null===(e=Ap())||void 0===e||null===(t=e.isWideMode)||void 0===t?void 0:t.call(e);if(Boolean(_)!==Boolean(n)){var i;const e=Ap();x(Boolean(n)),null==e||null===(i=e.wideModeChange)||void 0===i||i.call(e,Boolean(n))}}),1e3);t(),document.addEventListener("fullscreenchange",t);const i=new ResizeObserver(n);return i.observe(document.body),()=>{document.removeEventListener("fullscreenchange",t),i.disconnect()}}),[_]),(0,m.useEffect)((()=>()=>{a(!1)}),[]),(0,m.useEffect)((()=>{if(C.current){const e=C.current.getBoundingClientRect().bottom+180>document.documentElement.clientHeight;S((0,sr.A)()),w(e?"top":"bottom")}}),[C,r]);const B=null===(n=k.current)||void 0===n?void 0:n.getVideoSnapshot(),D=(0,m.useMemo)((()=>{var e;return(null===(e=k.current)||void 0===e||null===(e=e.getVideoSnapshot())||void 0===e?void 0:e.currentTime)||(null==I?void 0:I())||0}),[B]),O=(0,m.useCallback)((()=>null==R?void 0:R("toolbar")),[R]),[F]=(0,f.Y)("authInfo"),U=(0,m.useCallback)((e=>{s(e),F.isAuthenticated||(0,_e.DT)({trackMeta:{previous_page:"web",login_entrance:"web"}})}),[F]),H=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;return(0,Te.jsx)(je.AM,{position:b,rePosKey:A,spacing:15,content:(0,Te.jsx)(La,{ref:k,darkPanel:Boolean(document.fullscreenElement)||H,onTextInput:U,disableOkBtn:0===o.trim().length,onCancel:()=>{null==M||M("toolbar","cancel"),a(!1)},onEscape:()=>a(!1),editPadShow:O,onConfirm:()=>(null==M||M("toolbar","save"),y(o,D,(null==B?void 0:B.snapshot)||new Blob)),timeLabel:fi(`${Math.ceil(D)}`,l)}),trigger:"custom",visible:r,getPopupContainer:i,className:Ia,children:(0,Te.jsx)("div",{ref:C,children:(0,Te.jsx)(Ip,{btnContentStyle:d,textStyle:h,iconStyle:g,iconMode:E,getPopupContainer:i,onClick:()=>{null==L||L(),a(!r)}})})})},Np=()=>{const e=Dl();return(0,Te.jsx)(la.Provider,{value:e,children:(0,Te.jsx)(jp,{})})};function Rp(){const[e]=(0,f.Y)("videoMemoDisableAll");(0,m.useEffect)((()=>{if(!(0,ot.ku)())return;if(e)return;const t=Ap();if(!t)return;let n;return(0,rr.NZ)((()=>t.getVideoControlContainer())).then((e=>{e&&(n=function(e){if(!e)return;const t=Ap();if(!t)return;const n=u.m.getInstance().getHostId(),i=`${ae.tI}${n}`,o=document.createElement("div");o.id=i,t.configMemoBtn(o);const s=`${ae.tm}${n}`,r=e.querySelector(`[id='${s}']`);r?e.insertBefore(o,r.nextSibling):e.prepend(o);const a=o.attachShadow({mode:"open"});let l;return(0,et.NR)(a,ae.QN).then((()=>{l=(0,p.createRoot)(a),l.render(m.createElement(Np))})),()=>{var e,t;null===(e=document.getElementById(`${i}`))||void 0===e||e.remove(),null===(t=l)||void 0===t||t.unmount(),l=void 0}}(e))})),()=>{var e;null===(e=n)||void 0===e||e()}}),[e])}const Mp=()=>{const{videoId:e,title:t,partId:n}=(0,Cn.e)(),{isAuthenticated:i}=(0,f.Y)("authInfo")[0]||{},[o]=(0,f.Y)("videoSummaryDisableHosts"),[s]=(0,f.Y)("videoSummaryDisableAll"),r=o.includes(window.location.host)||s;return Rp(),e?(0,Te.jsx)("div",{className:"cici-ext-always-light semi-always-light",children:e&&!r&&(0,Te.jsx)(bp,{videoParamId:e,videoTitle:t},e)},`${e}${n}-${i?1:0}`):null};var Pp=n(70798);const Lp=()=>{(0,Kr.Mz)(Kr.FM.searchCardAutoSummary,!0)||(0,se.vE)("searchUsageTimesInfo",{lastUseTime:Date.now(),usageTimes:0})},Bp="searchAssistantContainer-dCwn7m",Dp="header-YtilIR",Op="headerName-k4Ij57",Fp="controls-If21mO",Up="isSearchIdEmpty-XXguxl",Hp="footer-KEZpq4",zp="buttonGroup-OCyzPQ",qp="content-DWiwJ2",Vp="content-loading-auKMT6",$p="content-collapse-IB4d3g",Wp="content-expand-button-c1o1xs",Kp="closeIcon-SQi8TC",Yp="loginButton-QV9e95",Gp="suggest-message-list-wrapper-VsKrvI",Qp="suggest-message-title-Kd6i2s",Zp="suggest-message-title-icon-_VDoIY",Xp="suggest-message-title-deep-FqjPXb",Jp="suggest-message-container-oneLine-qJavRT",eg="suggest-message-iywAli",tg="fadeIn-dVad2K";var ng=n(29428);const ig=({type:e,text:t,onClick:n,getPopupContainer:i})=>"icon"===e?(0,Te.jsx)(je.m_,{getPopupContainer:i,content:t,spacing:{y:10,x:0},children:(0,Te.jsx)(ea.c,{type:"tertiary",icon:(0,Te.jsx)(ng.A,{}),size:"small",onClick:n})}):(0,Te.jsx)(ea.c,{type:"tertiary",icon:(0,Te.jsx)(ng.A,{}),size:"small",onClick:n,children:t});var og=n(34870),sg=n(45498);const rg={searchList:[],isDeepSearchMode:!1},ag=(0,sg.vt)()((0,og.eh)((e=>(0,r.A)((0,r.A)({},rg),{},{addSearch:t=>e((e=>({searchList:[...e.searchList,t]}))),replaceSearch:(t,n)=>e((e=>({searchList:e.searchList.map(((e,i)=>i===n?t:e))}))),resetSearch:t=>e((()=>({searchList:[t]}))),clearSearch:()=>e((()=>({searchList:[]}))),setDeepSearchMode:t=>e((()=>({isDeepSearchMode:t})))})))),lg=({hasDeepSearchEntry:e,isFeatureAvailable:t,query:n,searchId:i,popContainerRef:o,triggerCollection:s=!1,onOpenShareCard:r})=>{var a;const l=null===(a=(0,m.useContext)(on.mn))||void 0===a?void 0:a.engine,c=(0,v.B)(),d=(0,An.P)((e=>e.sendMessage)),u=(0,An.P)((e=>e.messages)),{text:h="",body:p,isDone:g}=u[i]||{},f=e&&t&&g,{searchList:x,resetSearch:y,setDeepSearchMode:b}=ag((e=>({searchList:e.searchList,resetSearch:e.resetSearch,setDeepSearchMode:e.setDeepSearchMode}))),{collectionIcon:w,onCollectionClick:C,collected:A,collectionId:S}=Bs({getCollectionParam:()=>{var e;return{collectFrom:zt.vP.search_result_card,collectionType:wn.X.SearchResult,messageId:null==p||null===(e=p.message)||void 0===e?void 0:e.message_id,localMessageId:i,userInput:n}},click_from:zt.vP.search_result_card,collect_type:zt.p6.searchresult}),{onCopyClick:k,onMouseEnter:E,onMouseLeave:T,checked:I}=vu((()=>{var e;Gt()(h),(({message_id:e})=>{Pt({message_id:e,click_from:_.Z5.searchAssistant})})({message_id:null==p||null===(e=p.message)||void 0===e?void 0:e.message_id})})),j=I?hu.A:Rc.A;(0,m.useEffect)((()=>{s&&C()}),[s]);const N=()=>{var e;null!==(e=(0,se.TK)("authInfo"))&&void 0!==e&&e.isAuthenticated?(Lp(),ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),To(n,{enterMethod:_.cz.searchAssistant}),Xr({search_engine_name:null==l?void 0:l.name,button_name:"continue_in_chat",whether_full_screen:0})):(0,_e.DT)({trackMeta:{previous_page:"search_engine",login_entrance:"search_result_card"}})};return(0,Te.jsxs)("div",{className:Hp,children:[(0,Te.jsx)("div",{className:zp,children:f?(0,Te.jsx)(ea.c,{type:"ai-primary",icon:(0,Te.jsx)(Pp.A,{}),size:"small",onClick:()=>{if(Lp(),!x.length){const e=(0,kn.wz)((0,se.TK)("uiLanguage")),t={skill_id:"8",skill_type:8},i=d({text:n,prompt:so.EU.input_skill,answerWithSuggest:!0,current_page:"search_engine",scene:"search_engine",sec_scene:"deep_search_mode",input_skill:JSON.stringify(t),replyLang:e});y({searchId:i,searchQuery:n})}b(!0),(({search_id:e,click_from:t})=>{(0,It.z8)(_.Ur.clickDeepSearchBtn,{current_page:"search_engine",search_engine_name:"google",search_id:e,click_from:t})})({search_id:i,click_from:"search_result_card"})},"data-testid":"search-assistant-deep-btn",children:c("flow_web_ext_search_deepinsearch")}):(0,Te.jsx)(ig,{getPopupContainer:()=>o.current,type:"normal",text:c("flow_web_ext_action_translate_chat"),onClick:N})}),(0,Te.jsxs)("div",{className:zp,children:[f&&(0,Te.jsx)(ig,{getPopupContainer:()=>o.current,type:"icon",text:c("flow_web_ext_action_translate_chat"),onClick:N}),(0,Te.jsx)(fu.T,{text:h,style:{fontSize:16},getPopupContainer:()=>o.current,onClick:()=>{Xr({search_engine_name:null==l?void 0:l.name,button_name:"read",whether_full_screen:0})}}),(0,Te.jsx)(je.m_,{content:c("flow_web_ext_search_share"),getPopupContainer:()=>o.current,spacing:{y:10,x:0},children:(0,Te.jsx)(ea.c,{"data-testid":"search-share-image-btn",type:"tertiary",icon:(0,Te.jsx)(xd.A,{}),size:"small",onClick:()=>{r(),Lp()}})}),(0,ot.ku)()&&(0,Te.jsx)(je.m_,{content:(0,Te.jsx)(Hs,{collected:A,savedId:S,collectType:zt.p6.searchresult,clickFrom:zt.vP.search_result_card}),getPopupContainer:()=>o.current,spacing:{y:10,x:0},children:(0,Te.jsx)(ea.c,{type:"tertiary",icon:w,size:"small",onClick:()=>{C(),Lp(),Xr({search_engine_name:null==l?void 0:l.name,button_name:"collect",whether_full_screen:0})}})}),(0,Te.jsx)(je.m_,{content:c("message_long_press_copy"),getPopupContainer:()=>o.current,spacing:{y:10,x:0},children:(0,Te.jsx)(ea.c,{type:"tertiary",icon:(0,Te.jsx)(j,{}),size:"small",onMouseEnter:E,onMouseLeave:T,onClick:()=>{k(),Lp(),Xr({search_engine_name:null==l?void 0:l.name,button_name:"copy",whether_full_screen:0})},"data-testid":"search-assistant-copy-btn"})})]})]})};var cg=n(28152),dg=n(51820);const ug={"card-list":"card-list-T40dCM",cardList:"card-list-T40dCM","carousel-item":"carousel-item-fmD69A",carouselItem:"carousel-item-fmD69A","carousel-arrow-left":"carousel-arrow-left-qE_12K",carouselArrowLeft:"carousel-arrow-left-qE_12K","carousel-arrow-right":"carousel-arrow-right-NfduEb",carouselArrowRight:"carousel-arrow-right-NfduEb","s-card":"s-card-Ry_oF_",sCard:"s-card-Ry_oF_","s-card-content":"s-card-content-EmaR4e",sCardContent:"s-card-content-EmaR4e","s-card-content-header":"s-card-content-header-X5hOTw",sCardContentHeader:"s-card-content-header-X5hOTw","s-card-content-header-title":"s-card-content-header-title-Dtywnn",sCardContentHeaderTitle:"s-card-content-header-title-Dtywnn","s-card-content-header-image":"s-card-content-header-image-iO_N5N",sCardContentHeaderImage:"s-card-content-header-image-iO_N5N","s-card-content-footer":"s-card-content-footer-igTo1M",sCardContentFooter:"s-card-content-footer-igTo1M","s-card-content-footer-icon":"s-card-content-footer-icon-hEdS21",sCardContentFooterIcon:"s-card-content-footer-icon-hEdS21","s-card-content-footer-site-name":"s-card-content-footer-site-name-oTEVSY",sCardContentFooterSiteName:"s-card-content-footer-site-name-oTEVSY","s-card-content-footer-card-index":"s-card-content-footer-card-index-tVOMLm",sCardContentFooterCardIndex:"s-card-content-footer-card-index-tVOMLm"},hg=e=>{const{source:t,className:n,index:i}=e;return(0,Te.jsx)("a",{className:J()(n,ug["s-card"]),href:t.url,target:"_blank",rel:"noreferrer noopener",onClick:()=>{},children:(0,Te.jsxs)("div",{className:ug["s-card-content"],children:[(0,Te.jsxs)("div",{className:ug["s-card-content-header"],children:[(0,Te.jsx)("div",{className:ug["s-card-content-header-title"],children:t.title}),t.image_url?(0,Te.jsx)("img",{className:ug["s-card-content-header-image"],src:t.image_url}):null]}),(0,Te.jsxs)("div",{className:ug["s-card-content-footer"],children:[t.logo_url?(0,Te.jsx)("img",{className:ug["s-card-content-footer-icon"],src:t.logo_url}):(0,Te.jsx)(fd.A,{className:J()(ug["search-source-shortcuts-img-icon"],"!ml-0 text-12 text-gray-500 bg-[rgba(0,0,0,0.05)] flex justify-center items-center")}),(0,Te.jsx)("span",{className:ug["s-card-content-footer-site-name"],children:`${t.site_name}`}),(0,Te.jsx)("div",{className:ug["s-card-content-footer-card-index"],children:i})]})]})})},mg=({sources:e=[]})=>(0,Te.jsx)("div",{className:ug["card-list"],children:(0,Te.jsx)(dg.F,{rows:1,scrollStep:.9,itemClassName:ug["carousel-item"],leftArrowClassName:ug["carousel-arrow-left"],rightArrowClassName:ug["carousel-arrow-right"],children:e.map(((e,t)=>(0,Te.jsx)(hg,{source:e,index:t+1},t)))})});var pg=n(63075);const gg="step-container-j3lpCB",vg="step-head-JUpUMG",fg="clickable-Cqyhd0",_g="left-iLZ7Z1",xg="prefix-OsiZ7n",yg="children-a0klQZ",bg=e=>{const{className:t,children:n,title:i,right:o,onClick:s}=e;return(0,Te.jsxs)("div",{className:J()(gg,t),children:[(0,Te.jsxs)("div",{className:J()(vg,{[fg]:Boolean(s)}),onClick:s,children:[(0,Te.jsxs)("div",{className:_g,children:[(0,Te.jsx)("span",{className:xg,children:(0,Te.jsx)(pg.A,{})}),(0,Te.jsx)("span",{children:i})]}),o]}),n?(0,Te.jsx)("div",{className:yg,children:n}):null]})},wg=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:12,height:12,fill:"none",viewBox:"0 0 12 12"},e),{},{children:(0,Te.jsx)("path",{fill:"#000",fillOpacity:.3,d:"M6.262 4.477q.315.066.547.187.234.12.394.285.492.488.656 1.082.165.59 0 1.184-.163.59-.652 1.078L5.832 9.668a2.43 2.43 0 0 1-1.074.648q-.59.165-1.184 0-.59-.16-1.082-.656a2.43 2.43 0 0 1-.656-1.082q-.165-.594 0-1.183t.652-1.079L3.59 5.223q-.066.254-.035.53.03.274.132.509l-.597.597a1.63 1.63 0 0 0-.434.711q-.105.387.004.778.11.39.434.714.32.325.71.43.391.106.778-.004.387-.105.711-.425L6.605 7.75q.325-.321.43-.707.106-.39-.004-.781a1.6 1.6 0 0 0-.43-.715 1.4 1.4 0 0 0-.417-.274 1.9 1.9 0 0 0-.57-.144zm-.528 3.347a2 2 0 0 1-.55-.18 1.6 1.6 0 0 1-.391-.289 2.46 2.46 0 0 1-.656-1.082q-.165-.593 0-1.183t.652-1.078L6.16 2.64a2.44 2.44 0 0 1 1.078-.653q.59-.165 1.18 0 .595.16 1.09.657.488.492.652 1.085.165.59 0 1.18-.164.59-.648 1.074L8.406 7.082q.067-.255.035-.527a1.8 1.8 0 0 0-.132-.512l.597-.598q.324-.32.43-.707.105-.39-.004-.777a1.6 1.6 0 0 0-.43-.715 1.6 1.6 0 0 0-.71-.43 1.4 1.4 0 0 0-.778 0q-.387.106-.71.426L5.39 4.555a1.63 1.63 0 0 0-.434.71q-.105.387.004.778.109.387.434.715.17.168.418.277.246.105.57.137z"})})),Cg="shortcuts-ZSaYXt",Ag="site-image-Y33_kY",Sg="ready-o34Fme",kg="site-image-border-KiLGCO",Eg="site-image-icon-AD17An",Tg=({url:e="",zIndex:t})=>{const[n,i]=(0,m.useState)(!1);return(0,m.useEffect)((()=>{const t=new Image;t.src=e,t.onload=()=>i(!0)}),[]),(0,Te.jsxs)("span",{className:J()(Ag,{[Sg]:n}),style:{zIndex:t},children:[n?(0,Te.jsx)("img",{src:e}):(0,Te.jsx)(wg,{className:Eg}),(0,Te.jsx)("span",{className:kg})]})},Ig=({sources:e=[]})=>{const t=(0,m.useMemo)((()=>e.filter((e=>e.logo_url&&e.site_name)).map((e=>e.logo_url)).slice(0,8)),[e]);return(0,Te.jsx)("span",{className:Cg,children:t.map(((e,n)=>(0,Te.jsx)(Tg,{url:e,zIndex:t.length-n},n)))})},jg="brief-iN2H4J",Ng="brief-prefix-zLwYwZ",Rg="brief-prefix-icon-mKz7is",Mg="brief-prefix-title-CRd8nT",Pg=e=>{const t=(0,v.B)(),{onClick:n,sources:i=[]}=e,o=t("flow_web_ext_search_deepinsearch_title",{number:i.length});return(0,Te.jsxs)("div",{onClick:n,className:jg,children:[(0,Te.jsxs)("span",{className:Ng,children:[(0,Te.jsx)("span",{className:J()(Rg),children:(0,Te.jsx)(Pp.A,{})}),(0,Te.jsx)("span",{className:Mg,children:o})]}),(0,Te.jsx)(Ig,{sources:i})]})},Lg="tag-item-list-nfsCTL",Bg="tag-item-zUvqBC",Dg=e=>{const{style:t,queryParams:n={}}=e,i=(0,m.useMemo)((()=>{const{text_card:e,video_card:t}=n,i=[...(e||[]).map((e=>e.query)),...(t||[]).map((e=>e.query))].filter((e=>Boolean(e)));return[...new Set(i)]}),[n]);return(0,Te.jsx)("div",{className:Lg,style:t,children:i.map(((e,t)=>(0,Te.jsx)("span",{className:Bg,children:e},t)))})},Og="container-U4dRxy",Fg="expanded-QjCzuN",Ug="search-children-oCTSPv",Hg="search-children-visible-FcM1_h",zg="search-children-display-k8XR1y",qg=({searchId:e="",style:t={},query:n=""})=>{const{searchCardData:i,text:o,isError:s,isAborted:a}=(0,An.P)((t=>t.messages[e]||{})),{expanded:l,childrenDisplay:c,transStyle:d,containerRef:u,handleExpand:h,handleClose:p,onTransitionEnd:g}=(()=>{const[e,t]=(0,m.useState)(!1),[n,i]=(0,m.useState)(!1),[o,s]=(0,m.useState)(0),a=(0,m.useRef)(null),[l,c]=(0,m.useState)({width:"fit-content",height:"44px"});return(0,m.useEffect)((()=>{if(!e&&0===o&&a.current){const e=new ResizeObserver((()=>{a.current&&s(a.current.scrollWidth)}));return e.observe(a.current),()=>{e.disconnect()}}}),[e,a.current]),{expanded:e,childrenDisplay:n,transStyle:l,containerRef:a,handleExpand:()=>{i(!0),t(!0),setTimeout((()=>{c((()=>{var e;return{width:"100%",height:`${null===(e=a.current)||void 0===e?void 0:e.scrollHeight}px`}}))}),0)},handleClose:()=>{t(!1),c({width:`${o}px`,height:"44px"})},onTransitionEnd:()=>{e||(i(!1),c((e=>(0,r.A)((0,r.A)({},e),{},{width:"fit-content"}))))}}})(),{search_result:f,query_params:_}=i||{},x=!o&&!i,{sources:y}=(0,m.useMemo)((()=>{var e;const t=(null==f||null===(e=f.text_card)||void 0===e?void 0:e.card_list)||[];return{sources:null==t?void 0:t.map((e=>({title:e.title,url:e.url,logo_url:e.logo_url,site_name:e.sitename,image_url:e.image_url})))}}),[f]),b=(0,v.B)();return s||a?null:x?(0,Te.jsx)(cg.c_,{text:n,t:b}):(0,Te.jsx)("div",{ref:u,className:J()(Og,{[Fg]:l}),onTransitionEnd:g,style:(0,r.A)((0,r.A)({},d),t),children:(0,Te.jsxs)(Te.Fragment,{children:[l?(0,Te.jsx)(bg,{title:b("flow_web_ext_search_deepinsearch_understand"),right:(0,Te.jsx)(ht.A,{}),onClick:p}):(0,Te.jsx)(Pg,{onClick:()=>(null==y?void 0:y.length)>0&&h(),sources:y}),(0,Te.jsxs)("div",{className:J()(Ug,{[Hg]:l,[zg]:c}),children:[(0,Te.jsx)(bg,{title:b("flow_web_ext_search_deepinsearch_search"),children:(0,Te.jsx)(Dg,{queryParams:_,style:{marginBottom:-4,paddingLeft:28}})}),(0,Te.jsx)(bg,{title:b("flow_web_ext_search_deepinsearch_soure",{number:y.length}),children:(0,Te.jsx)(mg,{sources:y})}),(0,Te.jsx)(bg,{title:b("flow_web_ext_search_deepinsearch_answer")})]})]})})},Vg=({suggestMessageListWithStatus:e,className:t,onClick:n,fullMode:i=!1})=>{const{failed:o,suggests:s=[],isRegen:r}=e||{},a=(0,v.B)(),l=(e,t)=>{n(e,t)};return o||!s.length?null:(0,Te.jsxs)("div",{className:J()(Gp,t),children:[(0,Te.jsxs)("div",{className:J()(Qp,{[Xp]:i}),children:[i?(0,Te.jsx)(Pe.oE,{className:Zp}):(0,Te.jsx)(ct.A,{className:Zp}),(0,Te.jsx)("div",{children:a("flow_web_ext_search_ask_more",{brand:(0,fs.L2)()})})]}),i?(0,Te.jsx)("div",{className:J()(Jp),children:s.map(((e,t)=>(0,Te.jsxs)("div",{className:J()(eg,{[tg]:!r}),onClick:()=>l(e,t),children:[(0,Te.jsx)("span",{style:{marginRight:8,fontSize:i?"14px":"12px"},children:e}),(0,Te.jsx)(Pe.n4,{})]},t)))}):(0,Te.jsx)(Te.Fragment,{children:s.map(((e,t)=>(0,Te.jsxs)("div",{className:J()(eg,{[tg]:!r}),onClick:()=>l(e,t),children:[(0,Te.jsx)("span",{style:{marginRight:8,fontSize:i?"14px":"12px"},children:e}),(0,Te.jsx)(Pe.n4,{})]},t)))})]})},$g="expandSummaryButton-wchrB9",Wg=({onClick:e,getPopupContainer:t,text:n,icon:i})=>{var o;const s=null===(o=(0,m.useContext)(on.mn))||void 0===o?void 0:o.engine,r=(0,m.useRef)(null),[a,l]=(0,m.useState)(!1),c=(0,v.B)(),d=n||c("flow_web_ext_search_btn_start");return(0,Te.jsx)(je.m_,{getPopupContainer:t,content:d,trigger:"custom",visible:a,spacing:{y:12,x:0},children:(0,Te.jsx)(ea.c,{onMouseEnter:()=>{var e;const t=null===(e=r.current)||void 0===e?void 0:e.parentElement;t&&(t.clientWidth<t.scrollWidth?l(!0):l(!1))},onMouseLeave:()=>{l(!1)},type:"ai-secondary",icon:i||(0,Te.jsx)(ht.A,{}),size:"medium",onClick:()=>{Lp(),e(),Qr({search_engine_name:null==s?void 0:s.name,result_type:"summary",show_type:"full_content_manual"}),Xr({search_engine_name:null==s?void 0:s.name,button_name:"start_ai_search",whether_full_screen:0})},className:$g,"data-testid":"search-assistant-start-btn",children:(0,Te.jsx)("span",{ref:r,children:d})})})};var Kg=n(62135);const Yg="spacing-KduYLV",Gg="link-JieA9Q",Qg="linkIcon-_nuf2A",Zg="text-Nef5ie",Xg=({href:e=""})=>{const t=(0,m.useMemo)((()=>{try{return new URL(e).hostname.replace(/^www\./,"")}catch(t){return""}}),[e]);return t?(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("span",{className:Yg}),(0,Te.jsxs)("a",{href:e,target:"_blank",className:Gg,children:[(0,Te.jsx)(Kg.A,{className:Qg}),(0,Te.jsx)("span",{className:Zg,children:t})]})]}):null},Jg=({isFeatureAvailable:e,hasDeepSearchEntry:t,enableWebAISearchCard:n,popContainerRef:i,searchId:o,query:s,handleSearch:r,isContentCollapse:l,setIsContentCollapse:c,onOpenShareCard:d})=>{const[u,h]=(0,m.useState)(!1),[p,g]=(0,m.useState)(!1),f=(0,v.B)(),x=(0,m.useRef)(null),y=(0,An.P)((e=>e.messages)),{isDeepSearchMode:b}=ag((e=>({isDeepSearchMode:e.isDeepSearchMode}))),{insertedElements:w}=(e=>{var t;const n=(null==e||null===(t=e.body)||void 0===t||null===(t=t.message)||void 0===t?void 0:t.meta_infos)||[],i=(null==e?void 0:e.id)||"",o=(0,m.useRef)({id:null==e?void 0:e.id,links:[]}),s=(0,m.useMemo)((()=>{i!==o.current.id&&(o.current.id=i,o.current.links=[]);const{links:e}=o.current;return n.forEach((t=>{if(-1===t.type){const n=(0,R.O)(t.info,{});null!=n&&n.url&&!e.find((e=>e.position===n.position))&&e.push(n)}})),o.current.links=e,e.map((e=>({range:e.position,render:()=>(0,Te.jsx)(Xg,{href:e.url})})))}),[i,n]);return{insertedElements:s}})(b?void 0:y[o]),{isDone:C,isError:A,isAborted:S,text:k="",suggests:E=[],body:T}=y[o]||{},I=!(k||A||C||S),[j,N]=(0,m.useState)(!1);(0,m.useEffect)((()=>{const e=()=>{C&&setTimeout((()=>N(!1)),100)};e();const t=()=>(N(!0),e(),!0);return pn.A.on("trigger-search-assistant-collection",t),()=>{pn.A.off("trigger-search-assistant-collection",t)}}),[C]);const M=function(){var e=(0,a.A)((function*(){var e,t,n,i,o,s;if((({message_id:e})=>{Lt({message_id:e,click_from:_.Z5.searchAssistant})})({message_id:null!==(e=null==T||null===(t=T.message)||void 0===t?void 0:t.message_id)&&void 0!==e?e:""}),u)return;h(!0);const r={messageIds:[null!==(n=null==T||null===(i=T.message)||void 0===i?void 0:i.reply_id)&&void 0!==n?n:"",null!==(o=null==T||null===(s=T.message)||void 0===s?void 0:s.message_id)&&void 0!==o?o:""]};yield(0,So.ci)(r)}));return function(){return e.apply(this,arguments)}}(),P=function(){var e=(0,a.A)((function*(e,t){var n,i;if(Lp(),(({click_position:e,message_id:t,search_id:n,search_engine_name:i,suggested_type:o=_.Ld.search})=>{const{assistantBotId:s}=(0,se.ue)();(0,It.z8)(_.Ur.clickSearchAssistantSuggest,{bot_id:s,suggested_type:o,click_position:e,message_id:t,button_name:_._h.suggest,click_from:_.Z5.searchAssistant,search_id:n,search_engine_name:i})})({click_position:`${t+1}`,message_id:null==T||null===(n=T.message)||void 0===n?void 0:n.message_id}),null===(i=(0,se.TK)("authInfo"))||void 0===i||!i.isAuthenticated)return void(0,_e.DT)({trackMeta:{previous_page:"search_engine",login_entrance:"search_result_card"}});ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),Co.l.getState().setIsShowSidebar(!0,_.cz.searchAssistant),yield(0,ko.Z)(),yield M();const{convId:o,convType:s,mainBotId:r}=(0,Jt.IK)(),a={text:e,reportParams:{scene:bo.sJ.search_related_suggested_prompt},extraExt:{need_create_thread:s===Zt.H.NewThread?"1":"0",browser_language:(0,kn.wz)((0,se.TK)("uiLanguage"))},ctx:(0,So.Pe)(s,o,r)};yield(0,ko.Z)(),yield(0,So.Bc)(s,[a])}));return function(t,n){return e.apply(this,arguments)}}();return(0,m.useEffect)((()=>{if(!x.current||!l)return;const{height:e}=x.current.getBoundingClientRect();e>=260&&g(!0)}),[y]),(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsxs)("div",{className:J()(qp,{[Vp]:I,[$p]:l}),ref:x,children:[n&&(0,Te.jsx)(qg,{searchId:o,style:{marginBottom:12},query:s}),(0,Te.jsx)(Qu,{id:o,onRetry:()=>{var e;r(),(({message_id:e})=>{Bt({message_id:e,click_from:_.Z5.searchAssistant})})({message_id:null==T||null===(e=T.message)||void 0===e?void 0:e.message_id})},type:"search",loadingSlot:n?null:void 0,MDBoxProps:{insertedElements:w}}),(0,Te.jsx)(Vg,{suggestMessageListWithStatus:{isRegen:!1,loading:!1,suggests:E.filter((e=>e)),failed:!1},onClick:P}),(0,Jr.s)()&&(0,Te.jsx)("textarea",{style:{visibility:"hidden",position:"absolute"},"data-testid":"search-assistant-copy-result",value:k}),l&&p&&(0,Te.jsx)("div",{className:Wp,children:(0,Te.jsx)(Wg,{getPopupContainer:()=>i.current,onClick:()=>{c(!1)},text:f("flow_web_ext_search_btn_start")})})]}),C&&!l&&(0,Te.jsx)(lg,{popContainerRef:i,isFeatureAvailable:e,triggerCollection:j,hasDeepSearchEntry:t,query:s,searchId:o,syncToChat:M,onOpenShareCard:d})]})},ev=({provider:e,popContainerRef:t,activeKey:n,query:i})=>{const o=(0,v.B)();return(0,Te.jsx)(eh,{t:o,isActive:"mindmap"===n,getPopupContainer:()=>t.current,onFirstShow:()=>{Qr({search_engine_name:null==e?void 0:e.name,result_type:"mind_map",show_type:"full_content_manual"})},onCopy:t=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:"copy_mind_map",whether_full_screen:t?1:0})},onCopyImg:t=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:"copy_mind_map_image",whether_full_screen:t?1:0})},onCopyHtml:t=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:"copy_mind_map_text",whether_full_screen:t?1:0})},onDownload:t=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:Xu.download,whether_full_screen:t?1:0})},onEnterFullscreen:()=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:Xu.fullscreen})},onZoomIn:t=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:Xu.zoom_in,whether_full_screen:t?1:0})},onZoomOut:t=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:Xu.zoom_out,whether_full_screen:t?1:0})},onZoomFit:t=>{Xr({search_engine_name:null==e?void 0:e.name,button_name:Xu.zoom_fit,whether_full_screen:t?1:0})},getSendMessageParams:()=>({text:i,answerWithSuggest:!1,current_page:"search_engine",scene:"search_engine",replyLang:(0,kn.wz)((0,se.TK)("uiLanguage")),prompt:so.EU.browser_plugin_info,browser_plugin_info:JSON.stringify({skill_name:"search_mindnote",frontend_source:"plugin"})})})},tv=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",d:"M3.053 5a.343.343 0 0 0-.343.343v1.6c0 .19.153.343.343.343h1.6c.19 0 .343-.154.343-.343v-1.6A.343.343 0 0 0 4.653 5zm5.714 5.857a.343.343 0 0 0-.343.343v1.029c0 .189.154.342.343.342h11.886c.19 0 .343-.153.343-.342V11.2a.343.343 0 0 0-.343-.343zM2.71 11.2c0-.19.153-.343.343-.343h1.6c.19 0 .343.154.343.343v1.6c0 .19-.154.343-.343.343h-1.6a.343.343 0 0 1-.343-.343zM8.767 5a.343.343 0 0 0-.343.343V6.37c0 .19.154.343.343.343h11.886c.19 0 .343-.153.343-.343V5.343A.343.343 0 0 0 20.653 5zM2.71 17.057c0-.19.153-.343.343-.343h1.6c.19 0 .343.154.343.343v1.6c0 .19-.154.343-.343.343h-1.6a.343.343 0 0 1-.343-.343zm6.057.229a.343.343 0 0 0-.343.343v1.028c0 .19.154.343.343.343h11.886c.19 0 .343-.154.343-.343V17.63a.343.343 0 0 0-.343-.343z"})})),nv=(0,js.a)((0,Te.jsx)(tv,{})),iv=e=>(0,Te.jsxs)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:[(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M19.03 16.749h-5.107a.87.87 0 1 0 0 1.74h5.107a.87.87 0 0 0 0-1.74m-5.107-1.4a2.27 2.27 0 1 0 0 4.54h5.107a2.27 2.27 0 0 0 0-4.54zM19.03 5.4h-5.107a.87.87 0 1 0 0 1.74h5.107a.87.87 0 0 0 0-1.74M13.923 4a2.27 2.27 0 1 0 0 4.54h5.107a2.27 2.27 0 0 0 0-4.54zM4.75 8.25A2.75 2.75 0 0 1 7.5 5.5h2a.75.75 0 0 1 0 1.5h-2c-.69 0-1.25.56-1.25 1.25v7.5c0 .69.56 1.25 1.25 1.25h2a.75.75 0 0 1 0 1.5h-2a2.75 2.75 0 0 1-2.75-2.75z",clipRule:"evenodd"}),(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M2.25 12a.75.75 0 0 1 .75-.75h2a.75.75 0 0 1 0 1.5H3a.75.75 0 0 1-.75-.75",clipRule:"evenodd"})]})),ov=(0,js.a)((0,Te.jsx)(iv,{})),sv="container-hMHPJo",rv="btn-jV7wPW",av="iconBtn-vhHKne",lv="active-z2xEVk",cv=(0,l.jc)(),dv=({setActiveKey:e,activeKey:t,getPopupContainer:n})=>{var i;const o=null===(i=(0,m.useContext)(on.mn))||void 0===i?void 0:i.engine,s=(0,v.B)(),r=(0,m.useRef)(null),[a,l]=(0,m.useState)(!1),[c]=(0,f.Y)("uiLanguage"),d=[{key:"summary",content:s("flow_web_ext_search_summary"),icon:(0,Te.jsx)(nv,{})},{key:"mindmap",content:s("flow_web_ext_search_mindmap"),icon:(0,Te.jsx)(ov,{})}];(0,m.useEffect)((()=>{var e;if(!r.current)return;const t=null===(e=r.current.parentElement)||void 0===e?void 0:e.parentElement;if(!t)return;const n=r.current.getBoundingClientRect(),i=t.getBoundingClientRect();n.right>i.right?l(!0):l(!1)}),[c]);const u=t=>{Xr({search_engine_name:null==o?void 0:o.name,button_name:"switch_result_type"}),e(t)};return(0,Te.jsx)("div",{className:sv,ref:r,children:d.map((e=>a?(0,Te.jsx)(je.m_,{content:cv?void 0:e.content,getPopupContainer:n,spacing:{y:12,x:0},children:(0,Te.jsx)("button",{className:J()(av,{[lv]:t===e.key}),onClick:()=>u(e.key),"data-testid":`search-assistant-tab-${e.key}`,children:e.icon},e.key)}):(0,Te.jsx)("button",{className:J()(rv,{[lv]:t===e.key}),onClick:()=>u(e.key),"data-testid":`search-assistant-tab-${e.key}`,children:e.content},e.key)))})},{Text:uv}=je.o5,hv=({searchId:e,isFeatureAvailable:t,popContainerRef:n,activeKey:i,setActiveKey:o,setIsContentCollapse:s,handleSearch:r,isSearchIdReady:a})=>{const l=(0,v.B)(),c=(0,As.A)("search_assistant"),d=()=>{s(!1),r()};return(0,m.useEffect)((()=>(pn.A.on("trigger-search-assistant-summary",d),()=>{pn.A.off("trigger-search-assistant-summary",d)})),[d]),(0,Te.jsxs)("div",{className:J()(Fp,{[Up]:!e}),children:[!t&&(0,Te.jsx)(je.$n,{theme:"solid",size:"small",className:Yp,icon:(0,Te.jsx)(Pe.oE,{}),onClick:()=>{(0,_e.DT)({trackMeta:{previous_page:"search_engine",login_entrance:"search_result_card"}})},type:"primary",children:(0,Te.jsx)(uv,{ellipsis:{showTooltip:{opts:{getPopupContainer:()=>n.current}}},style:{maxWidth:125},size:"small",children:l("flow_web_ext_search_login",{brand:(0,fs.L2)()})})}),t&&e&&c.mindmap_show&&(0,Te.jsx)(dv,{activeKey:i,setActiveKey:o,getPopupContainer:()=>n.current}),t&&a&&!e&&(0,Te.jsx)(Wg,{getPopupContainer:()=>n.current,onClick:d,text:l("flow_web_ext_search_btn_continue"),icon:(0,Te.jsx)(ct.A,{})})]})},mv=({provider:e,activeKey:t,searchId:n,isFeatureAvailable:i,hasDeepSearchEntry:o,isContentCollapse:s,isSearchIdReady:r})=>{const a=(0,m.useRef)(0),l=(0,An.P)((e=>e.messages)),{isDone:c,suggests:d=[],body:u}=l[n]||{};(0,m.useEffect)((()=>{if(!r)return;let i="half_content";s||(i=n?"full_content_auto":"no_content"),Qr({search_engine_name:null==e?void 0:e.name,result_type:"summary"===t?"summary":"mind_map",show_type:i})}),[r]),(0,m.useEffect)((()=>{if(c){var t;(({prompt_cnt:e,message_id:t,from_search_id:n,show_from:i,search_engine_name:o,suggested_type:s=_.Ld.search})=>{const{assistantBotId:r}=(0,se.ue)();(0,It.z8)(_.Ur.showSearchAssistantSuggest,{bot_id:r,suggested_type:s,prompt_cnt:e,message_id:t,from_search_id:n,show_from:i,search_engine_name:o})})({prompt_cnt:d.length,message_id:null==u||null===(t=u.message)||void 0===t?void 0:t.message_id,search_engine_name:null==e?void 0:e.name});o&&i&&c&&(({show_from:e})=>{(0,It.z8)(_.Ur.showDeepSearchBtn,{current_page:"search_engine",search_engine_name:"google",show_from:e})})({show_from:"search_result_card"})}}),[c]),(0,m.useEffect)((()=>{if(d.length&&d.length>a.current){for(let n=a.current;n<d.length;n++){var t;Zr({prompt_position:`${n+1}`,message_id:null==u||null===(t=u.message)||void 0===t?void 0:t.message_id,search_engine_name:null==e?void 0:e.name})}a.current=d.length}}),[d]),(0,m.useEffect)((()=>{i&&c&&(0,ot.ku)()&&(0,zt.ae)(zt.vP.search_result_card,zt.p6.searchresult)}),[i,c])},pv=({enableWebAISearchCard:e,query:t,searchCardAutoSummary:n})=>{const[i,o]=(0,m.useState)(""),[s,a]=(0,m.useState)(!1),l=(0,An.P)((e=>e.sendMessage)),c=(0,As.A)("search_assistant"),[d]=(0,f.Y)("searchUsageTimesInfo"),{isBrowserPluginSkillLimited:u}=(0,wo.cj)((e=>e)),h=!u("search"),p=(n={})=>{const i={text:t,answerWithSuggest:!0,current_page:"search_engine",scene:"search_engine"},s=e?{prompt:so.EU.input_skill,input_skill:JSON.stringify({skill_id:"4",skill_type:4})}:{prompt:so.EU.browser_plugin_info,browser_plugin_info:'{"skill_name":"search"}'},a=(0,kn.wz)((0,se.TK)("uiLanguage")),c=l((0,r.A)((0,r.A)((0,r.A)((0,r.A)({},i),n),s),{},{replyLang:a,preventDefaultAuthAction:!0}));o(c)},{clearSearch:g,setDeepSearchMode:v}=ag((e=>({clearSearch:e.clearSearch,setDeepSearchMode:e.setDeepSearchMode})));return(0,m.useEffect)((()=>{n&&(0,se.vE)("searchUsageTimesInfo",{}),h&&t&&((n||(()=>{const e=(0,se.TK)("searchUsageTimesInfo"),t=(0,se.tl)("search_assistant");if(!e.usageTimes&&!e.lastUseTime)return!e.haflContentShowCount||e.haflContentShowCount<t.max_half_content_show_count;if(e.usageTimes&&e.usageTimes>=t.max_search_auto_summary_count)return!1;const n=Date.now();return!(e.lastUseTime&&n-e.lastUseTime>=t.max_search_auto_summary_time)})())&&((0,wo.BB)({action:"web_search",triggerLogin:!1}),g(),v(!1),p(),n||(d.lastUseTime||d.usageTimes?(0,se.vE)("searchUsageTimesInfo",{lastUseTime:d.lastUseTime||Date.now(),usageTimes:d.usageTimes?Math.min(d.usageTimes,c.max_search_auto_summary_count)+1:1}):(0,se.vE)("searchUsageTimesInfo",{haflContentShowCount:d.haflContentShowCount?d.haflContentShowCount+1:1})),A.vF.persist.log({message:"[search - ui-creation] component mounted"})),a(!0))}),[h,t,n]),{searchId:i,handleSearch:p,isFeatureAvailable:h,isSearchIdReady:s}};var gv=n(56834);const vv="autoSummaryTips-BYtjtA",fv="content-OztiZ5",_v="tips-hrtxDb",xv="text-Xg7cNo",yv=({getPopupContainer:e})=>{const[t,n]=(0,m.useState)(!0),i=(0,v.B)(),{isDeepSearchMode:o}=ag((e=>({isDeepSearchMode:e.isDeepSearchMode}))),s=(0,m.useRef)(null);return(0,Te.jsx)(Te.Fragment,{children:t&&!o&&(0,Te.jsx)("div",{className:J()(vv,"cici-ext-always-light","semi-always-light"),children:(0,Te.jsxs)("div",{className:fv,children:[(0,Te.jsxs)("div",{className:_v,children:[(0,Te.jsx)("span",{ref:s,className:xv,children:i("flow_web_ext_search_tips")}),(0,Te.jsx)(je.m_,{getPopupContainer:e,content:i("flow_web_ext_search_tips_hover"),spacing:{y:12,x:0},children:(0,Te.jsx)("span",{style:{display:"flex"},children:(0,Te.jsx)(gv.A,{})})})]}),(0,Te.jsx)(ve.A,{onClick:()=>n(!1)})]})})})};let bv=function(e){return e.search="search_card",e.podcast="podcast_summary_card",e}({});const wv="shadow-qepQsb",Cv="card-QUOU6b",Av="card-head-YVYCf5",Sv="close-btn-YAfYyc",kv="card-image-wAongx",Ev="card-body-vMha_D",Tv="card-content-whjGTM",Iv="card-captain-Na2qRB",jv="card-captain-left-lX4l8I",Nv="title-Hh9Nov",Rv="desc-ke5kGa",Mv="card-captain-image-N9kS1J",Pv="divider-QuBT4a",Lv="md-ZuOTN9",Bv="card-footer-slRvKz",Dv="brand-Ah3tk9",Ov="qrcode-vus28R",Fv="card-action-UuaXtL",Uv=({coverUrl:e,shareLink:t,title:n,desc:i,content:o,onClose:s=h.A,extIconUrl:r,extName:l,t:c,onCopy:d=h.A,onDownload:u=h.A})=>{const p=(0,m.useRef)(null),[g,v]=(0,m.useState)(""),[f,_]=(0,m.useState)(""),[x,y]=(0,m.useState)(!0),[b,w]=(0,m.useState)(!1),C=(0,m.useRef)(null),A=function(){var e=(0,a.A)((function*(){b||(d(),C.current?yield(0,Ec.WF)(C.current):yield(0,Ec.sW)(p.current),w(!0),setTimeout((()=>w(!1)),2e3))}));return function(){return e.apply(this,arguments)}}();(0,m.useEffect)((()=>{void 0!==t&&Tc.url2QRCodeSVG(t,{colorLight:"#f1f4fb",colorDark:"#000000"}).then((e=>{_(e)}))}),[]),(0,m.useEffect)((()=>{const e=function(){var e=(0,a.A)((function*(){const e=yield(0,Ec.fG)(p.current);C.current=e;const t=(null==e?void 0:e.toDataURL("image/png"))||"";v(t)}));return function(){return e.apply(this,arguments)}}(),t=setTimeout((()=>e()),500);return()=>clearTimeout(t)}),[]);const S=g&&(void 0===t||""!==f),k=e&&""!==e&&x;return(0,Te.jsxs)("div",{className:Cv,children:[(0,Te.jsx)("div",{className:wv,children:(0,Te.jsxs)("div",{className:Ev,ref:p,children:[(0,Te.jsxs)("div",{className:Tv,children:[(0,Te.jsxs)("div",{className:Iv,children:[(0,Te.jsxs)("div",{className:jv,children:[(0,Te.jsx)("div",{className:J()(Nv,"font-semibold mb-5px"),children:n}),(0,Te.jsx)("div",{className:Rv,children:i})]}),k&&(0,Te.jsx)("div",{className:Mv,children:(0,Te.jsx)("img",{src:e,referrerPolicy:"no-referrer",onError:()=>y(!1)})})]}),(0,Te.jsx)("div",{className:Pv}),(0,Te.jsx)(Uc.FH,{markDown:o,className:Lv})]}),(0,Te.jsxs)("div",{className:Bv,children:[(0,Te.jsxs)("div",{className:Dv,children:[(0,Te.jsx)("img",{src:r}),(0,Te.jsxs)("div",{children:[(0,Te.jsx)("div",{className:"text-[16px] font-semibold",children:l}),(0,Te.jsx)("div",{className:"text-[12px]",children:c("flow_web_ext_search_share_pic_doubao")})]})]}),""!==f&&(0,Te.jsx)("img",{className:Ov,src:f,alt:"qrcode"})]})]})}),S?(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("div",{className:Av,children:(0,Te.jsx)(jc.A,{"data-testid":"share-img-close",onClick:s,className:Sv})}),(0,Te.jsx)("img",{"data-testid":"share-img",src:g,className:kv}),(0,Te.jsxs)("div",{className:Fv,children:[(0,Te.jsx)(ea.c,{"data-testid":"share-img-download",type:"tertiary",icon:(0,Te.jsx)(Nc.A,{}),onClick:()=>{u(),(0,Ec.GV)(g,"share-card.png")},children:c("flow_web_ext_search_share_pic_download")}),(0,Te.jsx)(ea.c,{"data-testid":"share-img-copy",type:"tertiary",icon:b?(0,Te.jsx)(hu.A,{}):(0,Te.jsx)(Rc.A,{}),onClick:A,children:c("flow_web_ext_search_share_pic_copy")})]})]}):(0,Te.jsx)(je.tK,{spinning:!0,style:{alignSelf:"center"}})]})},Hv="wrapper-M6eeCt",zv="mask-BB8E8w",qv=()=>{const[e,t]=(0,m.useState)(!1);return{shareCardVisible:e,onCloseShareCard:()=>{t(!1)},onOpenShareCard:()=>{t(!0)}}},Vv=({msgId:e,type:t,title:n,shareLink:i,imgUrl:o,onClose:s})=>{const r=(0,v.B)(),a=(0,An.P)((e=>e.messages)),{text:l="",searchCardData:c}=a[e]||{},d=(0,m.useMemo)((()=>{var e;const t=(null==c||null===(e=c.search_result)||void 0===e||null===(e=e.text_card)||void 0===e?void 0:e.card_list)||[];return t.length>0?r("flow_web_ext_search_share_pic_tips",{sourceCount:t.length}):r("flow_web_ext_search_share_pic_tips2")}),[null==c?void 0:c.search_result,r]);(0,m.useEffect)((()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""})),[]);return(0,Te.jsxs)("div",{"data-testid":"share-image-card",className:Hv,children:[(0,Te.jsx)("div",{className:zv,onClick:s}),(0,Te.jsx)(Uv,{content:l,coverUrl:o,shareLink:i,title:n,desc:d,t:r,extIconUrl:(0,fs.Nf)(),extName:(0,fs.L2)(),onClose:s,onCopy:()=>(0,Ke.s)("share_card_result_click",{current_page:(0,It.M5)(location.href),content_type:t,button_name:"copy"}),onDownload:()=>(0,Ke.s)("share_card_result_click",{current_page:(0,It.M5)(location.href),content_type:t,button_name:"download"})})]})};function $v({hasDeepSearchEntry:e,enableWebAISearchCard:t}){var n;const i=(0,v.B)(),[o,s]=(0,m.useState)(""),[a,l]=(0,m.useState)(!1),[c,d]=(0,m.useState)("summary"),u=(0,Co.l)((e=>e.setIsShowSearch)),{value:h}=(0,Kr.Tu)(Kr.FM.searchCardAutoSummary,!0),p=(0,As.A)("search_assistant"),[g]=(0,f.Y)("searchUsageTimesInfo"),[_,x]=(0,m.useState)(!g.lastUseTime&&!g.usageTimes&&(!g.haflContentShowCount||g.haflContentShowCount<p.max_half_content_show_count)),{searchId:y,handleSearch:b,isFeatureAvailable:w,isSearchIdReady:C}=pv({enableWebAISearchCard:t,query:o,searchCardAutoSummary:Boolean(h)}),A=(0,An.P)((e=>e.messages)),{isDone:S}=A[y]||{},{shareCardVisible:k,onCloseShareCard:E,onOpenShareCard:T}=qv(),I=null===(n=(0,m.useContext)(on.mn))||void 0===n?void 0:n.engine;mv({provider:I,activeKey:c,searchId:y,isFeatureAvailable:w,hasDeepSearchEntry:e,isContentCollapse:!h&&_,isSearchIdReady:C});const{isDeepSearchMode:j}=ag((e=>({isDeepSearchMode:e.isDeepSearchMode})));(0,m.useEffect)((()=>{const e=(e=>{if(!e)return"";let t;const n=document.querySelector(e.inputQuery[0]);n&&(t=n.value),t||(t=new URL(location.href).searchParams.get(e.searchParam)||"");return t})(I);e&&s(e)}),[]);const N=(0,m.useRef)(null),R=(null==I?void 0:I.containerStyle)||{};return(0,Te.jsxs)("div",{style:(0,r.A)({marginBottom:"24px",display:"flex",flexDirection:"column-reverse"},R),children:[!h&&!_&&S&&(0,Te.jsx)(yv,{getPopupContainer:()=>N.current}),(0,Te.jsxs)("div",{"data-testid":"search-assistant-container",className:J()(Bp,"cici-ext-always-light","semi-always-light"),style:{display:j?"none":"block"},onMouseLeave:()=>l(!1),ref:N,children:[(0,Te.jsx)(xe.A,{className:Kp,show:a,optionPageSection:"search-engin-summary",disableKey:os.lf.searchAssistant,onDisableOnceClick:()=>u(!1),setShow:l,cssStyle:{zIndex:100}}),(0,Te.jsxs)("div",{className:Dp,children:[(0,Te.jsx)(ou.A,{size:"large",disable:!0,bransNameVisible:!1,style:{maxWidth:"calc(100% - 54px)"},children:(0,Te.jsx)("span",{className:Op,children:i("flow_web_ext_search_summarytitle1",{brandName:(0,fs.L2)()})})}),(0,Te.jsx)(hv,{searchId:y,isFeatureAvailable:w,popContainerRef:N,activeKey:c,setActiveKey:d,setIsContentCollapse:x,handleSearch:b,isSearchIdReady:C})]}),w&&y&&(0,Te.jsxs)(je.tU,{activeKey:c,renderTabBar:()=>null,children:[(0,Te.jsx)(je.mF,{itemKey:"summary","data-testid":"search-assistant-content-summary",children:(0,Te.jsx)(Jg,{isFeatureAvailable:w,hasDeepSearchEntry:e,enableWebAISearchCard:t,popContainerRef:N,searchId:y,query:o,handleSearch:b,isContentCollapse:!h&&_,setIsContentCollapse:x,onOpenShareCard:()=>{Xr({search_engine_name:null==I?void 0:I.name,button_name:"share",whether_full_screen:0}),T()}})}),p.mindmap_show&&(0,Te.jsx)(je.mF,{itemKey:"mindmap","data-testid":"search-assistant-content-mindmap",children:(0,Te.jsx)(ev,{provider:I,popContainerRef:N,activeKey:c,query:o})})]}),k&&(0,Te.jsx)(Vv,{onClose:E,type:bv.search,msgId:y,title:o})]})]})}var Wv=n(27527);const Kv=e=>{const t=(0,v.B)(),{buttonState:n,handleClick:i}=e,o=(0,m.useRef)(null);(0,m.useEffect)((()=>{o.current&&(n===zi.t.loading?o.current.classList.add("loading"):o.current.classList.remove("loading"))}),[n]);const s=(0,m.useMemo)((()=>{const e={display:"flex",alignItems:"center",gap:"3px",border:"none",borderRadius:"16px",padding:"5px 12px 5px 8px",boxShadow:"0px 2px 12px 0px rgba(255, 255, 255, 0.25) inset",fontSize:"12px",lineHeight:"18px",fontWeight:500,cursor:"pointer",position:"relative"};return{[zi.t.default]:(0,r.A)((0,r.A)({},e),{},{background:"radial-gradient(78.87% 125% at 21.13% 50%, #0057FF 0%, #5A91FC 81.94%)",color:"var(--s-color-text-invert-intact-primary, rgba(255, 255, 255, 1))"}),[zi.t.loading]:(0,r.A)((0,r.A)({},e),{},{color:"var(--s-color-text-invert-intact-primary, rgba(255, 255, 255, 1))",background:"transparent",overflow:"hidden"}),[zi.t.done]:(0,r.A)((0,r.A)({},e),{},{background:"var(--s-color-brand-primary-transparent-3, rgba(0, 102, 255, 0.15))",color:"var(--s-color-brand-primary-default, rgba(0, 87, 255, 1))"})}}),[]),a=n===zi.t.default||n===zi.t.commonFailed||n===zi.t.exceedSizeFailed;return(0,Te.jsxs)("div",{children:[(0,Te.jsx)("style",{children:'\n    @keyframes btn-spin-animation {\n      0% {\n        transform: translate(-50%, -50%) rotate(0);\n      }\n      100% {\n        transform: translate(-50%, -50%) rotate(1turn);\n      }\n    }\n\n    .loading::before {\n      content: "";\n      top: 50%;\n      left: 50%;\n      position: absolute;\n      transform: translate(-50%, -50%);\n      width: 150%;\n      height: 400%;\n      background: radial-gradient(78.87% 125% at 21.13% 50%, #0057FF 0%, #5A91FC 81.94%);\n      animation: btn-spin-animation 3s linear infinite;\n      z-index: -1;\n    }\n  '}),(0,Te.jsx)("button",{ref:o,style:s[a?zi.t.default:n],onClick:i,"data-testid":"podcast-assistant-single-summary-btn",children:a?(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Te.jsx)("path",{d:"M9.13292 13.5547C8.98276 13.5547 8.85038 13.5033 8.73579 13.4006C8.62515 13.2978 8.55599 13.1674 8.52833 13.0094C8.42164 12.4008 8.31297 11.8891 8.20233 11.4742C8.09169 11.0632 7.95536 10.7274 7.79335 10.4666C7.63529 10.2058 7.42783 9.99633 7.17098 9.83826C6.91413 9.6802 6.58615 9.55375 6.18705 9.45892C5.79189 9.36408 5.29992 9.27319 4.71115 9.18626C4.54913 9.16255 4.41478 9.0934 4.30809 8.9788C4.20535 8.86421 4.15398 8.72788 4.15398 8.56982C4.15398 8.41176 4.20732 8.27543 4.31402 8.16084C4.42071 8.04229 4.55506 7.97314 4.71707 7.95338C5.30585 7.8862 5.80177 7.80717 6.20483 7.71629C6.60788 7.6254 6.93981 7.50093 7.20062 7.34287C7.46142 7.18085 7.67283 6.96747 7.83484 6.70272C8.0008 6.43401 8.13516 6.0922 8.2379 5.67729C8.34064 5.25843 8.43745 4.74473 8.52833 4.13619C8.55204 3.97418 8.61922 3.84378 8.72986 3.74499C8.84446 3.64225 8.97881 3.59088 9.13292 3.59088C9.28703 3.59088 9.41941 3.64225 9.53005 3.74499C9.64464 3.84378 9.71577 3.97418 9.74343 4.13619C9.85012 4.74473 9.95682 5.25645 10.0635 5.67137C10.1741 6.08233 10.3105 6.41821 10.4725 6.67901C10.6345 6.93981 10.8439 7.14924 11.1008 7.3073C11.3576 7.46536 11.6836 7.59181 12.0788 7.68665C12.4779 7.78149 12.9699 7.8704 13.5547 7.95338C13.7207 7.98104 13.855 8.05217 13.9578 8.16676C14.0644 8.28136 14.1178 8.41571 14.1178 8.56982C14.1178 8.73183 14.0644 8.87211 13.9578 8.99066C13.8511 9.10525 13.7147 9.17045 13.5488 9.18626C12.9639 9.25344 12.47 9.33444 12.0669 9.42928C11.6639 9.52016 11.33 9.64464 11.0652 9.8027C10.8044 9.96076 10.593 10.1741 10.431 10.4428C10.269 10.7116 10.1366 11.0534 10.0339 11.4683C9.93113 11.8871 9.83432 12.4008 9.74343 13.0094C9.71972 13.1674 9.65057 13.2978 9.53598 13.4006C9.42533 13.5033 9.29098 13.5547 9.13292 13.5547ZM4.74694 6.45657C4.54937 6.45657 4.43872 6.35383 4.41501 6.14835C4.3676 5.76901 4.32018 5.47066 4.27276 5.25333C4.22534 5.036 4.14631 4.87201 4.03567 4.76136C3.92502 4.64677 3.75906 4.56181 3.53777 4.50649C3.31649 4.45117 3.00827 4.39585 2.61311 4.34052C2.39578 4.30891 2.28711 4.19827 2.28711 4.00859C2.28711 3.81892 2.38392 3.70828 2.57755 3.67666C2.9806 3.60554 3.29673 3.54034 3.52592 3.48106C3.75511 3.42179 3.92502 3.33881 4.03567 3.23212C4.14631 3.12147 4.22534 2.96144 4.27276 2.752C4.32018 2.53862 4.3676 2.24423 4.41501 1.86884C4.43872 1.6594 4.54937 1.55469 4.74694 1.55469C4.94057 1.55469 5.05121 1.65545 5.07887 1.85698C5.12629 2.25213 5.17371 2.56035 5.22113 2.78164C5.2725 3.00293 5.35351 3.16889 5.46415 3.27954C5.57479 3.38623 5.74273 3.46526 5.96797 3.51663C6.19321 3.568 6.50538 3.62134 6.90448 3.67666C6.99142 3.68457 7.06255 3.72013 7.11787 3.78336C7.17319 3.84658 7.20085 3.92166 7.20085 4.00859C7.20085 4.19432 7.10601 4.30496 6.91634 4.34052C6.50933 4.4077 6.19123 4.4729 5.96204 4.53612C5.7368 4.5954 5.56886 4.68036 5.45822 4.791C5.34758 4.89769 5.26855 5.05773 5.22113 5.27111C5.17371 5.48449 5.12629 5.78086 5.07887 6.16021C5.06702 6.24714 5.02948 6.31827 4.96625 6.37359C4.90303 6.42891 4.82993 6.45657 4.74694 6.45657Z",fill:"white"})}),t("flow_web_ext_podcast_summarize")]}):n===zi.t.loading?(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Te.jsx)("path",{d:"M9.13292 13.5547C8.98276 13.5547 8.85038 13.5033 8.73579 13.4006C8.62515 13.2978 8.55599 13.1674 8.52833 13.0094C8.42164 12.4008 8.31297 11.8891 8.20233 11.4742C8.09169 11.0632 7.95536 10.7274 7.79335 10.4666C7.63529 10.2058 7.42783 9.99633 7.17098 9.83826C6.91413 9.6802 6.58615 9.55375 6.18705 9.45892C5.79189 9.36408 5.29992 9.27319 4.71115 9.18626C4.54913 9.16255 4.41478 9.0934 4.30809 8.9788C4.20535 8.86421 4.15398 8.72788 4.15398 8.56982C4.15398 8.41176 4.20732 8.27543 4.31402 8.16084C4.42071 8.04229 4.55506 7.97314 4.71707 7.95338C5.30585 7.8862 5.80177 7.80717 6.20483 7.71629C6.60788 7.6254 6.93981 7.50093 7.20062 7.34287C7.46142 7.18085 7.67283 6.96747 7.83484 6.70272C8.0008 6.43401 8.13516 6.0922 8.2379 5.67729C8.34064 5.25843 8.43745 4.74473 8.52833 4.13619C8.55204 3.97418 8.61922 3.84378 8.72986 3.74499C8.84446 3.64225 8.97881 3.59088 9.13292 3.59088C9.28703 3.59088 9.41941 3.64225 9.53005 3.74499C9.64464 3.84378 9.71577 3.97418 9.74343 4.13619C9.85012 4.74473 9.95682 5.25645 10.0635 5.67137C10.1741 6.08233 10.3105 6.41821 10.4725 6.67901C10.6345 6.93981 10.8439 7.14924 11.1008 7.3073C11.3576 7.46536 11.6836 7.59181 12.0788 7.68665C12.4779 7.78149 12.9699 7.8704 13.5547 7.95338C13.7207 7.98104 13.855 8.05217 13.9578 8.16676C14.0644 8.28136 14.1178 8.41571 14.1178 8.56982C14.1178 8.73183 14.0644 8.87211 13.9578 8.99066C13.8511 9.10525 13.7147 9.17045 13.5488 9.18626C12.9639 9.25344 12.47 9.33444 12.0669 9.42928C11.6639 9.52016 11.33 9.64464 11.0652 9.8027C10.8044 9.96076 10.593 10.1741 10.431 10.4428C10.269 10.7116 10.1366 11.0534 10.0339 11.4683C9.93113 11.8871 9.83432 12.4008 9.74343 13.0094C9.71972 13.1674 9.65057 13.2978 9.53598 13.4006C9.42533 13.5033 9.29098 13.5547 9.13292 13.5547ZM4.74694 6.45657C4.54937 6.45657 4.43872 6.35383 4.41501 6.14835C4.3676 5.76901 4.32018 5.47066 4.27276 5.25333C4.22534 5.036 4.14631 4.87201 4.03567 4.76136C3.92502 4.64677 3.75906 4.56181 3.53777 4.50649C3.31649 4.45117 3.00827 4.39585 2.61311 4.34052C2.39578 4.30891 2.28711 4.19827 2.28711 4.00859C2.28711 3.81892 2.38392 3.70828 2.57755 3.67666C2.9806 3.60554 3.29673 3.54034 3.52592 3.48106C3.75511 3.42179 3.92502 3.33881 4.03567 3.23212C4.14631 3.12147 4.22534 2.96144 4.27276 2.752C4.32018 2.53862 4.3676 2.24423 4.41501 1.86884C4.43872 1.6594 4.54937 1.55469 4.74694 1.55469C4.94057 1.55469 5.05121 1.65545 5.07887 1.85698C5.12629 2.25213 5.17371 2.56035 5.22113 2.78164C5.2725 3.00293 5.35351 3.16889 5.46415 3.27954C5.57479 3.38623 5.74273 3.46526 5.96797 3.51663C6.19321 3.568 6.50538 3.62134 6.90448 3.67666C6.99142 3.68457 7.06255 3.72013 7.11787 3.78336C7.17319 3.84658 7.20085 3.92166 7.20085 4.00859C7.20085 4.19432 7.10601 4.30496 6.91634 4.34052C6.50933 4.4077 6.19123 4.4729 5.96204 4.53612C5.7368 4.5954 5.56886 4.68036 5.45822 4.791C5.34758 4.89769 5.26855 5.05773 5.22113 5.27111C5.17371 5.48449 5.12629 5.78086 5.07887 6.16021C5.06702 6.24714 5.02948 6.31827 4.96625 6.37359C4.90303 6.42891 4.82993 6.45657 4.74694 6.45657Z",fill:"white"})}),t("flow_web_ext_podcast_summarizing","\u603b\u7ed3\u4e2d"),"..."]}):(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Te.jsx)("path",{d:"M7.10905 12.5189C6.85905 12.5189 6.64551 12.4078 6.46842 12.1855L3.77051 8.81055C3.70454 8.73069 3.65592 8.65256 3.62467 8.57617C3.5969 8.49978 3.58301 8.42166 3.58301 8.3418C3.58301 8.16124 3.64204 8.01194 3.76009 7.89388C3.88162 7.77582 4.0344 7.7168 4.21842 7.7168C4.43023 7.7168 4.60905 7.81228 4.75488 8.00326L7.08822 10.998L11.609 3.81576C11.6889 3.69423 11.7705 3.60916 11.8538 3.56055C11.9372 3.50846 12.0448 3.48242 12.1768 3.48242C12.3573 3.48242 12.5049 3.53971 12.6195 3.6543C12.734 3.76541 12.7913 3.91124 12.7913 4.0918C12.7913 4.16471 12.7792 4.23937 12.7549 4.31576C12.7306 4.38867 12.6924 4.4668 12.6403 4.55013L7.74447 12.1803C7.59169 12.406 7.37988 12.5189 7.10905 12.5189Z",fill:"#0057FF"})}),t("flow_web_ext_podcast_summarized")]})})]})},Yv=({result_type:e,content_title:t,content_duration:n})=>{(0,It.z8)(_.Ur.showPodcastAssistantSummarizeResult,{result_type:e,content_title:t,content_duration:n},!1,!1)},Gv=e=>{(0,It.z8)(_.Ur.clickPodcastAssistantSummarizeResult,e,!1,!0)};let Qv=function(e){return e.summary="summary",e.mindmap="mindmap",e.memo="memo",e}({});const Zv={closeAssistant:"closeAssistant-uLjECa",podcastSummaryContainer:"podcastSummaryContainer-y0iMf0",tabContainer:"tabContainer-OEwikr",area:"area-hJcYAm",reminder:"reminder-NyfrPX",podcastMindMap:"podcastMindMap-IPJ6t3","share-btn":"share-btn-UOA4cG",shareBtn:"share-btn-UOA4cG","share-icon":"share-icon-y5oSPJ",shareIcon:"share-icon-y5oSPJ"},Xv=e=>{const{containerRef:t,onOpenShareCard:n}=e,i=(0,v.B)();return(0,Te.jsx)(je.m_,{content:i("flow_web_ext_search_share"),getPopupContainer:()=>t.current,spacing:{y:10,x:0},children:(0,Te.jsx)(ea.c,{"data-testid":"podcast-share-image-btn",type:"tertiary",className:Zv["share-btn"],icon:(0,Te.jsx)(xd.A,{className:Zv["share-icon"]}),size:"small",onClick:()=>{n()}})})},Jv=e=>{const t=(0,v.B)();let n=null;if(e.status===zi.t.loading)n=t("flow_web_ext_podcast_summarizing_desc","\u6b63\u5728\u4e3a\u4f60 AI \u603b\u7ed3\uff0c\u5927\u6982\u9700\u8981\u51e0\u5206\u949f\uff0c\u8bf7\u4e00\u4f1a\u518d\u6765\u3002");else{const i=e.status===zi.t.commonFailed,o=e.status===zi.t.exceedSizeFailed;i?n=t("flow_web_ext_podcast_summarizefail_desc2","\u62b1\u6b49\uff0c\u65e0\u6cd5\u603b\u7ed3\u8be5\u97f3\u9891\uff0c\u8bf7\u5237\u65b0\u6216\u8005\u6362\u4e00\u4e2a\u97f3\u9891\u8bd5\u8bd5"):o&&(n=t("flow_web_ext_podcast_summarizefail_desc","\u97f3\u9891\u65f6\u957f\u8d85\u8fc7\u9650\u5236\uff0c\u65e0\u6cd5\u4e3a\u4f60\u751f\u6210\u603b\u7ed3\uff0c\u8bf7\u6362\u4e00\u4e2a\u97f3\u9891\u518d\u8bd5\u8bd5\u3002"))}return(0,Te.jsx)("div",{className:Zv.reminder,children:n})},ef=({isActive:e,transcript_list:t=[],translateLanguage:n})=>{var i,o;const s=(0,v.B)(),r=(null===(i=Dd())||void 0===i?void 0:i.meta.title)||"",a=(null===(o=Dd())||void 0===o?void 0:o.meta.duration)||0;return(0,Te.jsx)(eh,{className:Zv.podcastMindMap,t:s,isActive:e,getSendMessageParams:()=>({text:location.href,answerWithSuggest:!1,current_page:(0,It.M5)(location.href),scene:bo.sJ.podcast,replyLang:null!=n?n:(0,kn.wz)((0,se.TK)("uiLanguage")),prompt:so.EU.browser_plugin_info,browser_plugin_info:JSON.stringify({skill_name:"text_to_mindnote",mindnote_source:"transcript",transcript_list:t})}),translateLanguage:n,onFirstShow:()=>{Yv({result_type:"mind_map",content_title:r,content_duration:a})},onCopy:e=>{Gv({result_type:"mind_map",whether_full_screen:e?1:0,button_name:Xu.copy,content_title:r,content_duration:a})},onCopyImg:e=>{Gv({result_type:"mind_map",whether_full_screen:e?1:0,button_name:Xu.copy_picture,content_title:r,content_duration:a})},onCopyHtml:e=>{Gv({result_type:"mind_map",whether_full_screen:e?1:0,button_name:Xu.copy_rich_text,content_title:r,content_duration:a})},onDownload:e=>{Gv({result_type:"mind_map",whether_full_screen:e?1:0,button_name:Xu.download,content_title:r,content_duration:a})},onEnterFullscreen:()=>{Gv({result_type:"mind_map",whether_full_screen:0,button_name:Xu.fullscreen,content_title:r,content_duration:a})},onZoomIn:e=>{Gv({result_type:"mind_map",whether_full_screen:e?1:0,button_name:Xu.zoom_in,content_title:r,content_duration:a})},onZoomOut:e=>{Gv({result_type:"mind_map",whether_full_screen:e?1:0,button_name:Xu.zoom_out,content_title:r,content_duration:a})},onZoomFit:e=>{Gv({result_type:"mind_map",whether_full_screen:e?1:0,button_name:Xu.zoom_fit,content_title:r,content_duration:a})}})};function tf(){return document.querySelector("audio")}function nf(){var e;const t=document.querySelector(`[data-podcast-host-id="${u.m.getInstance().getHostId()}"]`);return(null==t||null===(e=t.shadowRoot)||void 0===e?void 0:e.querySelector('div[data-testid="podcast-assistant-container"]'))||document.body}const of=({transcript:e,getCollectionParam:t})=>{const n=(0,m.useMemo)((()=>({reportTakeNotePadShow:()=>{(0,It.z8)(_.Ur.takeNotePadShow,{card_name:Ll})},reportTakeNotePadClick:(e,t)=>{!function(e){(0,It.z8)(_.Ur.takeNotePadClick,{card_name:Ll,button_name:e})}(t)},reportTakeNoteShow:e=>{(0,It.z8)(_.Ur.takeNoteShow,{card_name:Ll})},reportTakeNoteStatus:(e,t,n)=>{!function(e,t){(0,It.z8)(_.Ur.takeNoteStatus,{card_name:Ll,button_name:e,status:t})}(t,n)}})),[]),i=(0,m.useMemo)((()=>{return{tracker:n,getMediaTarget:()=>tf(),getMediaCurrentTime:()=>{var e;return(null===(e=tf())||void 0===e?void 0:e.currentTime)||0},getMediaDuration:()=>{var e;return(null===(e=tf())||void 0===e?void 0:e.duration)||0},getMediaTranscript:()=>e,seekMediaTo:e=>{const t=tf();t&&(t.currentTime=e,t.play())},updateMemo:(o=(0,a.A)((function*(e){return yield function(e){return _l.apply(this,arguments)}(e),pn.A.emit("video-memo-updated",e.id),e.id})),function(e){return o.apply(this,arguments)}),insertMemo:(i=(0,a.A)((function*(e){const n=yield null==t?void 0:t();return yield function(e,t){return yl.apply(this,arguments)}(e,n)})),function(e){return i.apply(this,arguments)}),removeMemo:e=>function(e){return xl.apply(this,arguments)}(e),queryMemoList:()=>function(){return fl.apply(this,arguments)}()};var i,o}),[e,t,n]);return(0,Te.jsx)(la.Provider,{value:i,children:(0,Te.jsx)(El,{cardMode:"TextMode",getMemoListContainer:nf,emptyNode:(0,Te.jsx)("div",{style:{height:"5px"}})})})},sf=e=>{var t,n,i;const{episodeMeta:o,audioElement:s,summaryId:r,transcript:a,lang:l,summaryStatus:c,summaryMaxHeight:d,podcastMeta:u,handleLangChange:h,handleRetry:p,handleMsgDone:g,handleClickClose:f,handleSummary:x,onClickHighlight:y,summarizeLanguage:b,lastSummaryId:w,handleLoadingStatus:C,loadingStatus:A}=e,[S,k]=(0,m.useState)(!1),E=(0,m.useRef)(null),[T,I]=(0,m.useState)(""),j=(null===(t=Dd())||void 0===t?void 0:t.meta.title)||"",N=(null===(n=Dd())||void 0===n?void 0:n.meta.duration)||0,R=(0,An.P)((e=>e.messages)),M=null===(i=(0,m.useContext)(cn))||void 0===i?void 0:i.platform,{isAllDone:P,summaryResult:L,highlightsResult:B,isHighlightsDone:D,isError:O}=mh(r);(0,m.useEffect)((()=>{P&&g()}),[P]),(0,m.useEffect)((()=>{w===r&&C({isSummaryLoading:!1,isHighlightsLoading:!0}),P&&C({isSummaryLoading:!1,isHighlightsLoading:!1})}),[w,r,P]);const F=P&&!yi(B)&&!L;const[U,H]=(0,m.useState)({currentActiveBreakdownIndex:-1,currentActiveBulletPointIndex:-1,progress:0}),[z,q]=(0,m.useState)(!1),V=(0,m.useRef)();(0,m.useEffect)((()=>{z||clearTimeout(V.current)}),[z]);const{isActionLimited:$}=(0,wo.cj)((e=>e)),W=!$("web_podcast_summary"),{shareCardVisible:K,onCloseShareCard:Y,onOpenShareCard:G}=qv(),Q=Boolean(null==a?void 0:a.length),Z=!O&&Boolean(L),X=!Z&&!D&&W,{activeTab:ee,renderTab:te,podcastSetting:ne}=(()=>{var e,t;const n=(0,Je.Uk)(),i=(0,As.A)("podcast_assistant"),[o,s]=(0,m.useState)(Qv.summary),r=(null===(e=Dd())||void 0===e?void 0:e.meta.title)||"",a=(null===(t=Dd())||void 0===t?void 0:t.meta.duration)||0,l=(0,m.useMemo)((()=>[{itemKey:Qv.summary,itemTitle:n("flow_web_ext_youtube_summary"),enable:!0},{itemKey:Qv.mindmap,itemTitle:n("flow_web_ext_search_mindmap"),enable:i.mindmap_show},{itemKey:Qv.memo,itemTitle:n("bookmarks_sidebar_notes"),enable:!0}]),[i]),c=(0,m.useCallback)((()=>{const e=l.filter((e=>e.enable));return e.length<=1?(0,Te.jsx)(Te.Fragment,{}):(0,Te.jsx)(Yl,{webpageTabs:e,activeKey:o,onChange:e=>{s(e);let t="summary";e===Qv.mindmap?t="mind_map":e===Qv.memo&&(t="take_note"),Gv({result_type:t,button_name:"switch_result_type",whether_full_screen:0,content_title:r,content_duration:a})}})}),[o,l]);return{activeTab:o,renderTab:c,podcastSetting:i}})(),ie=(0,v.B)(),oe=(0,As.A)("collection_assistant"),se=ne.subtitle_search_enabled&&Z&&a&&a.length>0&&D,re=(0,m.useCallback)((()=>{var e;return{collectFrom:zt.vP.podcast_collect,collectionType:nn.e.PodcastSummary,podcastSummaryResult:{summary:L,summary_msg_id:(null===(e=R[r])||void 0===e||null===(e=e.body)||void 0===e||null===(e=e.message)||void 0===e?void 0:e.message_id)||"",podcastParams:{podcast_type:(0,Pi.Ll)(M),audio_url:u.mediaUrl,title:u.title,timeline:wi(B)||[],cover_url:u.coverUrl,transcript:a?JSON.stringify(a):"",podcast_duration:u.duration,theme_color:(0,Pi.lE)((0,Pi.Ll)(M))},getHtmlContent:()=>(0,Pi.F4)((0,Pi.Ll)(M))}}}),[L,R,r,M,B,a,u]),ae=(0,m.useCallback)(((e,t)=>{dc(t),s&&(s.currentTime=e.offset/1e3,s.play())}),[s]);return(0,Te.jsxs)("div",{"data-testid":"podcast-assistant-container",style:{maxHeight:d?`${d}px`:"unset"},className:J()(Zv.podcastSummaryContainer),ref:E,children:[(0,Te.jsx)(xe.A,{className:J()(Zv.area),show:S,setShow:k,position:"bottomRight",optionPageSection:"podcast-summary",disableKey:os.lf.podcastSummary,onDisableOnceClick:f,children:(0,Te.jsx)("div",{className:Zv.closeIcon,"data-testid":"podcast-assistant-close-btn",onPointerDown:()=>k(!0),children:(0,Te.jsx)(Rm.A,{className:Zv.icon})})}),(0,Te.jsx)(su,{available:W,contentVisible:c!==zi.t.default,popContainerRef:E,isAllDone:!!P,noContent:!!F,hasTranscript:!0,isTranscriptLoaded:Q,summarizeTriggered:c!==zi.t.default,hideToolBtns:!1,translateLanguage:l,onTranslateLanguage:h,onSummarizeVideo:()=>x(),onClickLogin:()=>{(0,_e.DT)({trackMeta:{previous_page:"podcast_page",login_entrance:"podcast_page"}})},renderActionBtnTabs:X?void 0:te,showSearch:se,searchTooltip:ie("flow_web_ext_subtitle_search_podcast"),onSearch:e=>I(e)}),se&&T&&(0,Te.jsx)(Cc,{subtitles:a,query:T,onVisible:cc,onItemClick:ae}),(0,Te.jsxs)("div",{className:Zv.tabContainer,style:{display:se&&T?"none":"flex"},children:[X?(0,Te.jsx)(Jv,{status:c}):(0,Te.jsxs)(je.tU,{activeKey:ee,renderTabBar:()=>null,children:[(0,Te.jsx)(je.mF,{itemKey:Qv.summary,children:(0,Te.jsx)(Zu,{mediaElement:s,onClickHighlight:y,available:W,hasNoSubtitles:!1,isContentOnRisk:!1,hasShowedUserGuidance:!0,noContent:!!F,contentVisible:!0,videoSummaryId:r,onRetry:p,isSummaryDone:!A.isSummaryLoading,isHighlightsDone:!A.isHighlightsLoading,transcript:a,highlightsResult:B,trackHighlightEvent:(e,t,n,i)=>{e===_.Ur.clickVideoAssistantHighlightsTimeline&&Gv({result_type:"summary",whether_full_screen:0,button_name:"timeline",content_title:j,content_duration:N}),sc(e,{summary_message_id:L?r:"",video_time:t,position:n,is_immersion:i?1:0,content_type:"podcast"})},videoState:U,setVideoState:H,handleUserInteract:()=>{q(!0),clearTimeout(V.current),V.current=setTimeout((()=>{q(!1)}),1e4)},userInteracting:z,isImmersionMode:!1,summarizeLanguage:b})}),(0,Te.jsx)(je.mF,{itemKey:Qv.mindmap,children:(0,Te.jsx)(ef,{isActive:ee===Qv.mindmap,transcript_list:a,translateLanguage:l})}),(0,Te.jsx)(je.mF,{itemKey:Qv.memo,children:ee===Qv.memo&&(0,Te.jsx)(of,{transcript:a,getCollectionParam:re})})]}),W&&ee===Qv.summary&&P&&!F&&(0,Te.jsx)(_u,{onClickContinueInChat:()=>{Gv({result_type:"summary",whether_full_screen:0,button_name:"continue_in_chat",content_title:j,content_duration:N})},popContainerRef:E,onCopy:()=>{Gv({result_type:"summary",whether_full_screen:0,button_name:"copy",content_title:j,content_duration:N})},onClickAudio:()=>{Gv({result_type:"summary",whether_full_screen:0,button_name:"read",content_title:j,content_duration:N})},transcript:a,summaryResult:L,highlightResult:B,videoSummaryId:r,shareSlot:(0,Te.jsx)(Xv,{containerRef:E,onOpenShareCard:()=>{Gv({result_type:"summary",whether_full_screen:0,button_name:"share",content_title:j,content_duration:N}),G()}}),collectionData:"xiaoyuzhou"===(null==M?void 0:M.name)&&oe.podcast_enabled?{getCollectionParam:re,click_from:zt.vP.podcast_collect,collect_type:zt.p6.Podcast}:void 0})]}),K&&(0,Te.jsx)(Vv,{onClose:Y,type:bv.podcast,msgId:r,title:o.title,shareLink:o.url+We.yt,imgUrl:o.cover})]})},rf=m.memo(sf),af=[".mp3",".m4a",".wav",".ogg",".flac",".ape",".aac",".aiff",".wma",".webm"],lf=450,cf=()=>{var e;const t=(0,m.useRef)(document.querySelector("main")),n=(0,m.useRef)(document.querySelector('[class*="avater-container"]')),i=(0,m.useCallback)((()=>{var e;return((null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect().top)||110)<=30}),[]),[o,s]=(0,m.useState)({center:(window.innerWidth-((null===(e=t.current)||void 0===e?void 0:e.offsetWidth)||600))/2<lf,sticky:i(),forceUpdate:0});(0,m.useEffect)((()=>{let e=null;const a=()=>{e&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>{if(!n.current||o.center)return;const{top:e}=n.current.getBoundingClientRect();s((0,r.A)((0,r.A)({},o),{},{sticky:e<=30}))}))};window.addEventListener("scroll",a);let l=null;const c=()=>{l&&cancelAnimationFrame(l),l=requestAnimationFrame((()=>{var e;const n=(null===(e=t.current)||void 0===e?void 0:e.offsetWidth)||0;if((window.innerWidth-n)/2<lf)s((0,r.A)((0,r.A)({},o),{},{sticky:!1,center:!0}));else{const e=i();s({forceUpdate:e?o.forceUpdate+1:o.forceUpdate,sticky:e,center:!1})}}))};return window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c),window.removeEventListener("scroll",a)}}),[o.center,o.forceUpdate]);const a=(0,m.useMemo)((()=>{var e;if(o.center)return{padding:"0 20px"};const i=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect())||{left:0,width:0},s=o.sticky?i.left-lf:-450;let r=30;if(!o.sticky){const e=n.current;if(e){var a;const t=(null===(a=e.parentElement)||void 0===a||null===(a=a.nextElementSibling)||void 0===a?void 0:a.getBoundingClientRect().top)||0;r=e.getBoundingClientRect().top-t}else r=0}return{position:o.sticky?"fixed":"absolute",left:`${s}px`,top:`${r}px`,width:"450px",padding:"0 20px","z-index":"10"}}),[o.center,o.sticky,o.forceUpdate]);let l=600;var c;o.center||(l=o.sticky?window.innerHeight-30-100:window.innerHeight-((null===(c=n.current)||void 0===c?void 0:c.getBoundingClientRect().top)||0)-100);return{summaryMaxHeight:l,layoutCss:a}},df=function(){var e=(0,a.A)((function*(){const e=yield fetch(location.href),t=yield e.text();let n="";const i=t.match(/[\\]*"assetUrl[\\]*":[\\]*"(.*?)[\\]*"/);null!=i&&i[1]&&(n=i[1]);let o="";const s=t.match(/[\\]*"name[\\]*":[\\]*"(.*?)[\\]*"/);null!=s&&s[1]&&(o=s[1]);let r="";const a=t.match(/[\\]*"durationInMilliseconds[\\]*":[\\]*(.*?),[\\]*/);null!=a&&a[1]&&(r=fi(parseInt(a[1])/1e3));let l="";const c=t.match(/<source srcset="(.*?0w\.(png|jpg|webp)).*,.*"/);return null!=c&&c[1]&&(l=c[1]),{mediaUrl:n,coverUrl:l,title:o,duration:r}}));return function(){return e.apply(this,arguments)}}(),uf=e=>{const t=(0,m.useRef)(document.querySelector('button[class*="icon-play"]')),[,n]=(0,m.useState)(0),i=(0,m.useRef)();(0,m.useEffect)((()=>{if(e.current||!t.current)return;const o=new MutationObserver((function(){if(e.current)return;const t=document.querySelector("audio");var o;return"apple-music-player"===(null==t?void 0:t.id)&&t instanceof HTMLAudioElement&&""!==t.src?((0,ar.Rm)("[zx] podcast: find audio element"),e.current=t,null===(o=i.current)||void 0===o||o.call(i,e.current),void n((e=>e+1))):void 0}));return o.observe(document.body,{childList:!0,attributes:!0,subtree:!0}),()=>{o.disconnect()}}),[t.current,e.current]);return{summaryMaxHeight:600,onClickHighlight:n=>{!e.current&&t.current&&(i.current=n,t.current.click())}}},hf=e=>{const t=(0,m.useRef)(null),[n,i]=(0,m.useState)({mediaUrl:"",coverUrl:"",title:"",duration:""}),o="xiaoyuzhou"===(null==e?void 0:e.name),s="applepodcast"===(null==e?void 0:e.name),r=o?cf:s?uf:void 0,{summaryMaxHeight:a,layoutCss:l,onClickHighlight:c}=(null==r?void 0:r(t))||{};return(0,m.useEffect)((()=>{if(!e)return;const n=e=>{af.find((t=>{var n;return null===(n=e.mediaUrl)||void 0===n?void 0:n.toLowerCase().endsWith(t)}))||(0,ar.z3)("[zx] podcast: audio src not valid",e.mediaUrl),(0,ar.Rm)("[zx] podcast: audio info:",e),i(e)},o=e.audioQuery?document.querySelector(e.audioQuery):null;switch(o instanceof HTMLAudioElement&&""!==o.src&&(t.current=o),e.name){case"xiaoyuzhou":{const e=(e=>{var t,n;const i=(null===(t=document.querySelector("h1.title"))||void 0===t?void 0:t.textContent)||"";let o="";const s=document.querySelector('img[class*="avatar"]');s instanceof HTMLImageElement&&(o=s.src);const r=null===(n=document.querySelector('div[class*="label right"]'))||void 0===n?void 0:n.textContent;let a=r||"";if(r){const e=r.split(":"),t=parseInt(e[0]),n=parseInt(e[1]);t>=60&&(a=fi(60*t+n))}return{mediaUrl:(null==e?void 0:e.src)||"",coverUrl:o,title:i,duration:a}})(t.current);n(e);break}case"applepodcast":df().then((e=>{n(e)}))}}),[]),{summaryMaxHeight:a,layoutCss:l,audioEle:t.current,mediaUrl:n.mediaUrl,podcastTitle:n.title,podcastDuration:n.duration,coverUrl:n.coverUrl,onClickHighlight:c}};var mf=n(50711);const pf=()=>{var e;const t=null===(e=(0,m.useContext)(cn))||void 0===e?void 0:e.platform,[n]=(0,f.Y)("podcastSummaryDisableHosts"),[i]=(0,f.Y)("podcastSummaryDisableAll"),o=n.includes(window.location.host)||i,[s,l]=(0,m.useState)(zi.t.default),[c,d]=(0,m.useState)(!1),{summaryMaxHeight:u,layoutCss:h={},audioEle:p,mediaUrl:g,podcastTitle:v,coverUrl:x,podcastDuration:y,onClickHighlight:b}=hf(t),[w,C]=(0,m.useState)(void 0),A=(0,m.useRef)(void 0),[S,k]=(0,m.useState)(!1),E=(0,m.useRef)(null),[T,I]=(0,m.useState)(""),j=(0,An.P)((e=>e.sendMessage)),N=(0,m.useRef)(""),[R,M]=(0,m.useState)({isSummaryLoading:!1,isHighlightsLoading:!1}),{value:P}=(0,Kr.Tu)(Kr.FM.enableHighlightTag,!1),[L,B]=(0,f.Y)("mediaCardTranslateLanguage"),D=(0,m.useRef)();(0,m.useEffect)((()=>{const e=null!=t&&t.buttonContainerNodeQuery?document.querySelector(t.buttonContainerNodeQuery):null;return e?(D.current=document.createElement("div"),D.current.style.marginLeft="10px",e.appendChild(D.current)):d(!0),()=>{e&&D.current&&e.removeChild(D.current)}}),[]),(0,m.useEffect)((()=>{v&&y&&(({content_title:e,content_duration:t})=>{(0,It.z8)(_.Ur.showPodcastAssistant,{content_title:e,content_duration:t},!0,!1)})({content_title:v,content_duration:_i(y)})}),[v,y]);const O=(0,m.useCallback)((e=>{l(e)}),[]),F=(0,m.useCallback)(function(){var e=(0,a.A)((function*(e){try{if(yield Fi(location.href,(null==t?void 0:t.name)||""))return;const n=location.href,i=yield Di(n,(null==t?void 0:t.name)||"",e);"success"===i.status?setTimeout((()=>{ai.on.getState().updateWebContext({type:ai.e6.audioTranscript,content:(0,yn.qf)(i.transcript||[])})}),1e3):"fail"===i.status&&ai.on.getState().updateWebContext({type:ai.e6.default,content:""})}catch(n){(0,ar.z3)("podcast: fetch podcast transcript failed",n)}}));return function(t){return e.apply(this,arguments)}}(),[]),U=function(){var e=(0,a.A)((function*(e){(0,ar.Rm)("[zx] podcast: start polling to get podcast transcript");try{const n=location.href,i=yield Di(n,(null==t?void 0:t.name)||"",e);if("success"===i.status||"fail"===i.status)if(k(!1),E.current&&(clearInterval(E.current),E.current=null),"success"===i.status)C(i.transcript),ai.on.getState().updateWebContext({type:ai.e6.audioTranscript,content:(0,yn.qf)(i.transcript||[])});else if("fail"===i.status)throw O(zi.t.commonFailed),ai.on.getState().updateWebContext({type:ai.e6.default,content:""}),new Error(`podcast url ${n}, resource url ${e}`)}catch(n){(0,ar.z3)("[zx] podcast: fetch podcast transcript failed",n)}}));return function(t){return e.apply(this,arguments)}}();(0,m.useEffect)((()=>(S?E.current=setInterval(U,1e4,A.current):E.current&&clearInterval(E.current),()=>{E.current&&clearInterval(E.current)})),[S]);const H=e=>{(0,ar.Rm)("[zx] podcast: start send message to ai summary(summary + highlight)");const t={title:v,url:location.href,transcript_list:w,with_tag:P,skill_name:"video_summary"};((e,t)=>{const n=j((0,r.A)((0,r.A)({},e),{},{browser_language:(0,kn.wz)(null!=t?t:L),current_page:(0,It.M5)(location.href),scene:bo.sJ.podcast,sec_scene:bo._o.podcast_click_summary,preventDefaultAuthAction:!0}));I(n),N.current=n,(0,ar.Rm)("[zx] podcast: summaryId",n)})({text:location.href,prompt:so.EU.youtube,browser_youtube_transcript:{browser_plugin_info:JSON.stringify(t)}},e)};(0,m.useEffect)((()=>{null!=w&&w.length&&(H(L),ch({cover_url:x,title:v,duration:y}))}),[w]);const z=function(){var e=(0,a.A)((function*(){if(s!==zi.t.default)return;if(!g)return;if(l(zi.t.loading),I(""),d(!0),M({isSummaryLoading:!0,isHighlightsLoading:!0}),(({content_title:e,content_duration:t})=>{(0,It.z8)(_.Ur.clickPodcastAssistantSummarizeBtn,{content_title:e,content_duration:t},!1,!0)})({content_title:v,content_duration:_i(y)}),Yv({result_type:"summary",content_title:v,content_duration:_i(y)}),null!=w&&w.length)return void H(L);if(A.current)return k(!0),void(yield U());const e=yield Fi(location.href,(null==t?void 0:t.name)||"");if((0,ar.Rm)(`[zx] podcast: ${e?"":"no "}need upload resource`),e){const e=performance.now();mf.J.getFileBlob(g,function(){var t=(0,a.A)((function*(t){if(!t)return(0,ar.z3)("[zx] podcast: dowload audio failed"),void O(zi.t.commonFailed);const n=t.size/1048576;if(n>=200)return(0,ar.Rm)("[zx] podcast: file size >= 200MB, cant transform to text"),void O(zi.t.commonFailed);(0,ar.Rm)(`[zx] podcast: download audio resource(${t.type}, ${n.toFixed(3)}MB) success, start to upload to imageX...`);try{var i;const n=yield(0,xn.r)(t,"file"),{data:o}=yield Wv.j.apiService.resource.GetFileURL({uris:[n],type:"file"}),s=performance.now(),r=null==o||null===(i=o.file_urls)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.main_url;(0,ar.Rm)(`[zx] podcast: upload resource, url(${r}), duration: ${((s-e)/1e3).toFixed(3)}s`),A.current=r,k(!0),yield U(r)}catch(o){(0,ar.z3)("[zx] podcast: upload failed, error",o),O(zi.t.commonFailed)}}));return function(e){return t.apply(this,arguments)}}())}else k(!0),yield U()}));return function(){return e.apply(this,arguments)}}();return(0,m.useEffect)((()=>{((0,Wr.$Z)()||(0,Wr.cr)()||(0,Wr.Z)())&&g&&z(),Hi.x.resetVideoSummaryStatus(),F()}),[g]),(0,m.useEffect)((()=>{Hi.x.setVideoSummaryStatus({podcastType:null==t?void 0:t.name,audioUrl:g,title:v,coverUrl:x,transcript:w,summaryStatus:s,summaryId:T,duration:y})}),[s,v,g,x,w,T,y]),o?null:g?(0,Te.jsx)(Bd.Provider,{value:{scene:"podcast",secScene:null==t?void 0:t.name,meta:{title:v,duration:_i(y)}},children:(0,Te.jsxs)("div",{className:J()("cici-ext-always-light","semi-always-light"),style:{position:"relative"},children:[D.current&&Ac.createPortal((0,Te.jsx)(Kv,{buttonState:s,handleClick:z}),D.current),c&&(0,Te.jsx)("div",{style:h,children:(0,Te.jsx)(rf,{episodeMeta:{url:location.href,title:v,cover:x},audioElement:p,summaryId:T,summaryStatus:s,transcript:w,lang:L,summaryMaxHeight:u,podcastMeta:{mediaUrl:g,coverUrl:x,duration:y,title:v},handleLangChange:e=>{(0,ar.Rm)("[zx] podcast: change language to",e),l(zi.t.loading),B(e),H(e),Gv({result_type:"summary",whether_full_screen:0,button_name:"translate",content_title:v,content_duration:_i(y)})},handleClickClose:()=>{l(zi.t.default),d(!1),k(!1)},handleRetry:()=>H(L),handleMsgDone:()=>{l(zi.t.done)},handleSummary:z,onClickHighlight:b,summarizeLanguage:L,lastSummaryId:N.current,handleLoadingStatus:e=>M(e),loadingStatus:R})})]})}):null};function gf(e){const[t,n]=(0,m.useState)(void 0),[i]=(0,f.Y)("authInfo");return(0,m.useEffect)((()=>{if(!i.isAuthenticated)return void n(void 0);const t=(0,T.A)((()=>{if(!(0,ot.ku)())return;if((0,on.Ay)(location.href))return;const t=e||((0,tn.OM)()?nn.e.VideoSummary:un()?nn.e.Pdf:an(location.href)?nn.e.PodcastSummary:nn.e.Web);(0,Tn.K)(t,t===nn.e.Web?void 0:"").then((e=>{Kn(e).then((e=>{n(e)})).catch((()=>n(void 0)))})).catch((()=>n(void 0)))}),1e4),o=e=>{n(e),t()},s=new MutationObserver(t);return s.observe(document,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("focus",t),pn.A.on("router-change",t),pn.A.on("onWebpageSaved",o),t(),()=>{s.disconnect(),pn.A.off("router-change",t),window.removeEventListener("focus",t),pn.A.off("onWebpageSaved",o)}}),[i]),t}var vf=n(29322);const ff=e=>{const t=(0,It.M5)(location.href);(0,Ke.s)(_.Ur.showPdfAssistant,{current_page:t,show_from:e}),(0,$e.M7)({current_page:t,show_from:_.Ur.showPdfAssistant})},_f=e=>{const t=(0,It.M5)(location.href);(0,Ke.s)(_.Ur.clickReadPdfBtn,{current_page:t,click_from:e}),(0,$e.dn)({current_page:t,click_from:_.Ur.clickReadPdfBtn})};var xf=n(70139);let yf=function(e){return e.YOUTUBE_SUMMARIZE="onboarding_youtube_summarize",e.VIDEO_SUMMARIZE="onboarding_video_summarize",e.ARTICLE_SUMMARIZE="onboarding_article_summarize",e.CHAT="chat",e.PDF="pdf",e}({});const bf=({current_page:e})=>{(0,It.z8)(_.Ur.enterPage,{current_page:e,previous_page:_.g6.welcome})};var wf=n(73134),Cf=n(29761);const Af="pdfAssistantContainer-tzWRfF",Sf="pdfCollectBtn-z2TM9_",kf="name-rmIuEu",Ef="readButton-ZDzC9k",Tf="text-kak2Ld",If="buttonArxiv-s7j92h",jf="buttonPdfChrome-U0M4qX",Nf="buttonPdfEdge-uB3XIz",Rf="buttonPdfSafari-EZUGmo";function Mf(){var e;const t=(0,Je.Uk)(),n=null===(e=(0,m.useContext)(hn))||void 0===e?void 0:e.platform,i=null==n?void 0:n.name,o=(0,Co.l)((e=>e.isSidePanelMode)),s=(0,Co.l)((e=>e.setIsShowSidebar)),c=(0,ai.on)((e=>e.setFloatingCardVisible)),d=(0,ai.on)((e=>e.setSummaryActionVisible)),[u,h]=(0,f.Y)("needOpenSideBar"),p="arxiv"===i,g=(0,l.UP)(),v=(0,l.nr)(),x=window.location.protocol.startsWith("file:"),y=!p&&!x&&(0,ot.ku)(),[b,w]=(0,m.useState)(!1);(0,m.useEffect)((()=>{o?(0,a.A)((function*(){yield(0,vf.EE)(),Cf.O.initMessageProtocolService(),w(!0)}))():w(!0)}),[o]),(0,m.useEffect)((()=>{ff(p?_.Z5.arxiv:_.Z5.pdf),u&&(h(!1),s(!0,_.cz.other),c(!1),d(!1))}),[]);const C=function(){var e=(0,a.A)((function*(){const e=p?location.href.replace("/abs/","/pdf/"):location.href;p?_f(_.Z5.arxiv):(s(!0,_.cz.other),c(!1),d(!1),_f(_.Z5.pdf)),o?(s(!0,_.cz.other),yield(0,ko.Z)(),(0,jn.cs)({name:"read-pdf",body:{url:e}})):(yield(0,Jt.$D)(),(0,wf.M)({url:e})),p&&(h(!0),location.href=e)}));return function(){return e.apply(this,arguments)}}(),[S,k]=(0,m.useState)(!1),[E,T]=(0,m.useState)(0),I=(0,m.useRef)({}),j=!(0,f.Y)("authInfo")[0].isAuthenticated&&x,N=(0,m.useMemo)((()=>"arxiv"===(null==n?void 0:n.name)?zt.vP.arxiv_view_pdf:zt.vP.chrome_pdf_viewer),[n]);(0,m.useEffect)((()=>{y&&(0,zt.ae)(N,zt.p6.pdf)}),[x]);const R=gf(),M=(0,m.useMemo)((()=>(0,Te.jsx)(Hs,{collected:!!R,savedId:R,collectType:zt.p6.pdf,clickFrom:N})),[R]);return(0,m.useEffect)((()=>{var e;(null===(e=location.hash)||void 0===e?void 0:e.startsWith(We.RB))&&(C(),bf({current_page:yf.PDF})),A.vF.persist.info({eventName:"PDF ASSISTANT mounted",meta:{uriType:location.href.startsWith("file")?"file":"web"}})}),[]),(0,Te.jsxs)("div",{className:J()(Af,{[If]:p,[jf]:!p&&!g&&!v,[Nf]:!p&&g,[Rf]:!p&&v}),children:[b&&(0,Te.jsxs)("div",{className:J()(Ef),onClick:()=>{var e;if(_f(p?_.Z5.arxiv:_.Z5.pdf),j)return void(0,_e.DT)({trackMeta:{previous_page:"web",login_entrance:"web"}});if(S)return;const t=p?location.href.replace("/abs/","/pdf/"):location.href,n=p?"from_extention_read_pdf_arxiv":"from_extention_read_pdf_pdfviewer",i=null===(e=I.current)||void 0===e?void 0:e[t];if(x&&!i)k(!0),mf.J.getFileBlob(t,(e=>{e?(0,wf.M)({url:t,blob:e,createMessage:!1},((e,i)=>{T(e.percent),e.percent>=100&&(I.current[t]=(0,r.A)({key:e.key},i),k(!1),T(0),(0,mf.f)({type:"file",file:(0,r.A)({key:e.key},i),fromSource:n,opt:{createNewConv:!0,sendReadMessage:!0}}))})):k(!1)}));else{const e=!!i;(0,mf.f)({type:e?"file":"link",link:e?void 0:{url:t},file:e?(0,r.A)({},i):void 0,fromSource:n,opt:{createNewConv:!0,sendReadMessage:!0}})}},"data-testid":"flow-pdf-assistant-airead",children:[S?(0,Te.jsx)(je.tK,{spinning:!0,size:"small"}):(0,Te.jsx)(Pe.HD,{}),(0,Te.jsx)("div",{className:Tf,children:S?t("flow_web_ext_pdf_page_btn_immersive_uploading",{number:E}):t(j?"flow_web_ext_pdf_page_btn_log_out_immersive":"flow_web_ext_pdf_page_btn_immersive")})]}),y&&(0,Te.jsxs)("button",{className:Sf,onPointerUp:()=>{R?ao(R,N,zt.p6.pdf):ro({collectFrom:N,collectionType:wn.X.Pdf})},"data-testid":"flow-pdf-assistant-collect",children:[R?(0,Te.jsx)(Rs,{}):(0,Te.jsx)(Ms.A,{}),(0,Te.jsx)("span",{className:kf,children:M})]})]})}var Pf=n(93976),Lf="new-mail",Bf="reply",Df="forward";let Of=function(e){return e.positive="positive",e.negative="negative",e.uncertain="need_more",e}({});var Ff="create",Uf="reply",Hf="regeneration",zf="formalize",qf="elaborate",Vf="shorten",$f="insert",Wf="reply lange";const Kf='[class="gmail_quote"]',Yf=(e,t=!0)=>{if(!e)return"";let n="";return e.childNodes.forEach((e=>{e instanceof HTMLElement&&e.matches(Kf)||(n+=e.textContent)})),t?n.trim():n},Gf=(e,t)=>{var n;if(t!==Bf)return"";const i=document.querySelectorAll('[role="listitem"]');let o=null;for(const h of i)if(h.contains(e)){o=h;break}if(!o)return"";const s=o.querySelector('[data-message-id*="#msg-"]');if(!s)return"";const r=(null===(n=s.getAttribute("data-message-id"))||void 0===n?void 0:n.match(/^#msg-([r|f|a]):.+/))||null;if(!r)return"";const a=r[1],l="r"===a||"f"===a?s.querySelector('[jslog*="20277"]'):null;if(!l)return"";let c="",d=!1;const u=e=>{var t;if(e.nodeType===Node.TEXT_NODE)c+=(null===(t=e.textContent)||void 0===t?void 0:t.trim())||"";else if(e.nodeType===Node.ELEMENT_NODE){if((e=>{for(const t of[Kf,'[id*="divRplyFwdMsg"]','[id*="lark-mail-quote"]'])if(e.matches(t))return!0;return!1})(e))return void(d=!0);for(const t of e.childNodes)d||u(t)}};return u(l),c=c.replace(/\n\s*\n/g,"\n"),c},Qf=e=>""!==(0,Pf.A)(e),Zf=e=>{switch(e){case Of.positive:return _.Z5.mailPositive;case Of.negative:return _.Z5.mailNegative;default:return _.Z5.mailNeedMore}},Xf="container-_HnD61",Jf="non-pop-window-LOUDTy",e_="icon-write-pencil-C8Qtgc",t_="help-write-btn-ft3n62",n_="gradient-button-EctToC",i_="quick-reply-container-mec4qr",o_="quick-reply-text-SLRpCO",s_="quick-action-btn-l5msDz",r_="quick-reply-popover-Ha5FIZ",a_="quick-reply-message-container-w1Okm9",l_="mail-stream-message-rKVARE",c_="quick-reply-toolbar-rjWpIX",d_="mail-input-container-mE5nG4",u_="mail-input-textarea-C_HZBR",h_="mail-input-btn-container-uuyYvE",m_="mail-input-cancel-btn-hxgwmJ",p_="mail-header-left-lw1XVt",g_="icon-arrow-FffRH_",v_="mail-input-ok-btn-KOQQ5i",f_="btn-disable-eEHGUv",__="mail-message-container-t3DtyB",x_="mail-stream-message-container-W2GSGg",y_="mail-toolbar-HMJVdE",b_="mail-toolbar-hidden-jlCCeB",w_="mail-toolbar-left-SRmWKN",C_="mail-operation-btn-BJdgZ4",A_="mail-operation-btn-text-vOfZEO",S_="mail-toolbar-insert-button-IPiwra",k_="mail-header-input-Y5rKom",E_="is-inputting-UcaZT_",T_="header-right-lfm_Jq",I_="close-btn-wVRrfQ",j_="close-btn-behind-not-editable-E5QwMD",N_="not-editable-content-KpzdYO",R_="not-write-done-Lh5aMx",M_="mail-divider-KlplzU",P_="btn-dropdown-trigger-fuI45K",L_="btn-refine-yB7V1i",B_="btn-dropdown-container-fORGk6",D_="refine-triangle-expand-H3s7G3",O_="mail-toolbar-right-McT0t7",F_="regenerate-icon-container-NZMvPS",U_="languageBtn-A2EWmB",H_=({handleClick:e})=>{const t=(0,v.B)();return(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(je.$n,{className:C_,onClick:()=>e(zf),icon:(0,Te.jsx)(Pe.zG,{}),"data-testid":"mail-formalize-btn",children:(0,Te.jsx)("div",{className:A_,children:t("flow_web_ext_email_formalize")})}),(0,Te.jsx)(je.$n,{className:C_,onClick:()=>e(qf),icon:(0,Te.jsx)(Pe.li,{}),"data-testid":"mail-elaborate-btn",children:(0,Te.jsx)("div",{className:A_,children:t("flow_web_ext_email_elaborate")})}),(0,Te.jsx)(je.$n,{className:C_,onClick:()=>e(Vf),icon:(0,Te.jsx)(Pe.P$,{}),"data-testid":"mail-shorten-btn",children:(0,Te.jsx)("div",{className:A_,children:t("flow_web_ext_email_shorten")})})]})},z_=({handleClick:e,position:t="topLeft"})=>{const n=(0,m.useRef)(null),[i,o]=(0,m.useState)(!1),s=(0,v.B)();return(0,Te.jsx)("div",{ref:n,onMouseDown:e=>e.stopPropagation(),style:{position:"relative"},children:(0,Te.jsx)(je.ms,{className:B_,position:t,trigger:"click",render:(0,Te.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:(0,Te.jsx)(H_,{handleClick:e})}),getPopupContainer:()=>n.current,onVisibleChange:e=>{"topLeft"===t&&o(e)},children:(0,Te.jsxs)("div",{className:P_,children:[(0,Te.jsx)(Pe.EH,{}),(0,Te.jsx)("div",{className:L_,children:s("flow_web_ext_email_refine")}),(0,Te.jsx)(Pe.R0,{className:J()({[D_]:i})})]})})})},q_=({handleClick:e,isShow:t})=>{const n=(0,v.B)(),[i,{width:o}]=(0,Nm.A)();return(0,Te.jsxs)("div",{ref:i,className:J()(y_,{[b_]:!t}),children:[(0,Te.jsxs)("div",{className:w_,children:[(0,Te.jsx)(je.$n,{className:C_,onClick:()=>e(Hf),icon:(0,Te.jsx)(Pe.eD,{}),"data-testid":"mail-regenerate-btn",children:(0,Te.jsx)("div",{className:A_,children:n("flow_web_ext_email_regen")})}),o<=502?(0,Te.jsx)(z_,{handleClick:e}):(0,Te.jsx)(H_,{handleClick:e})]}),(0,Te.jsx)(je.$n,{"data-testid":"mail-insert-btn",type:"primary",theme:"solid",className:S_,onClick:()=>e($f),children:n("flow_web_ext_email_insert")})]})},V_=e=>{const{replyLang:t,handleClick:n}=e,i=(0,v.B)(),o=(0,m.useRef)(null);return(0,Te.jsxs)("div",{ref:o,className:c_,children:[(0,Te.jsxs)("div",{className:w_,children:[(0,Te.jsx)(je.$n,{"data-testid":"mail-insert-btn",type:"primary",theme:"solid",className:S_,style:{marginRight:"8px"},onClick:()=>n($f),children:i("flow_web_ext_email_insert")}),(0,Te.jsx)(z_,{position:"bottomLeft",handleClick:n})]}),(0,Te.jsxs)("div",{className:O_,children:[(0,Te.jsx)(iu,{scene:Yd.jv.mail,translateLanguage:t,anchorRef:o,popContainerRef:o,toolTipClassname:U_,onLanguageChange:e=>{n(Wf,e)}}),(0,Te.jsx)(je.m_,{content:i("flow_web_ext_email_regen"),spacing:{y:10,x:0},getPopupContainer:()=>o.current,children:(0,Te.jsx)("div",{className:F_,onClick:()=>n(Hf),"data-testid":"mail-regenerate-btn",children:(0,Te.jsx)(Pe.eD,{})})})]})]})},$_=e=>{const t=(0,v.B)(),{content:n,onChangeContent:i,handleCancel:o,handleSubmit:s,onResize:r}=e,a=!Qf(n);return(0,Te.jsxs)("div",{"data-testid":"mail-input-container",className:J()(d_,{}),children:[(0,Te.jsxs)("div",{className:p_,children:[(0,Te.jsx)(Pe.un,{className:e_}),(0,Te.jsx)(je.fs,{autosize:{maxRows:3},rows:1,className:J()({[u_]:!a}),value:n,onChange:i,autoFocus:!0,onEnterPress:a?void 0:e=>{"Enter"===e.key&&e.shiftKey||s()},onResize:r,placeholder:t("flow_web_ext_email_tellme")})]}),(0,Te.jsxs)("div",{className:h_,children:[(0,Te.jsx)(je.$n,{className:m_,theme:"solid",onClick:o,children:t("flow_web_ext_email_cancel")}),(0,Te.jsx)(je.$n,{className:J()(v_,{[f_]:a}),theme:"solid",disabled:a,onClick:s,children:t("flow_web_ext_email_write")})]})]})},W_=e=>{const{content:t,writeDone:n,lastSendContent:i,replyLang:o,inputting:s=!1,disable:r=!1,onBlur:a,onFoucs:l,onChangeContent:c,handleSubmit:d,handleClickClose:u,handleClickReturn:h,onSwitchDivider:p,onChangeLang:g}=e,f=(0,v.B)(),_=!Qf(t)||t===i,x=(0,m.useRef)(null),y=(0,m.useRef)(null);return(0,m.useEffect)((()=>{const e=e=>{i!==t&&e.target!==x.current&&e.preventDefault()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[i,t]),(0,Te.jsxs)("div",{"data-testid":"mail-header-input",className:J()(k_,{[E_]:s}),children:[r?(0,Te.jsx)("div",{className:N_,children:t}):(0,Te.jsxs)("div",{className:J()(p_,{[R_]:!n}),onMouseEnter:()=>null==p?void 0:p(!1),onMouseLeave:()=>null==p?void 0:p(!0),children:[s?(0,Te.jsx)(Pe.Gk,{onMouseDown:h,className:g_}):(0,Te.jsx)(Pe.un,{className:e_}),(0,Te.jsx)(je.pd,{ref:x,borderless:!0,size:"small",value:t,disabled:!n,onFocus:l,onChange:c,onBlur:a,onMouseDown:e=>{e.stopPropagation()},onEnterPress:_?void 0:e=>{"Enter"===e.key&&e.shiftKey||d()},placeholder:f("flow_web_ext_email_tellme")})]}),s?(0,Te.jsx)(je.$n,{theme:"solid",onClick:d,disabled:_,className:J()(v_,{[f_]:_}),"data-testid":"mail-input-update-btn",children:f("flow_web_ext_email_update")}):(0,Te.jsxs)("div",{ref:y,className:T_,children:[(0,Te.jsx)("div",{style:{marginRight:"4px"},children:(0,Te.jsx)(iu,{scene:Yd.jv.mail,anchorRef:y,translateLanguage:o,popContainerRef:y,toolTipClassname:U_,onLanguageChange:e=>{null==g||g(e)}})}),(0,Te.jsx)(je.cG,{layout:"vertical"}),(0,Te.jsx)("div",{className:J()(I_,{[j_]:r}),onClick:u,children:(0,Te.jsx)(Pe.gz,{})})]})]})},K_=e=>{const{id:t,isDone:n,content:i,lastSendContent:o,inputting:s,replyLang:r,inputDisable:a=!1,bottom:l,onInputBlur:c,onInputFocus:d,onInputChange:u,handleClose:h,handleReturn:m,handleUpdate:p,handleClickTool:g}=e;return(0,Te.jsxs)("div",{"data-testid":"mail-message-container",style:{bottom:`${l}px`},className:__,children:[(0,Te.jsxs)("div",{children:[(0,Te.jsx)(W_,{writeDone:n,content:i,lastSendContent:o,inputting:s,disable:a,replyLang:r,onBlur:c,onFoucs:d,onChangeContent:u,handleClickClose:h,handleClickReturn:m,handleSubmit:p,onChangeLang:e=>g(Wf,e)}),(0,Te.jsx)(je.cG,{className:M_,layout:"horizontal"}),(0,Te.jsx)("div",{className:x_,children:(0,Te.jsx)(Qu,{id:t,type:"mail",enableScroll:!0,className:l_,autoScrollToEnd:!1})})]}),n&&(0,Te.jsx)(q_,{handleClick:g,isShow:!s})]})},Y_=e=>{const{id:t,isDone:n,replyLang:i,handleClickBtn:o}=e;return(0,Te.jsxs)("div",{className:a_,children:[(0,Te.jsx)(Qu,{id:t,type:"mail",enableScroll:!0,className:l_,autoScrollToEnd:!1}),n&&(0,Te.jsx)(V_,{replyLang:i,handleClick:o})]})},G_=e=>{(0,It.z8)(_.Ur.showMailEntryButton,(0,r.A)({},e))},Q_=e=>{(0,It.z8)(_.Ur.clickMailEntryButton,(0,r.A)({},e))},Z_=e=>{(0,It.z8)(_.Ur.showMailThreadResult,(0,r.A)({},e))},X_=e=>{(0,It.z8)(_.Ur.closeMailThreadResult,(0,r.A)({},e))},J_=e=>{var t;const n=null==e||null===(t=e.closest("table"))||void 0===t||null===(t=t.parentElement)||void 0===t||null===(t=t.closest("table"))||void 0===t?void 0:t.querySelectorAll('[role="toolbar"]');let i=null;if(n)for(const s of n)if(s.matches(":has([command])")){var o;i=null===(o=s.parentElement)||void 0===o?void 0:o.parentElement;break}return i},ex=(e,t)=>{var n;const{bannerHeight:i}=((e,t)=>{const n=e===Lf,[i,o]=(0,m.useState)(0);return(0,m.useEffect)((()=>{if(!n){var e;const n=null===(e=t.parentElement)||void 0===e||null===(e=e.previousElementSibling)||void 0===e?void 0:e.previousElementSibling;if(!n)return;const i=new MutationObserver((function(){if(n instanceof HTMLElement){n.style.marginLeft="0px",n.style.marginRight="0px";const e=n.style.display;if(""===e){const e=n.getBoundingClientRect().height;o(e)}else"none"===e&&o(0)}}));return i.observe(n,{childList:!1,subtree:!1,attributes:!0,attributeFilter:["style"]}),()=>{i.disconnect()}}}),[n]),{bannerHeight:i}})(t,e),o=(0,m.useRef)(J_(e)),[s,r]=(0,m.useState)(!!o.current),[a,l]=(0,m.useState)((null===(n=o.current)||void 0===n?void 0:n.offsetHeight)||0);let c=0;return 0!==a&&(c+=a+20+i),(0,m.useEffect)((()=>{if(!s||!o.current)return;const e=new MutationObserver((function(){if(!o.current)return;const e=o.current.style.display;""===e?l(o.current.offsetHeight):"none"===e&&l(0)}));return e.observe(o.current,{childList:!1,subtree:!1,attributes:!0,attributeFilter:["style"]}),()=>{e.disconnect()}}),[s]),(0,m.useEffect)((()=>{if(s)return;const t=new MutationObserver((()=>{if(o.current)return;const t=J_(e);t&&(o.current=t,r(!0))}));return t.observe(document.body,{childList:!0,subtree:!1}),()=>{t.disconnect()}}),[]),{bottom:c}},tx=()=>{const e=(0,v.B)(),t=(0,An.P)((e=>e.sendMessage)),n=(0,m.useRef)(""),[i,o]=(0,m.useState)([]);return{replyContentRef:n,quickReplys:i,setQuickReplys:o,initQuickReply:(i,s,r)=>{if(n.current=Gf(i,s),""===n.current)return;(0,It.z8)(_.Ur.quickReplyButtonShow,{button_name:"positive"}),(0,It.z8)(_.Ur.quickReplyButtonShow,{button_name:"negative"}),(0,It.z8)(_.Ur.quickReplyButtonShow,{button_name:"need_more"});const a={action:Uf,reply_content:n.current},l=[{type:Of.positive,text:e("flow_web_ext_email_reply_positive"),msgId:void 0},{type:Of.negative,text:e("flow_web_ext_email_reply_negative"),msgId:void 0},{type:Of.uncertain,text:e("flow_web_ext_email_reply_uncertain"),msgId:void 0}];for(const e of l){const n=t({text:e.text,scene:bo.sJ.mail,prompt:so.EU.mail,answerWithSuggest:!1,browser_mail:JSON.stringify(a),replyLang:(0,kn.wz)(r)});e.msgId=n}o(l)}}},nx=(e,t,n)=>{const i=(0,An.P)((e=>e.sendMessage)),o=(0,se.TK)("uiLanguage"),[s,a]=(0,m.useState)(o),{inputContent:l,inputHeight:c,isInputting:d,lastInputContent:u,fromInputMsgId:h,currInputMsgId:p,generateScene:g,writingDone:v,writingResult:f,setInputContent:x,setIsInputting:y,setLastInputContent:b,setFromInputMsgId:w,setCurrInputMsgId:C,setGenerateScene:A,onChangeInputContent:S,onInputBlur:k,onInputFocus:E,onInputHeightChange:T}=(()=>{const e=(0,An.P)((e=>e.messages)),[t,n]=(0,m.useState)(""),[i,o]=(0,m.useState)(20),[s,r]=(0,m.useState)(!1),[a,l]=(0,m.useState)(""),[c,d]=(0,m.useState)(""),[u,h]=(0,m.useState)(""),[p,g]=(0,m.useState)(_.Z5.mailCreate),{isDone:v,text:f=""}=e[u]||{};return(0,m.useEffect)((()=>{v&&Z_({message_id:u,from_message_id:c,scene:p,thread_length:f.length})}),[v]),{inputContent:t,inputHeight:i,isInputting:s,lastInputContent:a,fromInputMsgId:c,currInputMsgId:u,generateScene:p,writingDone:v,writingResult:f,setInputContent:n,setIsInputting:r,setLastInputContent:l,setFromInputMsgId:d,setCurrInputMsgId:h,setGenerateScene:g,onChangeInputContent:e=>{r(!0),n(e||"")},onInputBlur:()=>{r(!1),n(a)},onInputFocus:()=>{r(!0)},onInputHeightChange:e=>{o(e.height)}}})(),{replyContentRef:I,quickReplys:j,setQuickReplys:N,initQuickReply:R}=tx(),{isPopWindow:M,showHelpWriteBtn:P,showRewrite:L,showFooterInput:B,mainBodyContentRef:D,mainTextRef:O,setShowHelpWriteBtn:F,setShowRewrite:U,setShowFooterInput:H}=(e=>{var t;const n=(0,m.useRef)((null==e||null===(t=e.closest("table"))||void 0===t||null===(t=t.parentElement)||void 0===t||null===(t=t.closest("table"))||void 0===t?void 0:t.querySelector('[aria-multiline="true"][contenteditable="true"]'))||void 0),[i,o]=(0,m.useState)(!!n.current),s=(0,m.useRef)(Yf(n.current)),[r,a]=(0,m.useState)(""===s.current),[l,c]=(0,m.useState)(!r),[d,u]=(0,m.useState)(!1);return(0,m.useEffect)((()=>{if(i)return;const t=new MutationObserver((t=>{t.forEach((t=>{if(!n.current&&"childList"===t.type&&t.addedNodes.length>0){var i;const t=null==e||null===(i=e.closest("table"))||void 0===i||null===(i=i.parentElement)||void 0===i||null===(i=i.closest("table"))||void 0===i?void 0:i.querySelector('[aria-multiline="true"][contenteditable="true"]');if(t)return n.current=t,o(!0),s.current=Yf(n.current),c(""!==s.current),void a(""===s.current)}}))}));return t.observe(document.body,{childList:!0,subtree:!1}),()=>{t.disconnect()}}),[]),(0,m.useEffect)((()=>{if(!n.current)return;const e=new MutationObserver((()=>{s.current=Yf(n.current);const e=""===s.current;(r&&!e||l&&e||d&&!e)&&(c(!e),a(e),u(!1))}));return e.observe(n.current,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),()=>{e.disconnect()}}),[i,r,l,d]),{isPopWindow:(0,m.useMemo)((()=>Array.from(document.querySelectorAll('[role="dialog"][aria-labelledby]')).some((t=>t.contains(e)))),[]),showHelpWriteBtn:r,showRewrite:l,showFooterInput:d,mainBodyContentRef:s,mainTextRef:n,setShowHelpWriteBtn:a,setShowRewrite:c,setShowFooterInput:u}})(t),{bottom:z}=ex(t,n),q=(0,m.useMemo)((()=>({bottom:`${16+c}px`})),[c]),[V,$]=(0,m.useState)(!1),[W,K]=(0,m.useState)(!1),Y=B&&""!==I.current&&!Qf(l);((e,t,n,i,o,s,r)=>{var a;const l=e===Lf,c=(0,m.useRef)(null===(a=r.parentElement)||void 0===a?void 0:a.parentElement);(0,m.useLayoutEffect)((()=>{if(!l&&c.current){const e=`${c.current.offsetHeight}px`;c.current.parentElement&&(c.current.parentElement.style.height=e,c.current.parentElement.parentElement&&(c.current.parentElement.parentElement.style.height=e))}}),[l,t,n,i,o,s]),(0,m.useEffect)((()=>{if(!l&&c.current&&c.current.parentElement){const e=new MutationObserver((function(){if(!c.current)return;const e=`${c.current.offsetHeight}px`;c.current.parentElement&&(c.current.parentElement.style.height=e,c.current.parentElement.parentElement&&(c.current.parentElement.parentElement.style.height=e))}));return e.observe(c.current.parentElement,{childList:!1,subtree:!1,attributes:!0,attributeFilter:["style"]}),()=>{e.disconnect()}}}),[l])})(n,Y,P,L,V,c,t),(0,m.useEffect)((()=>{var e;P?(null===(e=Kr.Ay.Tea)||void 0===e||e.event("show_button",{button_type:"help_me_write",current_page:"mail_page"}),G_({button_name:_._h.write})):L&&G_({button_name:_._h.rewrite})}),[]);const G=(e,t,n)=>{const o={action:e};o.action===Uf&&(o.reply_content=I.current);const r=i({text:t,scene:bo.sJ.mail,prompt:so.EU.mail,answerWithSuggest:!1,browser_mail:JSON.stringify(o),replyLang:(0,kn.wz)(null!=n?n:s)});return y(!1),e===Ff&&b(t),r},Q=()=>{if(Q_({button_name:_._h.write}),F(!1),H(!0),n===Bf){if(0!==j.length&&j.every((e=>void 0!==e.msgId&&""!==e.msgId)))return;R(t,n,s)}},Z=()=>{Q_({button_name:_._h.rewrite}),U(!1),x(D.current),$(!0),C(G(Ff,D.current)),K(!0)},X=()=>{x(""),""===D.current?F(!0):U(!0),H(!1),y(!1)};return{isPopWindow:M,showHelpWriteBtn:P,showRewrite:L,enableQuickReply:Y,showFooterInput:B,showMessageBox:V,messageBottom:z,writingDone:v,writingResult:f,replyLang:s,inputContent:l,lastInputContent:u,inputHeight:c,isInputting:d,currInputMsgId:p,quickReplys:j,quickReplyStyle:q,onInputBlur:k,onInputFocus:E,onInputHeightChange:T,onChangeInputContent:S,handleCancelInput:X,handleCloseMsgBox:()=>{X(),w(""),$(!1),K(!1),X_({message_id:p,scene:g,from_message_id:h,thread_length:f.length})},handleReturn:()=>{y(!1),x(u)},handleWriteOrUpdate:e=>{e===_.Z5.mailCreate&&(H(!1),$(!0));const t=G(Ff,l);C(t),A(e),(e=>{(0,It.z8)(_.Ur.clickInputBar,{scene:e})})(e),w(t)},handleClickToolBar:(e,t,n,i,o)=>{const l=!!o,c=l?o.msgId||"":p;if(e===$f)((e,t,n)=>{if(!t)return;const i=t.querySelector(Kf);if(n)for(;t.firstChild&&t.firstChild!==i;)t.removeChild(t.firstChild);const o=(e=>{const t=e.split("\n");let n="";return t.forEach(((e,t)=>{""!==e.trim()?n+=`<div>${e}</div>`:n+="<br>"})),n+="<br>",n})(e),s=document.createElement("div");s.innerHTML=o,t.insertBefore(s,i)})(n,O.current,W||""===D.current),$(!1),U(!0),K(!1),x(""),w(""),H(!1),d={message_id:c,scene:l?Zf(o.type):g,from_message_id:l?"":h,thread_length:n.length},(0,It.z8)(_.Ur.insertMailThreadResult,(0,r.A)({},d));else{let c=t,d=e;switch(e){case Hf:d=l?Uf:Ff;break;case zf:case qf:case Vf:c=n;break;case Wf:return void((e,t,n)=>{if(a(e),!n){const n=G(Ff,t,e);C(n)}const i=[...j];for(const o of i)o.msgId=G(Uf,o.text,e);N(i)})(null!=i?i:s,c,l)}const u=G(d,c,i);l?N((e=>{const n=[...e],i=n.findIndex((e=>e.text===t));return n[i].msgId=u,n})):C(u),(e=>{(0,It.z8)(_.Ur.clickMailThreadResult,(0,r.A)({},e))})({thread_length:n.length,message_id:u,from_message_id:l?"":h,scene:l?Zf(o.type):g,button_name:e})}var d},handleClickEntry:()=>{e?P?Q():L&&Z():(0,_e.DT)({trackMeta:{previous_page:"gmail_page",login_entrance:"gmail_page"}})}}},ix=e=>{const{showHelpWrite:t,onClick:n}=e,i=(0,v.B)();return(0,Te.jsx)("div",{className:t_,children:(0,Te.jsx)(je.$n,{theme:"solid",size:"default",icon:(0,Te.jsx)(Pe.un,{}),onClick:n,"data-testid":t?"help-write-btn":"rewrite-btn",className:n_,children:i(t?"flow_web_ext_email_helpme":"flow_web_ext_email_rewrite")})})},ox=e=>{const{quickReplysData:t,replyLang:n,cssStyle:i,onClickToolbar:o}=e,s=(0,v.B)(),a=(0,An.P)((e=>e.messages)),l=(0,m.useRef)(null),c=(e,t)=>{const n=t.msgId||"",{isDone:i=!1,text:o=""}=a[n]||{},s=Zf(t.type);var l;e?(l={scene:s},(0,It.z8)(_.Ur.hoverQuickReplyButton,(0,r.A)({},l)),i&&Z_({message_id:n,from_message_id:"",scene:s,thread_length:o.length})):X_({message_id:n,from_message_id:"",scene:s,thread_length:o.length})};return(0,Te.jsxs)("div",{ref:l,className:i_,style:i,children:[(0,Te.jsxs)("div",{className:o_,children:[s("flow_web_ext_email_quickreply"),":"]}),t.map(((e,t)=>{const i=e.msgId||"",{isDone:s=!1,text:r=""}=a[i]||{};return(0,Te.jsx)(je.AM,{className:r_,content:(0,Te.jsx)(Y_,{replyLang:n,id:i,isDone:s,handleClickBtn:(t,n)=>o(t,e.text,r,n,e)}),position:"topLeft",getPopupContainer:()=>l.current,onVisibleChange:t=>c(t,e),children:(0,Te.jsx)(je.vw,{className:s_,children:e.text})},t)}))]})},sx=({isLogin:e=!1,mailScene:t,mailToolContainer:n})=>{const{isPopWindow:i,showHelpWriteBtn:o,showRewrite:s,enableQuickReply:r,showFooterInput:a,showMessageBox:l,messageBottom:c,writingDone:d,writingResult:u,replyLang:h,inputContent:m,lastInputContent:p,isInputting:g,currInputMsgId:v,quickReplys:f,quickReplyStyle:x,onInputBlur:y,onInputFocus:b,onInputHeightChange:w,onChangeInputContent:C,handleCancelInput:A,handleCloseMsgBox:S,handleReturn:k,handleWriteOrUpdate:E,handleClickToolBar:T,handleClickEntry:I}=nx(e,n,t),j=o||s;return(0,Te.jsxs)("div",{className:J()(Xf,"cici-ext-always-light","semi-always-light",{[Jf]:!i}),children:[l&&(0,Te.jsx)(K_,{bottom:c,isDone:d||!1,content:m,lastSendContent:p,inputting:g,id:v,replyLang:h,onInputBlur:y,onInputFocus:b,onInputChange:C,handleClose:S,handleReturn:k,handleUpdate:()=>E(_.Z5.mailUpdate),handleClickTool:(e,t)=>T(e,m,u,t)}),r&&(0,Te.jsx)(ox,{quickReplysData:f,replyLang:h,cssStyle:x,onClickToolbar:T}),a&&(0,Te.jsx)($_,{content:m,onChangeContent:C,handleCancel:A,handleSubmit:()=>E(_.Z5.mailCreate),onResize:w}),j&&(0,Te.jsx)(ix,{showHelpWrite:o,onClick:I})]})},rx=m.memo(sx),ax=(0,m.createContext)(null);var lx=n(41659);const cx=({hasDeepSearchEntry:e,enableWebAISearchCard:t})=>{var n,i;const o=(0,Je.Uk)();(0,nr.A)(null===(n=document.querySelector(`[id*=${ae.U6}]`))||void 0===n?void 0:n.shadowRoot);const s=(0,Co.l)((e=>e.isShowSearch)),[r]=(0,f.Y)("searchDisabledAll"),[a]=(0,f.Y)("searchDisabledHosts"),l=a.includes(window.location.host),[c,d]=(0,m.useState)((new Date).getTime()),u=!r&&!l&&s,h=null===(i=(0,m.useContext)(ax))||void 0===i?void 0:i.recorder;return(0,m.useEffect)((()=>{u?(d((new Date).getTime()),null==h||h.end("cici_search_engine_ux_rendered")):(({duration:e})=>{(0,It.z8)(_.Ur.closeSearchAssistant,{duration:e})})({duration:(new Date).getTime()-c})}),[u]),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t:o,children:(0,Te.jsx)("div",{id:"cici-inline-container",className:"cici-ext-container",children:u&&(0,Te.jsx)($v,{hasDeepSearchEntry:e,enableWebAISearchCard:t})})})})},dx=()=>{var e,t;const n=(0,Je.Uk)();(0,nr.A)(null===(e=(0,$r.A)())||void 0===e||null===(e=e.findAssistant())||void 0===e?void 0:e.shadowRoot);const i=null===(t=(0,m.useContext)(ax))||void 0===t?void 0:t.recorder,o=(0,Co.l)((e=>e.isShowVideo));return(0,m.useEffect)((()=>{o&&(null==i||i.end("cici_video_summary_ux_rendered"))}),[o]),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t:n,children:(0,Te.jsx)("div",{id:"cici-inline-container",className:"cici-ext-container",children:o&&(0,Te.jsx)(Mp,{})})})})},ux=function(){var e=(0,a.A)((function*(e){const t=yield(e=>new Promise((t=>{const n=()=>{let n=document.querySelector(e.sidebarContainerQuery);!n&&e.customAppend&&(n=e.customAppend()),n&&(window.clearInterval(i),t(n))},i=setInterval(n,500);n()})))(e);if(!t)return;const n=(0,Kr.Mz)(Kr.FM.enableWebAISearch,!1);((e,t)=>{var n;const{hasDeepSearchMode:i=!1,hasEntry:o=!1,enableWebAISearchCard:s=!1}=t,r=(0,on.Ay)(location.href);if(!r||null!=r&&null!==(n=r.disabled)&&void 0!==n&&n.call(r))return;const a=u.m.getInstance().getHostId(),l=`${ae.U6}${a}`;if(e.querySelector(`#${l}`))return;const c=document.createElement("div");c.id=l,c.dataset.searchHostId=u.m.getInstance().getHostId(),c.style.order="-99999",e.insertBefore(c,e.firstChild),(0,ar.Rm)("[Daniel] mount search-assistant at:",e,"before",c.firstChild);const d=dh.Qz.create("cici_search_engine_ux_perf",!0),h=c.attachShadow({mode:(0,Jr.s)()?"open":"closed"}),m=(0,p.createRoot)(h);(0,et.NR)(h,ae.QN).then((()=>{d.mark("load_search_engine_css"),m.render((0,Te.jsx)(ax.Provider,{value:{recorder:d},children:r&&(0,Te.jsx)(on.mn.Provider,{value:{engine:r},children:(0,Te.jsx)(Vr,{element:c,children:(0,Te.jsx)(cx,{hasDeepSearchEntry:i&&o,enableWebAISearchCard:s})})})}))})),(0,u.A)((()=>{var e;null===(e=document.querySelector(`#${l}`))||void 0===e||e.remove(),m.unmount()}))})(t,{hasDeepSearchMode:!1,enableWebAISearchCard:Boolean(n),hasEntry:!1}),((e,t=[])=>{const n=(0,xi.Ay)(location.href),i=(0,xi.jB)(null==n?void 0:n.name);if(!n||!i)return;const o=(0,$r.A)();if(!o)return;if(o.findAssistant())return;const s=(0,Wr.id)(),r=o.getAssistantId(),a=document.createElement("div");s||(a.id=r,a.style.setProperty("display","block","important"),a.dataset.videoSearchHostId=u.m.getInstance().getHostId(),a.style.order="-99999"),t.forEach((([e,t])=>{a.setAttribute(e,t)})),e.insertBefore(a,e.firstChild);const l=dh.Qz.create("cici_video_summary_ux_perf",!0),c=a.attachShadow({mode:s?"closed":"open"}),d=(0,p.createRoot)(c);if(In.j.recordContainer(r,a,c),s){const{children:e}=(0,se.tl)("video_assistant").bilibili_mount_config;null==e||e.forEach((e=>{const t=document.createElement(e.tag);e.attr.forEach((e=>{t.setAttribute(e[0],e[1])}));try{t.innerHTML=(0,N.D4)(e.content)}catch(n){t.innerHTML=e.content}a.appendChild(t)}))}(0,et.NR)(c,ae.QN).then((()=>{l.mark("load_video_summary_page_css"),d.render((0,Te.jsx)(ax.Provider,{value:{recorder:l},children:n&&(0,Te.jsx)(xi.un.Provider,{value:{platform:n},children:(0,Te.jsx)(Vr,{element:a,children:(0,Te.jsx)(dx,{})})})}))})),o.init(),(0,u.A)((()=>{d.unmount(),o.release()}))})(t,(null==e?void 0:e.customAttr)||void 0)}));return function(t){return e.apply(this,arguments)}}(),hx=()=>{const e=(0,se.tl)("video_assistant");if(!e.youtube_assistant_show&&(0,xi.jB)("youtube")||!e.bilibili_assistant_show&&(0,xi.jB)("bilibili"))return;const t=(e,t,n)=>{const{setVideoId:i,setVideoTitle:o,setVideoPartId:s}=Cn.e.getState();i(e||""),o(t||""),s(n||"0");const r=(0,xi.Ay)(location.href);ux(r)},n=e=>{var n;const i=null==e||null===(n=e.detail)||void 0===n||null===(n=n.response)||void 0===n||null===(n=n.playerResponse)||void 0===n?void 0:n.videoDetails;t(null==i?void 0:i.videoId,null==i?void 0:i.title)},i=()=>{if(!(0,xi.jB)("bilibili"))return;const{videoId:e,title:n,partId:i}=bi();t(e,n,i)};let o;let s;(()=>{const e=(0,xi.Ay)(location.href);if((0,xi.jB)(null==e?void 0:e.name)){let s="",r="";var n;if("youtube"===(null==e?void 0:e.name))s=(e=>e&&new URL(location.href).searchParams.get(e.searchParam)||"")(e),r=null===(n=document)||void 0===n?void 0:n.title,t(s,r);else if("bilibili"===(null==e?void 0:e.name)){var i;o=null===(i=e.pageIsReady)||void 0===i?void 0:i.call(e,(()=>{const{videoId:n,title:i,partId:o}=bi();s=n,r=i;const a=(0,$r.A)(),l=(null==a?void 0:a.getAssistantId())||"";(0,u.A)(Gr(l,(()=>{const e=In.j.getContainerById(l);return null!=e&&e.parentElement?e:null}),"block !important;",((e,t)=>{const n=e.getAttribute("style");return!(!n||"display: block !important;"===n)||"none"===t.display}),(()=>t(s,r,o)),e.customAttr))}))}}})();const r=(0,xi.Ay)(location.href);var a;(0,xi.jB)("bilibili")&&(s=null==r||null===(a=r.onUrlChange)||void 0===a?void 0:a.call(r,i));return window.addEventListener("yt-navigate-finish",n),()=>{var e,t;window.removeEventListener("yt-navigate-finish",n),null===(e=s)||void 0===e||e(),null===(t=o)||void 0===t||t()}},mx=({id:e,id_suffix:t,mailScene:n,mailToolContainer:i})=>{var o;const s=(0,Je.Uk)();(0,nr.A)(null===(o=document.getElementById(e))||void 0===o?void 0:o.shadowRoot);const[r]=(0,f.Y)("authInfo");return(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t:s,children:(0,Te.jsx)("div",{id:`cici-inline-container-${t}`,className:"cici-ext-container",children:(0,Te.jsx)(rx,{isLogin:(null==r?void 0:r.isAuthenticated)||!1,mailScene:n,mailToolContainer:i})})})})},px=(e,t)=>{const n=u.m.getInstance().getHostId();if(void 0===n)return;const i=`${ae.AJ}-${n}`;if(t.querySelector(`[id=${i}]`))return;const o=document.createElement("div");o.id=i,o.dataset.mailHostId=n,o.style.order="-99999",t.insertBefore(o,t.firstChild);let s=Lf;const r=Array.from(document.querySelectorAll('[aria-label^="Re"]')).some((e=>e.contains(t))),a=Array.from(document.querySelectorAll('[aria-label^="Fwd"]')).some((e=>e.contains(t)));r?s=Bf:a&&(s=Df);const l="cici_mail_ux_perf";let c;c=dh.Qz.get(l)?dh.Qz.get(l):dh.Qz.create(l);const d=o.attachShadow({mode:"open"}),h=(0,p.createRoot)(d);return(0,et.NR)(d,ae.QN).then((()=>{c.mark("load_mail_page_css"),h.render((0,Te.jsx)(ax.Provider,{value:{recorder:c},children:e&&(0,Te.jsx)(lx.Vk.Provider,{value:{platform:e},children:(0,Te.jsx)(mx,{id:i,id_suffix:n,mailScene:s,mailToolContainer:t})})}))})),()=>{h.unmount(),o.remove()}},gx=e=>{const t=(0,lx.N)(e.name),n=[];for(const i of t)n.push(px(e,i[0]));return()=>{n.forEach((e=>{e&&"function"==typeof e&&e()}))}},vx=()=>{var e;const t=(0,Je.Uk)();return(0,nr.A)(null===(e=document.querySelector(`[id*=${ae.OD}]`))||void 0===e?void 0:e.shadowRoot),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t,children:(0,Te.jsx)("div",{id:`cici-inline-container-${ae.OD}`,className:"cici-ext-container",children:(0,Te.jsx)(Mf,{})})})})},fx=()=>{const e=mn(location.href);if(!e)return;const t=(e=>{const t=u.m.getInstance().getHostId();if(void 0===t)return;const n=`${ae.OD}-${t}`;if(document.querySelector(`[id=${n}]`))return;const i=document.createElement("div");if(i.id=n,i.dataset.arxivHostId=t,i.style.order="999",i.style.display="inline-block",e.prevNodeQuery){const t=document.querySelector(e.prevNodeQuery),n=null==t?void 0:t.parentElement;n&&(n.style.display="inline-flex",n.style.alignItems="center",n.appendChild(i))}else document.body.appendChild(i);const o=i.attachShadow({mode:"open"}),s=(0,p.createRoot)(o);return(0,et.NR)(o,ae.QN).then((()=>{s.render((0,Te.jsx)(Te.Fragment,{children:e&&(0,Te.jsx)(hn.Provider,{value:{platform:e},children:(0,Te.jsx)(vx,{})})}))})),()=>{s.unmount(),i.remove()}})(e);return()=>{null==t||t()}},_x=()=>{var e;const t=(0,Je.Uk)(),{enable:n}=(0,As.A)("podcast_assistant");return(0,nr.A)(null===(e=document.querySelector(`[id*=${ae.sp}]`))||void 0===e?void 0:e.shadowRoot),n?(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t,children:(0,Te.jsx)("div",{id:`cici-inline-container-${ae.sp}`,className:"cici-ext-container",children:(0,Te.jsx)(pf,{})})})}):null},xx=e=>{var t;const n=u.m.getInstance().getHostId();if(void 0===n)return;const i=`${ae.sp}-${n}`;if(document.querySelector(`[id=${i}]`))return;if(null===(t=e.checkPodcastDetail)||void 0===t||!t.call(e,location.href))return;const o=document.createElement("div");if(o.id=i,o.dataset.podcastHostId=n,o.style.order="-9999",!e.headerNodeQuery)return;const s=document.querySelector(e.headerNodeQuery),r=null==s?void 0:s.parentElement;r&&("applepodcast"===e.name?r.appendChild(o):null!=s&&s.nextSibling?r.insertBefore(o,null==s?void 0:s.nextSibling):r.appendChild(o));const a=o.attachShadow({mode:"open"}),l=(0,p.createRoot)(a);return(0,et.NR)(a,ae.QN).then((()=>{l.render((0,Te.jsx)(Te.Fragment,{children:e&&(0,Te.jsx)(cn.Provider,{value:{platform:e},children:(0,Te.jsx)(_x,{})})}))})),()=>{l.unmount(),o.remove()}};var yx=n(97164);const bx={name:"open-cici-sidebar",handle:e=>{Co.l.getState().setIsShowSidebar(!0,null==e?void 0:e.enterSidebarMode)}};var wx=n(44963);function Cx(){var e;if(null===(e=window.location.host)||void 0===e||!e.endsWith(bn.Ud))return()=>{};const t=e=>{var t;if("web"===(null===(t=e.data.body)||void 0===t?void 0:t.originContext)){var n,i;const t=function(e){var t,n;(0,ar.Rm)("[zoei] login cs handleWebMessage",e);const{is_oversea:i}=(null===(t=e.data)||void 0===t?void 0:t.body)||{},o=(0,se.Fc)(),{isSidePanelMode:s}=Co.l.getState();if(!(0,yx.A)(i)||!1===i){switch(e.data.name){case"update-auth-info":(0,wx.c)({name:"update-auth-info",body:(0,r.A)((0,r.A)({},e.data.body),{},{reason:"login cs: web notify auth info updated"})});break;case"start-using":s&&bx.handle({enterSidebarMode:_.cz.onboarding},{});break;case"start-try-summarize":(0,wx.c)({name:"start-try-summarize",body:(0,r.A)({},e.data.body)});break;case"start-try-ask":bf({current_page:yf.CHAT}),To("\u4eba\u5de5\u667a\u80fd\u4f1a\u53d6\u4ee3\u4eba\u7c7b\u5417\uff1f",{enterMethod:_.cz.onboarding});break;case"start-try-discover-skill":(0,Vt.I)({add_prompt:"true",settting_key:"toolbar-configuration"});break;case"call-background-method":if("is-on-toolbar"===e.data.body.method){const{promiseId:t}=e.data;(0,wx.c)("is-on-toolbar").then((e=>{const{isOnToolbar:n}=e.data;window.postMessage({name:"call-background-method-reply",isOnToolbar:n,promiseId:t})}))}break;case"open-web-ai-read":s&&(0,a.A)((function*(){yield(0,vf.EE)(),Cf.O.initMessageProtocolService()}))(),(0,mf.f)({type:"link",link:{url:(null===(n=e.data)||void 0===n||null===(n=n.body)||void 0===n?void 0:n.pdfUrl)||"https://arxiv.org/pdf/1706.03762"},fromSource:"from_extention_read_pdf_onboarding",opt:{createNewConv:!!o.isAuthenticated,sendReadMessage:!0}});break;case"start-try-translate-selected-text":setTimeout((()=>{var e;const t=null===(e=document.querySelector('[data-testid="onboarding-card-highlight_translation"]'))||void 0===e||null===(e=e.firstChild)||void 0===e?void 0:e.firstChild;if(!t)return;const n=new Range;n.selectNode(t);const{x:i,y:o,width:s,top:r,left:a,height:l,bottom:c}=t.getBoundingClientRect(),d={x:i,y:o,width:s,left:a,height:l,text:"intelligence",contextText:"",range:n,right:a+s,bottom:r+l,clientBottom:window.innerHeight-c+188,top:0};qt.t_.setState({inputTextReady:!0,currentAction:so.EU.translate,boxVisible:!0,barVisible:!1,writeEnabled:!1,inputText:"intelligence",contextText:"",range:n,selectionBaseInfo:d,simpleSelectionBaseInfo:d,sceneId:fe.Fc.ChooseWordsTranslate})}),300);break;default:return!1}return!0}}(e);null===(n=e.ports[0])||void 0===n||null===(i=n.postMessage)||void 0===i||i.call(n,t)}};return window.addEventListener("message",t),(0,a.A)((function*(){try{var e;const t=yield(0,wx.c)("get-window-info");if(!t.success||!t.data)throw t.error;const n=null===(e=t.data.authInfo)||void 0===e?void 0:e.isAuthenticated;n!==("true"===localStorage.getItem("flow_web_has_login"))&&(0,wx.c)({name:"update-auth-info",body:{reason:"login cs: detect auth info not same"}}).catch((e=>{A.vF.persist.info({eventName:"[LOGIN] - UPDATE_AUTH_INFO",meta:(0,r.A)({},e)})}))}catch(t){A.vF.persist.info({eventName:"[LOGIN] - INIT",meta:(0,r.A)({},t)})}}))(),()=>{window.removeEventListener("message",t)}}var Ax=n(75683);const Sx="ciciai-with-right-side-chat-box",kx="ciciai-with-left-side-chat-box";var Ex=n(49278),Tx=n(88362),Ix=n(792),jx=n(59822),Nx=n(17114),Rx=n(12710);const Mx=e=>{const{children:t}=e,n=(0,Je.Uk)();return(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(v.C,{t:n,children:t})})},Px="wrapper-P0EoYL",Lx=({text:e,style:t,className:n})=>e?(0,Te.jsx)("div",{className:J()(Px,n),style:t,children:e}):null;var Bx=n(40577),Dx=n(51897),Ox=n(3105);const Fx="read-vmh2aO",Ux=({playing:e,style:t,onPlay:n,className:i})=>{const o=e?Dx.A:Ox.A;return(0,Te.jsx)("div",{className:J()(Fx,i,"read",{playing:e}),style:t,onClick:n,children:(0,Te.jsx)(o,{})})},Hx=({text:e,style:t,className:n})=>{const[i,o]=(0,m.useState)(!1),s=(0,m.useRef)(null);(0,m.useEffect)((()=>{const e=()=>{s.current=new Bx.B,s.current.onLoadStart((()=>{o(!0)})),s.current.onPlayStart((()=>{o(!0)})),s.current.onPlayPause((()=>{o(!1)})),s.current.onPlayEnd((()=>{e()}))};return e(),()=>{var e;null===(e=s.current)||void 0===e||e.destroy()}}),[]);return(0,Te.jsx)(Ux,{style:t,className:n,playing:i,onPlay:()=>{var t,n;i?null===(t=s.current)||void 0===t||t.cancelLoadAndPause():null===(n=s.current)||void 0===n||n.loadAndPlay(e,"zh_female_taozi_conversation_v4_wvae_bigtts")}})};var zx=n(26692),qx=n(77453),Vx=n(53012);const $x="container-rv7FJw",Wx="wrapper-_Db7ro",Kx="closeIcon-vJg1gw",Yx="translation-pWLX9s",Gx="button-vY_u9f",Qx=e=>{const t=(0,v.B)(),n=(0,m.useRef)(null),i=(0,m.useRef)(!1),[o,s]=(0,m.useState)(!1),{env:a,dictionary:l}=e;(0,m.useEffect)((()=>{(0,Ke.s)("highlight_result_show",{card_type:"blurred_card",button_name:"translate",current_page:(0,zt.p$)()}),(0,$e.dn)({click_from:"highlight_mark_result_show",current_page:(0,zt.p$)()})}),[]),(0,m.useEffect)((()=>{qt.t_.getState().trigger===os.LT.VocabruaryHighlight&&qt.t_.getState().setBoxVisible(!1)}),[]);const{bound:c}=l,d=window.scrollX+4,u=window.scrollX+window.innerWidth-240-10,h={left:Math.min(Math.max(c.left+window.scrollX+c.width/2-120,d),u),top:c.top+window.scrollY+c.height};return(0,Te.jsx)("div",{className:$x,ref:n,onMouseEnter:a.stopClosePopupCard,onMouseLeave:a.closePopupCard,style:h,children:(0,Te.jsxs)("div",{className:Wx,children:[(0,Te.jsx)(Lx,{text:l.word}),(0,Te.jsx)("div",{className:J()("mt-10",Yx),onMouseEnter:()=>{i.current||(i.current=!0,(0,Ke.s)("highlight_result_show",{card_type:"unblurred_card",button_name:"translate",current_page:(0,zt.p$)()}))},children:l.translation}),(0,Te.jsxs)("div",{className:"mt-16 flex items-center",children:[(0,Te.jsx)("div",{className:J()("flex-1"),children:(0,Te.jsx)("div",{className:J()(Gx,"text-12","font-[500]"),style:{padding:"6px 14px"},onClick:()=>{(0,Ke.s)("highlight_result_click",{card_type:"blurred_card",button_name:"translate",current_page:(0,zt.p$)(),click_result:"complete_translation"}),setTimeout((()=>{a.closePopupCard()}),100);const e=new Range;let t="";const n=document.querySelector(`${zx.v}[active="true"]`);n&&(e.selectNode(n),t=(0,qx.wM)(e,400).trimStart()+l.word+(0,qx.kW)(e,400).trimEnd());const i=(0,r.A)((0,r.A)({},c),{},{text:l.word,contextText:t,range:e,bottom:c.top+c.height,right:c.left+c.width,clientBottom:window.innerHeight-(c.top+c.height)});qt.t_.setState({inputTextReady:!1,currentAction:so.EU.translate,boxVisible:!0,barVisible:!1,writeEnabled:!1,inputText:l.word,contextText:t,range:e,selectionBaseInfo:i,simpleSelectionBaseInfo:i,sceneId:os.Fc.ChooseWordsTranslate,trigger:os.LT.VocabruaryHighlight}),setTimeout((()=>{qt.t_.setState({inputTextReady:!0,inputText:l.word})}),200)},children:t("flow_web_ext_translate_highlight_hover_btn_details")})}),(0,Te.jsxs)("div",{className:"flex flex-initial gap-8",children:[(0,Te.jsx)(je.m_,{content:t("flow_web_ext_general_speak"),getPopupContainer:()=>n.current,children:(0,Te.jsx)("div",{onClick:()=>{(0,Ke.s)("highlight_result_click",{card_type:"blurred_card",button_name:"translate",current_page:(0,zt.p$)(),click_result:"read"})},children:(0,Te.jsx)(Hx,{text:l.word,style:{width:28,height:28},className:J()(Gx)})})}),(0,Te.jsx)(je.m_,{content:t("flow_web_ext_translate_highlight_hover_btn_mastered"),getPopupContainer:()=>n.current,children:(0,Te.jsx)("div",{className:Gx,style:{width:28,height:28},onClick:()=>{(0,Ke.s)("highlight_result_click",{card_type:"blurred_card",button_name:"translate",current_page:(0,zt.p$)(),click_result:"clear_highlight"}),a.deleteDict(l),a.closePopupCard()},children:(0,Te.jsx)(hu.A,{})})})]})]}),(0,Te.jsx)(xe.A,{getPopupContainer:()=>n.current,optionPageSection:"toolbar-configuration",position:"bottomRight",disableKey:os.lf.vocabruary,onDisableOnceClick:a.closeService,show:o,setShow:s,children:(0,Te.jsx)("div",{className:Kx,onClick:()=>s(!0),children:(0,Te.jsx)(Vx.h,{})})})]})})},Zx=e=>{const{activeDictionary:t}=(0,jx.A)((e=>({activeDictionary:e.activeDictionary})));return t?(0,Te.jsx)(Qx,{env:e.env,dictionary:t}):null};class Xx{constructor(e){(0,y.A)(this,"dom",void 0),(0,y.A)(this,"shadowRoot",void 0),(0,y.A)(this,"root",void 0),(0,y.A)(this,"init",(()=>{const e=this.render();this.root.render(e),this.mount(this.dom)})),this.dom=document.createElement(e),this.shadowRoot=this.dom.attachShadow({mode:"open"});const t=document.createElement("div");t.classList.add("cici-ext-container");const n=document.createElement("div");n.classList.add("cici-ext-always-light","semi-always-light"),t.appendChild(n),this.shadowRoot.appendChild(t),this.root=(0,p.createRoot)(n),(0,et.NR)(this.shadowRoot,ae.QN).then((()=>{this.init()}))}destroy(){this.root.unmount(),this.dom.remove()}}class Jx extends Xx{constructor(e){super(ae.px),(0,y.A)(this,"env",void 0),this.env=e}mount(){document.documentElement.append(this.dom)}render(){return(0,Te.jsx)(Mx,{children:(0,Te.jsx)(Zx,{env:this.env})})}}const ey=(e,t)=>`\n${zx.v} {\n  background-color: ${e};\n  visibility: visible !important;\n}\n${zx.v}:hover {\n  background-color: ${t};\n}\n`;let ty=null;function ny(e,t){const n=[];return(0,vi.A)(e,(e=>{const i=function(e,t){const n=function(e){return e.match(/\b(\w+)\b/g)||[]}(e);if(0===n.length)return[];const i=[];let o=0,s="";for(const a of n){const n=e.indexOf(a,o);if(-1===n)continue;n>o&&(s+=e.slice(o,n),o=n),o+=a.length;const r=t.find((e=>e.word===a.toLowerCase()));r?(s&&(i.push({text:s,dict:void 0}),s=""),i.push({text:a,dict:r})):s+=a}const r=s+e.slice(o);return r&&i.push({text:r,dict:void 0}),i}(e.textContent||"",t);if(0===i.length)return;const o=function(e){const t=[];for(const n of e){const{text:e,dict:i}=n;if(i){const n=document.createElement(zx.v);n.setAttribute("data-key",i.word),n.textContent=e,t.push(n)}else{const n=document.createTextNode(e);t.push(n)}}return t}(i);for(const t of o)t instanceof HTMLElement&&t.matches(zx.v)&&n.push(t);e.replaceWith(...o)})),n}function iy(e){if(e&&0===e.length)return;const t=e?e.map((e=>`${zx.v}[data-key="${e}"]`)).join(","):zx.v,n=document.body.querySelectorAll(t);for(const i of n)i.replaceWith(i.textContent||"")}const oy=e=>{const t=Rx.Bx.find((t=>t[0]===e));return t?t[1]:e},sy=e=>{ty?ty.replaceChildren(document.createTextNode(ey(e,oy(e)))):(e=>{ty=document.createElement("style"),ty.setAttribute("data-id","samantha-vocabruary-style"),ty.innerHTML=ey(e,oy(e)),document.documentElement.insertBefore(ty,document.documentElement.firstChild)})(e)};class ry{constructor(e){(0,y.A)(this,"stopClosePopupCard",void 0),(0,y.A)(this,"closePopupCard",void 0),(0,y.A)(this,"closeService",void 0),(0,y.A)(this,"deleteDict",void 0),(0,y.A)(this,"context",void 0),this.context=e,this.stopClosePopupCard=e.stopClosePopupCard,this.closePopupCard=e.closePopupCard,this.closeService=e.closeService,this.deleteDict=e.deleteDict}}var ay=n(89380),ly=n(95830);class cy extends jd.A{constructor(){super(),(0,y.A)(this,"dicts",new Map),this.init()}init(){this.syncDicts().then((()=>{this.emit(Rx.Jh.DictionaryReady)}))}triggerChanged(e){(e.added.length||e.deleted.length)&&this.emit(Rx.Jh.DictionaryChanged,e)}syncDicts(){var e=this;return(0,a.A)((function*(){try{const{word_notes:t}=yield(0,ly.cP)(),n=Array.from(e.dicts,(([e,t])=>({word:e,translation:t.translation}))),i=t.map((e=>({word:e.word.toLowerCase(),translation:e.translate}))),o={added:i.filter((e=>!n.find((t=>t.word===e.word)))),deleted:n.filter((e=>!i.find((t=>t.word===e.word))))};for(const s of o.added)e.dicts.set(s.word,{translation:s.translation});for(const s of o.deleted)e.dicts.delete(s.word);e.triggerChanged(o)}catch(t){}}))()}addDict(e){const t={added:[],deleted:[]},n=(0,ay.A)(e).map((e=>(0,r.A)((0,r.A)({},e),{},{word:e.word.toLowerCase()})));for(const i of n)this.dicts.has(i.word)||t.added.push(i),(0,ly.jo)(i.word),this.dicts.set(i.word,{translation:i.translation});this.triggerChanged(t)}deleteDict(e,t){const{persist:n=!0}=t||{};n&&(0,ly.Gx)(e.word.toLowerCase()),this.dicts.delete(e.word.toLowerCase()),this.triggerChanged({added:[],deleted:[e]})}getDict(e){return this.dicts.get(e.toLowerCase())}destroy(){this.dicts.clear(),this.removeAllListeners()}}var dy=n(84943);const uy=["footer","aside","nav","img","base","link","style","meta","s","audio","video","track","map","area","iframe","embed","object","source","canvas","noscript","script","form","datalist","fieldset","legend","meter","optgroup","option","output","progress","select","details","summary","dialog","menu","slot","template","svg","math","cite","time","input","textarea",'[contenteditable="true"]',"mjx-container",zx.v,dy.Nt].join(", "),hy=e=>e instanceof HTMLElement&&e.matches(uy);function my(e,t){if(e instanceof HTMLElement&&e.matches(zx.v))return[];const n=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ALL,(e=>e instanceof HTMLElement||e instanceof Text?(e=>[et.ST,et.JL,et.yL,hy].some((t=>t(e))))(e)?NodeFilter.FILTER_REJECT:e instanceof Text?!1===(null==t?void 0:t(e))?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT));for(;i.nextNode();)n.push(i.currentNode);return n}class py extends jd.A{constructor(){var e;super(),e=this,(0,y.A)(this,"isInit",!1),(0,y.A)(this,"highlightShowObserver",void 0),(0,y.A)(this,"unbindEnableConfigChange",void 0),(0,y.A)(this,"disconnectObserveNewElement",void 0),(0,y.A)(this,"popupCardRenderer",null),(0,y.A)(this,"closePopupCardTimer",null),(0,y.A)(this,"env",void 0),(0,y.A)(this,"dictionary",null),(0,y.A)(this,"isDisable",(()=>{const{hostname:e}=window.location,t=(0,se.TK)("vocabruaryDisableAll"),n=(0,se.TK)("vocabruaryDisableHosts"),i=(0,se.tl)("vocabruary").disable_hosts;return!!(t||n.includes(e)||Rx.Zf.includes(e)||i.includes(e))})),(0,y.A)(this,"clearClosePopupCardTimer",(()=>{this.closePopupCardTimer&&(clearTimeout(this.closePopupCardTimer),this.closePopupCardTimer=null)})),(0,y.A)(this,"handleDictionaryChange",(e=>{const{added:t,deleted:n}=e;this.highlight(document.body,t),this.unHighlight(n)})),(0,y.A)(this,"handleHighlightMouseEnter",(e=>{if(e.target instanceof HTMLElement&&e.target.tagName.toLowerCase()===zx.v){var t;for(const e of document.querySelectorAll(`${zx.v}[active="true"]`))e.removeAttribute("active");e.target.setAttribute("active","true"),this.clearClosePopupCardTimer();const{left:n,top:i,width:o,height:s}=e.target.getBoundingClientRect(),r=e.target.getAttribute("data-key");if(!r)return;const a=null===(t=this.dictionary)||void 0===t?void 0:t.getDict(r);if(!a)return;jx.A.getState().setActiveDictionary({word:r,translation:a.translation,bound:{left:n,top:i,width:o,height:s}})}})),(0,y.A)(this,"handleEnableConfigChange",(0,a.A)((function*(){yield(0,rr.uk)(100),e.isDisable()?e.reset():e.init()}))),(0,y.A)(this,"bindEnableConfigChange",(()=>(re.A.watch({vocabruaryDisableAll:this.handleEnableConfigChange,vocabruaryDisableHosts:this.handleEnableConfigChange}),()=>{re.A.unwatch({vocabruaryDisableAll:this.handleEnableConfigChange,vocabruaryDisableHosts:this.handleEnableConfigChange})}))),(0,y.A)(this,"handleHighlightMouseLeave",(e=>{const{target:t}=e;t instanceof HTMLElement&&t.tagName.toLocaleLowerCase()===zx.v&&(this.clearClosePopupCardTimer(),this.closePopupCardTimer=window.setTimeout((()=>{t.removeAttribute("active"),this.clearActiveDictionaryState()}),100))})),(0,y.A)(this,"handleHighlightChange",(e=>{sy(e.newValue)})),(0,y.A)(this,"handleDocumentVisibilityChange",(()=>{var e;"visible"===document.visibilityState&&(null===(e=this.dictionary)||void 0===e||e.syncDicts())})),(0,y.A)(this,"_eventBubble",(e=>(...t)=>{this.emit(e,...t)})),(0,y.A)(this,"observeNewElement",((t=document.body)=>{var n;null===(n=this.disconnectObserveNewElement)||void 0===n||n.call(this);const i=new MutationObserver(((t,n)=>{for(const i of t)"childList"===i.type&&i.addedNodes.length>0&&i.addedNodes.forEach(function(){var t=(0,a.A)((function*(t){yield new Promise((e=>setTimeout(e,1e3))),t instanceof HTMLElement&&e.highlight(t)}));return function(e){return t.apply(this,arguments)}}())}));i.observe(t,{childList:!0,subtree:!0}),this.disconnectObserveNewElement=()=>i.disconnect()})),(0,y.A)(this,"unHighlight",(e=>{iy(e.map((e=>e.word)))})),(0,y.A)(this,"reportHighlightsShow",(e=>{for(const t of e)this.highlightShowObserver.observe(t)})),(0,y.A)(this,"highlight",((e,t)=>{if(t||(t=this.dictionary?Array.from(this.dictionary.dicts,(([e,t])=>({word:e,translation:t.translation}))):[]),0===t.length)return;const n=ny(my(e,(e=>!/^[\n\s]*$/.test(e.textContent||"")&&t.some((t=>{var n;return null===(n=e.textContent)||void 0===n?void 0:n.toLowerCase().includes(t.word)})))),t);this.reportHighlightsShow(n)})),(0,y.A)(this,"addDict",(e=>{var t;null===(t=this.dictionary)||void 0===t||t.addDict(e)})),(0,y.A)(this,"deleteDict",((e,t)=>{var n;null===(n=this.dictionary)||void 0===n||n.deleteDict(e,t)})),(0,y.A)(this,"reset",(()=>{var e,t,n;this.isInit=!1,this.clearClosePopupCardTimer(),null===(n=ty)||void 0===n||n.remove(),ty=null,this.unbind(),iy(),null===(e=this.dictionary)||void 0===e||e.destroy(),this.dictionary=null,null===(t=this.popupCardRenderer)||void 0===t||t.destroy(),this.popupCardRenderer=null,this.disconnectObserveNewElement=void 0})),(0,y.A)(this,"destroy",(()=>{var e;null===(e=this.unbindEnableConfigChange)||void 0===e||e.call(this),this.removeAllListeners(),this.highlightShowObserver.disconnect(),this.reset()})),this.env=new ry({stopClosePopupCard:this.clearClosePopupCardTimer,closePopupCard:this.clearActiveDictionaryState,closeService:this.reset,deleteDict:this.deleteDict}),this.unbindEnableConfigChange=this.bindEnableConfigChange(),this.highlightShowObserver=new IntersectionObserver((e=>{e.forEach((e=>{const t=e.target;t instanceof HTMLElement&&e.isIntersecting&&((0,Ke.s)("highlight_mark_show",{current_page:(0,zt.p$)()}),(0,$e.M7)({show_from:"highlight_mark_show",current_page:(0,zt.p$)()}),this.highlightShowObserver.unobserve(t))}))}))}clearActiveDictionaryState(){jx.A.getState().setActiveDictionary(void 0)}bind(){var e,t;document.body.addEventListener("mouseenter",this.handleHighlightMouseEnter,!0),document.body.addEventListener("mouseleave",this.handleHighlightMouseLeave,!0),document.addEventListener("visibilitychange",this.handleDocumentVisibilityChange),re.A.watch({vocabruaryHighlightColor:this.handleHighlightChange}),null===(e=this.dictionary)||void 0===e||e.on(Rx.Jh.DictionaryChanged,this.handleDictionaryChange),null===(t=this.dictionary)||void 0===t||t.on(Rx.Jh.DictionaryReady,this._eventBubble(Rx.Jh.DictionaryReady)),this.observeNewElement()}unbind(){var e,t;document.body.removeEventListener("mouseenter",this.handleHighlightMouseEnter,!0),document.body.removeEventListener("mouseleave",this.handleHighlightMouseLeave,!0),document.removeEventListener("visibilitychange",this.handleDocumentVisibilityChange),re.A.unwatch({vocabruaryHighlightColor:this.handleHighlightChange}),null===(e=this.dictionary)||void 0===e||e.off(Rx.Jh.DictionaryChanged,this.handleDictionaryChange),null===(t=this.disconnectObserveNewElement)||void 0===t||t.call(this)}init(){this.isDisable()||this.isInit||(this.isInit=!0,sy((0,se.TK)("vocabruaryHighlightColor")),this.popupCardRenderer=new Jx(this.env),this.dictionary=new cy,this.bind(),this.emit(Rx.Jh.Init))}}const gy=new py,vy="wrapper-hAX7v2",fy="caption-aPlG8z",_y="description-NWvrw0",xy="link-B8kahz",yy="button-zbOcm8",by="palette-item-kTJMbw",wy=(0,jh.A)((()=>{(0,Ke.s)("highlight_guide_card_show",{current_page:(0,zt.p$)(),guide_card_type:"translate_highlight"})})),Cy=()=>{const e=(0,v.B)(),t=(0,m.useRef)(null),[n]=(0,f.Y)("vocabruaryDisableHosts"),{disable_hosts:i=[]}=(0,As.A)("vocabruary"),[o,s]=(0,f.Y)("vocabruaryHighlightColor"),[r,a]=(0,f.Y)("vocabruaryOnboarding"),[,l]=(0,f.Y)("vocabruaryDisableAll"),c=(0,jx.A)((e=>e.onboardingBound)),d=(0,jx.A)((e=>e.onboardingDict)),{hostname:u}=window.location;if(!r||!c||n.includes(u)||i.includes(u)||Rx.Zf.includes(u))return null;const h=window.scrollX+4,p=window.scrollX+window.innerWidth-288-10,g={left:Math.min(Math.max(c.left+window.scrollX+c.width/2-144,h),p),top:c.top+window.scrollY+c.height};return wy(),(0,Te.jsxs)("div",{className:vy,ref:t,style:g,children:[(0,Te.jsx)("div",{className:fy,children:e("flow_web_ext_translate_highlight_popup_title")}),(0,Te.jsx)("div",{className:J()(_y,"mt-8"),children:(0,Te.jsxs)(Hu.x,{i18nKey:"flow_web_ext_translate_highlight_popup_desc",children:["\u5f00\u542f\u540e\uff0c\u4f60\u6bcf\u6b21\u7ffb\u8bd1\u7684\u5355\u8bcd\u90fd\u4f1a\u5728\u63a5\u4e0b\u6765\u7684\u6240\u6709\u7f51\u9875\u4e2d\u9ad8\u4eae\u663e\u793a\uff0c\u76f4\u5230\u4f60\u786e\u5b9a\u638c\u63e1\u8be5\u5355\u8bcd\u4e3a\u6b62\u3002\u6b64\u529f\u80fd\u53ef\u5728",(0,Te.jsx)("span",{className:xy,onClick:()=>{(0,Ke.s)("highlight_guide_card_click",{current_page:(0,zt.p$)(),guide_card_type:"translate_highlight",button_name:"setting"}),(0,Vt.I)({enter_method:_.cz.disableMenu,settting_key:"translate",anchor:"feature-vocabruary-setting"})},children:"\u8bbe\u7f6e"}),"\u4e2d\u5173\u95ed"]})}),(0,Te.jsxs)("div",{className:"mt-16 flex items-center",children:[(0,Te.jsx)("div",{className:"flex-1",children:(0,Te.jsx)(Nx.A,{palette:Rx.Bx,selected:o,onSelectedChange:s,getPopupContainer:()=>t.current,position:"bottom",children:(0,Te.jsx)("div",{className:by,style:{background:o}})})}),(0,Te.jsxs)("div",{className:"flex-initial flex gap-8",children:[(0,Te.jsx)(ea.c,{className:yy,type:"quartary",onClick:()=>{(0,Ke.s)("highlight_guide_card_click",{current_page:(0,zt.p$)(),guide_card_type:"translate_highlight",button_name:"ignore"}),a(!1),l(!0)},children:e("flow_web_ext_translate_highlight_popup_btn_ignore")}),(0,Te.jsx)(ea.c,{className:yy,onClick:()=>{(0,Ke.s)("highlight_guide_card_click",{current_page:(0,zt.p$)(),guide_card_type:"translate_highlight",button_name:"open"}),a(!1),l(!1),gy.on(Rx.Jh.DictionaryReady,(()=>{d&&gy.addDict(d)}))},children:e("flow_web_ext_translate_highlight_popup_btn_enable")})]})]})]})};var Ay=n(35687),Sy=n(56422),ky=n(28159);const Ey=e=>{if(e===so.EU.translate){var t;let e;const{inputTextLang:n}=qt.t_.getState(),i=(0,se.TK)("transPreferConfig");return e=n?null===(t=i.langMap)||void 0===t?void 0:t[n]:void 0,e||(0,se.TK)("translateLanguage")}};function Ty(e){return e&&(0,ky.A)(e)?e.replace(/^"""\n*|\n*"""$/gi,""):e}function Iy(e){(0,ps.Im)()||null==e||e.dispatchEvent(new Event("input",{bubbles:!0}))}class jy{constructor(e){if((0,y.A)(this,"selectionEl",null),(0,y.A)(this,"containerEl",null),(0,y.A)(this,"range",void 0),(0,y.A)(this,"_canInsert",!1),this._canInsert=!1,e&&e.rangeCount>0){const t=e.getRangeAt(0);this.range=t.cloneRange();const n=t.startContainer.childNodes[t.startOffset]||t.startContainer;if(this.selectionEl=(0,ie.A)(n,"tagName")?n:n.parentElement,!this.selectionEl)return;const i=(0,et.QN)(this.selectionEl)?this.selectionEl:(0,et.mn)(this.selectionEl);i&&(0,et.ow)(i)&&(this.containerEl=i,this._canInsert=!0)}}insert(e,t=os.cD.replace_selection,n=""){if(!this.containerEl)return;const i=this.containerEl,o=document||"#document"===i.getRootNode().nodeName&&i.getRootNode();if((0,et.Ku)(i)){const n=i.selectionEnd;if(t===os.cD.replace_selection)i.setRangeText(e);else if(null!==n){const t=i.value[n-1]||"";t&&!/[\n\r\t]/gi.test(t)&&(e=`${e}`),i.setRangeText(e,n,n,"end"),i.setSelectionRange(n,n+e.length)}i.focus()}else{if(i.focus(),this.range){const e=o.getSelection();null==e||e.removeAllRanges(),null==e||e.addRange(this.range)}t===os.cD.insert_below&&(i.textContent&&(e=`${e}`),n&&(e=`${n}${e}`)),t===os.cD.insert_below&&i.textContent&&(e=`${e}`),setTimeout((()=>(0,et.Ig)(e,i)),0)}setTimeout((()=>Iy(i)),0)}select(e=0,t=0){const n=this.containerEl;if(n)if(n.focus(),(0,et.Ku)(n))n.setSelectionRange(e,t||n.value.length,"forward");else{const e=new Range;e.selectNodeContents(n);const t=window.getSelection();null==t||t.removeAllRanges(),null==t||t.addRange(e),this.range=e.cloneRange()}}get canInsert(){return this._canInsert}}const Ny={selectionHelper:null},Ry=(0,m.createContext)(Ny),My=()=>(0,m.useContext)(Ry);var Py=n(13355);function Ly(e){const t=(0,Je.Uk)();return(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(je.$n,{type:"secondary",onClick:t=>{e.onClickButton(os.cD.insert_below,t)},className:Py.A["icon-btn"],icon:(0,Te.jsx)(Pe.H9,{className:Py.A.icon}),"data-testid":"rewrite-insert-btn",children:(0,Te.jsx)("span",{className:J()(Py.A.caption),children:t("doc_editor_ai_skill_panel_insert")})}),(0,Te.jsx)(je.$n,{type:"secondary",onClick:t=>{e.onClickButton(os.cD.replace_selection,t)},className:Py.A["icon-btn"],icon:(0,Te.jsx)(Pe.K2,{className:Py.A.icon}),"data-testid":"rewrite-replace-btn",children:(0,Te.jsx)("span",{className:J()(Py.A.caption),children:t("doc_editor_ai_skill_panel_replace")})})]})}function By(e){const t=(0,Je.Uk)(),{currentAction:n}=e;return(0,Te.jsx)(ea.c,{type:"quartary",icon:n===so.EU.explain?(0,Te.jsx)(Hd,{}):(0,Te.jsx)(ng.A,{}),size:"small",onClick:e.onClick,children:t([so.EU.explain].includes(n)?"flow_web_ext_action_popup_search":"flow_web_ext_action_popup_continue")})}const Dy=e=>{const{currentAction:t,messageId:n,message:i,onClickWritingAction:o,style:s}=e,{selectionHelper:r}=My(),a=(0,qt.t_)((e=>e.selectionBaseInfo)),l=e=>s=>{s.preventDefault(),s.stopPropagation(),(({button_name:e,action_name:t,message_id:n})=>{(0,It.z8)(_.Ur.clickSelectAssistantResultBtn,{button_name:e,action_name:t,message_id:n,click_from:_.Z5.selectAssistantResult})})({button_name:e,action_name:t,message_id:n});const l=Ty(i)||"";null==r||r.insert(l,e,a.text),null==o||o(e)};return(0,m.useEffect)((()=>{Ot({button_name:os.cD.insert_below,show_from:_.Z5.selectAssistantResult,isSubtitle:Tt.getIsCurrentSubtitle()}),Ot({button_name:os.cD.replace_selection,show_from:_.Z5.selectAssistantResult,isSubtitle:Tt.getIsCurrentSubtitle()})}),[]),(0,Te.jsx)("div",{style:s,className:Py.A["writing-operations"],onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onMouseUp:e=>{e.preventDefault(),e.stopPropagation()},children:null!=r&&r.canInsert?(0,Te.jsx)(Ly,{onClickButton:(e,t)=>l(e)(t)}):(0,Te.jsx)(By,{currentAction:t,onClick:e.onMainButtonClick})})};var Oy=n(56598);const Fy=Lu().bind(Py.A),Uy=(0,l.jc)(),Hy=e=>{const t=(0,m.useRef)(null),{regenerateDisable:n,disableCopy:i=!1,disableListen:o=!1,showVocabularyMastered:s=!1,collectionParam:a,onCopy:l,onRegenerate:c,onVocabularyMasteredClick:d}=e,u=(0,v.B)(),{currentAction:h}=(0,qt.t_)(),[p,g]=(0,m.useState)(),f=(0,m.useMemo)((()=>h===so.EU.translate?{click_from:zt.vP.highlight_result_card_translate,collect_type:zt.p6.TranslateResult}:h===so.EU.explain?{click_from:zt.vP.highlight_result_card_explain,collect_type:zt.p6.ExplainResult}:{click_from:zt.vP.highlight_result_card_custom_skill,collect_type:zt.p6.CustomSkillResult}),[h]),{collectionIcon:_,onCollectionClick:x,collected:y,collectionId:b}=Bs((0,r.A)({getCollectionParam:()=>a},f));(0,m.useEffect)((()=>{!Uy&&(0,ot.ku)()&&(0,zt.ae)(f.click_from,f.collect_type)}),[Uy,h]);const w=(()=>{const[e,t]=(0,m.useState)(""),{actionMessages:n,currentAction:i,messageCursor:o,inputText:s}=(0,qt.t_)(),r=(0,m.useMemo)((()=>{var e,t;return null!==(t=(null!==(e=n[i])&&void 0!==e?e:[])[o])&&void 0!==t?t:""}),[n,o]),a=(0,An.P)((e=>e.messages)),l=(0,m.useMemo)((()=>a[r]||{}),[a,r]);return(0,m.useEffect)((()=>{i===so.EU.translate?t(s):t(l.text||"")}),[l]),e})();return(0,m.useEffect)((()=>{(0,Tn.K)(nn.e.Web).then((e=>Kn(e))).then((e=>g(e))).catch((()=>g(void 0)))}),[]),(0,Te.jsxs)("div",{className:Fy("operations-next"),ref:t,children:[(0,Te.jsx)("div",{className:Fy("learn-more"),children:(0,Te.jsx)(Dy,{currentAction:h,message:e.message.text||"",messageId:e.message.id,onMainButtonClick:e.onMainButtonClick})}),(0,Te.jsxs)("div",{className:Fy("actions"),children:[!o&&(0,Te.jsx)(fu.T,{text:w,className:Fy(Py.A.actionButton,Py.A.audioButton),style:{fontSize:16},getPopupContainer:()=>t.current,onClick:()=>{(0,Ke.s)("highlight_result_click",{button_name:h,click_result:"read"})}}),(0,ot.ku)()&&(0,Te.jsx)(zd.S,{"data-testid":"select-output-panel-collect-operation",tooltip:(0,Te.jsx)(Hs,{collected:y,savedId:b,parentCollectionId:p,collectType:f.collect_type,clickFrom:f.click_from}),icon:_,onClick:x,getPopupContainer:()=>t.current}),!i&&(0,Te.jsx)(Oy.A,{"data-testid":"select-output-panel-copy-operation",tooltip:u("flow_ext_web_general_copy"),successTooltip:u("flow_web_ext_general_copied"),onCopyClick:l,className:Py.A.headerBtn}),(0,Te.jsx)(zd.S,{"data-testid":"select-output-panel-rewrite-operation",tooltip:u(!0===n?"maximum_regenerate_reached":"regenerate_button_hover_text"),icon:(0,Te.jsx)(Pe.eD,{}),onClick:()=>{!0!==n&&c()},getPopupContainer:()=>t.current}),s&&(0,Te.jsx)(zd.S,{tooltip:u("flow_web_ext_translate_highlight_hover_btn_mastered"),icon:(0,Te.jsx)(hu.A,{}),onClick:d,getPopupContainer:()=>t.current})]})]})},zy="suggest-message-container-XdB13M",qy="suggest-message-OfZEb5",Vy=({suggestMessageListWithStatus:e,onClick:t,className:n,containerClassName:i,style:o})=>{const{failed:s,suggests:r=[]}=e||{};return s||0===r.length?null:(0,Te.jsx)("div",{className:J()(i,zy),style:o,"data-testid":"suggest-message-container",children:r.map(((e,i)=>(0,Te.jsxs)("div",{className:J()(qy,n),onClick:()=>t(e,i),children:[(0,Te.jsx)("span",{style:{marginRight:8},children:e}),(0,Te.jsx)(Iu.A,{})]},i)))})},$y=e=>{const{convId:t,convType:n,mainBotId:i}=(0,Jt.IK)();return{text:e,reportParams:{scene:bo.sJ.suggested_prompts},extraExt:{need_create_thread:n===Zt.H.NewThread?"1":"0",browser_language:(0,kn.wz)((0,se.TK)("uiLanguage"))},ctx:(0,So.Pe)(n,t,i)}},Wy=function(){var e=(0,a.A)((function*(e){ai.on.setState({floatingCardVisible:!1,summaryActionVisible:!1});const{convType:t}=(0,Jt.IK)(),n=$y(e);yield(0,So.Bc)(t,[n])}));return function(t){return e.apply(this,arguments)}}();var Ky=n(52289);const Yy=()=>{var e,t;const{actionMessages:n,currentAction:i,messageCursor:o,setBoxVisible:s,contextText:l,search:c,regenerate:d,retry:u,inputText:h}=(0,qt.t_)(),p=(0,m.useRef)(h);p.current=h||p.current;const g=(0,m.useRef)(),v=(0,An.P)((e=>e.messages)),x=null!==(e=n[i])&&void 0!==e?e:[],y=null!==(t=x[o])&&void 0!==t?t:"",{text:b,body:w}=v[y]||{},C=Ty(b)||"",[A]=(0,f.Y)("selectTranslateService"),S=()=>{var e;return!(null===(e=(0,se.TK)("authInfo"))||void 0===e||!e.isAuthenticated)||((0,_e.DT)({trackMeta:{login_entrance:"highlight_result"}}),!1)},k=function(){var e=(0,a.A)((function*(){var e,t,n;let i=[null==w||null===(e=w.message)||void 0===e?void 0:e.reply_id].concat(x.map((e=>v[e])).map((e=>{var t;return null===(t=e.body)||void 0===t||null===(t=t.message)||void 0===t?void 0:t.message_id}))).filter(Boolean),o=null!==(t=null==w||null===(n=w.message)||void 0===n?void 0:n.message_id)&&void 0!==t?t:"0";var s,r,a,l;g.current&&(i=[null===(s=g.current)||void 0===s||null===(s=s.body)||void 0===s||null===(s=s.message)||void 0===s?void 0:s.reply_id,null===(r=g.current)||void 0===r||null===(r=r.body)||void 0===r||null===(r=r.message)||void 0===r?void 0:r.message_id].filter(Boolean),o=null!==(a=null===(l=g.current)||void 0===l||null===(l=l.body)||void 0===l||null===(l=l.message)||void 0===l?void 0:l.message_id)&&void 0!==a?a:"0");const c={messageIds:i,switchMessageId:o};yield(0,So.ci)(c)}));return function(){return e.apply(this,arguments)}}(),E=function(){var e=(0,a.A)((function*(){var e,t;S()&&((({message_id:e,skill_name:t})=>{Lt({message_id:e,click_from:_.Z5.selectAssistantResult,skill_name:t})})({message_id:null!==(e=null==w||null===(t=w.message)||void 0===t?void 0:t.message_id)&&void 0!==e?e:"0",skill_name:i}),s(!1),ai.on.setState({floatingCardVisible:!1,summaryActionVisible:!1}),yield k(),Co.l.getState().setIsShowSidebar(!0,_.cz.selectAssistantResult))}));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,a.A)((function*(e,t){var n;(e=>{const{assistantBotId:t}=(0,se.ue)();(0,It.z8)(_.Ur.clickSearchAssistantSuggest,(0,r.A)({bot_id:t,current_page:_.g6.webOther,suggested_type:_.Ld.select_explain,click_from:_.Z5.selectAssistantMenu,button_name:_._h.suggest},e))})({message_id:null==w||null===(n=w.message)||void 0===n?void 0:n.message_id,click_position:`${t+1}`}),S()&&(s(!1),Co.l.getState().setIsShowSidebar(!0,_.cz.searchAssistant),yield(0,ko.Z)(),yield k(),yield Wy(e))}));return function(t,n){return e.apply(this,arguments)}}();return(0,m.useEffect)((()=>{g.current=void 0}),[i]),{syncToChatMessage:g,doSearch:e=>{const t=(null==e?void 0:e.language)||Ey(i);c((0,r.A)({enter_chat_method:"highlight_search_result_tool",scene:(null==e?void 0:e.scene)||bo.sJ.highlight_search_result_tool,sec_scene:(null==e?void 0:e.sec_scene)||bo._o.highlight_search_result_ask,contextText:l,translateService:A,language:t,answerWithSuggest:i===so.EU.explain},(0,Sn.A)(e,["scene","sec_scene"])))},handleAISearch:()=>{var e,t;if(!S())return;(({message_id:e})=>{(0,It.z8)(_.Ur.clickSelectAssistantResultBtn,{message_id:e,click_from:_.Z5.selectAssistantResult,action_name:"ask",button_name:"ai_search"})})({message_id:null!==(e=null==w||null===(t=w.message)||void 0===t?void 0:t.message_id)&&void 0!==e?e:"0"});const n=i===so.EU.translate?(0,Ky.qP)(p.current):p.current;To(n),s(!1)},handleContinueInChat:E,handleCopy:()=>{var e;let t=!1;return t=i===so.EU.translate?Gt()((0,fn.YA)(C)):Gt()(C),(({message_id:e,skill_name:t})=>{Pt({message_id:e,click_from:_.Z5.selectAssistantResult,skill_name:t})})({message_id:null==w||null===(e=w.message)||void 0===e?void 0:e.message_id,skill_name:i}),t},handleRegenerate:()=>{var e,t;d({replyId:null==w||null===(e=w.message)||void 0===e?void 0:e.reply_id,enter_chat_method:"highlight_search_result_tool",scene:"highlight_search_result_tool",answerWithSuggest:i===so.EU.explain}),Ut({message_id:null==w||null===(t=w.message)||void 0===t?void 0:t.message_id,skill_name:i})},handleRetry:()=>{var e,t;u({replyId:null==w||null===(e=w.message)||void 0===e?void 0:e.message_id,enter_chat_method:"highlight_search_result_tool",scene:"highlight_search_result_tool",answerWithSuggest:i===so.EU.explain}),(({message_id:e,skill_name:t})=>{Bt({message_id:e,click_from:_.Z5.selectAssistantResult,skill_name:t})})({message_id:null==w||null===(t=w.message)||void 0===t?void 0:t.message_id,skill_name:i})},handleClickFollowUpQuestion:T,handleVocabularyMastered:()=>{(0,Ke.s)("highlight_result_click",{card_type:"full_card",button_name:"translate",current_page:(0,zt.p$)(),click_result:"clear_highlight"}),gy.deleteDict({word:p.current,translation:""}),s(!1)}}},Gy=e=>{const{render:t}=e,{renderHeader:n,renderStreamMessage:i}=t;return(0,Te.jsxs)(Te.Fragment,{children:[n(),i({textFormatter:e=>Ty(e.text)||""})]})},Qy=e=>(0,Te.jsx)(Gy,(0,r.A)({},e));var Zy=n(80944),Xy=n(14381),Jy=n(62858),eb=n(6784);const tb=Lu().bind({"cici-ext-container":"cici-ext-container-IYCEkb",ciciExtContainer:"cici-ext-container-IYCEkb","inactivelink-hover-animation":"inactivelink-hover-animation-a8Gq0G",inactivelinkHoverAnimation:"inactivelink-hover-animation-a8Gq0G","notactivelink-hover-animation":"notactivelink-hover-animation-fbsD3w",notactivelinkHoverAnimation:"notactivelink-hover-animation-fbsD3w","light-click-animation":"light-click-animation-JlAsqg",lightClickAnimation:"light-click-animation-JlAsqg","click-animation":"click-animation-MBAg5r",clickAnimation:"click-animation-MBAg5r","semi-animation-rotate":"semi-animation-rotate-CbK91s",semiAnimationRotate:"semi-animation-rotate-CbK91s","inactive-btn-hover-animation":"inactive-btn-hover-animation-nUPiTZ",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-nUPiTZ","cici-ext-always-dark":"cici-ext-always-dark-Ha0zoa",ciciExtAlwaysDark:"cici-ext-always-dark-Ha0zoa","cici-ext-always-light":"cici-ext-always-light-BtPMDH",ciciExtAlwaysLight:"cici-ext-always-light-BtPMDH",ellipsis:"ellipsis-JLALe7",select:"select-COUz7N","option-container":"option-container-DBZEFh",optionContainer:"option-container-DBZEFh","language-local":"language-local-TeDsvm",languageLocal:"language-local-TeDsvm","language-setting":"language-setting-qzXXeo",languageSetting:"language-setting-qzXXeo","selected-option":"selected-option-by2wk3",selectedOption:"selected-option-by2wk3","activelink-hover-animation":"activelink-hover-animation-aHHsTw",activelinkHoverAnimation:"activelink-hover-animation-aHHsTw"}),nb=({"data-testid":e,languageList:t,onLanguageChange:n,initialLanguage:i,getPopupContainer:o})=>{const s=t.length>0,r=(0,m.useMemo)((()=>{var e;const n=t.find((e=>e.language_code===i));return null!==(e=null==n?void 0:n.language_loc)&&void 0!==e?e:i}),[t,i]);return(0,Te.jsx)(je.l6,{value:r,clickToHide:!0,style:{flex:"1"},onChange:n,getPopupContainer:o,dropdownClassName:tb("select"),suffix:(0,Te.jsx)(Pe.R0,{style:{marginRight:6}}),showArrow:!1,disabled:!s,position:"bottomRight","data-testid":e,children:t.map((({language_loc:e,language_code:t,language:n})=>{const o=t===i;return(0,Te.jsx)(je.l6.Option,{showTick:!1,value:t,children:(0,Te.jsxs)("div",{className:tb("option-container"),"data-lang-option":t,"data-testid":"language-option",children:[(0,Te.jsxs)("div",{children:[(0,Te.jsx)("div",{"data-testid":"language-local",className:tb("language-local",{"selected-option":o}),children:e}),t!==kn.Aq&&(0,Te.jsx)("div",{className:tb("language-setting"),children:n})]}),(0,Te.jsx)("div",{children:o&&(0,Te.jsx)(Pe.Tf,{})})]})},n+t)}))})},ib=Lu().bind(Py.A),ob=(0,l.jc)(),sb=()=>{const e=(0,v.B)(),[t,n]=(0,m.useState)(!0);(0,m.useEffect)((()=>{const e=()=>{(0,se.vE)("transPreferConfig",{tipShown:!0},!0)};return setTimeout((()=>{e(),n(!1)}),5e3),()=>e()}),[]);const i=(0,m.useRef)(null);return(0,Te.jsx)("div",{style:{width:" 100%",position:"absolute",left:0,top:0},ref:i,children:(0,Te.jsx)(je.m_,{trigger:"custom",visible:t,getPopupContainer:()=>i.current,style:{fontSize:11},content:e("flow_web_ext_action_popup_translate_hover_preference"),children:(0,Te.jsx)("div",{style:{width:"100%"}})})})},rb=({handleTranslate:e,style:t})=>{var n;const{translateLanguage:i,setStorageLanguage:o}=(()=>{const[e,t]=(0,f.Y)("translateLanguage"),n=(0,qt.t_)((e=>e.inputTextLang)),[i]=(0,f.Y)("transPreferConfig"),[o,s]=(0,m.useMemo)((()=>{var o;return[(null===(o=i.langMap)||void 0===o?void 0:o[n||""])||e,e=>{t(e),n&&(0,se.vE)("transPreferConfig",{langMap:{[n]:e}},!0)}]}),[e,i,n]);return{translateLanguage:o,setStorageLanguage:s}})(),s=(0,Gd.e)(),{inputText:r}=(0,qt.t_)(),a=(0,v.B)(),l=(0,m.useRef)(r),c=(0,m.useRef)(null),[d,u]=(0,m.useState)(!1),h=null===(n=(0,f.Y)("transPreferConfig")[0])||void 0===n?void 0:n.tipShown;return(0,Te.jsxs)("div",{className:ib("language-options"),style:t,ref:c,children:[(0,Te.jsx)("div",{className:ib("language-wrapper"),style:{flex:"1",fontSize:ob?"15px":"12px",height:ob?"34px":"28px"},children:a("flow_web_ext_action_popup_autodetect")}),(0,Te.jsx)(Pe.hI,{className:ib("icon-arrow-right")}),(0,Te.jsxs)("div",{className:ib("language-selector",{pad:ob}),style:{flex:"1"},children:[d&&!h?(0,Te.jsx)(sb,{}):null,(0,Te.jsx)(nb,{"data-testid":"translate-language-selector",languageList:s||[],initialLanguage:i,onLanguageChange:t=>{const n=`${t}`;(0,Yd.Su)({before_language_result:i,after_language_result:n,scene:Yd.jv.highlight_result_choose}),u(!0),o(n),e({text:l.current,language:n,enter_chat_method:"highlight_search_result_tool",scene:"highlight_search_result_tool",abortOptions:{reason:"switch_language",from:i,to:n}})},getPopupContainer:()=>null==c?void 0:c.current})]})]})},ab=e=>e.commonAncestorContainer.textContent;var lb=n(99277),cb=n(367),db=n(87095);const ub=({text:e,className:t})=>{const[n,i]=(0,m.useState)(!1),o=(0,m.useRef)(null);(0,m.useEffect)((()=>{const e=()=>{o.current=new lb.L,o.current.onLoadStart((()=>{i(!0)})),o.current.onPlayStart((()=>{i(!0)})),o.current.onPlayPause((()=>{i(!1)})),o.current.onPlayEnd((()=>{i(!1),e()}))};return e(),()=>{var e;null===(e=o.current)||void 0===e||e.destroy()}}),[]);const s=(0,m.useCallback)((()=>{var t,i,s,r,a;n?null===(t=o.current)||void 0===t||t.pause():(null===(i=o.current)||void 0===i||i.readText(e),null===(s=o.current)||void 0===s||s.setSpeaker(db.F),null===(r=o.current)||void 0===r||r.finishSendingText(),null===(a=o.current)||void 0===a||a.play())}),[o,n,e]);return(0,Te.jsx)(cb.A,{className:t,playing:n,onPlay:s})},hb="wrapper-e9DSfj",mb="caption-D91XEB",pb="examples-A7UA7z",gb="example-RpplVd",vb="sentence-QlzJFY",fb="translation-a5q04G",_b=({inputText:e,examples:t,className:n,style:i})=>(t=t.map((t=>{const{sentence:n}=t,i=new RegExp(`(${o=e,o.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})`,"ig");var o;return(0,r.A)((0,r.A)({},t),{},{sentence:e?n.replaceAll(i,"<strong>$1</strong>"):n})})),(0,Te.jsx)("div",{className:J()(n,pb),style:i,"data-flow-selectable":"true","data-testid":"select-output-panel-translate-example-container",children:t.map((({sentence:e,translation:t})=>(0,Te.jsxs)("div",{className:gb,children:[(0,Te.jsxs)("div",{className:J()(vb,"flex items-start"),children:[(0,Te.jsx)("div",{className:"flex-1",children:(0,Te.jsx)(Hu.x,{defaults:e})}),(0,Te.jsx)(ub,{className:"tts-read flex-initial ml-8",text:e})]}),(0,Te.jsx)("div",{className:fb,children:t})]},`${e}%%${t}`)))})),xb=e=>{const{style:t,examples:n,loading:i,inputText:o}=e,s=(0,v.B)();return(0,Te.jsxs)("div",{className:hb,style:t,children:[(0,Te.jsx)("div",{className:mb,children:s("flow_web_ext_action_popup_translate_example")}),i&&(0,Te.jsx)("div",{className:"pt-10",children:(0,Te.jsx)(Wu.c,{})}),!i&&(0,Te.jsx)(_b,{className:"mt-10",examples:n,inputText:o})]})};var yb=n(73018);const bb=function(){var e=(0,a.A)((function*(e=100){return yield new Promise((t=>setTimeout(t,e))),(()=>{var e,t;const{currentAction:n,actionMessages:i,messageCursor:o}=qt.t_.getState();return null!==(t=(null!==(e=i[n])&&void 0!==e?e:[])[o])&&void 0!==t?t:""})()}));return function(){return e.apply(this,arguments)}}();var wb=n(6522),Cb=n(36481),Ab=n(12365);const Sb="dictionary-meta-LJ5JMT",kb="examples-Pkp9XK",Eb={found:!1,dict_has_data:void 0,translate:"",example_sentences:[],explains:[],phonetics:[],phrases:[]},Tb=e=>{const{action:t,ready:n,render:i,doSearch:o,range:s,contextText:l,syncToChatMessage:c,inputText:d,isDone:u,setEnableCopy:h,setEnableListen:p,setCollectionParam:g}=e,_=(0,v.B)(),[x,y]=(0,m.useState)(!1),[b,w]=(0,m.useState)(Eb),[C,A]=(0,m.useState)(!1),{renderHeader:S,renderStreamMessage:k,renderLLMContextTip:E}=i,[T,I]=(0,f.Y)("selectTranslateService"),{setOnboardingBound:j,setOnboardingDict:N}=(0,jx.A)((e=>({setOnboardingBound:e.setOnboardingBound,setOnboardingDict:e.setOnboardingDict})),Ko.x),R=(0,m.useRef)(),M=(0,m.useRef)(""),P=(0,m.useRef)(null),L=(0,Ky.qP)(d),B=Ey(t),D=e=>{g({collectionType:wn.X.TranslateResult,collectFrom:zt.vP.highlight_result_card_translate,translate_result:{translate_service:T,dict:e}}),w(e),M.current=e.translate},O=b.dict_has_data,F=[fe.c$.DOUBAO].includes(T),U=e=>{const{isDone:t}=e;let{text:n=""}=e;return t||(n=(0,Ky.sh)(n)),(0,fn.q4)(n)},H=e=>{if(c.current=void 0,s){const t=(0,fn.l$)(s),n=(null==e?void 0:e.language)||B;t&&(0,fn.Oi)({encodeText:t,lang:n,translateService:(null==e?void 0:e.translateService)||T,contextText:l}).then((e=>c.current=e))}};(0,m.useEffect)((()=>{h(!O),p(!O)}),[O]),(0,m.useEffect)((()=>()=>{if(R.current&&"zh"===Ey(t)&&qt.t_.getState().trigger!==fe.LT.VocabruaryHighlight){const e=null==s?void 0:s.getBoundingClientRect();if(e){const{left:t,top:n,width:i,height:o}=e;j({left:t,top:n,width:i,height:o})}M.current&&(N({word:L,translation:M.current}),gy.addDict({word:L,translation:M.current}))}else j(void 0)}),[]),(0,m.useEffect)((()=>{void 0!==O&&O!==R.current&&(R.current=O,(0,a.A)((function*(){const e=yield bb();let t="Auto Detect";try{const e=yield(0,fs.od)(d);t=(0,wb.S)(e)||"Auto Detect"}catch(n){}(0,Ke.s)("highlight_result_show",{button_name:"translate",message_id:e,current_page:(0,zt.p$)(),before_language:t,after_language:(0,se.TK)("translateLanguage"),translate_service:T,whether_dict:O?"1":"0",card_type:"full_card"})}))())}),[O]),(0,m.useEffect)((()=>{g({collectionType:wn.X.TranslateResult,collectFrom:zt.vP.highlight_result_card_translate,translate_result:{translate_service:T,dict:b}})}),[]),(0,Cb.H)((()=>{C&&(0,Ke.s)("choose_translate_service",{current_page:(0,zt.p$)()})}),[C]),(0,Cb.H)((()=>{(0,Ke.s)("choose_translate_service_result",{value:T,click_from:"highlight_translate",current_page:(0,zt.p$)()})}),[T]);const z=e=>{0===(null==e?void 0:e.code)&&D(e.data)},q=(e,t)=>{if(Ix.kF){D(Eb);try{((e,t)=>{Ab.B.fetch({req:{url:`${bn.kD}/plugin/dict/word`,body:{content:e,language_target:t,use_dict:F?"youdao":"",related_text:s?ab(s):void 0}}},{onOpen:()=>{y(!0)},onUpdate:e=>{const{body:t}=e;t&&(t.data.dict_has_data=void 0,z(t))},onDone:e=>{const{body:t}=e;z(t),y(!1)},onError:()=>{y(!1),D(Eb)},onAbort:()=>{y(!1),D(Eb)}})})(e,t)}catch(n){D(Eb)}}},V=e=>{o((0,r.A)((0,r.A)({},e),{},{sec_scene:bo._o.highlight_search_result_translate})),H(e)},$=e=>{I(e),V({translateService:e}),A(!1)};(0,Cb.H)((()=>{B&&q(L,B)}),[B,T]),(0,m.useEffect)((()=>{n&&(H(),B&&q(L,B))}),[n]);const W=()=>{const e=x?b.found:b.found&&(0,Zy.A)(b.example_sentences)>0;return(0,Te.jsxs)(Te.Fragment,{children:[k({textFormatter:U}),e&&(0,Te.jsx)(xb,{style:{marginTop:16},loading:x,inputText:d,examples:u?b.example_sentences:[]}),[fe.c$.GPT,fe.c$.DOUBAO].includes(T)&&E()]})};return(0,Te.jsxs)("div",{ref:P,children:[S({optionsNode:(0,Te.jsx)(je.AM,{trigger:"custom",position:"bottomRight",visible:C,onClickOutSide:()=>A(!1),content:(0,Te.jsx)(Xy.A,{selectedService:T,onSelectService:$,services:eb.E}),className:"rounded-[16px]",getPopupContainer:()=>P.current,children:(0,Te.jsx)("div",{onClick:()=>A(!C),children:(0,Te.jsx)(Jy.A,{mode:"logo",translateService:T})})})}),n&&(0,Te.jsx)(rb,{style:{marginTop:10},handleTranslate:e=>{V(e)}}),(0,Te.jsx)(Lx,{text:L,style:{marginTop:16}}),F?void 0===O?(0,Te.jsx)("div",{className:"pt-10",children:(0,Te.jsx)(Wu.c,{})}):O?(()=>{const e=(0,hi.A)(b.phrases,(e=>({sentence:e.phrase,translation:e.meaning})));return(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(yb.A,{className:"mt-10",translation:b.translate,explains:b.explains,phonetics:b.phonetics}),(0,Te.jsxs)(je.tU,{style:{marginTop:20},type:"line",className:Sb,onChange:e=>{(0,Ke.s)("highlight_result_click",{button_name:"translate",translate_service:T,whether_dict:"1",translate_tab:e})},children:[(0,Te.jsx)(je.mF,{tab:_("flow_web_ext_action_popup_translate_dictionary_contextual"),itemKey:"translate_follow_context",children:k({textFormatter:U,renderFollowupQuestions:!1,style:{marginTop:0,fontSize:13}})}),(0,Te.jsx)(je.mF,{tab:_("flow_web_ext_action_popup_translate_dictionary_example"),itemKey:"sentence_example",children:x?(0,Te.jsx)(Wu.c,{}):(0,Te.jsx)(_b,{className:kb,inputText:d,examples:u?b.example_sentences:[]})}),(0,Zy.A)(e)>0&&(0,Te.jsx)(je.mF,{tab:_("flow_web_ext_action_popup_translate_dictionary_collocation"),itemKey:"phrase",children:x?(0,Te.jsx)(Wu.c,{}):(0,Te.jsx)(_b,{className:kb,inputText:d,examples:u?e:[]})})]})]})})():W():W()]})},Ib=e=>{const{render:t,message:n}=e,{renderLLMContextTip:i}=t,{body:o,suggests:s=[],isDone:a}=n||{},l=(0,m.useRef)(0);return(0,m.useEffect)((()=>{var e;if(a&&s.length)return(e=>{const{assistantBotId:t}=(0,se.ue)();(0,It.z8)(_.Ur.showSearchAssistantSuggest,(0,r.A)((0,r.A)({bot_id:t},e),{},{current_page:_.g6.webOther,suggested_type:_.Ld.select_explain}))})({prompt_cnt:s.length,message_id:null==o||null===(e=o.message)||void 0===e?void 0:e.message_id}),()=>{l.current=0}}),[a]),(0,m.useEffect)((()=>{if(s.length){for(let t=l.current;t<s.length;t++){var e;Ht({prompt_position:`${t+1}`,message_id:null==o||null===(e=o.message)||void 0===e?void 0:e.message_id})}l.current=s.length}}),[s]),(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(Gy,(0,r.A)({},e)),i()]})},jb={[so.EU.translate]:Tb,[so.EU.explain]:Ib,[so.EU.rewrite]:Qy,[so.EU.grammar]:Qy,[so.EU.adjust_skill]:Qy},Nb=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 16 16"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",d:"M8.1 13.76a5.4 5.4 0 0 1-2.19-.445 5.7 5.7 0 0 1-1.81-1.223 5.8 5.8 0 0 1-1.227-1.803 5.5 5.5 0 0 1-.44-2.195q0-1.162.44-2.184A5.9 5.9 0 0 1 4.095 4.1a5.7 5.7 0 0 1 1.81-1.222 5.4 5.4 0 0 1 2.189-.446q1.162 0 2.19.446 1.031.44 1.809 1.222.782.783 1.227 1.81.446 1.02.446 2.184 0 1.167-.446 2.195a5.82 5.82 0 0 1-3.031 3.026 5.4 5.4 0 0 1-2.19.445m0-1.244q.917 0 1.716-.342a4.5 4.5 0 0 0 1.413-.945 4.365 4.365 0 0 0 1.293-3.135q0-.919-.348-1.717a4.4 4.4 0 0 0-.95-1.413 4.37 4.37 0 0 0-3.13-1.293 4.35 4.35 0 0 0-1.722.342 4.5 4.5 0 0 0-1.408.951 4.372 4.372 0 0 0-1.282 3.13q0 .923.337 1.727a4.5 4.5 0 0 0 .95 1.408q.61.603 1.408.945a4.35 4.35 0 0 0 1.722.342m-.951-1.478a.425.425 0 0 1-.45-.44q-.002-.184.129-.31a.45.45 0 0 1 .32-.124h.625V8.056h-.527a.46.46 0 0 1-.32-.12.42.42 0 0 1-.13-.32q0-.186.13-.31a.45.45 0 0 1 .32-.125h1.027q.239 0 .364.157a.62.62 0 0 1 .125.408v2.418h.56q.19 0 .32.125.13.124.13.31a.425.425 0 0 1-.45.44zm.929-4.656a.74.74 0 0 1-.533-.217.73.73 0 0 1-.223-.532q0-.32.223-.538a.73.73 0 0 1 .533-.223q.315 0 .532.223a.73.73 0 0 1 .217.538.74.74 0 0 1-.217.532.72.72 0 0 1-.532.217",opacity:.8})})),Rb="close-btn-plQNum",Mb="output-Yv5fff",Pb="header-container-W750nM",Lb="caption-j8fz7d",Bb="options-node-j1B0G7",Db="stream-message-container-U2Nsam",Ob="llm-context-tip-tYpfwb",Fb="result-flKBGi",Ub=()=>{var e,t;const{actionMessages:n,currentAction:i,range:o,messageCursor:s,clearMessages:l,boxVisible:c,setBoxVisible:d,setBarVisible:u,contextText:h,tone:p,checkAndSetInputLang:g,inputText:_,sceneId:x,inputTextReady:y,trigger:b,setTrigger:w,reportParams:C={}}=(0,qt.t_)(),[S,k]=(0,m.useState)(!1),[E,T]=(0,m.useState)(!0),[I,j]=(0,m.useState)(!0),N=(0,v.B)(),R=(0,m.useRef)(_),M=R.current,P=(0,An.P)((e=>e.messages)),L=null!==(e=n[i])&&void 0!==e?e:[],B=null!==(t=L[s])&&void 0!==t?t:"",{isDone:D,suggests:O=[]}=P[B]||{},[F]=(0,f.Y)("editingPopupActions"),[U]=(0,f.Y)("readingPopupActions"),{syncToChatMessage:H,doSearch:z,handleAISearch:q,handleContinueInChat:V,handleCopy:$,handleRegenerate:W,handleRetry:K,handleClickFollowUpQuestion:Y,handleVocabularyMastered:G}=Yy(),Q=(0,m.useMemo)((()=>{var e;const t=(0,Sy.A)([...F.actionList,...F.moreActionList,...U.actionList,...U.moreActionList],(e=>e.id===i)),n=(0,hh.A)(so.YN,(e=>e.id===i));return null!==(e=t[0])&&void 0!==e&&e.name?n||t[0].confId?N(t[0].name):t[0].name:""}),[i,F,U]);(0,m.useEffect)((()=>{_&&(R.current=_)}),[_]),(0,m.useEffect)((()=>{u(!1)}),[]),(0,m.useEffect)((()=>()=>{requestAnimationFrame((()=>w(void 0)))}),[]),(0,m.useEffect)((()=>{if(y){try{(0,a.A)((function*(){let e;i===so.EU.translate&&(e=x,yield g()),k(!0),z({scene:C.scene,sec_scene:C.sec_scene||`highlight_search_result_${i}`,sceneId:e})}))()}catch(e){A.vF.persist.error({eventName:"[SEARCH_CORE] - SEARCH",error:e})}return()=>{l()}}}),[y]);const Z=()=>{qt.t_.getState().setBoxVisible(!1)},X=e=>(0,Te.jsx)(Vy,{containerClassName:null==e?void 0:e.containerClassName,className:null==e?void 0:e.className,style:null==e?void 0:e.style,suggestMessageListWithStatus:{suggests:O.filter((e=>e))},onClick:Y}),ee=i===so.EU.translate,[te,ne]=(0,m.useState)({collectionType:ee?wn.X.TranslateResult:wn.X.ExplainResult,collectFrom:ee?zt.vP.highlight_result_card_translate:zt.vP.highlight_result_card_explain}),ie=jb[i]||Gy;const oe={message:P[B],action:i,boxVisible:c,setBoxVisible:d,doSearch:z,ready:S,range:o,contextText:h,syncToChatMessage:H,inputText:M,isDone:Boolean(D),setEnableCopy:T,setEnableListen:j,render:{renderHeader:e=>{const{optionsNode:t,className:n,style:o}=e||{};return(0,Te.jsxs)("div",{className:J()(Pb,n),style:o,children:[(0,Te.jsx)("div",{className:Lb,children:i===so.EU.adjust_skill?null==p?void 0:p.show_name:Q}),(0,Te.jsxs)("div",{className:Bb,children:[t,un()?(0,Te.jsx)(ve.A,{className:Rb,onClick:Z}):null]})]})},renderStreamMessage:e=>{const{textFormatter:t,renderFollowupQuestions:n=!0,className:i,style:o}=e||{};return(0,Te.jsxs)("div",{"data-flow-selectable":"true",className:J()(Db,i),style:o,children:[(0,Te.jsx)(Qu,{className:Fb,type:"selection",id:B,enableScroll:!0,onRetry:K,showShadow:!1,textFormatter:t,loadingStyle:"dot-flashing"}),n&&D&&X()]})},renderLLMContextTip:e=>{const{className:t,style:n}=e||{};return D?(0,Te.jsxs)("div",{className:J()(Ob,t),style:(0,r.A)({marginTop:12},n),children:[(0,Te.jsx)(Nb,{}),(0,Te.jsx)("span",{children:N("flow_web_ext_action_popup_translate_notice")})]}):null},renderSelectContentRef:e=>(0,Te.jsx)(Lx,{text:M,className:null==e?void 0:e.className,style:(0,r.A)((0,r.A)({},{marginTop:12}),null==e?void 0:e.style)}),renderFollowup:X},setCollectionParam:ne};return(0,Te.jsxs)("div",{className:Mb,"data-testid":"select-box-container",children:[(0,Te.jsx)(ie,(0,r.A)({},oe)),D&&(0,Te.jsx)("div",{style:{marginTop:16},children:(0,Te.jsx)(Hy,{message:P[B],showVocabularyMastered:b===fe.LT.VocabruaryHighlight,onVocabularyMasteredClick:G,disableCopy:!E,disableListen:!I,regenerateDisable:L.length>=bn.ch,onMainButtonClick:()=>{[so.EU.explain].includes(i)?q():V()},onCopy:$,onRegenerate:W,collectionParam:te})})]})},Hb=Lu().bind(Py.A),zb=(0,l.jc)(),qb=e=>{const{onSizeChange:t}=e,n=(0,v.B)(),i=(0,m.useRef)(null),{height:o,width:s}=(0,Yo.w)({ref:i}),r=(()=>{const{currentAction:e}=(0,qt.t_)();return!(0,wo.GQ)((0,wo.OB)(e))})();(0,m.useEffect)((()=>{null==t||t()}),[s,o]);const a=(0,Te.jsxs)("div",{className:Hb("login-content"),children:[(0,Te.jsxs)("div",{className:Hb("text"),children:["\u{1f389} ",n("flow_web_ext_login_note")]}),(0,Te.jsx)(je.$n,{theme:"solid",type:"primary",className:Hb("login-btn"),onClick:()=>(0,_e.DT)({trackMeta:{login_entrance:"highlight_result"}}),children:n("flow_web_ext_login")})]});return(0,Te.jsx)("div",{className:Hb("container"),style:zb?{gap:"10px"}:{},ref:i,children:r?(0,Te.jsx)(Ub,{}):a})};const Vb=e=>{var t;const n=null===(t=(0,m.useContext)(as.A))||void 0===t?void 0:t.getPopupContainer,i=(0,qt.t_)((e=>e.setBoxVisible)),[o,s]=(0,m.useState)(0),[a]=(0,m.useState)(e.selectionData),{top:l,left:c,width:d,height:u,clientBottom:h}=a,p={top:`${l+window.scrollY+5}px`,left:`${c+window.scrollX}px`,height:`${u}px`,width:`${d}px`},g=d/2;c+g<=210&&(p.left=`${210-g+window.scrollX}px`),h<300&&(p.top=l+window.scrollY+5+h-300+"px");const v={position:"relative",width:420,boxSizing:"border-box",marginLeft:`${Math.ceil((d-420)/2)}px`},f=(0,Rh.A)((()=>{i(!1)})),_=(0,Ay.A)((()=>{s((new Date).getTime())}),{trailing:!0,leading:!1,wait:666}),x=(0,Te.jsx)("div",{ref:f,onMouseDown:e=>{if(!function(e){let t=e.target;for(;t&&t!==e.currentTarget;){if("true"===t.getAttribute("data-flow-selectable"))return!0;t=t.parentElement}return!1}(e))return e.preventDefault(),e.stopPropagation(),!1},children:(0,Te.jsx)(qb,{onSizeChange:_.run})});return(0,Te.jsx)(je.AM,{rePosKey:o,content:x,trigger:"custom",visible:!0,autoAdjustOverflow:!0,position:"bottomLeft",getPopupContainer:n,onVisibleChange:e=>{i(e)},style:(0,r.A)({},v),className:ds,children:(0,Te.jsx)("span",{style:(0,r.A)({position:"absolute",pointerEvents:"none"},p)})})},$b=()=>{const{barVisible:e,boxVisible:t,setBarVisible:n}=(0,qt.t_)(),i=ks(),o=Ss(),[s,r]=(0,m.useState)((new Date).getTime()),[l,c]=(0,m.useState)(!0),{isContextMenu:d}=My(),u=(0,qt.t_)((e=>e.selectionBaseInfo)),h=u.text,p=(0,m.useRef)(h);(0,m.useEffect)((()=>{const e=Boolean(h);n(e),p.current!==h&&(ai.on.getState().setFloatingCardVisible(e),e&&ai.on.getState().setSummaryActionVisible(!1),p.current=h)}),[h]),(0,m.useEffect)((()=>{(0,et.lK)({"flow-ai-select-bar-enabled":!i})}),[i]);const g=function(){var e=(0,a.A)((function*(){const e=yield bb(),{currentAction:t}=qt.t_.getState();return{button_name:t,message_id:e}}));return function(){return e.apply(this,arguments)}}();return(0,m.useEffect)((()=>{if(t){c(!1),r((new Date).getTime());const{currentAction:e}=qt.t_.getState();e!==so.EU.translate&&g().then((e=>{(({before_language:e,after_language:t,button_name:n,message_id:i})=>{(0,It.z8)(_.Ur.showSelectAssistantResult,{before_language:e,after_language:t,button_name:n,message_id:i})})(e)}))}var e;t||l||(e={duration:(new Date).getTime()-s},(0,It.z8)(_.Ur.closeSelectAssistantResult,e))}),[t]),t?(0,Te.jsx)(Vb,{selectionData:u}):!e||d||i||o?null:(0,Te.jsx)(vs,{selectionData:u})};var Wb=n(84171);const Kb=e=>(0,Te.jsxs)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:26,height:31,fill:"none",viewBox:"0 0 26 31"},e),{},{children:[(0,Te.jsxs)("g",{filter:"url(#mouse_svg__a)",children:[(0,Te.jsxs)("mask",{id:"mouse_svg__b",width:31.553,height:32.651,x:-7.203,y:-6.184,fill:"#000",maskUnits:"userSpaceOnUse",children:[(0,Te.jsx)("path",{fill:"#fff",d:"M-7.203-6.184H24.35v32.651H-7.203z"}),(0,Te.jsx)("path",{d:"m5.126 4.393 13.796 10.33-6.814 1.472-5.135 5.257z"})]}),(0,Te.jsx)("path",{fill:"#000",d:"m5.126 4.393 13.796 10.33-6.814 1.472-5.135 5.257z"}),(0,Te.jsx)("path",{fill:"#fff",d:"m5.126 4.393 1.198-1.601L2.642.035l.495 4.573zm13.796 10.33.423 1.954 4.287-.927-3.511-2.629zm-6.814 1.472-.422-1.954-.588.127-.42.43zm-5.135 5.257-1.988.216.456 4.214 2.963-3.032zM3.927 5.994l13.797 10.33 2.397-3.203L6.324 2.791zm14.572 6.773-6.813 1.474.845 3.91 6.814-1.474zm-7.821 2.03-5.135 5.258 2.86 2.795 5.136-5.257zm-1.716 6.44L7.114 4.177l-3.977.431 1.848 17.06z",mask:"url(#mouse_svg__b)"})]}),(0,Te.jsx)("defs",{children:(0,Te.jsxs)("filter",{id:"mouse_svg__a",width:25.311,height:30.169,x:.481,y:.035,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,Te.jsx)("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),(0,Te.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,Te.jsx)("feOffset",{dy:2.161}),(0,Te.jsx)("feGaussianBlur",{stdDeviation:1.08}),(0,Te.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,Te.jsx)("feColorMatrix",{values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.12 0"}),(0,Te.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_8224_23498"}),(0,Te.jsx)("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_8224_23498",result:"shape"})]})})]})),Yb="summarizeOnboarding-bjgvPs",Gb="card-VE1owl",Qb="mouse-RYBJj5",Zb="clickMe-_5_fCR",Xb=({onClose:e})=>(0,Te.jsxs)("div",{className:Yb,children:[(0,Te.jsx)("div",{className:Gb,children:(0,Te.jsx)(Wb.A,{onSummarize:()=>{e()}})}),(0,Te.jsx)("div",{className:Qb,children:(0,Te.jsx)(Kb,{})}),(0,Te.jsx)("div",{className:Zb,children:"Click here"})]});var Jb=n(91469),ew=n(42265);const tw={"cici-ext-container":"cici-ext-container-tayrPu",ciciExtContainer:"cici-ext-container-tayrPu","inactivelink-hover-animation":"inactivelink-hover-animation-HRqUY6",inactivelinkHoverAnimation:"inactivelink-hover-animation-HRqUY6","notactivelink-hover-animation":"notactivelink-hover-animation-lomsAJ",notactivelinkHoverAnimation:"notactivelink-hover-animation-lomsAJ","light-click-animation":"light-click-animation-iZFe3U",lightClickAnimation:"light-click-animation-iZFe3U","click-animation":"click-animation-ahs_yg",clickAnimation:"click-animation-ahs_yg","semi-animation-rotate":"semi-animation-rotate-BL4TWA",semiAnimationRotate:"semi-animation-rotate-BL4TWA","inactive-btn-hover-animation":"inactive-btn-hover-animation-sxuohd",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-sxuohd","cici-ext-always-dark":"cici-ext-always-dark-jf13oz",ciciExtAlwaysDark:"cici-ext-always-dark-jf13oz","cici-ext-always-light":"cici-ext-always-light-THiaY_",ciciExtAlwaysLight:"cici-ext-always-light-THiaY_",ellipsis:"ellipsis-U4IiL4",floatBtn:"floatBtn-CjYdnn",left:"left-XFEjgX",right:"right-EKGjLV",floatBtnWrapper:"floatBtnWrapper-D6516N",reverse:"reverse-ycUQf6",floatBtnList:"floatBtnList-iGgAce",floatBtnBrand:"floatBtnBrand-DnIPgk",show:"show-D28vkP","common-feature-actions":"common-feature-actions-y0M2DV",commonFeatureActions:"common-feature-actions-y0M2DV",expand:"expand-uTJJDF",toolDivider:"toolDivider-BKJgFG",floatBtnPanelItem:"floatBtnPanelItem-efEC8W",toolContainer:"toolContainer-cfl5wc",floatBtnPanelItemBlock:"floatBtnPanelItemBlock-r06VPi",icon_size:"icon_size-jZfWVU",iconSize:"icon_size-jZfWVU",floatBtnPanelItemIcon:"floatBtnPanelItemIcon-l8mIbk",floatBtnPanelItemIconReverse:"floatBtnPanelItemIconReverse-T2KtUO",translateActiveIcon:"translateActiveIcon-xOVtGa",floatBtnPanelItemIconCollected:"floatBtnPanelItemIconCollected-zM3YDL",floatBtnPanelItemText:"floatBtnPanelItemText-GtXLVZ",floatBtnPanelItemTranslate:"floatBtnPanelItemTranslate-o3CGMp",floatBtnPanelItemLangSettingsIcon:"floatBtnPanelItemLangSettingsIcon-re_b2w",floatBtnPanelItemBlockWithSetting:"floatBtnPanelItemBlockWithSetting-IuDJ96",showLangSettingIcon:"showLangSettingIcon-CXn0JL",active:"active-wXvkas",showLangSettingIconReverse:"showLangSettingIconReverse-FnQPkq",floatBtnPanelLine:"floatBtnPanelLine-fGjRZ9",closeBtn:"closeBtn-MUUSAu",floatBtnClose:"floatBtnClose-f19uOF",floatBtnCloseIcon:"floatBtnCloseIcon-BIhnyV",floatBtnAvatar:"floatBtnAvatar-zS_g4L",float_btn_pad:"float_btn_pad-PTtRJh",floatBtnPad:"float_btn_pad-PTtRJh",float_btn_item_main:"float_btn_item_main-fqtDEM",floatBtnItemMain:"float_btn_item_main-fqtDEM",float_btn_item_main_icon:"float_btn_item_main_icon-rhepOY",floatBtnItemMainIcon:"float_btn_item_main_icon-rhepOY",float_btn_item_main_text:"float_btn_item_main_text-RdYjRN",floatBtnItemMainText:"float_btn_item_main_text-RdYjRN",float_btn_item_divider:"float_btn_item_divider-jP6dmI",floatBtnItemDivider:"float_btn_item_divider-jP6dmI",float_btn_item_setting:"float_btn_item_setting-jxDZ_f",floatBtnItemSetting:"float_btn_item_setting-jxDZ_f",highlight:"highlight-uNeLu1",hide:"hide-YZweor",shortcut:"shortcut-imnyIE","screen-capture":"screen-capture-OafYWh",screenCapture:"screen-capture-OafYWh","activelink-hover-animation":"activelink-hover-animation-EE8R_W",activelinkHoverAnimation:"activelink-hover-animation-EE8R_W"},nw="shortcut-text-_kLrAz",iw="text-fO5iyg",ow="hot-key-lNPMF8",sw=({text:e,hotKey:t})=>(0,Te.jsxs)("span",{className:nw,children:[(0,Te.jsx)("span",{className:iw,children:e}),t?(0,Te.jsx)("span",{className:ow,children:t}):null]});var rw=n(28328),aw=n(20825);const lw=()=>{const e=(0,Co.l)((e=>e.setIsShowSidebar));return function(){var t=(0,a.A)((function*(t){try{var n;if((0,_e.GT)(),(0,wo.BB)({action:"web_summary",loginParams:{trackMeta:{login_entrance:"float_btn"}}}))return;(0,xf.Ie)({button_name:_._h.summarizePage});const i=window.location.href,o=yield(0,ai.nx)(),s=(0,kn.wz)((0,se.TK)("uiLanguage"));e(!0,_.cz.clickSidebar);const r={title:null==o?void 0:o.title,url:i,content:null==o?void 0:o.textContent};ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),yield(0,ko.Z)();const{convId:a,convType:l,mainBotId:c}=(0,Jt.IK)(),d={text:i,extraExt:{origin:location.origin,browser_explain:JSON.stringify(r),llm_without_mem:"1",browser_language:s,flag_browser_plugin:"1",answer_with_suggest:"0",need_create_thread:l===Zt.H.NewThread?"1":"0"},reportParams:{scene:bo.sJ.chat_action_bar},ctx:(0,So.Pe)(l,a,c)};A.vF.persist.log({eventName:"summary_page_action",meta:{contentLength:null===(n=r.content)||void 0===n?void 0:n.length,from:"float-btn"}}),Co.l.getState().isSidePanelMode&&!aw._K.isInSidePanel?Tx.IF.getState().type===rw.u9.pdf?(0,jn.cs)({name:"read-pdf",body:{url:i}}):(0,jn.cs)({name:"send-message-to-chat",body:{msg:d,chatType:l}}):Tx.IF.getState().type===rw.u9.pdf?(0,wf.M)({url:i}):(dh.Qz.create("cici_summary_page_action_perf",!0),(0,ew.C)([d],{chatType:l,botType:"Main",beforeSendMessage:e=>{null==t||t((null==e?void 0:e[0].local_message_id)||"")}}))}catch(i){A.vF.persist.error({eventName:"[FLOAT_BUTTON] - SUMMARIZE",error:i})}}));return function(e){return t.apply(this,arguments)}}()},cw=()=>{const e=(0,v.B)(),t=lw(),{shortcutKey:n}=ts(Xo.e.ReadPage);(0,m.useEffect)((()=>rh.A.on("SUMMARIZE PAGE",rh.x.PAGE,(()=>{t()}))),[t]);const i=(0,m.useRef)(null);return(0,Te.jsx)("div",{ref:i,className:tw.toolContainer,children:(0,Te.jsx)(je.m_,{content:(0,Te.jsx)(sw,{text:e("flow_web_ext_sidebar_summarize"),hotKey:(0,Jo.o)(n)}),position:"left",getPopupContainer:()=>i.current,children:(0,Te.jsx)("div",{className:tw.floatBtnPanelItemIcon,onClick:()=>{t()},"data-testid":"float-button-read-page",children:(0,Te.jsx)(Jb.A,{})})})})},dw="onboarding-QNMbEE",uw=()=>{const[e,t]=(0,m.useState)(!0),n=(0,Co.l)((e=>e.setIsShowSidebar)),i=(0,Co.l)((e=>e.isSidePanelMode)),o=lw(),s=location.href===We.Z_,r=location.href===We.P9;if(r&&bf({current_page:yf.ARTICLE_SUMMARIZE}),s&&bf({current_page:yf.VIDEO_SUMMARIZE}),!e)return null;const a=()=>{(0,It.z8)(_.Ur.clickChatFloatCard,{highlight_page:_.g6.webOther,button_name:so.EU.read,module_name:xf.S1.READ_PAGE,click_from:_.Z5.onboarding,current_page:yf.ARTICLE_SUMMARIZE}),o(),history.pushState({},"",We.cT),t(!1)};return r?i?(a(),null):(n(!0,_.cz.onboarding),(0,Te.jsx)("div",{className:dw,children:(0,Te.jsx)(Xb,{onClose:a})})):null};let hw=function(e){return e.baidu="baidu",e.google="google",e.bing="bing",e.normal="normal_page",e}({});function mw(e){return e instanceof HTMLAnchorElement&&"a"===e.tagName.toLowerCase()&&(0,tn.AY)(e.href,{allowedProtocols:["https:","http:"]})}function pw(e,t){let n=e;for(;n;){const e=n.tagName.toLocaleLowerCase();if("img"===e||"image"===e)return;if(n.style.backgroundImage.includes("url"))return;if(t(n))return n;n=n.parentElement}}function gw(e,t){const n=e.target;if(t===hw.bing)return function(e){const t=pw(e,(e=>{var t,n;return!(!mw(e)||!(null!==(t=e.parentElement)&&void 0!==t&&t.classList.contains("rdtopattr")||null!==(n=e.parentElement)&&void 0!==n&&n.classList.contains("b_topTitle")))}));var n,i;if(t&&t instanceof HTMLAnchorElement)return null!==(n=t.parentElement)&&void 0!==n&&n.classList.contains("rdtopattr")?{alink:t.href,hoverEle:t,contentEle:(null===(i=t.parentElement.nextElementSibling)||void 0===i?void 0:i.querySelector("a"))||void 0}:{alink:t.href,hoverEle:t,contentEle:t};const o=pw(e,(e=>{var t,n;return!(!mw(e)||!(null!==(t=e.parentElement)&&void 0!==t&&t.classList.contains("b_tpcn")||"h2"===(null===(n=e.parentElement)||void 0===n?void 0:n.tagName.toLocaleLowerCase())))}));if(o&&o instanceof HTMLAnchorElement){var s;let e,t=o.href;if(t.startsWith("https://www.bing.com/")){var r;const e=(null===(r=o.parentElement)||void 0===r||null===(r=r.parentElement)||void 0===r||null===(r=r.querySelector('[role="contentinfo"]'))||void 0===r||null===(r=r.querySelector("cite"))||void 0===r?void 0:r.textContent)||"";try{new URL(e),t=e}catch(g){}}var a;return e=null!==(s=o.parentElement)&&void 0!==s&&s.classList.contains("b_tpcn")?(null===(a=o.parentElement.nextElementSibling)||void 0===a?void 0:a.querySelector("a"))||void 0:o.parentElement||void 0,{alink:t,hoverEle:o.parentElement||void 0,contentEle:e}}const l=pw(e,(e=>!(!e.classList.contains("b_fpl_icon")&&!e.classList.contains("b_fpl_attr"))));var c;if(l&&l.closest("a"))return{alink:(null===(c=l.closest("a"))||void 0===c?void 0:c.href)||"",hoverEle:l.parentElement||void 0,contentEle:l.parentElement||void 0};const d=pw(e,(e=>!!e.classList.contains("b_mainContent")));var u;if(null!=d&&d.querySelector("a"))return{alink:(null===(u=d.querySelector("a"))||void 0===u?void 0:u.href)||"",hoverEle:d,contentEle:d};const h=pw(e,(e=>!!e.classList.contains("na_t_news_caption")));var m;if(h)return{alink:(null===(m=h.closest("a"))||void 0===m?void 0:m.href)||"",hoverEle:h,contentEle:h};const p=pw(e,(e=>{var t,n;return!(!mw(e)||!(null!==(t=e.parentElement)&&void 0!==t&&t.classList.contains("b_rc_gb_sub_title")||e.closest('[class="b_algoRCAggreFC"]')||null!==(n=e.parentElement)&&void 0!==n&&n.classList.contains("deeplink_title")))}));return p&&p instanceof HTMLAnchorElement?{alink:p.href,hoverEle:p,contentEle:p}:{alink:"",hoverEle:void 0,contentEle:void 0}}(n);if(t===hw.google)return function(e){const t=pw(e,(e=>!!mw(e)&&!e.closest("#rhs")&&!!(e.querySelector("h3")||e.classList.contains("fl")||e.classList.contains("l")))),n=t;let i=t;if(t&&t instanceof HTMLAnchorElement){const e=t.querySelector("h3"),o=t.querySelector('[aria-level="3"]');return i=e||o||t,{alink:t.href,hoverEle:n,contentEle:i}}return{alink:"",hoverEle:void 0,contentEle:void 0}}(n);if(t===hw.baidu)return function(e){const t=pw(e,(e=>!(!mw(e)||e.closest('[id="content_right"]')||e.closest('[id="head"]')||e.closest('[id="s_tab"]')||e.closest('[class*="c-gap-top"]')||e.closest('[class*="c-abstract"]')||e.closest('[class*="result-molecule"]')||e.closest('[tpl="recommend_list"]')||e.closest('[class*="source"]')||e.closest('[class*="pc-container"]')||e.querySelector('[class*="single-card-more"]')||e.querySelector('[class*="image-wrapper"]')||e.classList.contains("op-mapcity-mapimg"))));return t&&t instanceof HTMLAnchorElement?{alink:t.href,hoverEle:t,contentEle:t}:{alink:"",hoverEle:void 0,contentEle:void 0}}(n);const i=pw(n,(e=>!!mw(e)));let o="";return i instanceof HTMLAnchorElement&&(o=i.href),{alink:o,hoverEle:n,contentEle:n}}const vw="link-text-style",fw="link-text-effect",_w=`\n.${fw} {\n}\n\n.${fw}:hover {\n  background-image: radial-gradient(78.87% 125% at 21.13% 50%, #0057FF 0%, #5A91FC 81.94%) !important;\n  -webkit-background-clip: text !important;\n  -webkit-text-fill-color: transparent !important;\n  color: transparent !important;\n  background-clip: text !important;\n  background-size: 300% !important;\n  background-position: 0% 50% !important;\n  animation: gradient_ani 2s ease infinite;\n}\n\n@keyframes gradient_ani {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n`,xw=e=>{(()=>{let e=document.getElementById(vw);e||(e=document.createElement("style"),e.id=vw,e.innerHTML=_w,(0,rr.EY)(e))})(),e.classList.add(fw)};function yw(){const e=(0,Co.l)((e=>e.isShowLinkPreview)),[t]=(0,f.Y)("linkPreviewDisabledHosts"),[n]=(0,f.Y)("linkPreviewDisabledAll"),i=null==t?void 0:t.includes(window.location.host),[o]=(0,f.Y)("isArc");return!e||i||n||o||(0,ps.Im)()||(e=>{try{const t=new URL(e);return[bn.o8,bn.Ud].some((e=>t.host.endsWith(e)))&&!(t.pathname.startsWith(ae.Cp)||t.pathname.startsWith("/ext/"))||t.pathname.includes("/login")&&!t.search.includes("loginSuccessBackUrl")}catch(t){return!1}})(location.href)}var bw=n(76398);const ww=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M10.474 4.733a.65.65 0 0 0-.948-.89L6.673 6.878 5.489 5.526a.65.65 0 1 0-.978.856l1.352 1.546.03.032.01.01c.046.046.104.104.16.152.067.056.171.135.317.182l.2-.618-.2.618c.186.06.387.06.573 0l-.2-.618.2.618a.9.9 0 0 0 .317-.182c.056-.048.115-.106.161-.153l.01-.01.014-.014zm1.006 2.54A.7.7 0 0 0 12 7.5h6.936q.315 0 .527-.22a.74.74 0 0 0 .22-.534.7.7 0 0 0-.22-.52.7.7 0 0 0-.527-.22H12a.7.7 0 0 0-.52.22.7.7 0 0 0-.212.52q0 .3.212.527m-5.95 5.34a.7.7 0 0 0 .52.22h12.886q.315 0 .527-.22a.72.72 0 0 0 .22-.528.7.7 0 0 0-.22-.527.7.7 0 0 0-.527-.22H6.05a.7.7 0 0 0-.52.22.73.73 0 0 0-.212.527q0 .3.212.527m0 5.16a.7.7 0 0 0 .52.227h12.886a.7.7 0 0 0 .52-.22.72.72 0 0 0 .22-.527.73.73 0 0 0-.22-.535.7.7 0 0 0-.52-.22H6.05a.69.69 0 0 0-.52.228.73.73 0 0 0-.212.527q0 .3.212.52",clipRule:"evenodd"})})),Cw=(0,js.a)((0,Te.jsx)(ww,{}));var Aw=n(92887),Sw=n(26094);const kw="container-GL1AQQ",Ew="pop-reminder-M9LIqU",Tw="pop-reminder-with-shadow-HcKy0J",Iw="pop-content-i2_mf6",jw="reminder-fx2_Gd",Nw="reminder-chrome-jk2NPJ",Rw="reminder-edge-YirJT9",Mw="expand-M9VMCx",Pw="close-icon-HqdLJ4",Lw="content-container-c_NTtc",Bw="content-img-uyS7zW",Dw="image-G5feq6",Ow="content-bottom-cxhbKf",Fw="content-text-AChjAg",Uw="tool-W9hU1F",Hw="left-wqzAXr",zw="main-btn-aCuk37",qw="right-Zoh_at",Vw="right-btn-i_81S_",$w="btn-icon-XMbY9O",Ww="login-QwLRK1";function Kw(){var e;const[t,n]=(0,f.Y)("isArc"),i=(0,v.B)(),o=null===(e=(0,Mo.A)())||void 0===e?void 0:e.getPopupContainer,[s,c]=(0,m.useState)(!1),[d,u]=(0,m.useState)(!1),h=(0,m.useRef)(""),p=(0,m.useRef)(),g=(0,m.useRef)(),x=(0,m.useRef)(null),{isBrowserPluginSkillLimited:y}=(0,wo.cj)((e=>e)),b=y("link_preview"),[w,C]=(0,m.useState)(!1),[A,S]=(0,m.useState)(!1),[k,E]=(0,m.useState)("rightTop"),[I,j]=(0,m.useState)(!1),[N,R]=(0,m.useState)(2),[M,P]=(0,m.useState)(!1),[L,B]=(0,m.useState)(0),[D,O]=(0,m.useState)(0),[F,U]=(0,m.useState)(!1),H=(0,m.useRef)(null),[z,q]=(0,f.Y)("needOpenSideBar"),{setIsShowSidebar:V,setIsShowLinkPreview:$}=(0,Co.l)((e=>(0,bw.A)(e,["setIsShowSidebar","setIsShowLinkPreview"])),Ko.x),W=lw(),K=(0,An.P)((e=>e.sendMessage)),Y=(0,An.P)((e=>e.messages)),G=(0,m.useRef)(void 0),Q=(0,m.useRef)({}),{link:Z="",msgId:X="",imgUrl:ee="",textContent:te="",disable:ne=!1}=G.current||{},{isDone:ie=!1,text:oe=""}=Y[X]||{},[se,re]=(0,m.useState)(""!==ee);(0,m.useEffect)((()=>{""!==ee&&(re(!0),O(D+1))}),[ee]);const ae=(0,m.useMemo)((()=>function(e){return/^https:\/\/www.baidu.com\//.test(e)?hw.baidu:/^https:\/\/www.google.com?(?:.\w+)?\/search\?/.test(e)?hw.google:/^https:\/\/\w+.bing.com\/search\?/.test(e)?hw.bing:hw.normal}(location.href)),[]),le=ae!==hw.normal,ce=function(e){const{search_engine_enabled:t,page_enabled:n,disable_hosts:i}=(0,As.A)("link_preview"),{hostname:o}=window.location;if(e)return t&&!(0,ws.A)(i)(o);return n&&!(0,ws.A)(i)(o)}(le),{trackClickEvent:de}=function({platform:e,url:t,showReminder:n,showResult:i,hasImg:o}){const s=e!==hw.normal,a={[s?"search_engine_name":"current_page"]:s?e:location.hostname};return(0,m.useEffect)((()=>{n&&(0,It.z8)(s?_.Ur.searchLinkPreviewEntryShow:_.Ur.hyperLinkPreviewEntryShow,(0,r.A)({},a),!0,!1)}),[n,s]),(0,m.useEffect)((()=>{i&&(0,It.z8)(s?_.Ur.searchLinkPreviewResultShow:_.Ur.hyperLinkPreviewResultShow,(0,r.A)((0,r.A)({},a),{},{whether_has_pic:o?1:0,url:t}),!1,!0)}),[i,o,t,s]),{trackClickEvent:e=>{(0,It.z8)(s?_.Ur.searchLinkPreviewResultClick:_.Ur.hyperLinkPreviewResultClick,(0,r.A)((0,r.A)({},a),{},{whether_has_pic:o?1:0,button_name:e,url:t}),!1,!1)}}}({platform:ae,url:Z,showReminder:d&&!w&&!ne,showResult:d&&w&&ie&&!ne,hasImg:se});(0,m.useEffect)((()=>{z&&(W(),q(!1))}),[]);const ue=(0,m.useCallback)((()=>{!le&&p.current&&xw(p.current)}),[le]),he=(0,m.useCallback)((()=>{le||document.body.querySelectorAll(`.${fw}`).forEach((e=>{e&&e.classList.remove(fw)}))}),[le]),me=(0,m.useCallback)((()=>{c(!1),he()}),[he]),pe=(0,Rh.A)((()=>{me()}));(0,m.useEffect)((()=>{if(!ce)return;const e=["mouseleave","dragstart","click"],i=()=>{me()},o=t=>{e.forEach((e=>{t.removeEventListener(e,i)}))},s=(0,T.A)((s=>{if(t)return;if((0,ps.fv)())return void n(!0);if(!s.target)return;if(I)return;const{alink:a="",hoverEle:l,contentEle:d}=gw(s,ae)||{};if(""!==a&&l&&d){a!==h.current&&u(!1),p.current=l,o(l),(t=>{e.forEach((e=>{t.addEventListener(e,i)}))})(l),g.current=d,c(!0),j(!1),h.current=a;const t=Q.current[a];t&&a===t.link&&(""!==t.msgId||t.disable)?(C(!0),G.current=(0,r.A)({},t)):(C(!1),G.current=void 0)}}),200);return document.addEventListener("mouseover",s),()=>{document.removeEventListener("mouseover",s),p.current&&o(p.current)}}),[I,ce]),(0,m.useEffect)((()=>{let e;return e=s?setTimeout((()=>{u(!0)}),500):setTimeout((()=>{u(!1),G.current=void 0,h.current="",p.current=void 0,g.current=void 0,x.current&&window.clearTimeout(x.current),P(!1),R(2),S(!1),C(!1),j(!1)}),100),()=>clearTimeout(e)}),[s]);const ge=(e,t,n)=>{if(""===e)return;const i=K({scene:bo.sJ.link_preview,prompt:so.EU.browser_plugin_info,browser_plugin_info:JSON.stringify({skill_name:"link_preview",url:e,content:t||""}),current_page:(0,It.M5)(window.location.href),preventDefaultAuthAction:!0});G.current={link:e,msgId:i,imgUrl:n,textContent:t||"",disable:!1},Q.current[e]=(0,r.A)({},G.current),Q.current[e].textContent=""},ve=(0,m.useCallback)((e=>{if(""===e)return;(0,Aw.tB)(e)?(0,jn.cs)({name:"get-page-content",body:{url:e}}).then((t=>{var n,i;if(!t.data.html)return G.current={link:e,msgId:"",imgUrl:"",textContent:"",disable:!0},void(Q.current[e]=(0,r.A)({},G.current));const o=(new DOMParser).parseFromString(null===(n=t.data)||void 0===n?void 0:n.html,"text/html"),{textContent:s}=(0,en.Tp)(o)||{},a=(null===(i=o.querySelector('meta[property="og:image"]'))||void 0===i?void 0:i.getAttribute("content"))||"";var l;void 0===s&&(0,ar.R8)(`[zx] parse page(${e}) text content failed, origin html(${null===(l=t.data)||void 0===l?void 0:l.html})`);ge(e,s,a)})):ge(e,void 0,"")}),[]);(0,m.useEffect)((()=>{if(!d||w||b)return;ue();let e=null;return M||(e=window.setInterval((()=>{if(1===N)return C(!0),void he();R(N-1)}),1e3)),()=>{e&&window.clearInterval(e)}}),[d,w,b,N,M,ue]),(0,m.useEffect)((()=>{if(d&&!w&&""!==h.current)return x.current=window.setTimeout((()=>{ve(h.current)}),500),()=>{x.current&&clearTimeout(x.current)}}),[d,w]);const fe=(0,m.useMemo)((()=>{if(!d||!g.current)return{};const e=le?function(e){if(e instanceof HTMLAnchorElement&&e.classList.contains("l"))return e.getBoundingClientRect();const t=document.createRange();return t.selectNodeContents(e),t.getBoundingClientRect()}(g.current):g.current.getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,i=e.top<=t/2,o=e.left<=n/2;if(B(L+1),le){const t=e.top+e.height/2-12;return E(i?"rightTop":"rightBottom"),{left:e.left+e.width+window.scrollX,top:t+window.scrollY,width:"7px",height:"24px"}}return E(i&&o?"bottomLeft":i&&!o?"bottomRight":!i&&o?"topLeft":"topRight"),{left:e.left+window.scrollX,top:e.top+window.scrollY,width:e.width,height:e.height}}),[d,le]),ye=function(){var e=(0,a.A)((function*(){de("open_chat");const e=Z;me(),Co.l.getState().setIsShowSidebar(!0,_.cz.searchPreview),ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),yield(0,ko.Z)(),Co.l.getState().isSidePanelMode&&!aw._K.isInSidePanel?(0,jn.cs)({name:"add-website-to-skill",body:{url:e}}):(0,Sw.j)(e)}));return function(){return e.apply(this,arguments)}}(),be=()=>{de("open_link"),V(!0,_.cz.other),q(!0),window.open(Z),me()},we=()=>{de("copy"),U(!0),H.current&&clearTimeout(H.current),H.current=window.setTimeout((()=>{U(!1),H.current=null}),1e3),Gt()(oe)},Ce=(0,m.useCallback)((()=>{(0,_e.DT)({trackMeta:{previous_page:(0,It.M5)(location.href),login_entrance:"link_preview"}})}),[]),Ae=(0,m.useCallback)((()=>{$(!1),me()}),[]),Se=i(F?"flow_web_ext_action_popup_copy":"message_long_press_copy"),ke=F?hu.A:Rc.A,Ee=!w||b,Ie=(0,m.useMemo)((()=>(0,l.UP)()),[]);if(!ce)return null;return d?(0,Te.jsx)(je.AM,{getPopupContainer:o,content:()=>(0,Te.jsxs)("div",{ref:pe,onMouseEnter:()=>{c(!0)},children:[Ee&&le&&(0,Te.jsxs)("div",{className:J()(jw,{[Nw]:!Ie,[Rw]:Ie,[Mw]:A||I}),"data-testid":"preview-reminder",onMouseEnter:()=>{S(!0)},onMouseLeave:()=>{S(!1),I||me()},children:[Ie&&(0,Te.jsx)("img",{width:16,height:16,style:{marginLeft:-4},src:(0,fs.Nf)()}),(0,Te.jsx)(xe.A,{className:Pw,show:I,disableKey:os.lf.linkPreview,optionPageSection:"search-engin-summary",onDisableOnceClick:Ae,setShow:j,cssStyle:{zIndex:100},position:"bottomLeft",closeClick:()=>{P(!0)},onOutsideClick:()=>{P(!1)}}),b?(0,Te.jsxs)("div",{children:[i("flow_web_ext_setting_search_preview_tips","\u767b\u5f55\u540e\u7ee7\u7eed\u603b\u7ed3")," ",(0,Te.jsx)("span",{className:Ww,onClick:Ce,children:i("login_button")})]}):(0,Te.jsx)("div",{children:i("flow_web_ext_search_preview_loading",{brandName:(0,fs.L2)(),number:N})})]}),!Ee&&!ne&&(0,Te.jsxs)("div",{className:Lw,onMouseLeave:()=>me(),"data-testid":"preview-content-container",children:[(0,Te.jsx)(xe.A,{className:Pw,show:I,disableKey:os.lf.linkPreview,optionPageSection:"search-engin-summary",onDisableOnceClick:Ae,setShow:j,cssStyle:{zIndex:100}}),se&&(0,Te.jsx)("div",{className:Bw,children:(0,Te.jsx)("img",{src:ee,className:Dw,referrerPolicy:"no-referrer",onError:()=>{re(!1)}},D)}),(0,Te.jsxs)("div",{className:Ow,children:[(0,Te.jsx)(Qu,{id:X,type:"mail",enableScroll:!0,className:Fw,style:{maxHeight:se?"180px":"300px"},autoScrollToEnd:!1,onRetry:()=>{ge(Z,te,ee)}}),ie&&(0,Te.jsxs)("div",{className:Uw,"data-testid":"preview-toolbar",children:[(0,Te.jsx)("div",{className:Hw,children:(0,Te.jsx)(ea.c,{disabled:!(0,Aw.tB)(Z),type:"quartary",icon:(0,Te.jsx)(Cw,{}),size:"small",onClick:ye,className:zw,children:i("flow_web_ext_search_preview_chat","\u6dfb\u52a0\u5230\u5bf9\u8bdd")})}),(0,Te.jsxs)("div",{className:qw,children:[(0,Te.jsx)(zd.S,{tooltip:i("flow_web_ext_search_preview_link","\u6253\u5f00\u94fe\u63a5"),icon:(0,Te.jsx)(Kg.A,{className:$w}),onClick:be,className:Vw}),(0,Te.jsx)(zd.S,{tooltip:Se,icon:(0,Te.jsx)(ke,{className:$w}),onClick:we,className:Vw})]})]})]})]})]}),visible:d,trigger:"custom",rePosKey:L,position:k,className:J()(kw,"cici-ext-always-light","semi-always-light",{[Ew]:Ee&&!Ie,[Tw]:Ee&&Ie,[Iw]:!Ee}),children:(0,Te.jsx)("span",{style:(0,r.A)({position:"absolute",pointerEvents:"none",backgroundColor:"transparent"},fe),"data-testid":"link-preview-entry"})}):null}let Yw=function(e){return e.open="open",e.disableThisTime="disable_this_time",e.disableAll="disable_all",e}({});const Gw=({button_name:e,value:t})=>{(0,It.z8)(_.Ur.quickTranslatePopupClick,{button_name:e,value:t})},Qw="modalContainer-qYAb_z",Zw="footerBtn-DOAhbw",Xw="cancelBtn-dyc6U2",Jw="modalContent-aHHjdN",eC="modalContentSetting-vakLeP",tC=({setDisableThisTime:e,handleMsgId:t,onFinished:n,inputCache:i})=>{var o;const s=(0,v.B)(),a=null===(o=(0,m.useContext)(as.A))||void 0===o?void 0:o.getPopupContainer,[l,c]=(0,m.useState)(Yw.open),d=[{value:Yw.open,text:"flow_web_ext_translate_input_box_popup_enable"},{value:Yw.disableThisTime,text:"flow_web_ext_translate_input_box_popup_disbale_once"},{value:Yw.disableAll,text:"flow_web_ext_translate_input_box_popup_disbale_forever"}],u=(e=!0)=>{e&&Gw({button_name:_._h.gotIt,value:l}),n(),(0,se.vE)("inputTranslateInfo",(0,r.A)((0,r.A)({},(0,se.TK)("inputTranslateInfo")),{},{isFirstUse:!1}))};return(0,Te.jsxs)(je.aF,{title:s("flow_web_ext_translate_input_box_popup_title","\u8f93\u5165\u6846\u5feb\u6377\u7ffb\u8bd1\u8bbe\u7f6e"),visible:null!==i,centered:!0,closable:!1,style:{position:"relative"},cancelText:s("flow_web_ext_translate_input_box_popup_disbale_btn_close","\u6211\u77e5\u9053\u4e86"),okText:s("flow_web_ext_translate_input_box_popup_disbale_btn_save","\u4fdd\u5b58\u4e14\u4e0d\u518d\u63d0\u793a"),cancelButtonProps:{className:J()(Zw,Xw)},okButtonProps:{className:Zw},className:J()(Qw,"cici-ext-always-light","semi-always-light"),onCancel:()=>u(),onOk:()=>{u(!1),Gw({button_name:_._h.save,value:l}),l!==Yw.disableAll?l!==Yw.open?l!==Yw.disableThisTime||e(!0):i&&t(i):(0,se.vE)("inputTranslateInfo",(0,r.A)((0,r.A)({},(0,se.TK)("inputTranslateInfo")),{},{disableAll:!0}))},getPopupContainer:a,children:[(0,Te.jsxs)("div",{className:Jw,"data-testid":"input-translate-tips",children:[(0,Te.jsx)("span",{children:s("flow_web_ext_translate_input_box_popup_desc1",{brandName:(0,fs.L2)()})}),(0,Te.jsx)("div",{children:s("flow_web_ext_translate_input_box_popup_desc2","\u5982\u679c\u8fd9\u662f\u4e00\u4e2a\u5931\u8bef\uff0c\u4e0d\u7528\u62c5\u5fc3\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u672c\u6b21\u7981\u7528\uff0c\u6216\u8005\u6c38\u4e45\u7981\u7528\u8f93\u5165\u6846\u7ffb\u3002\u60a8\u4e5f\u53ef\u4ee5\u5728 {settings} \u4e2d\u8bbe\u7f6e\u5176\u4ed6\u5feb\u6377\u952e\u6765\u89e6\u53d1\u3002").split("{settings}").map(((e,t,n)=>(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("span",{children:e}),(1===n.length||t<n.length-1)&&(0,Te.jsx)("span",{className:eC,onClick:()=>{(0,Vt.I)({settting_key:"translate"})},children:s("settings")})]})))})]}),(0,Te.jsx)(je.$Q,{defaultValue:[Yw.open],value:[l],style:{gap:"4px"},children:d.map((e=>(0,Te.jsx)(je.Sc,{value:e.value,onChange:()=>c(e.value),style:{padding:"8px 0",fontWeight:"500"},children:s(e.text)},e.value)))})]})};var nC=n(44118),iC=n(42879),oC=n(82914);let sC=function(e){return e.Input="input",e.Rich="rich",e}({});function rC(e,t,n){const i=e.split("."),o=t.split(".");let s=null!=n?n:Math.min(i.length,o.length);for(;s>0;){if(i.pop()!==o.pop())return!1;s--}return!0}function aC(e){return e instanceof HTMLElement}function lC(e,t=1){let n=t-1,i=e.parentElement;for(;n>0&&i;)i=i.parentElement,n-=1;return i}function cC(e,t){let n=e;for(;n;){if(t(n))return n;n=n.parentElement}}function dC(e){const t=cC(e,(e=>{var t,n;const i=null!==(t=null===(n=e.getAttribute("contenteditable"))||void 0===n?void 0:n.toLowerCase())&&void 0!==t?t:"false",o=e.tagName.toLowerCase(),s=e.getAttribute("data-language");return!["td","tr"].includes(o)&&"false"!==i&&!s&&!e.classList.contains("cm-content")}));if(t)return{type:sC.Rich,element:t};const n=cC(e,(e=>(0,et.QN)(e)&&(0,et.ZP)()));return n?{type:sC.Input,element:n}:void 0}function uC(e,t){return!(e.start>t.end||e.end<t.start)}function hC(e,t){let n=e;for(;n;){if(t(n))return!0;n=n.parentElement}return!1}function mC(e,t,n){const i=function(e,t,n){const i=document.createRange();return i.setStart(e,t),i.setEnd(e,n),i}(e,t,n),o=i.getClientRects();return i.detach(),o}function pC(e,t){const n=[];for(const o of t){const e=(0,oC.A)(n);e&&e.top===o.top&&e.height===o.height&&e.right>=o.left?(e.right=o.right,e.width+=o.width):n.push(o.toJSON())}const i=e.getBoundingClientRect();return n.map((t=>{const n=t.top-i.top+e.scrollTop,o=t.left-i.left+e.scrollLeft,s=n+t.height,r=o+t.width,{width:a,height:l}=t;return{x:o,y:n,top:n,left:o,bottom:s,right:r,width:a,height:l}})).sort(((e,t)=>e.left-t.left))}const gC="DOUBAO_INPUT_TRANSLATE_LOADING";class vC{constructor(e,t){var n=this;(0,y.A)(this,"_timer",null),(0,y.A)(this,"_loading",!1),(0,y.A)(this,"_hotKeyCount",0),(0,y.A)(this,"_disableThisTime",!1),(0,y.A)(this,"_inputElement",null),(0,y.A)(this,"_handleTranslate",void 0),(0,y.A)(this,"_setInput",void 0),(0,y.A)(this,"_clearTimer",(()=>{null!==this._timer&&(clearTimeout(this._timer),this._timer=null)})),(0,y.A)(this,"_reset",(()=>{this._clearTimer(),this._hotKeyCount=0,this._loading=!1,this._inputElement=null})),(0,y.A)(this,"_clearHotKeyCode",(()=>{if(!this._inputElement)return;const{value:e}=this._inputElement;(0,se.TK)("inputTranslateInfo").hotKeyCode===fe.WR.Space&&[".","\u3002"].includes(e[e.length-2])?this._inputElement.value=e.slice(0,e.length-2):this._inputElement.value=e.slice(0,e.length-3)})),(0,y.A)(this,"_onKeyup",function(){var e=(0,a.A)((function*(e){const t=(0,se.TK)("inputTranslateInfo");if(n._disableThisTime||t.disableAll||n._loading||!n._inputElement)return void(n._hotKeyCount=0);(yield(0,nC.b)([n._inputElement.value]))!==t.language&&((null==e?void 0:e.code)===t.hotKeyCode?(n._clearTimer(),n._timer=setTimeout((()=>{n._hotKeyCount=0}),300),++n._hotKeyCount>=3&&(n._clearHotKeyCode(),n.setLoading(!0),n._handleTranslate(n._inputElement),n._hotKeyCount=0)):n._hotKeyCount=0)}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"_onFocus",(e=>{this._onBlur();const{target:t}=e;if(!(t&&t instanceof HTMLElement))return;const n=cC(t,(e=>(0,et.QN)(e)));n&&(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement)&&(this._inputElement=n,this._setInput(n),this._inputElement.addEventListener("keyup",this._onKeyup))})),(0,y.A)(this,"_onBlur",(()=>{this._inputElement&&this._inputElement.removeEventListener("keyup",this._onKeyup),this._inputElement=null,this._setInput(null),this._reset()})),(0,y.A)(this,"init",(()=>{document.addEventListener("focus",this._onFocus,!0),document.addEventListener("blur",this._onBlur,!0)})),(0,y.A)(this,"destroy",(()=>{document.removeEventListener("focus",this._onFocus,!0),document.removeEventListener("blur",this._onBlur,!0),this.clearLoadingElement()})),(0,y.A)(this,"setDisableThisTime",(e=>{this._disableThisTime=e})),(0,y.A)(this,"setLoading",(e=>{this._loading=e})),(0,y.A)(this,"addLoadingElement",(()=>{if(this.clearLoadingElement(),!this._inputElement)return;(0,iC.lD)();const e=document.createElement("font");e.setAttribute("data-testid","input-translate-loading"),e.id=gC,e.classList.add(Nu.x_),e.appendChild(document.createElement("i")),e.style.display="inline-block",e.style.position="absolute",e.style.zIndex="9999";const{x:t,y:n,width:i,height:o}=this._inputElement.getBoundingClientRect();e.style.top=`${n+o/2+window.scrollY}px`,e.style.left=`${t+i+window.scrollX}px`,e.style.transform="translate(-100%,-50%)",document.body.appendChild(e),setTimeout(this.clearLoadingElement,5e3)})),(0,y.A)(this,"clearLoadingElement",(()=>{var e;null===(e=document.querySelector(`#${gC}`))||void 0===e||e.remove()})),this._handleTranslate=e,this._setInput=t}}const fC=()=>{const[e,t]=(0,m.useState)(!1),[n,i]=(0,m.useState)(""),[o,s]=(0,m.useState)(null),[l,c]=(0,m.useState)(null),d=(0,m.useRef)(null),u=(0,An.P)((e=>e.sendMessage)),h=e=>{var t;if(!e.value)return;null===(t=d.current)||void 0===t||t.addLoadingElement();const n=(0,se.TK)("inputTranslateInfo"),o=u({text:e.value.trimEnd(),prompt:so.EU.translate,language:(0,kn.wz)(n.language),translateService:n.translateService,answerWithSuggest:!1,sceneId:fe.Fc.InputFieldInstantTranslate});i(o)},p=(0,An.P)((e=>e.messages[n])),{isDone:g,text:v="",isError:f}=p||{},x=e=>{const t=(0,se.TK)("inputTranslateInfo");var n;s(e),(0,se.vE)("inputTranslateInfo",(0,r.A)((0,r.A)({},t),{},{showInputInnerTips:!1})),t.isFirstUse?((0,It.z8)(_.Ur.quickTranslatePopupShow),c(e)):(n=t.hotKeyCode,(0,It.z8)(_.Ur.quickTranslate,{click_from:n}),h(e))},y=()=>{var e,t;null===(e=d.current)||void 0===e||e.clearLoadingElement(),null===(t=d.current)||void 0===t||t.setLoading(!1)},b=function(){var e=(0,a.A)((function*(){o&&(document.activeElement!==o&&(o.focus(),yield(0,rr.uk)()),o.select(),yield(0,rr.uk)(),document.execCommand("insertText",!1,v),yield(0,rr.uk)(),y())}));return function(){return e.apply(this,arguments)}}();return(0,m.useEffect)((()=>{f?y():g&&b()}),[g,f]),(0,m.useEffect)((()=>(d.current=new vC(x,s),d.current.init(),()=>{var e;null===(e=d.current)||void 0===e||e.destroy()})),[]),(0,m.useEffect)((()=>{var t;null===(t=d.current)||void 0===t||t.setDisableThisTime(e)}),[e]),(0,Te.jsx)(Te.Fragment,{children:(0,Te.jsx)(tC,{setDisableThisTime:t,handleMsgId:h,onFinished:()=>{y(),c(null)},inputCache:l})})};function _C(e,t=-1,n=[]){if(!e)return"";const i=(o=function(e,t=[]){let n="";return function e(i){if(!t.includes(i))if(i.nodeType===Node.TEXT_NODE)n+=i.nodeValue;else if(i.nodeType===Node.ELEMENT_NODE){if(i instanceof HTMLElement&&!i.offsetParent)return;const t=i,o=window.getComputedStyle(t);if("none"===o.display||"hidden"===o.visibility||"0"===o.opacity)return;if("IMG"===t.tagName)n+=t.getAttribute("alt")||"";else for(const n of t.childNodes)e(n)}}(e),n}(e,n),o.replace(/^\s+|\s+$/gi,"").replace(/\s+/gi," "));var o;return function(e,t){return t>0&&t<e.length?`${e.substring(0,t)}...`:e}(i,t)}function xC(){return(xC=(0,a.A)((function*(e,t,n){n=n.replace(/\s{2,}/gi,"\n");const i=e;if(i){const e=window.getSelection(),o=document.createRange();"replace"===t?(o.setStartBefore(i),o.setEndAfter(i)):(o.setStartAfter(i),o.setEndAfter(i)),e&&(e.removeAllRanges(),e.addRange(o));const s=i.innerText;yield(0,rr.uk)(),(0,et.Ig)(n,i),Iy(i),yield(0,rr.uk)(),i.innerText===s&&(i.innerText=n,null==e||e.removeAllRanges())}}))).apply(this,arguments)}function yC(){return(yC=(0,a.A)((function*(e,t,n){document.activeElement!==e&&(e.focus(),yield(0,rr.uk)()),"replace"===t&&e.select(),document.execCommand("insertText",!1,n)}))).apply(this,arguments)}function bC(e,t,n){return wC.apply(this,arguments)}function wC(){return wC=(0,a.A)((function*(e,t,n){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName?function(e,t,n){return yC.apply(this,arguments)}(e,t,n):function(e,t,n){return xC.apply(this,arguments)}(e,t,n)})),wC.apply(this,arguments)}function CC(e){let t=e;for(;null!==(n=t)&&void 0!==n&&null!==(n=n.shadowRoot)&&void 0!==n&&n.activeElement;){var n;t.shadowRoot.activeElement instanceof HTMLElement&&(t=t.shadowRoot.activeElement)}return t instanceof HTMLElement?t:null}class AC{constructor(e){(0,y.A)(this,"elem",void 0),this.elem=e}static create(e){if("string"!=typeof e)return new AC(e);{const t=document.querySelector(e);if(t)return new AC(t)}return null}one(e){const t=this.elem.querySelector(e);if(t)return new AC(t)}all(e){return Array.from(this.elem.querySelectorAll(e)).map((e=>new AC(e)))}remove(){var e;return null===(e=this.elem.parentElement)||void 0===e||e.removeChild(this.elem),this}matches(e){return this.elem.matches(e)}attr(e){return this.elem.getAttribute(e)}deepOne(e){const t=this.deepAll(e);return t.length>0?t[0]:null}childElement(e=0){const t=this.elem.childNodes[e];return t instanceof Element?new AC(t):null}deepAll(e){let t=[this.elem];for(const n of e){const e=[];for(const i of t){let t=[];t=null!=i&&i.shadowRoot?Array.from(i.shadowRoot.querySelectorAll(n)):Array.from((null==i?void 0:i.querySelectorAll(n))||[]),e.push(...t)}if(t=e,t.length<=0)return[]}return t.map((e=>new AC(e)))}text(e=-1){return _C(this.elem,e)}textExclude(e,t=-1){return _C(this.elem,t,e)}_traverseSibling(e,t){let n=this.elem;for(;n;){const i=n[e];if(!i)break;if(n=i,t(n))return new AC(n)}return null}nextElem(e){return this._traverseSibling("nextElementSibling",(t=>t.matches(e)))}traverseNextSibling(e){return this._traverseSibling("previousElementSibling",(t=>t.matches(e)))}findParent(e,t){let n=null;return this.findParentUntil((i=>i.matches(e)?(n=i,!0):!!("string"==typeof(null==t?void 0:t.until)&&i.matches(t.until)||i===(null==t?void 0:t.until))),null==t?void 0:t.includeSelf),n?new AC(n):null}findParentUntil(e,t=!1){let n=this.elem;if(t&&e(n))return null;for(;n;){var i;if(n.parentElement)n=n.parentElement;else{if(null===(i=n)||void 0===i||null===(i=i.parentNode)||void 0===i||!i.host)break;n=n.parentNode.host}if(e(n))return new AC(n)}return null}}function SC(e,t){return e?e.all(".CommentContent").filter((e=>!t.includes(e.elem))).map((e=>e.text(200))).filter((e=>!!e)):[]}const kC={isUrlMatch:e=>/(\w+\.)?zhihu\.com$/.test(e.host),getReplyContext(e){const t=new AC(e).findParent(".DraftEditor-root");if(!t)return;const{title:n,content:i,replies:o,samples:s}=function(e){const t=e.findParent(".Modal-content");let n="",i="",o=[];if(t){const e=t.one(".CommentContent");e&&(o=SC(t,[null==e?void 0:e.elem])),i=(null==e?void 0:e.text())||""}else{const t=e.findParent(".Card");var s,r;t&&(o=SC(t,[]),n=(null===(s=t.one(".ContentItem-title"))||void 0===s?void 0:s.text())||"",i=(null===(r=t.one(".RichContent-inner"))||void 0===r?void 0:r.text(1e3))||"")}return{title:n,content:i,replies:function(e,t=5){let n=e.findParent("[data-id]");const i=[];for(;n;){const e=n.one(".CommentContent");if(e&&i.push(e.text()||""),i.length>=t)break;n=n.findParent("[data-id]")}return i}(e),samples:o}}(t);return n||i||o.length>0?{title:n,content:i,replies:o,samples:s,dom:e}:void 0},onFillText(e,t){bC(e,"replace",t)}};const EC={isUrlMatch:e=>/(\w+\.)?youtube.com$/.test(e.host),calcButtonPosition(e){const t=e.getBoundingClientRect();return new DOMPoint(window.scrollX+t.x+t.width,window.scrollY+t.y+t.height-32)},getReplyContext(e){var t;const n=new AC(e).findParent("#contenteditable-root",{includeSelf:!0}),i=(null===(t=AC.create("#content h1"))||void 0===t?void 0:t.text())||"";if(!n||!i)return;if(n.matches("ytd-comments-header-renderer #contenteditable-root")){const t=function(){const e=AC.create("ytd-comments");return e?null==e?void 0:e.all("ytd-comment-thread-renderer > ytd-comment-view-model #content-text").map((e=>{var t;return e.textExclude([null===(t=e.one("a"))||void 0===t?void 0:t.elem])})):[]}();return t.length>0?{title:i,content:"",samples:t,dom:e}:void 0}const o=function(e){var t,n,i;const o=e.findParent("ytd-comment-thread-renderer");if(!o)return;const s=(null===(t=o.one("ytd-comment-view-model #content-text"))||void 0===t?void 0:t.text())||"",r=null===(n=e.findParent("#body"))||void 0===n?void 0:n.one("#content-text"),a=(null==r?void 0:r.textExclude([null===(i=r.one("a"))||void 0===i?void 0:i.elem]))||"";let l=[];return l.push(a),s!==a&&l.push(s),l=l.filter((e=>!!e)),{replies:l,samples:o.all("#replies ytd-comment-view-model #content-text").map((e=>{var t;return e.textExclude([null===(t=e.one("a"))||void 0===t?void 0:t.elem])})).filter((e=>!!e))}}(n);return o?{title:i,content:"",replies:null==o?void 0:o.replies,samples:null==o?void 0:o.samples,dom:e}:void 0},onFillText(e,t){bC(e,"replace",t)}};const TC={isUrlMatch:e=>/(\w+\.)?xiaohongshu\.com$/.test(e.host),calcButtonPosition(e){const t=new AC(e).findParent(".content-edit");let n=e;null!=t&&t.elem&&(n=t.elem);const i=n.getBoundingClientRect();return new DOMPoint(window.scrollX+i.x+i.width-4,window.scrollY+i.y-32)},getReplyContext(e){const t=new AC(e).findParent(".content-edit");if(!t)return;const n=t.findParent(".interaction-container"),i=null==n?void 0:n.one("#detail-title"),o=null==n?void 0:n.one("#detail-desc > span"),s=null==n?void 0:n.one(".interactions .reply-content .content"),r=(null==s?void 0:s.text())||"";if(o){const t=o.text();return{title:(null==i?void 0:i.text())||"",samples:[],content:t,dom:e,replies:r?[r]:[]}}},onFillText(e,t){e.matches("p")?function(e,t){if(document.activeElement!==e&&e.focus(),!e.textContent){const t=document.createEvent("TextEvent");t.initTextEvent("textInput",!0,!0,window,"_",0,""),e.dispatchEvent(t)}document.execCommand("selectAll",!1,void 0),document.execCommand("insertText",!1,t)}(e,t):bC(e,"replace",t)}};let IC;function jC(e){const t=e.target;if(!(t instanceof HTMLElement))return;const n=new AC(t).findParent("button[data-testid=reply",{includeSelf:!0});if(n){if(document.querySelector("[data-testid=app-bar-back]")){var i;const e=null===(i=n.findParent("[data-testid=tweet]"))||void 0===i?void 0:i.one("[data-testid=tweetText]"),t=Array.from(document.querySelectorAll("article[data-testid=tweet] [data-testid=tweetText]"));if(e&&t.length>0)return void(IC={title:"",content:_C(t[0]),reply:e.text(),samples:t.slice(1).map((e=>_C(e)))})}else{var o;const e=null===(o=n.findParent("[data-testid=tweet]"))||void 0===o?void 0:o.one("[data-testid=tweetText]");if(e)return void(IC={title:"",content:e.text(),reply:"",samples:[]})}IC=void 0}}const NC={isUrlMatch:e=>/(\w+\.)?x\.com$/.test(e.host),install(){document.documentElement.addEventListener("pointerdown",jC,!0)},uninstall(){document.documentElement.removeEventListener("pointerdown",jC,!0)},getReplyContext(e){const t=new AC(e).findParent(".DraftEditor-root");if(!t)return;const n=t.findParent('[aria-labelledby="modal-header"]');if(n){const t=null==n?void 0:n.one("article [data-testid=tweetText]");if(t){var i,o;const n=t.text();return{title:"",samples:(null===(i=IC)||void 0===i?void 0:i.samples)||[],content:null===(o=IC)||void 0===o?void 0:o.content,dom:e,replies:[n]}}}else{const n=t.findParent("section"),i=null==n?void 0:n.one("article [data-testid=tweetText]");if(i)return{title:"",content:i.text(),dom:e,replies:[]}}},onFillText(e,t){bC(e,"replace",t)}};let RC;function MC(e){return(null==e?void 0:e.all(".wbpro-list .item1in .text > span").map((e=>e.text())).filter((e=>!!e)))||[]}function PC(e){e.target instanceof HTMLElement&&function(e){var t;if(e.matches('.wbpro-iconbed > i[title="\u8bc4\u8bba"]')||e.matches(".wbpro-iconbed")&&"\u8bc4\u8bba"===(null===(t=e.one("i"))||void 0===t?void 0:t.attr("title"))){let t="";const n=e.findParent(".wbpro-list"),i=null==n?void 0:n.one(".text"),o=null==i?void 0:i.one("a"),s=null==i?void 0:i.one(":scope > span");if(o&&s&&(t=s.text()),t){const n=e.findParent("article"),i=null==n?void 0:n.one(".wbpro-feed-content"),o=MC(n);RC={title:"",content:(null==i?void 0:i.text(1e3))||"",reply:t,samples:o}}else RC=void 0}}(new AC(e.target))}const LC={isUrlMatch:e=>/(\w+\.)?weibo.com$/.test(e.host),install(){document.documentElement.addEventListener("pointerdown",PC,!0)},uninstall(){document.documentElement.removeEventListener("pointerdown",PC,!0)},getReplyContext(e){const t=new AC(e);if(!t.findParent(".wbpro-form")){const e=t.findParent(".card");return t.matches("textarea")&&e?function(e,t){var n,i;const o=(null===(n=e.one("[node-type=feed_list_content"))||void 0===n?void 0:n.text())||"",s=e.all(".card-review .content .txt").map((e=>{var t;const n=(null===(t=e.one("a"))||void 0===t?void 0:t.text())||"";let i=e.text();if(i.startsWith(n)){const e=i.indexOf("\uff1a");i=i.substring(e+1).replaceAll("\u8bc4\u8bba\u914d\u56fe","")}return{author:n,content:i}})),r=(null===(i=t.elem)||void 0===i?void 0:i.value)||"",a=/^\u56de\u590d@(.*?):/.exec(r);let l=[];if(a){const e=a[1];l=s.filter((t=>t.author===e)).map((e=>e.content))}if(o||s.length>0)return{replies:l,samples:s.map((e=>e.content)),title:"",content:o,dom:t.elem}}(e,t):void 0}const n=function(e){if(e.findParent(".woo-modal-main"))return RC;const t=e.findParentUntil((e=>e.matches("article")||e.matches(".woo-panel-main"))),n=null==t?void 0:t.one(".wbpro-feed-content"),i=MC(t);return{title:"",content:null==n?void 0:n.text(1e3),reply:"",samples:i}}(t);if(!n)return;const{title:i,content:o,reply:s,samples:r}=n;return i||o||s?{title:i,content:o,replies:s?[s]:[],samples:r,dom:e}:void 0},onFillText(e,t){bC(e,"replace",t)}};const BC={isUrlMatch:e=>/(\w+\.)?linkedin\.com$/.test(e.host),calcButtonPosition(e){const t=e.getBoundingClientRect();return new DOMPoint(window.scrollX+t.x+t.width-8,window.scrollY+t.y+(t.height-32)/2)},getReplyContext(e){const t=new AC(e).findParent(".ql-editor",{includeSelf:!0});if(!t)return;const n=function(e){const t=e.findParent("div[data-view-name=feed-full-update]");if(!t)return;const n=t.one(".feed-shared-update-v2__description-wrapper .update-components-text");if(!n)return;if(!e.findParent(".comments-comment-box--reply",{includeSelf:!0})){const e=t.all(".comments-comment-list__container article .comments-comment-entity__content").map((e=>null==e?void 0:e.text())).filter((e=>!!e));return{title:"",content:n.text(),replies:[],samples:e}}return function(e){var t;const n=e.findParentUntil((e=>e.matches("#fie-impression-container")));if(!n)return;const i=n.all(".comments-comment-entity__content"),o=i.map((e=>{var t;return null===(t=e.findParent(".comments-thread-entity"))||void 0===t||null===(t=t.nextElem(".comments-comment-meta__container"))||void 0===t?void 0:t.one(".comments-comment-meta__description-title span[aria-hidden=true]")})).filter((e=>!!e));if(o.length!==i.length)return;const s=[];o.forEach(((e,t)=>{s.push({author:e.text(),content:i[t].text()})}));const r=e.all(".ql-mention").map((e=>e.text())).filter((e=>!!e)),a=(null===(t=n.one(".feed-shared-update-v2__description"))||void 0===t?void 0:t.text())||"";if(r.length>0){const e=[],t=[];return s.forEach((n=>{r.includes(n.author)?e.push(n.content):t.push(n.content)})),{title:"",content:a,replies:e,samples:t}}{var l;const t=null===(l=e.findParent("article.comments-comment-entity"))||void 0===l||null===(l=l.one(".comments-comment-meta__description-title span[aria-hidden=true]"))||void 0===l?void 0:l.text();if(t)return{title:"",content:a,replies:[t],samples:[]}}}(e)}(t);return n&&(n.title||n.content||n.replies.length>0)?{title:n.title,content:n.content,replies:n.replies.map((e=>e)),samples:n.samples.map((e=>e)),dom:e}:void 0},onFillText(e,t){bC(e,"replace",t)}},DC={atUser:""};var OC=function(e){return e.Comment="comment",e.Reply="reply",e}(OC||{});function FC(e){const t=function(e){var t;const n=null==e?void 0:e.deepOne(["bili-comment-renderer","#body"]),i=null==n?void 0:n.deepOne(["bili-comment-user-info","[data-user-profile-id]"]),o=(null==n||null===(t=n.deepOne(["#content bili-rich-text","#contents"]))||void 0===t?void 0:t.text())||"";return{uid:(null==i?void 0:i.attr("data-user-profile-id"))||"",user:(null==i?void 0:i.text())||"",content:o}}(e),n=e.deepAll(["bili-comment-replies-renderer","bili-comment-reply-renderer"]).map((e=>function(e){const t=e.deepOne(["bili-comment-user-info","[data-user-profile-id]"]);let n="",i="";const o=e.deepOne(["bili-rich-text","#contents"]),s=null==o?void 0:o.childElement(0);var r;return"\u56de\u590d"===(null==s?void 0:s.text().trim())?(i=(null==s||null===(r=s.nextElem("[data-user-profile-id]"))||void 0===r?void 0:r.attr("data-user-profile-id"))||"",n=Array.from((null==o?void 0:o.elem.children)||[]).slice(2).map((e=>_C(e))).join("")):n=(null==o?void 0:o.text())||"",{type:OC.Reply,uid:(null==t?void 0:t.attr("data-user-profile-id"))||"",user:(null==t?void 0:t.text())||"",content:n,replyTo:i}}(e))).filter((e=>!!e));return n.unshift({type:OC.Comment,uid:t.uid,user:t.user,content:t.content,replyTo:""}),n}function UC(e){let t=e.getAttribute("placeholder")||"";var n;t||(t=(null===(n=new AC(e).findParent(".brt-root"))||void 0===n||null===(n=n.one(".brt-placeholder"))||void 0===n?void 0:n.text())||"");const i=/^\u56de\u590d\s*@(.*?)\s*:/.exec(t);return i?i[1]:""}const HC={isUrlMatch:e=>/(\w+\.)?bilibili\.com$/.test(e.host),isContextChange(e,t){if(e!==t)return!0;const n=new AC(e).findParent("bili-comment-thread-renderer"),i=UC(e);return((null==n?void 0:n.elem)!==DC.root||i!==DC.atUser)&&(DC.root=null==n?void 0:n.elem,DC.atUser=i||"",!0)},getReplyContext(e){if(!e.matches("textarea")&&!e.matches(".brt-editor"))return;const t=_C(document.querySelector("h1")),n=_C(document.querySelector(".desc-info-text")),i=new AC(e);if(i.findParent("bili-comments-header-renderer")){var o;return{title:t,content:n,dom:e,samples:(null===(o=AC.create("bili-comments"))||void 0===o?void 0:o.deepAll(["bili-comment-thread-renderer"]).map((e=>{var t;return(null===(t=e.deepOne(["bili-comment-renderer","#content bili-rich-text","#contents"]))||void 0===t?void 0:t.text())||""})).filter((e=>!!e)))||[]}}const s=i.findParent("bili-comment-thread-renderer");if(!s)return;const r=FC(s);if(r.length<=0)return;const a=UC(e),l=new Map;r.forEach(((e,t)=>{l.has(e.user)||l.set(e.user,t+1),l.has(e.uid)||l.set(e.uid,t+1)}));const c=[],d=l.get(a)||"1";c.push(`\u9700\u8981\u5bf9\u4ee5\u4e0b\u5185\u5bb9\u4e2d\u5e8f\u53f7\u4e3a #${d} \u7684\u5185\u5bb9\u8fdb\u884c\u56de\u590d\uff0c\u5982\u679c\u56de\u590d\u5185\u5bb9\u4e2d\u5305\u542b\u8868\u60c5\u5982 [\u9ad8\u5174][\u6342\u8138] \u7b49\uff0c\u56de\u590d\u4e00\u4e9b emoji \u8868\u60c5:`),r.forEach((e=>{const t=l.get(e.replyTo);let n="";t&&(n=` \u56de\u590d #${t}`),c.push(`#${l.get(e.uid)}${n}: ${e.content}`)}));return{title:t,content:n,replies:c.join("\n"),dom:e}},onFillText(e,t){bC(e,"replace",t)}},zC=[HC,kC,LC,TC,NC,BC,EC],qC=new Set;function VC(e){const t=new URL(e);for(const i of zC)if(i.isUrlMatch(t)){var n;if(!qC.has(i))null===(n=i.install)||void 0===n||n.call(i),qC.add(i);return i}}function $C(e,t){if(null!=e&&e.calcButtonPosition)return e.calcButtonPosition(t);const n=t.getBoundingClientRect();return new DOMPoint(window.scrollX+n.x+n.width-4,window.scrollY+n.y+(n.height-32)/2)}function WC(){const[e,t]=(0,m.useState)(null),n=(0,m.useRef)(),[i,o]=(0,m.useState)(!0),[s,a]=(0,m.useState)(!0);return(0,m.useEffect)((()=>{let e;const i=()=>{var i;const o=CC(document.activeElement);if(o){var s;if(null!==(i=n.current)&&void 0!==i&&i.isContextChange){if(null===(s=n.current)||void 0===s||!s.isContextChange(o,e))return}else if(e===o)return;e=o;try{const e=function(e){if(e&&e instanceof HTMLElement)return VC(location.href)}(o);if(n.current=e,e){const n=e.getReplyContext(o);if(n){const i=$C(e,n.dom);t({activeElement:n.dom,replyContext:n,point:i})}}}catch(r){A.vF.persist.log({message:"reply assistant error",meta:{},error:r})}}};i();const o=(0,Is.A)(i,16);return document.addEventListener("focus",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),()=>{document.removeEventListener("focus",o,!0),document.removeEventListener("keydown",o,!0),document.removeEventListener("click",o,!0),qC.forEach((e=>{var t;null===(t=e.uninstall)||void 0===t||t.call(e)}))}}),[]),(0,m.useEffect)((()=>{if(null==e||!e.activeElement)return;let i=!0;const s=()=>{if(!i)return;null!=e&&e.activeElement&&t((e=>{if(null==e||!e.activeElement)return e;const t=$C(n.current,e.activeElement);return t.x===e.point.x&&t.y===e.point.y?e:(0,r.A)((0,r.A)({},e),{},{point:t})}));const l=CC(document.activeElement);var c;a(!(null==(c=null==e?void 0:e.activeElement)||!c.offsetParent)),o(l===(null==e?void 0:e.activeElement)),i&&setTimeout(s,200)};return s(),()=>{i=!1}}),[null==e?void 0:e.activeElement]),{visible:s,btnVisible:i,adapter:n,replyState:e}}const KC=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",d:"m7.357 18.528 1.558-1.558h10.156q.316 0 .546.237.229.23.229.546a.73.73 0 0 1-.23.546.75.75 0 0 1-.545.23zm-.886-.735-1.914.735q-.174.063-.316-.079a.3.3 0 0 1-.071-.324l.775-1.859 8.898-8.89 1.518 1.527zm9.65-9.634-1.535-1.526.854-.847q.317-.308.657-.332t.633.261l.308.317q.293.293.277.624-.015.332-.34.657z"})})),YC=(0,js.a)((0,Te.jsx)(KC,{})),GC=15,QC=5,ZC=30,XC=22,JC=5,eA=2,tA=!1,nA=(e,t)=>{(0,It.z8)(_.Ur.writingSettingClick,(0,r.A)({button_name:e,click_from:bo.sJ.writing_assistant},t))},iA=e=>{(0,It.z8)(_.Ur.showMailEntryButton,{button_name:e,show_from:bo.sJ.writing_assistant})},oA=e=>{(0,It.z8)(_.Ur.clickMailEntryButton,{button_name:e,click_from:bo.sJ.writing_assistant})},sA=e=>{(0,It.z8)(_.Ur.writingSkilShow,{skill_id:2,skill_name:"writing_assistant",show_from:bo.sJ.writing_assistant,module_actionid:e})},rA=(e,t)=>{(0,It.z8)(_.Ur.writingSkillClick,{skill_id:2,skill_name:"writing_assistant",module_actionid:e,content_detail:t,click_from:bo.sJ.writing_assistant})},aA=(e,t)=>{(0,It.z8)(_.Ur.clickMailThreadResult,{button_name:e,click_from:bo.sJ.writing_assistant,module_actionid:t})},lA=e=>{(0,It.z8)(_.Ur.writingAssistantResultClick,(0,r.A)((0,r.A)({},e),{},{click_from:bo.sJ.writing_assistant}))};class cA{constructor(e,t,n){(0,y.A)(this,"current_hostname",void 0),(0,y.A)(this,"hosts",void 0),(0,y.A)(this,"setter",void 0);const i=Array.isArray(t)?t:[];this.hosts=new Set(i),this.setter=n,this.current_hostname=e}hasHost(){return this.hosts.has(this.current_hostname)}addHost(){this.hosts.add(this.current_hostname),this.setter(Array.from(this.hosts))}removeHost(){this.hosts.delete(this.current_hostname),this.setter(Array.from(this.hosts))}toggleHost(){this.hosts.has(this.current_hostname)?this.hosts.delete(this.current_hostname):this.hosts.add(this.current_hostname),this.setter(Array.from(this.hosts))}disableHost(e){e?this.addHost():this.removeHost()}}function dA(e){const t=bn.zs[e];if(!t)throw new Error("disabled host key missing");const[n,i]=(0,f.Y)(t.page);return new cA(window.location.hostname,n,i)}const uA={inputAssistantDisabled:!1,revisionMap:new WeakMap,revisionVersion:0,dragPositionMap:new WeakMap,writingTemplatesActionId:Date.now().toString()},hA=(0,sg.vt)()((0,og.eh)(((e,t)=>(0,r.A)((0,r.A)({},uA),{},{setInputAssistantDisabled:t=>e({inputAssistantDisabled:t}),updateEditorRevision(n,i){this.revisionMap.set(n,i),e({revisionVersion:t().revisionVersion+1})},removeEditorRevision(n){this.revisionMap.delete(n),e({revisionVersion:t().revisionVersion+1})},updateDragPosition(e,t){this.dragPositionMap.set(e,t)},refreshWritingTemplatesActionId(){e({writingTemplatesActionId:Date.now().toString()})}})))),mA="settings-DMcHC8",pA="switchItem-bDObRQ",gA="title-A_d39g",vA="selectItem-xGmpwl",fA="body-jMNbH3",_A="item-BaRfKn",xA="active-ZMUuIN",yA="left-DuHHSc",bA="icon-ATBrm4",wA="itemTitle-xZUfB5",CA="itemSubTitle-cLmxN7",AA="langOnly-wnIrWv",SA="check-setting-item-jxcMcz";function kA(e){return(0,Te.jsxs)("div",{className:pA,children:[(0,Te.jsx)("div",{className:gA,children:e.title}),(0,Te.jsx)(je.dO,{size:"small",checked:e.value,onChange:t=>e.onChange(t)})]})}function EA(e){var t,n;const i=Wt(),o=null==i||null===(t=i.compose)||void 0===t||null===(t=t.language)||void 0===t?void 0:t.filter((e=>["en","zh","cn"].includes(e.language_code||""))),s=(null==o||null===(n=o.find((e=>!0===e.is_default)))||void 0===n?void 0:n.language_code)||"",[r,a]=(0,f.Y)("inputAssistantLang");return(0,m.useEffect)((()=>{r||a(s)}),[r]),(0,Te.jsxs)("div",{className:J()(vA,e.className),children:[(0,Te.jsx)("div",{className:gA,children:e.title}),(0,Te.jsx)(Fu,{className:fA,children:null==o?void 0:o.map((e=>{const t=r===e.language_code;return(0,Te.jsxs)("div",{className:J()({[_A]:!0,[xA]:t}),"data-lang-option":e.language_code,onClick:()=>{a(e.language_code||""),nA(_._h.writingLanguage,{language_setting:e.language_code})},children:[(0,Te.jsxs)("div",{className:yA,children:[(0,Te.jsx)("div",{className:wA,children:e.language_loc}),(0,Te.jsx)("div",{className:CA,children:e.language})]}),t&&(0,Te.jsx)(Pe.Tf,{className:bA})]},e.language_code)}))})]})}const TA=(0,m.forwardRef)((function(e,t){const{showLangOnly:n=!1}=e,i=dA(fe.lf.inputAssistant),o=dA(fe.lf.grammar),s=hA(),[r,a]=(0,m.useState)(0),l=()=>a(r+1),c=(0,m.useRef)({enableGrammar:!o.hasHost(),enableInputAssistant:!i.hasHost(),closeWritingTemp:!1}),d=c.current.enableInputAssistant||c.current.enableGrammar,u=(0,v.B)();(0,m.useEffect)((()=>()=>{const{closeWritingTemp:e,enableInputAssistant:t,enableGrammar:n}=c.current;s.setInputAssistantDisabled(e),nA(_._h.hideUntilNext,{whether_hide:e?1:0}),i.disableHost(!t),nA(_._h.closeWritingAssistant,{whether_close_writing_assistant:t?0:1}),o.disableHost(!n),nA(_._h.closeGrammerCheck,{whether_close_grammar_check:n?0:1})}),[]);const{closeWritingTemp:h,enableInputAssistant:p,enableGrammar:g}=c.current;return(0,Te.jsxs)("div",{"data-testid":e["data-testid"],ref:t,className:mA,children:[!n&&(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(kA,{title:u("flow_web_ext_writing_setting_switch"),value:d,onChange:e=>{c.current.enableGrammar=e,c.current.enableInputAssistant=e,l()}}),(0,Te.jsx)("div",{className:SA,children:(0,Te.jsx)(je.Sc,{checked:p,onChange:e=>{void 0!==e.target.checked&&(c.current.enableInputAssistant=e.target.checked,l())},children:u("flow_web_ext_writing_setting_writing")})}),(0,Te.jsx)("div",{className:SA,children:(0,Te.jsx)(je.Sc,{checked:g,onChange:e=>{void 0!==e.target.checked&&(c.current.enableGrammar=e.target.checked,l())},children:u("flow_web_ext_writing_setting_grammar")})}),(0,Te.jsx)(kA,{title:u("flow_web_ext_sidebar_hide_1"),value:h,onChange:e=>{c.current.closeWritingTemp=e,l()}})]}),tA&&(0,Te.jsx)(EA,{className:J()({[AA]:n}),title:u("flow_web_ext_writing_lang","\u56de\u590d\u8bed\u8a00")})]})})),IA={inputAssist:"inputAssist-_fVAzj",hasBg:"hasBg-y_Luk1",expand:"expand-bOxmVY",closeBtn:"closeBtn-jUWxH6",closeIcon:"closeIcon-x4JLSg",active:"active-qgigJz",promptEditor:"promptEditor-Rg1k7l",avatar:"avatar-JTSG4S",footer:"footer-IPbIFv",helpWrite:"helpWrite-Z_jSaZ",popover:"popover-sTjuQP",writePopover:"writePopover-fxZ6ia",header:"header-CDBQy1",headerBtn:"headerBtn-eBMIJA",moreBtns:"moreBtns-yGuX6p",backBtn:"backBtn-MiSuN8",back:"back-P1rTLq",spliter:"spliter-pManTA",headerTitle:"headerTitle-xfu1gd",headerTxt:"headerTxt-r78dw0","banner-wrapper":"banner-wrapper-HLihCs",bannerWrapper:"banner-wrapper-HLihCs",collapse:"collapse-Buj9Jt",messageBox:"messageBox-mRvZAm",message:"message-q6YYA1",banner:"banner-RTeYKx","carousel-row-wrapper":"carousel-row-wrapper-uclocB",carouselRowWrapper:"carousel-row-wrapper-uclocB",item:"item-KdhsII",selected:"selected-BuCP6w","item-title":"item-title-dch9y9",itemTitle:"item-title-dch9y9","bottom-bar-container":"bottom-bar-container-yPAVZt",bottomBarContainer:"bottom-bar-container-yPAVZt","rich-editor-wrapper":"rich-editor-wrapper-dpXavl",richEditorWrapper:"rich-editor-wrapper-dpXavl","flow-chat-editor":"flow-chat-editor-fLL66g",flowChatEditor:"flow-chat-editor-fLL66g","tools-box":"tools-box-zdE3p_",toolsBox:"tools-box-zdE3p_",revisionCount:"revisionCount-bq1jWH",messageFooter:"messageFooter-v0Gjco",messageBtns:"messageBtns-bcpuJA",btnLeft:"btnLeft-L2gplv",btn:"btn-z7sNqm",adjustTone:"adjustTone-Dxb0UZ",adjustToneImg:"adjustToneImg-QgQtFX",hidden:"hidden-rY_znh"};function jA(e){const{visible:t=!0}=e,n=(0,m.useRef)(null),i=(0,m.useRef)(null),[o,s]=(0,m.useState)(!1);return Po((()=>s(!1)),[i,n]),(0,m.useEffect)((()=>{t&&iA(_._h.settings)}),[t]),(0,Te.jsx)(je.AM,{className:IA.popover,style:{userSelect:"none"},getPopupContainer:e.getPopupContainer,onVisibleChange:e.onVisibleChange,trigger:"custom",visible:o,spacing:GC,position:"bottomLeft",content:(0,Te.jsx)(TA,{"data-testid":"writing-assistant-popover-settings",showLangOnly:e.showLangOnly,ref:i}),children:(0,Te.jsx)("span",{ref:n,style:{display:t?"block":"none"},children:(0,Te.jsx)(zd.S,{"data-testid":"writing-assistant-btn-settings",getPopupContainer:e.getPopupContainer,className:J()(e.buttonClassName,{[IA.active]:o}),tooltip:e.title,tooltipOptions:{spacing:GC},icon:e.icon,onClick:()=>{s(!o),oA(_._h.settings)}})})})}function NA(e){const t=(0,v.B)(),n=e.showCopy||tA;return(0,Te.jsxs)("div",{className:IA.header,children:[(0,Te.jsxs)("div",{className:IA.headerTitle,children:[e.hasBackIcon?(0,Te.jsx)(zd.S,{onClick:e.onBackClick,className:J()(IA.backBtn,IA.headerBtn),icon:(0,Te.jsx)(Iu.A,{className:IA.back})}):null,(0,Te.jsx)("div",{className:IA.headerTxt,children:`${Jr.R}${t("flow_web_ext_email_regenerate","\u5e2e\u6211\u5199")}`})]}),(0,Te.jsxs)("div",{className:IA.moreBtns,children:[e.showCopy&&(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(fu.T,{text:e.text||"",className:IA.headerBtn,style:{fontSize:16,marginRight:2},onClick:()=>{lA({button_name:"read"})}}),(0,Te.jsx)(Oy.A,{"data-testid":"writing-assistant-btn-copy",tooltip:t("flow_ext_web_general_copy"),successTooltip:t("flow_web_ext_general_copied"),onCopyClick:()=>{var t;return lA({button_name:"copy"}),Boolean(null===(t=e.onCopyClick)||void 0===t?void 0:t.call(e))},className:IA.headerBtn})]}),tA&&(0,Te.jsx)(jA,{showLangOnly:!0,buttonClassName:IA.headerBtn,getPopupContainer:e.getPopupContainer,icon:(0,Te.jsx)(Pe.kK,{}),title:t("flow_web_ext_writing_lang","\u56de\u590d\u8bed\u8a00")})]}),n&&(0,Te.jsx)("span",{className:IA.spliter}),(0,Te.jsx)(zd.S,{tooltip:t("flow_web_ext_close"),className:IA.headerBtn,onClick:e.onClose,icon:(0,Te.jsx)(ve.A,{})})]})}const RA=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 4.028a.75.75 0 0 1 .75.75v2.884l1.61-1.609a.75.75 0 0 1 1.06 1.06l-2.889 2.89a.75.75 0 0 1-1.06 0l-2.89-2.89a.75.75 0 0 1 1.061-1.06l1.609 1.609V4.778a.75.75 0 0 1 .75-.75M4.75 12a.75.75 0 0 1 .75-.75h13a.75.75 0 1 1 0 1.5h-13a.75.75 0 0 1-.75-.75m3.832 4.886 2.888-2.888a.75.75 0 0 1 1.061 0l2.889 2.888a.75.75 0 0 1-1.06 1.061l-1.61-1.608v2.883a.75.75 0 0 1-1.5 0v-2.884l-1.608 1.61a.75.75 0 0 1-1.06-1.062",clipRule:"evenodd"})})),MA=(0,js.a)((0,Te.jsx)(RA,{})),PA=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.75 5.5a.75.75 0 0 1 .75-.75h13a.75.75 0 0 1 0 1.5h-13a.75.75 0 0 1-.75-.75m6.833 1.543a.75.75 0 0 1 .832 0l2.167 1.444a.75.75 0 0 1-.832 1.248l-1-.667v5.864l1-.667a.75.75 0 1 1 .832 1.248l-2.167 1.444a.75.75 0 0 1-.832 0l-2.166-1.444a.75.75 0 1 1 .832-1.248l1 .667V9.068l-1 .667a.75.75 0 1 1-.832-1.248zM4.75 18.5a.75.75 0 0 1 .75-.75h13a.75.75 0 0 1 0 1.5h-13a.75.75 0 0 1-.75-.75",clipRule:"evenodd"})})),LA=(0,js.a)((0,Te.jsx)(PA,{}));var BA=n(22437);let DA=function(e){return e[e.Retry=0]="Retry",e[e.Regenerate=1]="Regenerate",e[e.ChangeTone=2]="ChangeTone",e[e.MakeShorter=3]="MakeShorter",e[e.MakeLonger=4]="MakeLonger",e}({});function OA(e){var t;const{t:n}=(0,BA.B)(),{onButtonClick:i=h.A,onConfirmClick:o=h.A,onMessageChange:s,getPopupContainer:r,messageId:a,writingConfig:l}=e,c=(null==l||null===(t=l.compose)||void 0===t?void 0:t.tone)||[],[d,u]=(0,m.useState)(""),[p,g]=(0,m.useState)(!1),{isDone:v,isError:f,isAborted:_,text:x=""}=(0,An.P)((e=>e.messages[a]))||{},y=!!(x||f||v||_);return(0,m.useEffect)((()=>{null==s||s(!!v,x)}),[v,Math.round(x.length/20)]),(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("div",{className:IA.messageBox,children:(0,Te.jsx)(Qu,{id:a,type:"mail",enableScroll:!0,className:IA.message,onRetry:()=>i(DA.Retry,d)})}),y&&(0,Te.jsx)("div",{className:IA.messageFooter,"data-testid":"writing-assistant-writing-footer",children:(0,Te.jsxs)("div",{className:IA.messageBtns,children:[(0,Te.jsxs)("div",{className:IA.btnLeft,children:[(0,Te.jsx)(ea.c,{"data-testid":"writing-assistant-btn-regenerate",className:IA.btn,size:"small",icon:(0,Te.jsx)(Pe.eD,{}),type:"tertiary",onClick:()=>i(DA.Regenerate,d),children:n("regenerate_button_hover_text","\u91cd\u65b0\u751f\u6210")}),(0,Te.jsx)(je.l6,{placeholder:n("modify_change_tone"),"data-testid":"writing-assistant-btn-changetone",className:J()(IA.btn,IA.adjustTone),size:"small",prefix:(0,Te.jsx)(Go.A,{}),getPopupContainer:r,value:d,arrowIcon:p?(0,Te.jsx)(Qo.A,{}):(0,Te.jsx)(ht.A,{}),clickToHide:!0,onDropdownVisibleChange:e=>g(e),onChange:e=>{u(String(e)),e&&i(DA.ChangeTone,e)},children:c.map((e=>(0,Te.jsx)(je.l6.Option,{value:e.value,children:(0,Te.jsx)("span",{"data-tone-option":e.value,children:e.show_name})},e.value)))}),(0,Te.jsx)(ea.c,{"data-testid":"writing-assistant-btn-shorter",className:IA.btn,size:"small",icon:(0,Te.jsx)(MA,{}),type:"tertiary",onClick:()=>i(DA.MakeShorter,d),children:n("cici_desktop_skill_make_shorter","\u7f29\u5199")}),(0,Te.jsx)(ea.c,{"data-testid":"writing-assistant-btn-longer",className:IA.btn,size:"small",icon:(0,Te.jsx)(LA,{}),type:"tertiary",onClick:()=>i(DA.MakeLonger,d),children:n("cici_desktop_skill_make_longer","\u6269\u5199")})]}),(0,Te.jsx)("div",{className:IA.btnRight,children:(0,Te.jsx)(ea.c,{"data-testid":"writing-assistant-btn-confirm",size:"small",type:"primary",onPointerDown:e=>e.preventDefault(),onClick:()=>{x&&o(x)},children:"write"===e.type?"\u63d2\u5165":"\u5168\u90e8\u66ff\u6362"})})]})})]})}var FA=n(54020);var UA=n(4290);function HA(e){var t,n;const i=Wt(),[o,s]=(0,m.useState)(!1),[r,a]=(0,m.useState)(""),l=(0,m.useRef)(null),c=(0,m.useRef)(null),d=(0,m.useRef)(null==e||null===(t=e.getPopupContainer)||void 0===t?void 0:t.call(e)),u=(0,m.useRef)(),h=(0,v.B)(),{visible:p=!0}=e,g=(null===(n=(0,An.P)((e=>e.messages[r]||{})))||void 0===n?void 0:n.text)||"";Po((()=>{s(!1)}),[l,c,d]);const f=e=>{r&&r!==e&&An.P.getState().abortMessage(r,"regenerate"),a(e)},x=(0,m.useCallback)((()=>{if(e.replyContext){const t=function(e){const{title:t,content:n,replies:i,samples:o}=e,s=[],r=[];if(i&&("string"==typeof i?s.push(i):i.length>0&&(r.push(...i.map((e=>e.length))),s.push(`\u9700\u8981\u5bf9\u4ee5\u4e0b\u5185\u5bb9\u4e2d\u5e8f\u53f7\u4e3a #1 \u7684\u5185\u5bb9\u8fdb\u884c\u56de\u590d\uff0c\u5982\u679c\u56de\u590d\u5185\u5bb9\u4e2d\u5305\u542b\u5982 [\u9ad8\u5174][\u6342\u8138] \u7b49\uff0c\u56de\u590d\u4e00\u4e9b emoji \u8868\u60c5: \n${i.map(((e,o)=>o<i.length-1?`#${o+1} \u56de\u590d #${o+2}: ${e}`:`#${o+1} \u56de\u590d ${function(e,t){const n=[];return e&&n.push(' "\u4e3b\u9898" '),t&&n.push(' "\u5185\u5bb9" '),n.length<=0?"":`\u4e0b\u9762\u7684${n.join("\u548c")}`}(t,n)}: ${e}`)).join("\n")}`))),t&&s.push(`====\u4e3b\u9898====\n${t}`),n&&s.push(`====\u5185\u5bb9====\n${n}`),o&&o.length>0){let e=o;e.length>3&&(e=(0,FA.A)(e).slice(0,3)),r.push(...e.map((e=>e.length))),s.push(`====\u4ee5\u4e0b\u662f\u4f60\u9700\u8981\u6a21\u4eff\u7684\u56de\u590d\u98ce\u683c====\n${e.map(((e,t)=>`\u4f8b${t+1}: ${e}`)).join("\n")}`)}const a=r[Math.random()*r.length|0]||200;return{content:s.join("\n"),replySize:Math.random()>.5?a:10+Math.ceil(190*Math.random())}}(e.replyContext);t&&(0,ar.Rm)("[reply assistant]",t.replySize,t.content);const n=(0,UA.a4)({text:t.content,replySize:t.replySize});f(n)}}),[e.replyContext]);(0,m.useEffect)((()=>{o&&e.replyContext&&u.current!==e.replyContext&&(u.current=e.replyContext,x())}),[e.replyContext,o]);const[y,b]=(0,m.useState)(0);(0,m.useEffect)((()=>{p&&(iA(_._h.helpMeReply),hA.getState().refreshWritingTemplatesActionId())}),[p]);const w={helpMeReply:h("flow_web_ext_help_me_reply","\u5e2e\u6211\u56de\u590d")};return(0,Te.jsx)(je.AM,{style:{width:600,userSelect:"none"},className:IA.popover,trigger:"custom",spacing:GC,visible:o&&p,getPopupContainer:e.getPopupContainer,onVisibleChange:e.onVisibleChange,rePosKey:y,position:"bottomRight",content:(0,Te.jsxs)("div",{ref:l,"data-testid":"writing-assistant-popover-reply",children:[(0,Te.jsx)(NA,{title:w.helpMeReply,getPopupContainer:e.getPopupContainer,showCopy:!!r,onCopyClick:()=>{const e=hA.getState().writingTemplatesActionId;return aA(_._h.btnCopy,e),!!g&&Gt()(g)},onClose:()=>{s(!1)},text:g}),(0,Te.jsx)(OA,{type:"write",messageId:r,getPopupContainer:e.getPopupContainer,writingConfig:i,onMessageChange:()=>b(y+1),onButtonClick:(e,t)=>{if(e===DA.Regenerate||e===DA.Retry)x();else if(e===DA.MakeLonger){const e=An.P.getState().messages[r],t=(0,UA.gR)({text:e.text||"",template_type:"adjust",adjust:"\u6269\u5199"});f(t)}else if(e===DA.MakeShorter){const e=An.P.getState().messages[r],t=(0,UA.gR)({text:e.text||"",template_type:"adjust",adjust:"\u7f29\u5199"});f(t)}else if(e===DA.ChangeTone){const e=An.P.getState().messages[r],n=(0,UA.gR)({text:e.text||"",template_type:"tone",tone:t});f(n)}},onConfirmClick:t=>{var n;s(!1),null===(n=e.onWriteComplete)||void 0===n||n.call(e,t);const i=hA.getState().writingTemplatesActionId;aA(_._h.btnReplace,i)}})]}),children:(0,Te.jsx)("span",{ref:c,style:{position:"relative",display:p?"block":"none"},children:(0,Te.jsx)(zd.S,{"data-testid":"writing-assistant-btn-reply",className:J()({[IA.active]:o}),tooltip:!1===e.showTooltip||o?"":w.helpMeReply,tooltipOptions:{spacing:GC},onClick:()=>{s(!o),oA(_._h.helpMeReply)},icon:(0,Te.jsx)(YC,{}),getPopupContainer:e.getPopupContainer})})})}function zA(e){const[t,n]=(0,m.useState)(!1),i=(0,m.useRef)(null),o=(0,m.useRef)(new Map),s=(0,m.useRef)(),[r,a]=(0,m.useState)(!1),[l,c]=(0,m.useState)(!1),d=(0,Co.l)((e=>e.setIsShowReplyBtn)),u=(0,m.useCallback)((()=>{s.current&&(clearTimeout(s.current),s.current=void 0)}),[s]);Po((()=>{r||n(!1)}),[i],[r]);const h=(0,m.useCallback)((()=>(0,rr.E8)()||i.current),[i]),p=(e,t)=>{o.current.set(e,t);let i=!1;for(const n of o.current)if(n[1]){i=!0;break}n(i),a(i)};return(0,Te.jsx)("div",{"data-testid":"reply-assistant-container",className:IA.helpWrite,ref:i,onClick:e=>e.stopPropagation(),style:{userSelect:"none"},onMouseEnter:()=>{u(),p("enter",!0)},onMouseLeave:()=>{u(),s.current=setTimeout((()=>{p("enter",!1)}),500)},children:(0,Te.jsxs)("div",{className:J()({[IA.inputAssist]:!0,[IA.expand]:t,[IA.hasBg]:!0}),children:[(0,Te.jsx)(xe.A,{className:IA.closeBtn,optionPageSection:"writing",position:"topRight",disableKey:fe.lf.replyAssistant,onDisableOnceClick:()=>d(!1),show:l,setShow:c,renderChildren:({onTriggerClick:e})=>(0,Te.jsx)(Pe.gz,{className:IA.closeIcon,onClick:t=>{t.preventDefault(),t.stopPropagation(),l?c(!l):e(t)}})}),(0,Te.jsx)(HA,{showTooltip:!l,visible:e.visible,replyContext:e.replyContext,onWriteComplete:t=>{var n;null===(n=e.onWriteComplete)||void 0===n||n.call(e,"insert",t)},getPopupContainer:h,onVisibleChange:e=>p("write",e)})]})})}const qA=(e,[t,n])=>Math.min(Math.max(e,t),n),VA={prevent:!0,preventPointerDown:!0,direction:"both",maxDistance:{x:{max:1/0,min:-1/0},y:{max:1/0,min:-1/0}},setCSS:!0},$A=e=>{const t=(0,m.useMemo)((()=>(0,r.A)((0,r.A)({},VA),e)),[e]),n=(0,m.useRef)(null),i=(0,m.useRef)(null),o=(0,m.useRef)([0,0]),s=(0,m.useRef)([0,0]),a=(0,m.useRef)([0,0]),l=(0,m.useRef)(!1),[c,d]=(0,m.useState)([0,0]),u=(0,m.useCallback)(((e,n)=>{a.current=e,d(e),i.current&&t.setCSS&&(i.current.style.transition=n||"",i.current.style.transform=`translate3d(${e[0]}px, ${e[1]}px, 0)`)}),[t.setCSS]),h=(0,m.useCallback)((e=>{var i;if(e.button>0)return;const[r,c]=a.current;let[d,h]=a.current;l.current=!0,d=e.clientX-r,h=e.clientY-c,s.current=[e.clientX,e.clientY],o.current=[d,h],null===(i=t.onStart)||void 0===i||i.call(t,n,[d,h],u),t.preventPointerDown&&e.preventDefault()}),[t,u]),p=(0,m.useCallback)((e=>{var i,s,r,c,d,h,m,p,v,f;if(e.button>0&&(l.current=!1,g(e)),!l.current)return;null===(i=n.current)||void 0===i||i.setPointerCapture(e.pointerId),t.prevent&&e.preventDefault();const[_,x]=o.current;let[y,b]=a.current;y=e.clientX-_,b=e.clientY-x,y="vertical"===t.direction?0:qA(y,[null!==(s=null===(r=t.maxDistance)||void 0===r||null===(r=r.x)||void 0===r?void 0:r.min)&&void 0!==s?s:-1/0,null!==(c=null===(d=t.maxDistance)||void 0===d||null===(d=d.x)||void 0===d?void 0:d.max)&&void 0!==c?c:1/0]),b="horizontal"===t.direction?0:qA(b,[null!==(h=null===(m=t.maxDistance)||void 0===m||null===(m=m.y)||void 0===m?void 0:m.min)&&void 0!==h?h:-1/0,null!==(p=null===(v=t.maxDistance)||void 0===v||null===(v=v.y)||void 0===v?void 0:v.max)&&void 0!==p?p:1/0]),null===(f=t.onMove)||void 0===f||f.call(t,n,[y,b],u),u([y,b])}),[l,t,u]),g=(0,m.useCallback)((e=>{var i,o;const[r,c]=s.current,d=Math.abs(e.clientX-r),h=Math.abs(e.clientY-c);var m;d<=4&&h<=4&&(null===(m=t.onClickLike)||void 0===m||m.call(t));null===(i=n.current)||void 0===i||i.releasePointerCapture(e.pointerId),l.current=!1,null===(o=t.onEnd)||void 0===o||o.call(t,n,a.current,u)}),[t,u]);return(0,m.useEffect)((()=>{const e=n.current;return null==e||e.addEventListener("pointerdown",h),null==e||e.addEventListener("pointermove",p),null==e||e.addEventListener("pointerup",g),null==e||e.addEventListener("pointercancel",g),()=>{null==e||e.removeEventListener("pointerdown",h),null==e||e.removeEventListener("pointermove",p),null==e||e.removeEventListener("pointerup",g),null==e||e.removeEventListener("pointercancel",g)}}),[n,t,h,p,g]),{anchor:n,target:i,position:c,setPosition:u}};function WA(){const{replyState:e,adapter:t,visible:n,btnVisible:i}=WC(),{dragPositionMap:o}=hA(),{target:s,anchor:r,setPosition:a}=$A({prevent:!0,preventPointerDown:!0,onMove(t,n){null!=e&&e.activeElement&&hA.getState().updateDragPosition(e.activeElement,n)}});return(0,m.useEffect)((()=>{null!=e&&e.activeElement&&a(o.get(e.activeElement)||[0,0])}),[null==e?void 0:e.activeElement]),null!=e&&e.activeElement&&e.replyContext?(0,Te.jsx)("div",{className:J()({[IA.hidden]:!(n&&i)}),style:{position:"absolute",left:e.point.x,top:e.point.y},ref:s,children:(0,Te.jsx)("div",{ref:r,children:(0,Te.jsx)(zA,{onWriteComplete:(n,i)=>{var o,s;e.activeElement&&(null===(o=t.current)||void 0===o||null===(s=o.onFillText)||void 0===s||s.call(o,e.activeElement,i))},visible:n,replyContext:e.replyContext})})}):null}const KA=["BLOCKQUOTE"];function YA(e){if(aC(e)){if(KA.includes(e.tagName))return NodeFilter.FILTER_REJECT;if(e instanceof HTMLButtonElement||"button"===e.getAttribute("role"))return NodeFilter.FILTER_REJECT;if("none"===getComputedStyle(e).display)return NodeFilter.FILTER_REJECT}if(e instanceof Text){if(!e.nodeValue||!e.parentElement)return NodeFilter.FILTER_REJECT;if(/^\s*\n\s*$/.test(e.nodeValue)&&!getComputedStyle(e.parentElement).whiteSpace.startsWith("pre"))return NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT}const GA=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT;function*QA(e,t){var n,i;const o=null!==(n=null==t?void 0:t.isNewline)&&void 0!==n?n:XA,s=null!==(i=null==t?void 0:t.filter)&&void 0!==i?i:YA,r=document.createTreeWalker(e,GA,s);let a=r.nextNode(),l=!1,c=!1;const d=[],u=e=>{const t=e.previousElementSibling,n=t?d.indexOf(t):-1;if(n>-1){return d.splice(n).some(o)}return!1};for(;a;){if(c=c||u(a),a instanceof Text){const e=c||l;c=!1,l=!1,yield{newline:e,node:a}}else a.childNodes.length>0&&d.push(a);l=l||o(a),a=r.nextNode()}}const ZA=["block","flex","grid","flow-root","table","-webkit-box","-moz-box","-webkit-flex","-moz-flex","-ms-flexbox","list-item"];function XA(e){if(e instanceof HTMLElement){if("BR"===e.tagName)return!0;const t=getComputedStyle(e),[n=""]=t.display.split(" ");if(ZA.includes(n))return!0}return!1}function JA(e){var t;if(!e.parentElement||!e.nodeValue)return"";let n=null===(t=e.nodeValue)||void 0===t?void 0:t.replace(/\u200b/g,"").replace(/\u00a0|\u2002|\u2003/g," ");return getComputedStyle(e.parentElement).whiteSpace.startsWith("pre")||(n=n.replace(/\n/g,"")),n}class eS extends jd.A{}class tS extends eS{constructor(e){var t,n;super(),t=this,(0,y.A)(this,"dom",void 0),(0,y.A)(this,"filter",void 0),(0,y.A)(this,"textNodes",void 0),(0,y.A)(this,"mutationObserver",void 0),(0,y.A)(this,"isComposition",!1),(0,y.A)(this,"handleCompositionStart",(()=>this.isComposition=!0)),(0,y.A)(this,"handleCompositionEnd",(()=>{this.isComposition=!1,this.handleChange()})),(0,y.A)(this,"bind",(()=>{this.dom.addEventListener("compositionstart",this.handleCompositionStart),this.dom.addEventListener("compositionend",this.handleCompositionEnd),this.mutationObserver=new MutationObserver(this.handleChange),this.mutationObserver.observe(this.dom,{subtree:!0,childList:!0,characterData:!0})})),(0,y.A)(this,"unbind",(()=>{var e;this.dom.removeEventListener("compositionstart",this.handleCompositionStart),this.dom.removeEventListener("compositionend",this.handleCompositionEnd),null===(e=this.mutationObserver)||void 0===e||e.disconnect(),this.mutationObserver=void 0})),(0,y.A)(this,"handleChange",(()=>{this.isComposition||(this.textNodes=this.extractTextNodes(),this.emit("contentChange",this.text))})),(0,y.A)(this,"splitContentTextRectIterator",(e=>{for(let t=this.textNodes.length-1;t>=0;t--){const n=this.textNodes[t].node,i=document.createRange();i.setStart(n,0),i.setEnd(n,n.length);const o=Array.from(i.getClientRects());for(let t=o.length-1;t>=0;t--)if(!1===e(o[t]))return}})),(0,y.A)(this,"getSelection",(()=>{const e=document.getSelection();if(!e||e.rangeCount<1)return;const t=e.getRangeAt(0);if(!this.dom.contains(t.commonAncestorContainer))return;let n,i,o=0;for(const s of this.textNodes){if(s.newline&&(o+=1),t.startContainer.contains(s.node)&&(n=o+t.startOffset),t.endContainer.contains(s.node)&&(i=o+t.endOffset),n&&i){const e=(0,oC.A)(t.getClientRects());return{collapsed:t.collapsed,start:n,end:i,rect:e,text:this.text.slice(n,i)}}o+=JA(s.node).length}})),(0,y.A)(this,"selectText",((e,t,n)=>{const i=window.getSelection(),o=new Range;return o.setStart(e,t),o.setEnd(e,n),null==i||i.removeAllRanges(),null==i||i.addRange(o),o})),(0,y.A)(this,"insertTextByRange",((e,t)=>{const n={bubbles:!0,cancelable:!0,inputType:"insertText",data:e};if(t&&"StaticRange"in window&&"getTargetRanges"in InputEvent.prototype)try{n.targetRanges=[new StaticRange(t)]}catch(o){}const i=new InputEvent("beforeinput",n);this.dom.dispatchEvent(i),document.execCommand("insertText",!1,e)})),(0,y.A)(this,"applyReplacement",function(){var e=(0,a.A)((function*(e,n,i,o){const s=t.selectText(e,n,i);yield(0,rr.uk)(),t.insertTextByRange(o,s)}));return function(t,n,i,o){return e.apply(this,arguments)}}()),(0,y.A)(this,"replace",function(){var e=(0,a.A)((function*(e,n,i){t.dom.focus();const o=t.getRelativeTextNodesByRange(e,n).map(((e,t)=>(0,r.A)((0,r.A)({},e),{},{replacement:0===t?i:""})));for(const s of o.reverse())yield t.applyReplacement(s.node,s.from,s.to,s.replacement);t.dom.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!1})),t.dom.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,keyCode:17,which:17,charCode:0,location:1,key:"Control",code:"ControlLeft"})),yield(0,rr.uk)()}));return function(t,n,i){return e.apply(this,arguments)}}()),this.filter=rC(n=window.location.hostname,"notion.so")?e=>aC(e)&&(e.classList.contains("notion-page-controls")||"true"===e.getAttribute("data-content-editable-void")||"14vh"===e.style.marginBottom)?NodeFilter.FILTER_REJECT:YA(e):rC(n,"mail.google.com",3)?e=>aC(e)&&e.classList.contains("gmail_quote")?NodeFilter.FILTER_REJECT:YA(e):(0,ps.Im)()?e=>aC(e)&&(e.classList.contains("code-block-container")||e.classList.contains("uneditable")||e.classList.contains("docx-code-block-container")||e.classList.contains("docx-diagram-block")||e.classList.contains("docx-chat_card-block")||e.classList.contains("doc-meta-entry-wrapper")||e.classList.contains("doc-info-wrapper")||e.classList.contains("scrollable-wrapper")||e.classList.contains("resizable-container")||e.classList.contains("ace-line")&&!e.isContentEditable)?NodeFilter.FILTER_REJECT:YA(e):rC(n,"outlook.live.com",3)?e=>{var t;return!aC(e)||"divRplyFwdMsg"!==e.id&&"divRplyFwdMsg"!==(null===(t=e.previousElementSibling)||void 0===t?void 0:t.id)?YA(e):NodeFilter.FILTER_REJECT}:YA,this.dom=e,this.textNodes=this.extractTextNodes(),this.bind()}extractTextNodes(){let e=0;return[...QA(this.dom,{filter:this.filter})].map((t=>{const{node:n,newline:i}=t;i&&(e+=1);const o=JA(n),s=(0,r.A)((0,r.A)({},t),{},{text:o,offset:e});return e+=o.length,s}))}calcPureText(){let e="";for(const t of this.textNodes)t.newline&&(e+="\n"),e+=JA(t.node);return e}get text(){return this.calcPureText()}valid(e){if(hC(e,(e=>e instanceof HTMLAnchorElement))||function(e){return hC(e,(e=>e instanceof HTMLElement&&e.matches("code")))}(e))return!1;var t,n;if((0,ps.Im)()&&(null!==(t=lC(e,2))&&void 0!==t&&t.classList.contains("smart-correction-text")||null!==(n=lC(e,4))&&void 0!==n&&n.classList.contains("grammar-check")))return!1;return!0}getRevisionRect(e){const t=[],n=new Set,{textNodes:i}=this;e:for(const o of e){if(n.has(o.sentId))continue;let e=[],s=0;for(const t of i){const i=JA(t.node).length;t.newline&&(s+=1);if(uC(o,{start:s,end:s+i})){if(!this.valid(t.node)){n.add(o.sentId);continue e}const r=Math.max(o.start,s)-s,a=Math.min(o.end,s+i)-s;e.push(...mC(t.node,r,a))}s+=i}e=e.filter((e=>e.width>0));const r=pC(this.dom,e);r.length>0&&t.push({revision:o,rects:r})}return t.filter((e=>!n.has(e.revision.sentId)))}getRelativeTextNodesByRange(e,t){const n=[];for(const i of this.textNodes){const{text:o,node:s,offset:r}=i;uC({start:e,end:t-1},{start:r,end:r+o.length-1})&&n.push({from:Math.max(e,r)-r,to:Math.min(t,r+o.length)-r,node:s})}return n}insertText(e){this.insertTextByRange(e)}destroy(){this.removeAllListeners(),this.unbind()}}function nS(e){const t=parseFloat(e);return isNaN(t)?0:t}function iS(e){return(0,m.useMemo)((()=>e?function(e){const t={x:e.x,y:e.y,top:e.top,left:e.left,right:e.right,width:e.width,height:e.height+2,bottom:e.bottom+2};return{getBoundingClientRect:()=>(0,r.A)((0,r.A)({},t),{},{toJSON:()=>t})}}(e):null),[e])}function oS(e,t){document.body.contains(oS.dom)||document.body.append(oS.dom),oS.dom.removeAttribute("style");const n=getComputedStyle(e),i=function(e){const t=getComputedStyle(e),n=nS(t.width),i=nS(t.height),o=nS(t.paddingTop),s=nS(t.paddingRight),r=nS(t.paddingBottom),a=nS(t.paddingLeft),l=nS(t.borderTopWidth),c=nS(t.borderRightWidth),d=nS(t.borderBottomWidth),u=nS(t.borderLeftWidth);return"border-box"===t.boxSizing?{width:n-a-s-u-c,height:i-o-r-l-d,offsetLeft:a+u,offsetTop:o+l,offsetRight:s+c,offsetBottom:r+d}:{width:n,height:i,offsetLeft:0,offsetTop:0,offsetRight:0,offsetBottom:0}}(e);return oS.dom.style.top="0",oS.dom.style.left="0",oS.dom.style.position="fixed",oS.dom.style.pointerEvents="none",oS.dom.style.opacity="0",oS.dom.style.opacity="0",oS.dom.style.width=`${e.clientWidth}px`,oS.dom.style.boxSizing=n.boxSizing,oS.dom.style.padding=n.padding,oS.dom.style.border=n.border,oS.dom.style.fontSize=n.fontSize,oS.dom.style.fontFamily=n.fontFamily,oS.dom.style.fontStyle=n.fontStyle,oS.dom.style.fontWeight=n.fontWeight,oS.dom.style.lineHeight=n.lineHeight,oS.dom.style.letterSpacing=n.letterSpacing,oS.dom.style.textAlign=n.textAlign,t?(oS.dom.style.whiteSpace="nowrap",oS.dom.style.height=`${e.clientHeight}px`,oS.dom.style.lineHeight=`${i.height}px`):(oS.dom.style.whiteSpace=n.whiteSpace,oS.dom.style.wordBreak=n.wordBreak),oS.dom.textContent=e.value,oS.dom}oS.dom=document.createElement("div"),oS.dom.classList.add("fake-editor");class sS extends eS{constructor(e){var t;super(),t=this,(0,y.A)(this,"dom",void 0),(0,y.A)(this,"isComposition",!1),(0,y.A)(this,"handleCompositionStart",(()=>this.isComposition=!0)),(0,y.A)(this,"handleCompositionEnd",(()=>{this.isComposition=!1,this.handleChange()})),(0,y.A)(this,"bind",(()=>{this.dom.addEventListener("compositionstart",this.handleCompositionStart),this.dom.addEventListener("compositionend",this.handleCompositionEnd),this.dom.addEventListener("input",this.handleChange),this.dom.addEventListener("change",this.handleChange)})),(0,y.A)(this,"unbind",(()=>{this.dom.removeEventListener("compositionstart",this.handleCompositionStart),this.dom.removeEventListener("compositionend",this.handleCompositionEnd),this.dom.removeEventListener("input",this.handleChange),this.dom.removeEventListener("change",this.handleChange)})),(0,y.A)(this,"handleChange",(()=>{this.isComposition||this.emit("contentChange",this.text)})),(0,y.A)(this,"splitContentTextRectIterator",(e=>{const t=oS(this.dom,"INPUT"===this.dom.tagName).firstChild;if(!t)return[];const n=document.createRange();n.setStart(t,0),n.setEnd(t,t.length);const{top:i,left:o}=this.dom.getBoundingClientRect(),s=Array.from(n.getClientRects()).map((e=>({top:e.top+i,left:e.left+o,y:e.y+i,x:e.x+o,width:e.width,height:e.height,right:e.right+o,bottom:e.bottom+i})));for(let r=s.length-1;r>=0;r--)if(!1===e(s[r]))return})),(0,y.A)(this,"replace",function(){var e=(0,a.A)((function*(e,n,i){document.activeElement!==t.dom&&(t.dom.focus(),yield(0,rr.uk)()),t.dom.setSelectionRange(e,n,"forward"),document.execCommand("insertText",!1,i),yield(0,rr.uk)()}));return function(t,n,i){return e.apply(this,arguments)}}()),this.dom=e,this.bind()}get text(){return this.dom.value}getSelection(){const e=this.dom.selectionStart,t=this.dom.selectionEnd;if(!e||!t)return;const n=oS(this.dom,"INPUT"===this.dom.tagName).firstChild;if(!n)return;const i=document.createRange();i.setStart(n,e),i.setEnd(n,t);const o=(0,oC.A)(i.getClientRects());if(!o)return;const{top:s,left:r}=this.dom.getBoundingClientRect();return{start:e,end:t,rect:{top:s+o.top,left:r+o.left,y:s+o.y,x:r+o.x,width:o.width,height:o.height,right:o.right+r,bottom:o.bottom+s},collapsed:e===t,text:this.text.slice(e,t)}}getRevisionRect(e){const t=[],n=oS(this.dom,"INPUT"===this.dom.tagName),i=document.createRange(),o=n.firstChild;if(!o)return t;for(const r of e)try{i.setStart(o,r.start),i.setEnd(o,r.end);const e=[...i.getClientRects()];t.push({revision:r,rects:e})}catch(s){}return i.detach(),t}insertText(e,t){var n=this;return(0,a.A)((function*(){document.activeElement!==n.dom&&(n.dom.focus(),yield(0,rr.uk)()),!0===t&&n.dom.select(),document.execCommand("insertText",!1,e),yield(0,rr.uk)()}))()}destroy(){this.unbind(),this.removeAllListeners()}}const rS=new WeakMap;function aS(e){let t,n,i=null;if(e instanceof tS){i=function(e){var t;let n;const i=(null===(t=window.getSelection())||void 0===t?void 0:t.focusNode)||null;return n=!i||i instanceof HTMLElement?i:i.parentElement,function(e,t){let n=t;for(;n;){if(n===e)return!0;n=n.parentElement}return!1}(e,n)||(n=null),n}(e.dom)||e.dom;const o=function(e){if(e){if((0,ps.Im)()){const t=cC(e,(e=>e.hasAttribute("data-block-type")||e.classList.contains("text-editor"))),n=cC(e,(e=>e.classList.contains("ace-line")));if(!t)return;const i=t.getBoundingClientRect();let o=i.x+i.width;const s=cC(e,(e=>e.matches(".page-block-children")));if(s){const e=s.getBoundingClientRect();o=e.x+e.width+130}return{anchorPoint:new DOMPoint(o,i.y-4),text:n?n.innerText:t.innerText,row:t}}if(/\bnotion\.so$/.test(location.hostname)){const t=cC(e,(e=>e.classList.contains("notion-text-block")));if(!t)return;const n=t.getBoundingClientRect();return{anchorPoint:new DOMPoint(n.x-48,n.y),text:t.innerText,row:t}}}}(i);o&&(o.anchorPoint&&(t=o.anchorPoint),n=o.text,i=o.row)}if(!t){const n=e.dom.getBoundingClientRect(),i=window.scrollX+n.x+n.width-QC,o=window.scrollY+n.y+(n.height-ZC)/2;t=new DOMPoint(i,o)}return void 0===n&&(n=e.text),n=n.replace(/^[\s]+|\s+$/gi,"").replace(/[\x00-\x1f\u200b]/g,""),{inputText:n,richElement:i,anchorPoint:t}}function lS(e){return!(null==e||!e.offsetParent)}function cS(){const[e,t]=(0,m.useState)(null),[n,i]=(0,m.useState)(!0),o=(0,m.useRef)(),[s,a]=(0,m.useState)(!0),l=(0,As.A)("writing_assistant");return(0,m.useEffect)((()=>{const e=()=>{var e;const n=document.activeElement;if(!(n instanceof HTMLElement))return;const i=dC(n);if(!i)return;if(!function(e,t){const{input_enabled_urls:n,input_disabled_urls:i,input_enabled_size:o,rich_enabled_urls:s,rich_disabled_urls:r,input_tag_disabled:a}=t;if(a&&"INPUT"===e.element.tagName)return!1;const l=location.href.replace(/^http?s:\/\//i,"");if(e.type===sC.Input){if(!Cs(l,n,i))return!1}else if(!Cs(l,s,r))return!1;return!(e.element.offsetWidth<o.width||e.element.offsetHeight<o.height)}(i,l))return void t(null);let s=rS.get(i.element);s||(s=i.type===sC.Rich?new tS(i.element):new sS(i.element),rS.set(i.element,s)),null===(e=o.current)||void 0===e||e.cancel(),a(lS(s.dom));const r=aS(s);t({editorType:i.type,editor:s,inputText:r.inputText,activeElement:r.richElement,point:r.anchorPoint})};e();const n=(0,Is.A)(e,16);return document.addEventListener("focus",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),()=>{document.removeEventListener("focus",n,!0),document.removeEventListener("keydown",n,!0),document.removeEventListener("click",n,!0)}}),[]),(0,m.useEffect)((()=>{const n=(0,Is.A)((()=>{null!=e&&e.editor&&t((e=>{if(null==e||!e.editor)return e;const t=aS(e.editor);return(0,r.A)((0,r.A)({},e),{},{point:t.anchorPoint})})),i(!0)}),400),s=()=>{i(!1),n()},l=(0,Is.A)((()=>{lS(null==e?void 0:e.editor.dom)||a(!1)}),200);o.current=l,window.addEventListener("scroll",s,!0),window.addEventListener("resize",s,!0),document.addEventListener("pointerdown",l,!0);let c=!0;const d=()=>{c&&(lS(null==e?void 0:e.editor.dom)||a(!1),c&&setTimeout(d,1e3))};return d(),()=>{var e;window.removeEventListener("scroll",s,!0),window.removeEventListener("resize",s,!0),document.removeEventListener("pointerdown",l,!0),null===(e=o.current)||void 0===e||e.cancel(),c=!1}}),[l,null==e?void 0:e.editor]),{visible:s&&n,inputState:e}}var dS=n(41349),uS=n(54191),hS=n(14979),mS=n(70292),pS=n(7378),gS=n(69675);const vS=["active","item","onClick"];function fS(e){const{active:t,item:n,onClick:i}=e,o=(0,jt.A)(e,vS);return(0,Te.jsxs)("div",(0,r.A)((0,r.A)({},o),{},{className:J()(IA.item,{[IA.selected]:t}),onClick:i,children:[(0,Te.jsx)(pS.Image,{wrapperClassName:IA["item-img"],src:n.background_url,imageOptions:{squareContainer:!0,objectFit:"contain",draggable:!1,width:100,height:130}},n.value),(0,Te.jsx)("div",{className:IA["item-title"],title:n.show_name,children:n.show_name})]}))}function _S(e){const{config:t}=e,[n,i]=(0,m.useState)();return null!=t&&t.template?(0,Te.jsx)(dg.F,{carouselRowClassName:IA["carousel-row-wrapper"],children:(null==t?void 0:t.template)&&t.template.map(((o,s)=>(0,Te.jsx)(fS,{"data-testid":`writing-assistant-template-${s}`,item:o,active:n===s,onClick:()=>{var r;if(s===n)return;i(s);const a=(0,gS.nP)(o.value||"",t.input_options);null===(r=e.onItemClick)||void 0===r||r.call(e,o,a)}},s)))}):(0,Te.jsx)(je.tK,{})}function xS(e){const{editorValue:t,onEditorValueChange:n,writingConfig:i}=e,{t:o}=(0,BA.B)(),s=(0,hS.r$)(t?(0,dS.fG)(null==t?void 0:t.data):"",!0);return(0,m.useEffect)((()=>{hA.getState().refreshWritingTemplatesActionId(),sA(hA.getState().writingTemplatesActionId)}),[]),(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("div",{"data-testid":"writing-assistant-template-container",className:J()(IA.banner),children:(0,Te.jsx)(_S,{config:null==i?void 0:i.write,onItemClick:(e,t)=>{n(t),rA(hA.getState().writingTemplatesActionId,e.show_name||"")}})}),(0,Te.jsxs)("div",{className:IA.promptEditor,style:{userSelect:"auto"},children:[(0,Te.jsx)(mS.uX,{"data-testid":"writing-assistant-text-editor",value:t,style:{fontSize:14},dir:(0,hS.V8)()?s:"ltr",onChange:e=>n(e),placeholder:o("skill_writing_compose_input_placeholder")}),(0,Te.jsx)("div",{className:IA.footer,children:(0,Te.jsx)(ea.c,{"data-testid":"writing-assistant-editor-btn-write",type:"primary",size:"small",onPointerDown:e=>e.preventDefault(),onClick:()=>{e.onConfirm&&e.onConfirm(t)},disabled:(0,dS.GI)(t),children:o("flow_web_ext_email_write","\u64b0\u5199")})})]})]})}function yS(e){var t,n;const{visible:i=!0}=e,o=Wt(),[s,r]=(0,m.useState)(!1),[a,l]=(0,m.useState)(""),[c,d]=(0,m.useState)({data:[]}),u=(0,m.useRef)(null),h=(0,m.useRef)(null),p=(0,m.useRef)(null==e||null===(t=e.getPopupContainer)||void 0===t?void 0:t.call(e)),g=(0,v.B)();Po((()=>{r(!1)}),[u,h,p]);const f=(0,m.useCallback)((e=>{const t=(0,dS.fG)(e.data),n=(0,UA.qk)({text:t});l(n)}),[l]),[x,y]=(0,m.useState)(0),b=(null===(n=(0,An.P)((e=>e.messages[a]||{})))||void 0===n?void 0:n.text)||"";return(0,m.useEffect)((()=>{i&&iA(_._h.write)}),[i]),(0,Te.jsx)(je.AM,{style:{width:600},className:J()(IA.popover,{[IA.writePopover]:!a}),trigger:"custom",spacing:GC,visible:s,getPopupContainer:e.getPopupContainer,onVisibleChange:e.onVisibleChange,rePosKey:x,position:"bottomLeft",content:(0,Te.jsxs)("div",{ref:u,"data-testid":"writing-assistant-popover-write",style:{userSelect:"none"},children:[(0,Te.jsx)(NA,{title:"\u5e2e\u6211\u5199",getPopupContainer:e.getPopupContainer,hasBackIcon:!!a,showCopy:!!a,onBackClick:()=>{l("")},onClose:()=>{r(!1)},onCopyClick:()=>{const e=hA.getState().writingTemplatesActionId;return aA(_._h.btnCopy,e),!!b&&Gt()(b)},text:b}),a?(0,Te.jsx)(OA,{type:"write",messageId:a,getPopupContainer:e.getPopupContainer,writingConfig:o,onMessageChange:()=>y(x+1),onButtonClick:(e,t)=>{if(e===DA.Regenerate||e===DA.Retry)f(c);else if(e===DA.MakeLonger){const e=An.P.getState().messages[a],t=(0,UA.gR)({text:e.text||"",template_type:"adjust",adjust:"\u6269\u5199"});l(t)}else if(e===DA.MakeShorter){const e=An.P.getState().messages[a],t=(0,UA.gR)({text:e.text||"",template_type:"adjust",adjust:"\u7f29\u5199"});l(t)}else if(e===DA.ChangeTone){const e=An.P.getState().messages[a],n=(0,UA.gR)({text:e.text||"",template_type:"tone",tone:t});l(n)}},onConfirmClick:t=>{var n;r(!1),null===(n=e.onWriteComplate)||void 0===n||n.call(e,t);const i=hA.getState().writingTemplatesActionId;aA(_._h.btnInsert,i)}}):(0,Te.jsx)(xS,{writingConfig:o,editorValue:c,onEditorValueChange:e=>d(e),onConfirm:e=>{f(e)}})]}),children:(0,Te.jsx)("span",{ref:h,style:{position:"relative",display:i?"block":"none"},children:(0,Te.jsx)(zd.S,{"data-testid":"writing-assistant-btn-write",className:J()({[IA.active]:s}),tooltip:g("flow_web_ext_email_regenerate","\u5e2e\u6211\u5199"),onClick:()=>{r(!s),oA(_._h.write)},icon:(0,Te.jsx)(uS.A,{}),tooltipOptions:{spacing:GC},getPopupContainer:e.getPopupContainer})})})}function bS(e){var t,n;const i=Wt(),[o,s]=(0,m.useState)(!1),[r,a]=(0,m.useState)(""),l=(0,m.useRef)(null),c=(0,m.useRef)(null),d=(0,m.useRef)(null==e||null===(t=e.getPopupContainer)||void 0===t?void 0:t.call(e)),u=(0,m.useRef)(),h=(0,v.B)(),{visible:p=!0}=e,g=(null===(n=(0,An.P)((e=>e.messages[r]||{})))||void 0===n?void 0:n.text)||"";Po((()=>{s(!1)}),[l,c,d]);const f=e=>{r&&r!==e&&An.P.getState().abortMessage(r,"regenerate"),a(e)},x=(0,m.useCallback)((()=>{if(e.inputText){var t;const n=(null==i||null===(t=i.compose)||void 0===t||null===(t=t.tone)||void 0===t||null===(t=t.find((e=>e.is_default)))||void 0===t?void 0:t.value)||"",o=(0,UA.gR)({text:e.inputText||"",template_type:"tone",tone:n});f(o)}}),[e.inputText]);(0,m.useEffect)((()=>{o&&e.inputText&&u.current!==e.inputText&&(u.current=e.inputText,x())}),[e.inputText,o]);const[y,b]=(0,m.useState)(0);return(0,m.useEffect)((()=>{p&&(iA(_._h.rewrite),hA.getState().refreshWritingTemplatesActionId())}),[p]),(0,Te.jsx)(je.AM,{style:{width:600,userSelect:"none"},className:IA.popover,trigger:"custom",spacing:GC,visible:o,getPopupContainer:e.getPopupContainer,onVisibleChange:e.onVisibleChange,rePosKey:y,position:"bottomLeft",content:(0,Te.jsxs)("div",{ref:l,"data-testid":"writing-assistant-popover-rewrite",children:[(0,Te.jsx)(NA,{title:"\u91cd\u5199",getPopupContainer:e.getPopupContainer,showCopy:!!r,onCopyClick:()=>{const e=hA.getState().writingTemplatesActionId;return aA(_._h.btnCopy,e),!!g&&Gt()(g)},onClose:()=>{s(!1)},text:g}),(0,Te.jsx)(OA,{type:"rewrite",messageId:r,getPopupContainer:e.getPopupContainer,writingConfig:i,onMessageChange:()=>b(y+1),onButtonClick:(e,t)=>{if(e===DA.Regenerate||e===DA.Retry)x();else if(e===DA.MakeLonger){const e=An.P.getState().messages[r],t=(0,UA.gR)({text:e.text||"",template_type:"adjust",adjust:"\u6269\u5199"});f(t)}else if(e===DA.MakeShorter){const e=An.P.getState().messages[r],t=(0,UA.gR)({text:e.text||"",template_type:"adjust",adjust:"\u7f29\u5199"});f(t)}else if(e===DA.ChangeTone){const e=An.P.getState().messages[r],n=(0,UA.gR)({text:e.text||"",template_type:"tone",tone:t});f(n)}},onConfirmClick:t=>{var n;s(!1),null===(n=e.onWriteComplate)||void 0===n||n.call(e,t);const i=hA.getState().writingTemplatesActionId;aA(_._h.btnReplace,i)}})]}),children:(0,Te.jsx)("span",{ref:c,style:{position:"relative",display:p?"block":"none"},children:(0,Te.jsx)(zd.S,{"data-testid":"writing-assistant-btn-rewrite",className:J()({[IA.active]:o}),tooltip:h("flow_ext_rewrite","\u91cd\u5199"),tooltipOptions:{spacing:GC},onClick:()=>{s(!o),oA(_._h.rewrite)},icon:(0,Te.jsx)(YC,{}),getPopupContainer:e.getPopupContainer})})})}function wS(e){const{revisionState:t={count:0,loading:!1}}=e,[n,i]=(0,m.useState)(!1),o=(0,m.useRef)(null),s=(0,m.useRef)(new Map),r=(0,m.useRef)(),[a,l]=(0,m.useState)(!1),c=(0,v.B)(),d=(0,m.useCallback)((()=>{r.current&&(clearTimeout(r.current),r.current=void 0)}),[r]);Po((()=>{a||i(!1)}),[o],[a]);const u=(0,m.useCallback)((()=>(0,rr.E8)()||o.current),[o]),{width:h,hasBg:p}=(0,m.useMemo)((()=>function(e,t,n){let i=1,o=!0;return e&&(i++,n.length>0&&i++),t>0&&(e?i++:(i=1,o=!1)),{width:i*XC+(i-1)*eA+(i<=1?0:JC+eA),hasBg:o}}(n,t.count,e.inputText)),[n,t.count,e.inputText]),g=(e,t)=>{s.current.set(e,t);let n=!1;for(const i of s.current)if(i[1]){n=!0;break}i(n),l(n)};return(0,Te.jsx)("div",{"data-testid":"writing-assistant-container",className:IA.helpWrite,ref:o,onClick:e=>e.stopPropagation(),style:{userSelect:"none"},onMouseEnter:()=>{d(),g("enter",!0)},onMouseLeave:()=>{d(),r.current=setTimeout((()=>{g("enter",!1)}),500)},children:(0,Te.jsxs)("div",{className:J()({[IA.inputAssist]:!0,[IA.expand]:n,[IA.hasBg]:p}),style:{width:h},children:[(0,Te.jsx)(jA,{visible:n,getPopupContainer:u,onVisibleChange:e=>g("settings",e),icon:(0,Te.jsx)(Pe.TH,{}),title:"\u8bbe\u7f6e"}),(0,Te.jsx)("span",{className:IA.spliter}),(0,Te.jsx)(bS,{visible:!!e.inputText,inputText:e.inputText,onWriteComplate:t=>{var n;return null===(n=e.onWriteComplete)||void 0===n?void 0:n.call(e,"replace",t)},onVisibleChange:e=>g("rewrite",e),getPopupContainer:u}),(0,Te.jsx)(yS,{onWriteComplate:t=>{var n;null===(n=e.onWriteComplete)||void 0===n||n.call(e,"insert",t)},getPopupContainer:u,onVisibleChange:e=>g("write",e)}),t.count>0&&(0,Te.jsx)(zd.S,{tooltip:c("flow_web_ext_grammer_correction"),icon:(0,Te.jsx)("div",{className:IA.revisionCount,children:t.count}),tooltipOptions:{spacing:GC},onClick:e.onRevisionClick,getPopupContainer:u})]})})}const CS=(0,ws.A)(["*.doubao.com","*.ciciai.com"]);function AS(){const{inputAssistantDisabled:e,revisionMap:t,dragPositionMap:n}=hA(),i=dA(fe.lf.inputAssistant),[o]=(0,f.Y)("InputAssistantDisabledAll"),{inputState:s,visible:r}=cS(),{target:a,anchor:l,setPosition:c}=$A({prevent:!0,preventPointerDown:!0,onMove(e,t){null!=s&&s.editor&&hA.getState().updateDragPosition(s.editor.dom,t)}});if((0,m.useEffect)((()=>{null!=s&&s.editor&&c(n.get(s.editor.dom)||[0,0])}),[null==s?void 0:s.editor]),CS(location.hostname)&&!location.pathname.startsWith("/browser-extension/welcome")||null==s||!s.editor||e||o||i.hasHost())return null;const d=t.get(s.editor.dom);return(0,Te.jsx)("div",{style:{display:r?"block":"none",position:"absolute",left:s.point.x,top:s.point.y},ref:a,children:(0,Te.jsx)("div",{ref:l,children:(0,Te.jsx)(wS,{inputText:s.inputText,revisionState:{count:(null==d?void 0:d.count)||0,loading:(null==d?void 0:d.loading)||!1},onRevisionClick:()=>{null==d||d.env.replaceAll(),(0,Ke.s)("detect_grammar_error_click",{current_page:(0,It.M5)(location.href)}),(0,$e.dn)({click_from:"writing_assistant"})},onWriteComplete:(e,t)=>{if(s.editorType===sC.Rich){t=t.replace(/\s{2,}/gi,"\n");const n=s.activeElement;if(n){const i=window.getSelection(),o=document.createRange();"replace"===e?(o.setStartBefore(n),o.setEndAfter(n)):(o.setStartAfter(n),o.setEndAfter(n)),i&&(i.removeAllRanges(),i.addRange(o));const s=n.innerText;setTimeout((()=>{(0,et.Ig)(t,n),Iy(n),setTimeout((()=>{n.innerText===s&&(n.innerText=t,null==i||i.removeAllRanges())}),0)}),0)}}else s.editor.insertText(t,"replace"===e)}})})})}function SS(){const e=dA(fe.lf.replyAssistant),[t]=(0,f.Y)("replyAssistantDisabledAll"),n=(0,Co.l)((e=>e.isShowReplyBtn)),i=(0,As.A)("reply_assistant"),o=n&&!t&&!e.hasHost();return i.enabled&&o&&function(e){return!!VC(e)}(location.href)?(0,Te.jsx)(WA,{}):(0,Te.jsx)(AS,{})}var kS=n(10517),ES=n(40992);const TS=["block","flow-root","grid","list-item","flex","-webkit-box"],IS=e=>{const t=getComputedStyle(e).getPropertyValue("display"),n="br"===e.tagName.toLowerCase()||TS.includes(t)||t.includes("table");return{display:t,isBlockOrTableDisplay:n}},jS=(e,t)=>{const n=(e=>!!e.querySelector(`.${Nu.x_}`))(e);if(n)return;if(e.classList.contains(dy.Nt)||e.classList.contains(Nu.Sf))return;const i=(e=>e.querySelector(`.${dy.Nt}`))(e);i?i.remove():t.current=setTimeout((()=>{(0,kS.Zq)(e),(0,ES.o$)()}),200)};var NS=n(7685),RS=n.n(NS);const MS={active:!1,isReading:!1},PS=(0,sg.vt)()((0,og.eh)(((e,t)=>(0,r.A)((0,r.A)({},MS),{},{setIsActive:t=>e({active:t}),setIsReading:t=>e({isReading:t})}))));var LS=n(71772),BS=n(35791);const DS=768,OS=(e,t,n)=>{const{keepRatio:i=!1,maxOriginRatioSize:o=DS}=n||{},s=null==e?void 0:e.getContext("2d");if(s&&t.width>0&&t.height>0){const e=window.devicePixelRatio,n=s.getImageData(t.left*e,t.top*e,t.width*e,t.height*e),a=document.createElement("canvas");a.width=t.width*e,a.height=t.height*e;let l=a.getContext("2d");if(l){var r;if(l.putImageData(n,0,0),1===e||i||t.width<o&&t.height<o)return a;const s=document.createElement("canvas");return s.width=t.width,s.height=t.height,l=s.getContext("2d"),null===(r=l)||void 0===r||r.drawImage(a,0,0,t.width,t.height),s}}return null},FS=e=>{const t="macos"===RS().getParser(navigator.userAgent).getOSName(!0);let n="";return e.ctrlKey&&(n+=`${Jo.vK.Ctrl}+`),e.metaKey&&(n+=`${t?Jo.vK.Command:Jo.vK.Windows}+`),e.altKey&&(n+=`${t?Jo.vK.Option:Jo.vK.Alt}+`),e.shiftKey&&(n+=`${Jo.vK.Shift}+`),n+=(0,Jo.Lj)(e.code),n},US=e=>{const t=FS(e);if(!t)return;const n=(0,se.gv)(),i=Object.entries(n).find((([e,n])=>{if(n.key.toLocaleLowerCase()===t.toLocaleLowerCase())return!0}));if(i)switch(i[0]){case Xo.e.OpenSide:e.preventDefault(),function(e){""!==qt.t_.getState().inputText?Io(so.EU.ask,_.Z5.shortcut):((0,xf.pM)({click_from:e}),Co.l.getState().toggleShowSidebar(_.cz.other))}(t);break;case Xo.e.TranslatePage:e.preventDefault(),HS(t);break;case Xo.e.ReadPage:e.preventDefault(),zS(t);break;case Xo.e.BilingualSubtitles:VS();break;case Xo.e.ScreenCapture:!function(e){if((0,ps.gm)()||!(0,se.tl)("capture_assistant").enable||BS.RT.getState().open)return;if((0,xf.Ie)({params:{click_from:e},button_name:_._h.screenCapture}),(0,wo.BB)({loginParams:{trackMeta:{trackMeta:{login_entrance:"float_btn"}}}}))return;BS.RT.setState({open:!0,reportParams:{from:"shortcut"}})}(t);break;case Xo.e.TTSReadPage:$S();break;case Xo.e.CollectPage:qS()}};const HS=e=>{const{active:t}=Ex.I.getState();(0,wo.BB)({action:"web_translatePage",loginParams:{trackMeta:{login_entrance:"float_btn"}}})||(aw._K.isInSidePanel?(0,jn.cs)("translate-page-request"):((0,xf.Ie)({params:{click_from:e}}),(0,LS.TI)({isActive:!t})))},zS=function(){var e=(0,a.A)((function*(e){const{setIsShowSidebar:t}=Co.l.getState();try{var n;if((0,_e.GT)(),(0,wo.BB)({action:"web_summary",loginParams:{trackMeta:{login_entrance:"float_btn"}}}))return;const i=window.location.href;yield(0,en.GA)();const o=(0,en.CC)(),s=(0,kn.wz)((0,se.TK)("uiLanguage"));t(!0,_.cz.clickSidebar);const r={title:null==o?void 0:o.title,url:i,content:null==o?void 0:o.textContent};ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),yield(0,ko.Z)();const{convId:a,convType:l,mainBotId:c}=(0,Jt.IK)(),d={text:i,extraExt:{origin:location.origin,browser_explain:JSON.stringify(r),llm_without_mem:"1",browser_language:s,flag_browser_plugin:"1",answer_with_suggest:"0",need_create_thread:l===Zt.H.NewThread?"1":"0"},reportParams:{scene:bo.sJ.chat_action_bar},ctx:(0,So.Pe)(l,a,c)};A.vF.persist.log({eventName:"summary_page_action",meta:{contentLength:null===(n=r.content)||void 0===n?void 0:n.length,from:"shortcut"}}),Co.l.getState().isSidePanelMode&&!aw._K.isInSidePanel?Tx.IF.getState().type===rw.u9.pdf?(0,jn.cs)({name:"read-pdf",body:{url:i}}):((0,xf.Ie)({params:{click_from:e}}),(0,jn.cs)({name:"send-message-to-chat",body:{msg:d,chatType:l}})):Tx.IF.getState().type===rw.u9.pdf?(0,wf.M)({url:i}):(dh.Qz.create("cici_summary_page_action_perf",!0),(0,ew.C)([d],{chatType:l,botType:"Main"}))}catch(i){A.vF.persist.error({eventName:"shortcut_summarize_page",error:i})}}));return function(t){return e.apply(this,arguments)}}(),qS=()=>{(0,ot.ku)()&&ro({collectionType:wn.X.Web,collectFrom:zt.vP.side_bar_popover})},VS=()=>{Tt.toggleBilingualSubtitle()},$S=()=>{if(!(0,ot.gp)())return;const{active:e,setIsActive:t}=PS.getState();t(!e)},WS=()=>{const e=(0,m.useRef)(),t=(0,m.useRef)(null),n=(0,m.useRef)(null),[i,o]=(0,m.useState)(!1),[s]=(0,f.Y)("hoverTranslateSetting"),r=s===fe.X0.TRANSLATE_DIRECTLY||i,a=(0,se.gv)(),l=()=>{n.current&&clearTimeout(n.current),t.current=null,e.current&&e.current.removeEventListener("mouseleave",l)},c=(0,T.A)((i=>{if(!i.target)return;const o=i.target;if(o instanceof HTMLElement){e.current=o,e.current.addEventListener("mouseleave",l);const{isBlockOrTableDisplay:i}=IS(o);if(o.childNodes.length>0){if(Array.from(o.childNodes).some((e=>{const t=e.textContent;return e.nodeType===Node.TEXT_NODE&&t&&/\S/.test(t)})))if(i)t.current=o,r&&jS(o,n);else{const e=(e=>{let t=null==e?void 0:e.parentElement;for(let i=0;i<5;i++){const{isBlockOrTableDisplay:e}=IS(t);if(e)return t;var n;t=null===(n=t)||void 0===n?void 0:n.parentElement}})(o);t.current=e,e&&r&&jS(e,n)}}}}),300),d=(0,m.useCallback)((e=>{if(e.repeat)return;const i=FS(e),r=i.replace(/\+/g,"");s===fe.X0.TRANSLATE_BY_COMMAND&&r===(0,Jo.AI)(Jo.jv.Command)||s===fe.X0.TRANSLATE_BY_OPTION&&r===(0,Jo.AI)(Jo.jv.Option)||s===fe.X0.TRANSLATE_BY_CUSTOM_SHORTCUT&&[i,r].includes(a[Xo.e.HoverTextTranslate].key)?(t.current&&jS(t.current,n),o(!0)):o(!1)}),[s,a]),u=()=>{o(!1)};return(0,m.useEffect)((()=>(document.addEventListener("mouseover",c),document.addEventListener("keydown",d),document.addEventListener("keyup",u),()=>{document.removeEventListener("mouseover",c),document.removeEventListener("keydown",d),document.removeEventListener("keyup",u),e.current&&e.current.removeEventListener("mouseleave",l)})),[c,d,u,l]),null};var KS=n(76064),YS=n(50920);const GS=()=>{const[e,t]=(0,m.useState)(!1),[n,i]=(0,m.useState)(""),[o,s]=(0,m.useState)(!1),r=function(){var e=(0,a.A)((function*(){t(!0),s(!1);const e=yield(0,en.B9)(),n=(null==e?void 0:e.textContent)||"";t(!1),o||i(n)}));return function(){return e.apply(this,arguments)}}();return{documentContent:n,isDocumentParsing:e,parseDoc:r,cancelParse:()=>{t(!1),s(!0),i("")}}},QS=()=>{const[e,t]=(0,m.useState)(!1),[n,i]=(0,m.useState)(!1),[o,s]=(0,m.useState)(!1),[r,a]=(0,m.useState)(!1),{isDocumentParsing:l,parseDoc:c,documentContent:d,cancelParse:u}=GS(),{setIsActive:h}=PS((e=>({setIsActive:e.setIsActive}))),p=(0,m.useMemo)((()=>{const e=()=>{const n=new lb.L;return n.readText(d),n.finishSendingText(),n.onLoadStart((()=>{s(!0)})),n.onPlayStart((()=>{s(!1),t(!0)})),n.onPlayPause((()=>{s(!1),t(!1)})),n.onPlayEnd((()=>{s(!1),t(!1),n.destroy(),e()})),n.onCurrentText((e=>{e&&(0,YS.p)([{text:e}])})),n};return d?e():null}),[d]);(0,m.useEffect)((()=>{r&&p&&(null==p||p.play(),a(!1))}),[p,r]),(0,m.useEffect)((()=>{""!==d&&n&&(g(),i(!1))}),[d,n]);const g=(0,m.useCallback)((()=>l?(a(!1),void u()):e||o?void(null==p||p.pause()):d?void(null==p||p.play()):(a(!0),void c())),[l,e,o,d]),v=()=>{null==p||p.stop(),u(),t(!1)};return{isPlaying:e,isLoading:o||r,togglePlay:g,activeTTSReadPage:()=>{h(!0)},cancelTTSReadPage:()=>{h(!1)},stopReading:v,restart:()=>{v(),c(),i(!0)}}},ZS=()=>{const e=(0,m.useRef)(null),{activeTTSReadPage:t}=QS();return(0,Te.jsx)("div",{ref:e,className:tw.toolContainer,children:(0,Te.jsx)(je.m_,{content:(0,Te.jsx)(sw,{text:"\u6717\u8bfb\u7f51\u9875",hotKey:"\u2325 + 6"}),position:"left",getPopupContainer:()=>e.current,children:(0,Te.jsx)("div",{className:J()({[tw.floatBtnPanelItemIcon]:!0,[tw.icon_size]:!0}),onClick:()=>{t()},"data-testid":"float-button-tts-read-page",children:(0,Te.jsx)(Pe.wv,{})})})})},XS=e=>(0,Te.jsxs)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:[(0,Te.jsx)("path",{fill:"currentColor",d:"M12 21a8.7 8.7 0 0 1-3.476-.706 9.2 9.2 0 0 1-2.868-1.95 9.2 9.2 0 0 1-1.95-2.868A8.7 8.7 0 0 1 3 12q0-1.844.706-3.468a9.3 9.3 0 0 1 1.941-2.876 9.2 9.2 0 0 1 2.868-1.95A8.7 8.7 0 0 1 11.99 3q1.844 0 3.477.706a9.2 9.2 0 0 1 2.876 1.95q1.245 1.245 1.95 2.876A8.6 8.6 0 0 1 21 12q0 1.845-.706 3.476a9.2 9.2 0 0 1-1.95 2.868 9.2 9.2 0 0 1-2.876 1.95A8.6 8.6 0 0 1 12 21m0-1.5a7.3 7.3 0 0 0 2.92-.582 7.6 7.6 0 0 0 2.392-1.606 7.4 7.4 0 0 0 1.606-2.391Q19.5 13.56 19.5 12a7.3 7.3 0 0 0-.582-2.92 7.6 7.6 0 0 0-1.615-2.392 7.3 7.3 0 0 0-2.391-1.606 7.3 7.3 0 0 0-2.92-.582 7.3 7.3 0 0 0-2.921.582q-1.359.574-2.383 1.606A7.6 7.6 0 0 0 5.082 9.08 7.4 7.4 0 0 0 4.51 12q0 1.562.573 2.92a7.6 7.6 0 0 0 1.606 2.392 7.6 7.6 0 0 0 2.391 1.606q1.36.582 2.921.582"}),(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M10.863 8.513c-.584-.093-1.13.325-1.22.934l-.018.133q-.125.954-.125 2.422 0 1.57.143 2.55.016.11.052.213c.202.58.815.878 1.37.668l.127-.05q.899-.36 2.068-1.087 1.12-.697 1.803-1.308.073-.065.136-.14a1.34 1.34 0 0 0-.134-1.835l-.107-.095q-.663-.571-1.698-1.217-1.255-.78-2.197-1.135a1 1 0 0 0-.2-.053",clipRule:"evenodd"})]})),JS=(0,js.a)((0,Te.jsx)(XS,{})),ek="tts_read_page_button_container-RTUDi_",tk="icon_button-ZAsfGJ",nk="divider-Lzs5k_";var ik=n(89962);const ok="voice_selector_modal-_rrADR",sk="title-M2doXp",rk="voice_selector-F_pXOg",ak="footer-JWarrP",lk="confirm-pI8DMo",ck="cancel-uAtGtw",dk=e=>{const{onClose:t,onConfirm:n,onSelect:i}=e,o=(0,v.B)();return(0,Te.jsxs)("div",{className:ok,children:[(0,Te.jsx)("div",{className:sk,children:o("flow_web_ext_setting_general_select_voice")}),(0,Te.jsx)("div",{className:rk,children:(0,Te.jsx)(ik.E,{onSelect:i})}),(0,Te.jsxs)("div",{className:ak,children:[(0,Te.jsx)("div",{className:lk,onClick:()=>{n(),t()},children:(0,Te.jsx)("span",{children:"\u786e\u8ba4"})}),(0,Te.jsx)("div",{className:ck,onClick:()=>{t()},children:(0,Te.jsx)("span",{children:"\u53d6\u6d88"})})]})]})};var uk=n(54422);const hk=e=>{const t=(0,v.B)(),{onExit:n}=e,[i,o]=(0,m.useState)(!1),{isLoading:s,isPlaying:a,togglePlay:l,cancelTTSReadPage:c,stopReading:d,restart:u}=QS(),h=(0,m.useRef)(),[p,g]=(0,f.Y)("voiceSpeaker");(0,m.useEffect)((()=>(l(),()=>{(0,jn.cs)({name:uk.lO,body:{id:"",scene:aw._K.isInSidePanel?"sidepanel":"content-script"}})})),[]);const _=()=>{if(h.current){try{const e=document.createElement("canvas");e.width=48,e.height=48;const t=e.getContext("2d");if(t&&h.current){const n=new Image;n.src=h.current.avatarUrl,n.setAttribute("crossOrigin","anonymous"),n.onload=()=>{t.drawImage(n,0,0,48,48);const i=h.current;g((0,r.A)((0,r.A)({},i),{},{avatarUrl:e.toDataURL()}))}}}catch(e){}g(h.current),u()}};let x=Ox.A;return a?x=Oo.d:s&&(x=Do.L),(0,Te.jsx)("div",{onMouseEnter:()=>{o(!0)},onMouseLeave:()=>{o(!1)},className:ek,children:i?(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(je.m_,{content:t("flow_web_ext_tts_exit","\u9000\u51fa\u6717\u8bfb"),position:"top",getPopupContainer:()=>(0,rr.E8)()||document.body,children:(0,Te.jsx)("div",{className:tk,onClick:()=>{a&&d(),c(),n()},children:(0,Te.jsx)(ve.A,{})})}),(0,Te.jsx)("div",{className:nk}),(0,Te.jsx)(je.m_,{content:t("flow_web_ext_tts_select","\u9009\u62e9\u58f0\u97f3"),position:"top",getPopupContainer:()=>(0,rr.E8)()||document.body,children:(0,Te.jsx)("div",{className:tk,onClick:()=>{Ld.addModal((0,Te.jsx)(Pd,{Modal:dk,props:{onSelect:e=>{h.current=e},onConfirm:_}}))},children:(0,Te.jsx)("img",{src:p.avatarUrl,alt:"\u5934\u50cf"})})}),(0,Te.jsx)(je.m_,{content:a?t("flow_web_ext_tts_pause","\u6682\u505c\u64ad\u653e"):t("flow_web_ext_tts_continue","\u7ee7\u7eed\u64ad\u653e"),position:"top",getPopupContainer:()=>(0,rr.E8)()||document.body,children:(0,Te.jsx)("div",{className:tk,onClick:()=>{l()},children:a?(0,Te.jsx)(Pe.k$,{}):(0,Te.jsx)(JS,{})})})]}):(0,Te.jsx)("div",{className:tk,children:(0,Te.jsx)(x,{})})})};var mk=n(67457);const pk={active:!1,showMicPermissionTip:!1},gk=(0,sg.vt)()((0,og.eh)(((e,t)=>(0,r.A)((0,r.A)({},pk),{},{setActive:t=>e({active:t}),setShowMicPermissionTip:t=>e({showMicPermissionTip:t})})))),vk=({onStartAsr:e})=>{var t;const n=(0,v.B)(),{setActive:i}=gk(),o=null===(t=(0,f.Y)("shortcutsConfig")[0])||void 0===t||null===(t=t.VoiceInput)||void 0===t?void 0:t.key,s=(0,m.useRef)(null);return(0,Te.jsx)("div",{className:tw.toolContainer,ref:s,onClick:()=>{(0,xf.Ie)({button_name:_._h.voiceInput}),null==e||e(),i(!0)},children:(0,Te.jsx)(je.m_,{position:"left",getPopupContainer:()=>s.current,content:(0,Te.jsx)(sw,{text:n("flow_web_ext_voice_input"),hotKey:o?n("flow_web_ext_voice_input_shortkey",{shortcutKey:o}):""}),children:(0,Te.jsx)("span",{className:tw["screen-capture"],children:(0,Te.jsx)(mk.A,{})})})})},fk=e=>{var t,n;const i=null===(t=(0,f.Y)("authInfo")[0])||void 0===t?void 0:t.isAuthenticated;return(null===(n=(0,As.A)("voice_input"))||void 0===n?void 0:n.enabled)&&i?(0,Te.jsx)(vk,(0,r.A)({},e)):null};var _k=n(73346);const xk=e=>(0,Te.jsxs)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:[(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.471 3.646a.748.748 0 0 0-.93 1.171l.002.002.016.013a3 3 0 0 1 .164.146H5.11a.748.748 0 1 0 0 1.495h.87c.374 1.111.87 2.008 1.814 3.081-.989.746-2.213 1.253-3.077 1.385a.748.748 0 1 0 .226 1.479c1.17-.18 2.702-.836 3.906-1.79.81.694 1.905 1.328 2.606 1.707a.748.748 0 0 0 .712-1.315c-.67-.362-1.57-.892-2.226-1.428a10.6 10.6 0 0 0 1.92-3.119h.649a.748.748 0 1 0 0-1.495H9.672a6 6 0 0 0-.725-.894 6 6 0 0 0-.431-.401l-.03-.025-.01-.007-.003-.003zm.413 4.884c-.652-.748-1.03-1.367-1.31-2.057h2.657A9.1 9.1 0 0 1 8.884 8.53",clipRule:"evenodd"}),(0,Te.jsx)("path",{fill:"currentColor",d:"M14.53 3.846a.748.748 0 1 0 0 1.495h2.426c.926 0 1.677.751 1.677 1.678v2.425a.748.748 0 0 0 1.495 0V7.019a3.173 3.173 0 0 0-3.172-3.173zM16.195 10.118a.75.75 0 0 0-.7.486l-3.089 8.28a.748.748 0 0 0 1.402.522l2.387-6.4.403 1.079a4 4 0 0 1 1.372-.602l-1.074-2.879a.75.75 0 0 0-.7-.486M4.83 13.547a.75.75 0 0 0-.748.747v2.425a3.173 3.173 0 0 0 3.173 3.173H9.68a.748.748 0 0 0 0-1.495H7.255a1.677 1.677 0 0 1-1.677-1.678v-2.425a.75.75 0 0 0-.748-.748"}),(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M18.869 20.515a3.113 3.113 0 1 0 0-6.225 3.113 3.113 0 0 0 0 6.225m1.55-4.7a.4.4 0 0 1 .15.32q-.001.09-.037.174l-.002.003q-.03.069-.067.13l-.001.002-1.527 2.424a.55.55 0 0 1-.185.173.498.498 0 0 1-.473.005.6.6 0 0 1-.191-.166l-.8-.991a.6.6 0 0 1-.085-.151.5.5 0 0 1-.032-.174.446.446 0 0 1 .647-.402.6.6 0 0 1 .172.154l.499.645 1.239-2.017c.087-.144.216-.24.386-.24q.174 0 .307.112",clipRule:"evenodd"})]})),yk=(0,js.a)((0,Te.jsx)(xk,{}));var bk=n(39638),wk=n(53334),Ck=n(85379);const Ak=({onClickOutside:e,placementLeft:t})=>{const n=(0,v.B)(),i=(0,Rh.A)((()=>{null==e||e()}));return(0,Te.jsx)("div",{"data-testid":"page-translate-same-language-notice",ref:i,className:J()(Ck.A["language-notice-wrapper"],{[Ck.A["placement-left"]]:t}),children:(0,Te.jsxs)("div",{className:Ck.A["language-notice"],children:[(0,Te.jsx)(Pe.Zx,{className:Ck.A.icon}),(0,Te.jsx)("div",{className:Ck.A.content,children:n("flow_web_ext_sidebar_translate_notify")})]})})};var Sk=n(94953);function kk(e,t){return Ek.apply(this,arguments)}function Ek(){return(Ek=(0,a.A)((function*(e,t){if((0,wo.BB)({action:"web_translatePage",loginParams:{trackMeta:{login_entrance:"float_btn"}}}))return;const{setShowLangNotice:n}=Ex.I.getState();(0,kS.Ip)({lang:e,translateService:(0,Sk.w)(t)});e===(yield(0,nC.b)((0,nC.T)()))&&n(!0)}))).apply(this,arguments)}const Tk=()=>{const{active:e}=(0,Ex.I)();return e?(0,Te.jsx)(yk,{className:tw.translateActiveIcon}):(0,Te.jsx)(bk.A,{})},Ik=e=>{const{btnListReverse:t,showLangSettings:n,showLangSettingIcon:i,shortcutText:o}=e,[s]=(0,f.Y)("translateLanguage"),[r]=(0,f.Y)("pageTranslateService"),{active:a,setActive:l,showLangNotice:c,setShowLangNotice:d}=(0,Ex.I)(),[u,h]=(0,m.useState)(!1),p=(0,v.B)(),{type:g}=(0,Tx.IF)(),[x]=(0,f.Y)("pageTranslateShowUnderline");(0,m.useEffect)((()=>{(0,kS.J7)(x)}),[x]),(0,m.useEffect)((()=>{location.href===We.$3&&(l(!0),kk(s,r))}),[]);const y=(0,m.useRef)(null),b=(0,m.useMemo)((()=>!u),[u]);return(0,Te.jsxs)("div",{className:Ck.A.wrapper,children:[(0,Te.jsx)("div",{className:J()(tw.floatBtnPanelItemTranslate),onMouseEnter:()=>{h(g===rw.u9.pdf)},onMouseLeave:()=>{h(!1)},children:(0,Te.jsxs)("div",{className:J()(tw.floatBtnPanelItemBlock,{[tw.floatBtnPanelItemBlockWithSetting]:n||i}),onClick:e=>{e.stopPropagation(),e.preventDefault(),g!==rw.u9.pdf&&((0,_e.GT)(),a?(0,kS.g$)():kk(s,r),l(!a),(0,xf.Ie)({button_name:_._h.translatePage,params:{translate_service:(0,se.TK)("pageTranslateService"),to_lang:(0,se.TK)("translateLanguage")}}))},"data-testid":"float-button-translate",children:[(0,Te.jsx)("div",{className:J()("float-button-translate-setting",tw.floatBtnPanelItemLangSettingsIcon,tw.floatBtnPanelItemIcon,{[tw.showLangSettingIcon]:n||i},{[tw.active]:n},{[tw.showLangSettingIconReverse]:t}),onClick:t=>{t.stopPropagation(),t.preventDefault(),g!==rw.u9.pdf&&((0,_e.GT)(),e.onClickSettings())},"data-testid":"float-button-translate-setting",style:{margin:t?"6px 0 0 0":"0 0 6px 0"},children:(0,Te.jsx)(wk.A,{})}),(0,Te.jsx)("div",{ref:y,className:J()(tw.floatBtnPanelItemIcon,{[tw.floatBtnPanelItemIconReverse]:t}),"data-testid":"float-button-translate-icon",children:(0,Te.jsx)(je.m_,{content:(0,Te.jsx)(sw,{text:p(u?"flow_web_ext_sidebar_translate_notice_pdfsupport":a?"flow_web_ext_sidebar_translateoff":"flow_web_ext_sidebar_translate"),hotKey:b?o:""}),position:"left",getPopupContainer:()=>y.current,className:tw.tooltipContainer,children:(0,Te.jsx)("div",{style:{lineHeight:0},children:(0,Te.jsx)(Tk,{})})})})]})}),c&&(0,Te.jsx)(Ak,{placementLeft:t,onClickOutside:()=>d(!1)})]})},jk=e=>{const{active:t}=(0,Ex.I)(),[n]=(0,f.Y)("translateLanguage"),[i]=(0,f.Y)("pageTranslateService"),[o,s]=(0,f.Y)("autoTranslatePageHosts"),a={onSetAutoTranslate:e=>{const{href:t}=window.location,n=new URL(t).hostname;s(e?[...new Set([...o,n])]:(0,Sy.A)(o,(e=>e!==n)))}},l=(0,r.A)((0,r.A)({},a),e);return(0,Cb.H)((()=>{t&&kk(n,i)}),[n,i]),(0,Te.jsx)(_k.A,(0,r.A)({},l))},Nk=()=>{const e=(0,v.B)(),{shortcutKey:t}=ts(Xo.e.CollectPage),n=gf(),i=(0,m.useMemo)((()=>n?(0,Te.jsx)(Hs,{collected:!!n,savedId:n,collectType:zt.p6.web,clickFrom:zt.vP.side_bar_popover}):(0,Te.jsx)(sw,{text:e("flow_web_ext_setting_shortcut_bookmark"),hotKey:(0,Jo.o)(t)})),[n,t]),o=(0,m.useRef)(null);return(0,Te.jsx)("div",{className:tw.toolContainer,onClick:()=>{n?ao(n,zt.vP.side_bar_popover,zt.p6.web):ro({collectionType:wn.X.Web,collectFrom:zt.vP.side_bar_popover})},"data-testid":"float-button-collect-page",ref:o,children:(0,Te.jsx)(je.m_,{content:i,position:"left",getPopupContainer:()=>o.current,children:(0,Te.jsx)("div",{className:tw.floatBtnPanelItemBlock,children:n?(0,Te.jsx)(Rs,{className:J()(tw.floatBtnPanelItemIcon,tw.floatBtnPanelItemIconCollected)}):(0,Te.jsx)(Ms.A,{className:J()(tw.floatBtnPanelItemIcon)})})})})};var Rk=n(32138),Mk=n(64815);const Pk=({onStartCapture:e})=>{const[t,n]=(0,m.useState)(!0),{open:i,setOpen:o,setReportParams:s}=(0,BS.RT)(),r=(0,v.B)(),{shortcutKey:a}=ts(Xo.e.ScreenCapture);(0,m.useEffect)((()=>{n(!i)}),[i]);const l=(0,m.useRef)(null);return(0,Te.jsx)("div",{className:tw.toolContainer,ref:l,onClick:()=>{(0,xf.Ie)({button_name:_._h.screenCapture}),(0,wo.BB)({loginParams:{trackMeta:{trackMeta:{login_entrance:"float_btn"}}}})||(n(!1),null==e||e(),s({from:"chat_side_bar"}),setTimeout((()=>o(!0)),100))},children:(0,Te.jsx)(je.m_,{position:"left",getPopupContainer:()=>l.current,style:{visibility:t?"visible":"hidden"},content:(0,Te.jsx)(sw,{text:r("flow_web_ext_sidebar_screenshot2"),hotKey:(0,Jo.o)(a)}),children:(0,Te.jsx)("span",{className:tw["screen-capture"],children:(0,Te.jsx)(Rk.A,{})})})})},Lk=e=>(0,Mk.F)("all")?(0,Te.jsx)(Pk,(0,r.A)({},e)):null,Bk=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",d:"M6.268 19q-.687 0-1.194-.323a2.2 2.2 0 0 1-.79-.844A2.4 2.4 0 0 1 4 16.673q0-.615.306-1.168l5.75-10.338q.314-.576.844-.867.529-.3 1.104-.3.574 0 1.096.292.522.291.85.875l5.744 10.33A2.4 2.4 0 0 1 20 16.674q0 .63-.284 1.16a2.14 2.14 0 0 1-.783.844Q18.426 19 17.74 19zm5.743-5.5q.798.001.843-.844l.127-3.31q.015-.43-.261-.7-.276-.276-.716-.276-.448 0-.724.269-.268.27-.246.699l.12 3.326q.044.837.857.837m0 2.781q.448 0 .746-.269a.9.9 0 0 0 .306-.706.9.9 0 0 0-.306-.707 1.07 1.07 0 0 0-.746-.269 1.1 1.1 0 0 0-.753.27.9.9 0 0 0-.306.706q0 .438.306.706.314.27.753.27"})})),Dk=(0,js.a)((0,Te.jsx)(Bk,{})),Ok="container-TLYlAD",Fk="mask-tdXKWn",Uk="modal-PZKNb0",Hk="title-xiKQNx",zk="tip-icon-L8mxi9",qk="content-h7zK8g",Vk="footer-aVwJFt",$k=({onClose:e=h.A})=>{const t=(0,v.B)();return(0,Te.jsxs)("div",{className:Ok,children:[(0,Te.jsx)("div",{className:Fk,onClick:e}),(0,Te.jsxs)("div",{className:Uk,children:[(0,Te.jsxs)("div",{className:Hk,children:[(0,Te.jsx)(Dk,{className:zk}),t("flow_web_ext_voice_input_block_website_title")]}),(0,Te.jsx)("div",{className:qk,children:t("flow_web_ext_voice_input_block_website_desc")}),(0,Te.jsxs)("div",{className:Vk,children:[(0,Te.jsx)(ea.c,{onClick:()=>{window.open("https://bytedance.larkoffice.com/wiki/GEuMwtHAiigx8okBa1scxIxHnAX"),e()},type:"quartary",children:t("flow_web_ext_view_tutorial","\u67e5\u770b\u6559\u7a0b")}),(0,Te.jsx)(ea.c,{onClick:e,children:t("flow_web_ext_voice_input_block_website_btn")})]})]})]})},Wk=()=>{(()=>{var e;const t=null===(e=(0,f.Y)("shortcutsConfig")[0])||void 0===e||null===(e=e.VoiceInput)||void 0===e?void 0:e.key;(0,m.useEffect)((()=>{if(!t)return;let e=0,n=0;const i=i=>{var o;if(!(i.metaKey||i.ctrlKey||i.altKey||(null===(o=i.key)||void 0===o?void 0:o.toLocaleLowerCase())!==t.toLocaleLowerCase()||(0,et.YD)(i.target))){const t=Date.now();if(t-n>1e3&&(e=0),n=t,e++,2===e){pn.A.emit("shortcut-combo-bb");const{active:e,setActive:t}=gk.getState();e||((0,xf.Ie)({button_name:_._h.voiceInput,params:{click_from:"bb"}}),t(!0))}}};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}}),[t])})();const{showMicPermissionTip:e,setShowMicPermissionTip:t,setActive:n}=gk();return(0,Te.jsx)(Te.Fragment,{children:e&&(0,Te.jsx)($k,{onClose:()=>{n(!1),t(!1)}})})},Kk=()=>{var e,t;const n=null===(e=(0,f.Y)("authInfo")[0])||void 0===e?void 0:e.isAuthenticated;return(null===(t=(0,As.A)("voice_input"))||void 0===t?void 0:t.enabled)&&n?(0,Te.jsx)(Wk,{}):null};var Yk=n(17837);const Gk="container-nCITyG",Qk="dot-L5nRGf",Zk=({className:e,mode:t="mute",themeColor:n="var(--primary-50, #0066ff)"})=>(0,Te.jsx)("div",{className:J()(Gk,e),"data-mode":t,children:Array.from({length:3}).map(((e,t)=>(0,Te.jsx)("span",{className:Qk,style:{backgroundColor:n}},t)))});class Xk extends jd.A{constructor(){var e;super(),e=this,(0,y.A)(this,"sendMessageId",""),(0,y.A)(this,"receiveMessageId",""),(0,y.A)(this,"sseId",""),(0,y.A)(this,"latestTTSContent",""),(0,y.A)(this,"ttsInstance",null),(0,y.A)(this,"ttsContentQueue",[]),(0,y.A)(this,"messageReceiveEnd",!1),(0,y.A)(this,"firstMessageDone",!1),(0,y.A)(this,"ttsPaused",!1),(0,y.A)(this,"messageMode","web-im"),(0,y.A)(this,"checkSidePanelOpen",(0,a.A)((function*(){if(!Co.l.getState().isSidePanelMode)return e.messageMode="web-im",!1;const t=yield Promise.race([(0,jn.cs)("check-side-panel-open"),new Promise((e=>setTimeout((()=>e({success:!1})),1e3)))]),n=t.success&&t.data;return e.messageMode=n?"sidepanel-im":"web-im",n}))),(0,y.A)(this,"start",function(){var t=(0,a.A)((function*(t){e.reset(),e.emit("msg-send-start");const n=yield e.checkSidePanelOpen();pn.A.on("im-message-send-end",e.onMessageSent),pn.A.on("im-message-update",e.onMessageUpdate),pn.A.on("im-message-receive-end",e.onMessageEnd),n?Wy(t):(0,ew.C)([$y(t)],{chatType:(0,Jt.IK)().convType,botType:"Main"}),(0,Ke.s)("send_message",{current_page:(0,It.M5)(location.href),scene:"sidebar_action_popover",sec_scene:"sidebar_voice_input",has_voice_output:1,web_url:window.location.hostname})}));return function(e){return t.apply(this,arguments)}}()),(0,y.A)(this,"onMessageSent",(({message:e})=>{this.sendMessageId=(null==e?void 0:e.message_id)||"",this.ttsInstance=new lb.L,this.ttsInstance.stopAllOtherAudios(),this.ttsInstance.onFirstPlayStart((()=>{(0,ar.Rm)("[lwx] tts play start"),this.emit("tts-play-start")})),this.ttsInstance.onPlayEnd((e=>{const t=e||0!==this.ttsContentQueue.length?"queue-not-empty":"";(0,ar.Rm)("[lwx] tts play end, reason: ",t),this.emit("tts-play-end",t)})),this.emit("msg-send-end"),"sidepanel-im"===this.messageMode&&(this.sseId=this.createSseRequest(this.sendMessageId)),(0,Ke.s)("send_message_status",{success:1,current_page:(0,It.M5)(location.href),scene:"sidebar_action_popover",sec_scene:"sidebar_voice_input",has_voice_output:1,web_url:window.location.hostname})})),(0,y.A)(this,"createSseRequest",(e=>{if(!e)return"";const t={req:{url:`${bn.Jk}/message/stream_reply`,body:{reply_id:e,binary_type:"pb",seq_st:1}}};return Ab.B.fetch(t,{onUpdate:e=>{var t,n;null!==(t=e.body)&&void 0!==t&&t.message&&(pn.A.off("im-message-update"),pn.A.off("im-message-receive-end"),this.onMessageUpdate({message:null===(n=e.body)||void 0===n?void 0:n.message,from:"internal"}))},onDone:e=>{var t;this.onMessageEnd({message:null===(t=e.body)||void 0===t?void 0:t.message,from:"internal"})}})})),(0,y.A)(this,"onMessageUpdate",(0,T.A)((({message:e})=>{if(e&&e.reply_id===this.sendMessageId&&e.tts_content){const{tts_content:n="",message_id:i=""}=e;if(!n)return;var t;if(this.receiveMessageId=i,this.firstMessageDone)this.emit("msg-receive-update");else this.firstMessageDone=!0,this.stopAllAudios(),null===(t=this.ttsInstance)||void 0===t||t.play(),this.emit("msg-receive-first"),"web-im"===this.messageMode&&setTimeout((()=>(0,jn.cs)("refresh-latest-message")),5e3);const o=n.substring(this.latestTTSContent.length);null!=o&&o.trim()&&(this.ttsContentQueue.push(o),this.latestTTSContent=n,this.throttlePlayTTS()),this.debouncedOnMessageEnd()}}),500)),(0,y.A)(this,"handleMessageEnd",(()=>{if(!this.messageReceiveEnd){var e;if((0,ar.Rm)("[lwx] message receive end"),this.messageReceiveEnd=!0,!this.ttsContentQueue.length)(0,ar.Rm)("[lwx] tts send finish text 2"),null===(e=this.ttsInstance)||void 0===e||e.finishSendingText();this.emit("msg-receive-end")}})),(0,y.A)(this,"debouncedOnMessageEnd",(0,Is.A)((()=>this.handleMessageEnd()),1e4)),(0,y.A)(this,"onMessageEnd",(({message:e})=>{(null==e?void 0:e.reply_id)===this.sendMessageId&&this.handleMessageEnd()})),(0,y.A)(this,"throttlePlayTTS",(0,T.A)((()=>{if(this.ttsContentQueue.length&&!this.ttsPaused){var e;const n=this.ttsContentQueue.join("");var t;if(null===(e=this.ttsInstance)||void 0===e||e.readText(n).catch((e=>(0,ar.z3)(e))),this.ttsContentQueue=[],this.messageReceiveEnd)(0,ar.Rm)("[lwx] tts send finish text 1"),null===(t=this.ttsInstance)||void 0===t||t.finishSendingText()}}),1e3,{leading:!0,trailing:!0})),(0,y.A)(this,"stopAllAudios",(()=>{(0,jn.cs)({name:uk.lO,body:{id:""}})})),(0,a.A)((function*(){Co.l.getState().isSidePanelMode&&!(yield e.checkSidePanelOpen())&&(yield(0,vf.EE)(),Cf.O.initMessageProtocolService())}))()}resumeTTS(){var e;this.ttsPaused=!1,null===(e=this.ttsInstance)||void 0===e||e.play(),this.throttlePlayTTS()}pauseTTS(){var e;this.ttsPaused=!0,null===(e=this.ttsInstance)||void 0===e||e.pause()}stopTTS(){var e,t,n,i,o;null===(e=this.ttsInstance)||void 0===e||e.onPlayEnd(h.A),null===(t=this.ttsInstance)||void 0===t||t.onFirstPlayStart(h.A),null===(n=this.ttsInstance)||void 0===n||n.finishSendingText(),null===(i=this.ttsInstance)||void 0===i||i.pause(),null===(o=this.ttsInstance)||void 0===o||o.stop(),this.ttsInstance=null}reset(){var e,t;this.stopTTS(),null===(e=(t=this.debouncedOnMessageEnd).cancel)||void 0===e||e.call(t),pn.A.off("im-message-send-end"),pn.A.off("im-message-update"),pn.A.off("im-message-receive-end"),this.sseId&&Ab.B.abort(this.sseId,"cancel request"),this.ttsContentQueue=[],this.sendMessageId="",this.receiveMessageId="",this.latestTTSContent="",this.messageReceiveEnd=!1,this.ttsPaused=!1,this.firstMessageDone=!1,this.sseId=""}}var Jk=n(12898),eE=n(964),tE=n(36245);const nE=e=>`on-open-${e}`,iE=e=>`on-message-${e}`,oE=e=>`on-error-${e}`,sE=e=>`on-close-${e}`;const rE=new class{constructor(){(0,y.A)(this,"port",null),(0,y.A)(this,"emitter",new jd.A),(0,y.A)(this,"handleMessage",(e=>{const{id:t,action:n,data:i}=e||{};switch(n){case"open":this.emitter.emit(nE(t),i);break;case"message":this.emitter.emit(iE(t),i);break;case"error":this.emitter.emit(oE(t),i);break;case"close":this.emitter.emit(sE(t),i)}}))}getPort(){return this.port||(this.port=(0,tE.c)("websocket"),this.port.onMessage.addListener(this.handleMessage)),this.port}connect(e,t){const n=this.getPort(),i=t.id||(0,yn.AP)();return n.postMessage({body:{id:i,action:"init",data:e}}),t.onOpen&&this.emitter.on(nE(i),t.onOpen),t.onMessage&&this.emitter.on(iE(i),t.onMessage),t.onClose&&this.emitter.on(sE(i),t.onClose),t.onError&&this.emitter.on(oE(i),t.onError),i}sendMessage(e,t){var n;null===(n=this.port)||void 0===n||n.postMessage({body:{id:e,action:"message",data:t}})}close(e){var t;null===(t=this.port)||void 0===t||t.postMessage({body:{id:e,action:"close"}})}reconnect(e){var t;null===(t=this.port)||void 0===t||t.postMessage({body:{id:e,action:"reconnect"}})}};var aE=n(9144);class lE extends jd.A{constructor(e){super(),(0,y.A)(this,"config",void 0),(0,y.A)(this,"wsId",""),(0,y.A)(this,"readyState",0),(0,y.A)(this,"createWsSession",(()=>{var e;this.wsId=rE.connect({url:(0,Wr.ID)(Jk.ZW,(0,r.A)({},null===(e=this.config)||void 0===e?void 0:e.commonParams))},{onOpen:()=>{this.readyState=1,this.emit(Jk.jc.ON_OPEN)},onMessage:e=>{this.emit(Jk.jc.ON_MESSAGE,e)},onError:()=>{this.readyState=2,this.emit(Jk.jc.ON_ERROR)},onClose:()=>{this.readyState=3,this.emit(Jk.jc.ON_CLOSE)}})})),(0,y.A)(this,"sendWsMessage",(e=>{e instanceof Uint8Array?rE.sendMessage(this.wsId,Array.from(e)):rE.sendMessage(this.wsId,e)})),(0,y.A)(this,"closeWsSession",(()=>{rE.close(this.wsId)})),(0,y.A)(this,"isSocketOnOpen",(()=>Promise.resolve(1===this.readyState))),this.config=e}}class cE extends jd.A{constructor(...e){super(...e),(0,y.A)(this,"service",null)}createService(){const e=(0,r.A)((0,r.A)({},(0,aE.wH)()),{},{format:"pcm"}),t=new lE({commonParams:e});return this.service=new eE.default({wsConfig:{commonParams:e,onWsConnectInvalidCode:e=>this.emit("invalid-code",e)},audioWorklet:!0,wsProxy:t,onPermissionDenied:()=>this.emit("permission-denied")}),(0,u.A)((()=>{var e;return null===(e=this.service)||void 0===e?void 0:e.destroyAsr()})),this.service}getService(){return this.service||this.createService(),this.service}}const dE=new cE,uE={comp:"comp-MRp5ht","recording-mode":"recording-mode-LX4Nw9",recordingMode:"recording-mode-LX4Nw9","hover-close-btn":"hover-close-btn-JYxLAJ",hoverCloseBtn:"hover-close-btn-JYxLAJ","text-container":"text-container-IQsXGE",textContainer:"text-container-IQsXGE","icon-actions":"icon-actions-gvduL3",iconActions:"icon-actions-gvduL3","asr-text":"asr-text-RIbNQX",asrText:"asr-text-RIbNQX","icon-btn":"icon-btn-RkPwOb",iconBtn:"icon-btn-RkPwOb","audio-playing":"audio-playing-wel5qa",audioPlaying:"audio-playing-wel5qa"};var hE=function(e){return e.INIT="init",e.WAIT_INPUT="wait_input",e.RECORDING="recording",e.VOICE_SENDING_MSG="voice_sending_msg",e.VOICE_WAITING_TEXT="voice_waiting_text",e.VOICE_SPEAKING="voice_speaking",e.VOICE_SPEAKING_PAUSED="voice_speaking_paused",e.TEXT_GENERATING="text_generating",e.ASR_PERMISSION_DENIED="asr_permission_denied",e}(hE||{});const mE=e=>[hE.VOICE_SENDING_MSG,hE.VOICE_WAITING_TEXT,hE.VOICE_SPEAKING,hE.VOICE_SPEAKING_PAUSED].includes(e),pE=({onExit:e})=>{var t;const n=(0,v.B)(),{setActive:i}=gk(),[o,s]=(0,m.useState)(hE.WAIT_INPUT),r=null===(t=(0,f.Y)("shortcutsConfig")[0])||void 0===t||null===(t=t.VoiceInput)||void 0===t?void 0:t.key,[a,l]=(0,m.useState)(""),c=(0,m.useRef)(a),d=(0,m.useRef)(o),u=(0,m.useRef)(0),h=(0,m.useRef)(0),p=(0,m.useRef)(),g=(0,m.useRef)(),_=(0,m.useRef)({}),[x,y]=(0,f.Y)("voiceInputShortcutTipShown");c.current=a,d.current=o;const b=()=>{var e,t,n;C(),s(hE.WAIT_INPUT),l(""),null===(e=g.current)||void 0===e||e.stopAllAudios(),null===(t=g.current)||void 0===t||t.reset(),null===(n=p.current)||void 0===n||n.startAsr()},w=()=>{var e,t;A(),null===(e=p.current)||void 0===e||e.stopAsr(),null===(t=g.current)||void 0===t||t.stopTTS()};(0,m.useEffect)((()=>(p.current=dE.getService(),g.current=new Xk,g.current.on("msg-send-start",(()=>s(hE.VOICE_WAITING_TEXT))),g.current.on("tts-play-start",(()=>{s(hE.VOICE_SPEAKING),(0,Ke.s)("voice_output_show",{current_page:(0,It.M5)(location.href)})})),g.current.on("tts-play-end",(e=>{switch(e){case"queue-not-empty":case"interrupted":case"error":S();break;default:b()}})),dE.on("permission-denied",(()=>{gk.getState().setShowMicPermissionTip(!0),s(hE.ASR_PERMISSION_DENIED)})),dE.on("invalid-code",(e=>{(0,ar.Rm)("[lwx] asr service invalid code: ",e),s(hE.INIT),l(""),w(),h.current=setTimeout((()=>{b()}),2e3)})),pn.A.on("shortcut-combo-bb",(()=>{mE(d.current)&&(w(),b())})),b(),()=>{var e;w(),dE.removeAllListeners(),null===(e=g.current)||void 0===e||e.removeAllListeners(),pn.A.off("shortcut-combo-bb"),clearTimeout(u.current),clearTimeout(h.current)})),[]);const C=()=>{var e,t,n;A(),_.current.result=null===(e=p.current)||void 0===e?void 0:e.getAsrMessageSubscription().subscribe((e=>{null!=e&&e.trim()&&(c.current=e,l(e),s(hE.RECORDING),!x&&y(!0))})),_.current.status=null===(t=p.current)||void 0===t?void 0:t.getAsrStatusSubscription().subscribe((e=>{e===Yk.rE.RECORDING&&s(hE.WAIT_INPUT)})),_.current.volume=null===(n=p.current)||void 0===n?void 0:n.getAudioVolumeSubscription().subscribe((e=>{e>=.04?(clearTimeout(u.current),u.current=0,s(hE.RECORDING)):u.current=u.current||setTimeout((()=>{var e;(u.current=0,c.current)?(w(),s(hE.VOICE_SENDING_MSG),null===(e=g.current)||void 0===e||e.start(c.current)):s(hE.WAIT_INPUT)}),1500)}))},A=()=>{var e,t,n;_.current&&(null===(e=_.current.result)||void 0===e||e.unsubscribe(),null===(t=_.current.volume)||void 0===t||t.unsubscribe(),null===(n=_.current.status)||void 0===n||n.unsubscribe())},S=()=>{i(!1),null==e||e(),w(),clearTimeout(u.current),clearTimeout(h.current)};return(0,Te.jsx)("div",{className:uE.comp,children:mE(o)?o===hE.VOICE_SPEAKING_PAUSED?(0,Te.jsxs)("div",{className:uE["icon-actions"],children:[(0,Te.jsx)(ve.A,{className:uE["icon-btn"],onClick:()=>{(0,Ke.s)("voice_output_click",{button_name:"close",current_page:(0,It.M5)(location.href)}),S()}}),(0,Te.jsx)(JS,{className:uE["icon-btn"],onClick:()=>{var e;(0,Ke.s)("voice_output_click",{button_name:"continue",current_page:(0,It.M5)(location.href)}),null===(e=g.current)||void 0===e||e.resumeTTS(),s(hE.VOICE_SPEAKING)}})]}):(0,Te.jsx)("div",{className:uE["audio-playing"],onClick:()=>{var e;(0,Ke.s)("voice_output_click",{button_name:"pause",current_page:(0,It.M5)(location.href)}),null===(e=g.current)||void 0===e||e.pauseTTS(),s(hE.VOICE_SPEAKING_PAUSED)},children:[hE.VOICE_SENDING_MSG,hE.VOICE_WAITING_TEXT].includes(o)?(0,Te.jsx)(Do.L,{size:20}):(0,Te.jsx)(Oo.d,{size:20})}):(0,Te.jsxs)("div",{className:uE["recording-mode"],children:[(0,Te.jsxs)("div",{className:uE["text-container"],children:[o===hE.WAIT_INPUT&&(0,Te.jsx)("span",{children:x||!r?n("flow_web_ext_voice_input_tip"):n("flow_web_ext_voice_input_shortkey_tip",{shortcutKey:r})}),o===hE.RECORDING&&a?(0,Te.jsxs)("span",{className:uE["asr-text"],children:[a,"\u200e"]}):null]}),(0,Te.jsx)(Zk,{mode:(()=>{switch(o){case hE.TEXT_GENERATING:return"loading";case hE.RECORDING:return"active";default:return"mute"}})(),className:uE["tip-icon"]}),(0,Te.jsx)(ve.A,{className:J()(uE["icon-btn"],uE["hover-close-btn"]),onClick:S})]})})};var gE=n(8391),vE=n(80556);const fE={dot:"dot-CShR0Q"};function _E(e){const{className:t,children:n}=e,i=(0,vE.A)();return null!=i&&i.version&&(i.version===i.dotVisibleVersion||i.version===i.cardVisibleVersion)||null==i||!i.data?null:(0,Te.jsxs)("div",{className:J()(fE.badge,t),children:[n,(0,Te.jsx)("span",{className:fE.dot})]})}const xE=e=>-e*window.innerHeight,yE={startX:0,startY:0,threshold:6,startT:0,start(e,t){this.startX=e,this.startY=t,(0,ar.Rm)("[Daniel] floatBtn pos",e,t),this.startT=Date.now()},isValid(e,t){const n=e-this.startX,i=t-this.startY;return Math.sqrt(n*n+i*i)>this.threshold&&Date.now()-this.startT>300}};function bE(e){const[t,n]=(0,f.Y)("sidebarButtonTop"),[i,o]=(0,m.useState)(!1),[s,r]=(0,m.useState)(!1),[a,l]=(0,m.useState)(!1),[c,d]=(0,m.useState)(!1),[u,h]=(0,m.useState)(!1),[p,g]=(0,m.useState)(!1),{ttsReadPageEnabled:v}=(0,As.A)("tts"),x=(0,Co.l)((e=>e.setIsShowSidebarBtn)),{shortcutKey:y}=ts(Xo.e.OpenSide),{shortcutKey:b}=ts(Xo.e.TranslatePage),{active:w}=gk((e=>({active:e.active}))),{active:C}=PS((e=>({active:e.active}))),{active:A}=(0,Ex.I)((e=>({active:e.active}))),S=s,k=A,E=S||k,I=490-window.innerHeight,j=42-window.innerHeight,{anchor:N,target:R,setPosition:M}=$A({direction:"both",onStart(e,t){const[n,i]=t;yE.start(n,i)},onMove(e,t){const[n,i]=t;yE.isValid(n,i)&&(o(!0),d(!1),l(!1),g(!1))},onEnd(e,t){const i=-t[1]/window.innerHeight;const s=qA(xE(i),[j,0]);n(i),M([0,s]),h(s<I),(0,KS.A)((()=>o(!1)))},maxDistance:{y:{min:j,max:0}},onClickLike:()=>{i||((0,_e.GT)(),Co.l.getState().toggleShowSidebar(_.cz.clickSidebar),(0,gE.sw)(),(0,xf.pM)({click_from:"chat_entrance"}))}});(0,m.useEffect)((()=>{(0,xf.oJ)()}),[]),(0,m.useEffect)((()=>{!i&&S&&((0,xf.jv)(),(0,ot.ku)()&&(0,zt.ae)(zt.vP.side_bar_popover,zt.p6.web))}),[i,S]),(0,m.useLayoutEffect)((()=>{const e=()=>{const e=qA(xE(t),[j,0]);M([0,e]),h(e<I)};e();const n=(0,T.A)(e,100);return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}}),[j,t]);const P=!i&&E&&!a&&!c||c,L=function(e,t,n){const[i,o]=(0,m.useState)([]);return(0,m.useEffect)((()=>{let i;return n&&(o([e]),i=setTimeout((()=>o([e,t])),50)),()=>{clearTimeout(i),o([])}}),[n]),i}(tw.show,tw.expand,P),B=P?L:[],D=(0,m.useRef)(null);return(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)("div",{ref:R,style:e.isSidebarShow?{[e.align]:bn.gH}:{},className:J()(tw.floatBtn,{[tw.left]:"left"===e.align,[tw.right]:"right"===e.align}),children:(0,Te.jsxs)("div",{className:J()(tw.floatBtnWrapper,{[tw.reverse]:u}),onMouseLeave:()=>r(!1),children:[!i&&c&&!a&&(0,Te.jsx)(jk,{onVisibleChange:(e,t)=>{var n;const i=null==t||null===(n=t.composedPath)||void 0===n?void 0:n.call(t);null!=i&&i.some((e=>{var t;return e===(null===(t=R.current)||void 0===t?void 0:t.querySelector(".float-button-translate-setting"))}))||d(e)},reverse:u}),i||w||C?null:(0,Te.jsx)("div",{style:{width:40,display:"flex",justifyContent:"end"},children:(0,Te.jsxs)("div",{"data-role":"float-button-list",className:J()(tw.floatBtnList,[...B]),style:{flexDirection:u?"column-reverse":"column"},children:[(0,Te.jsx)(Ik,{btnListReverse:u,showLangSettingIcon:k,showLangSettings:c,onClickSettings:()=>{(0,xf.Ie)({button_name:_._h.languageSettings}),d(!c)},shortcutText:(0,Jo.o)(b)}),!S&&k?null:(0,Te.jsxs)(Te.Fragment,{children:[(0,Te.jsx)(je.cG,{className:tw.toolDivider}),(0,Te.jsxs)("div",{className:tw["common-feature-actions"],style:{flexDirection:u?"column-reverse":"column"},children:[(0,Te.jsx)(cw,{}),(0,Te.jsx)(Lk,{onStartCapture:()=>r(!1)}),(0,ot.ku)()&&(0,Te.jsx)(Nk,{}),v?(0,Te.jsx)(ZS,{}):null,(0,Te.jsx)(fk,{})]})]})]})}),!i&&w?(0,Te.jsx)(pE,{onExit:()=>r(!1)}):null,!i&&C?(0,Te.jsx)(hk,{onExit:()=>r(!1)}):null,(0,Te.jsxs)("div",{ref:D,"data-testid":"float-button-brand-entry",className:J()(tw.floatBtnBrand,{[tw.expand]:!i&&E||a}),children:[(0,Te.jsx)(xe.A,{className:J()(tw.closeBtn,{[tw.closeBtnExpand]:!i&&E}),optionPageSection:"sidebar",position:u?"bottomRight":"topRight",disableKey:os.lf.chatAssistant,onDisableOnceClick:()=>x(!1),show:a,setShow:l,renderChildren:({onTriggerClick:e})=>(0,Te.jsx)(Pe.gz,{className:tw.floatBtnCloseIcon,onClick:t=>{t.preventDefault(),t.stopPropagation(),a?l(!a):e(t)}})}),(0,Te.jsx)(je.m_,{visible:Boolean(p&&y),trigger:"custom",className:tw.shortcut,content:(0,Jo.o)(y),position:"left",getPopupContainer:()=>D.current,children:(0,Te.jsx)("img",{ref:N,src:(0,fs.Nf)(),className:tw.floatBtnAvatar,onMouseEnter:()=>{r(!0),g(!0)},onMouseLeave:()=>{g(!1)}})}),(0,Te.jsx)(_E,{})]})]})}),(0,Te.jsx)(Kk,{})]})}const wE="wrapper-Vi_cs1",CE=()=>{var e,t;const{actionMessages:n,currentAction:i,messageCursor:o,inputText:s}=(0,qt.t_)(),r=(0,An.P)((e=>e.messages)),a=null!==(t=(null!==(e=n[i])&&void 0!==e?e:[])[o])&&void 0!==t?t:"",{text:l=""}=r[a]||{},{value:c}=(0,Kr.Tu)(Kr.FM.searchCardAutoSummary,!0),d=(0,m.useRef)(s),u=d.current;return(0,m.useEffect)((()=>{s&&(d.current=s)}),[s]),(0,Jr.s)()?(0,Te.jsxs)("div",{className:wE,children:[(0,Te.jsx)("input",{type:"hidden","data-testid":"e2e-meta-runtime-state-input-text",value:u}),(0,Te.jsx)("input",{type:"hidden","data-testid":"e2e-meta-runtime-state-current-action",value:i}),(0,Te.jsx)("input",{type:"hidden","data-testid":"e2e-meta-runtime-state-search-card-auto-summary",value:c.toString()}),(0,Te.jsx)("input",{type:"hidden","data-testid":"e2e-meta-runtime-state-enable-collection",value:(0,ot.ku)().toString()}),(0,Te.jsx)("textarea",{readOnly:!0,value:Ty(l),"data-testid":"e2e-meta-runtime-state-message"})]}):null};var AE=n(88225),SE=n(39649);const kE="container-d0TwYv",EE="mask-EdK1hp",TE="frame-lkPH7k",IE="anchor-dnIPwm",jE="coordinates-y_TcZ_";var NE=function(e){return e.leftTop="lt",e.top="t",e.rightTop="rt",e.left="l",e.right="r",e.leftBottom="lb",e.bottom="b",e.rightBottom="rb",e}(NE||{});const RE=[{left:0,top:0,pos:NE.leftTop,cursor:"nwse-resize"},{left:50,top:0,pos:NE.top,cursor:"ns-resize"},{left:100,top:0,pos:NE.rightTop,cursor:"nesw-resize"},{left:0,top:50,pos:NE.left,cursor:"ew-resize"},{left:100,top:50,pos:NE.right,cursor:"ew-resize"},{left:0,top:100,pos:NE.leftBottom,cursor:"nesw-resize\t"},{left:50,top:100,pos:NE.bottom,cursor:"ns-resize"},{left:100,top:100,pos:NE.rightBottom,cursor:"nwse-resize\t"}],ME=({className:e,onCaptureAreaUpdate:t=h.A,onStart:n=h.A,onStop:i=h.A})=>{const[o,s]=(0,m.useState)({left:-100,top:-100,width:0,height:0}),a=(0,m.useRef)(null),l=(0,m.useRef)(null);(0,m.useEffect)((()=>{const e=a.current,{innerHeight:c,innerWidth:d}=window;let u=!1,h=!1,m={left:-1,top:-1},p=o,g="create",v=null,f=(0,jh.A)(n);const _=e=>{if(e.stopPropagation(),e.preventDefault(),u=!0,g=e.target.getAttribute("data-mode")||"",v=e.target.getAttribute("data-pos"),m={left:e.clientX,top:e.clientY},"adjust"===g)switch(v){case NE.leftTop:m={left:p.left+p.width,top:p.top+p.height};break;case NE.rightTop:m={left:p.left,top:p.top+p.height};break;case NE.leftBottom:m={left:p.left+p.width,top:p.top};break;case NE.rightBottom:m={left:p.left,top:p.top};break;case NE.left:m.left=p.left+p.width;break;case NE.right:m.left=p.left;break;case NE.top:m.top=p.top+p.height;break;case NE.bottom:m.top=p.top}f=(0,jh.A)(n)},x=e=>{if(!u)return;e.stopPropagation(),e.preventDefault(),h=!0;const{clientX:n,clientY:i}=e;if("move"===g){const e=n-m.left,t=i-m.top;m.left=n,m.top=i,p=(0,r.A)((0,r.A)({},p),{},{left:(0,SE.A)(p.left+e,0,d-p.width),top:(0,SE.A)(p.top+t,0,c-p.height)})}else if("create"===g||"adjust"===g&&[NE.leftTop,NE.leftBottom,NE.rightBottom,NE.rightTop].includes(v)){const e=Math.abs(n-m.left),t=Math.abs(i-m.top),o=Math.min(n,m.left),s=Math.min(i,m.top);p={left:o,top:s,width:e,height:t}}else if("adjust"===g)if([NE.left,NE.right].includes(v)){const e=Math.abs(n-m.left),t=Math.min(n,m.left);p=(0,r.A)((0,r.A)({},p),{},{left:t,width:e})}else if([NE.bottom,NE.top].includes(v)){const e=Math.abs(i-m.top),t=Math.min(i,m.top);p=(0,r.A)((0,r.A)({},p),{},{top:t,height:e})}var o;f(),s(o=p),t(o)},y=()=>{u&&h&&i(p),u=!1,h=!1,g=""},b=t=>{t.stopPropagation();const{clientX:n,clientY:i}=t,o=t.target===e;var s,r;l.current&&(!o||"create"!==g&&""!==g?l.current.style.visibility="hidden":(l.current.style.left=`${n+4}px`,l.current.style.top=`${i+4}px`,l.current.style.visibility="visible",l.current.innerHTML=`${null===(s=t.clientX)||void 0===s?void 0:s.toLocaleString()}<br/>${null===(r=t.clientY)||void 0===r?void 0:r.toLocaleString()}`))},w=()=>{l.current&&(l.current.style.visibility="hidden")};return e.addEventListener("pointerdown",_),e.addEventListener("pointermove",x),e.addEventListener("pointerup",y),e.addEventListener("mousemove",b),e.addEventListener("mouseout",w),window.addEventListener("pointerup",y),window.addEventListener("mouseout",w),()=>{e.removeEventListener("pointerdown",_),e.removeEventListener("pointermove",x),e.removeEventListener("pointerup",y),e.removeEventListener("mousemove",b),e.removeEventListener("mouseout",w),window.removeEventListener("pointerup",y),window.removeEventListener("mouseout",w)}}),[]);const c=window.innerWidth,d=window.innerHeight;return(0,Te.jsxs)("div",{ref:a,className:J()(kE,e),"data-mode":"create",onMouseDown:e=>e.stopPropagation(),children:[(0,Te.jsx)("svg",{width:"100%",height:"100%",viewBox:`0 0 ${c} ${d}`,xmlns:"http://www.w3.org/2000/svg",className:EE,children:(0,Te.jsx)("path",{d:`M0,0L0,${d}L${c},${d}L${c},0Z M${o.left},${o.top}L${o.left+o.width},${o.top}L${o.left+o.width},${o.top+o.height}L${o.left},${o.top+o.height}Z`,fill:"black",fillOpacity:.5})}),(0,Te.jsx)("div",{"data-mode":"move",className:TE,style:(0,r.A)({},o),children:RE.map((e=>(0,Te.jsx)("i",{"data-mode":"adjust","data-pos":e.pos,className:IE,style:{left:`${e.left}%`,top:`${e.top}%`,cursor:e.cursor}},e.pos+e.cursor)))}),(0,Te.jsx)("div",{ref:l,className:jE})]})},PE=({text:e,getPopupContainer:t})=>{const n={click_from:zt.vP.extract_text_card,collect_type:zt.p6.ExtractText},{collectionIcon:i,onCollectionClick:o,collected:s,collectionId:a}=Bs((0,r.A)({getCollectionParam:()=>({collectFrom:zt.vP.extract_text_card,collectionType:wn.X.CustomSkillResult,ocr_result:{text:e}})},n));return(0,m.useEffect)((()=>{(0,zt.ae)(zt.vP.extract_text_card,zt.p6.ExtractText)}),[]),(0,Te.jsx)(zd.S,{"data-testid":"select-output-panel-collect-operation",tooltip:(0,Te.jsx)(Hs,{collected:s,savedId:a,collectType:n.collect_type,clickFrom:n.click_from}),icon:i,onClick:o,getPopupContainer:t})},LE=e=>(0,ot.ku)()?(0,Te.jsx)(PE,(0,r.A)({},e)):null,BE={"cici-ext-container":"cici-ext-container-Dq2w9A",ciciExtContainer:"cici-ext-container-Dq2w9A","inactivelink-hover-animation":"inactivelink-hover-animation-QGpF_H",inactivelinkHoverAnimation:"inactivelink-hover-animation-QGpF_H","notactivelink-hover-animation":"notactivelink-hover-animation-fdMUJF",notactivelinkHoverAnimation:"notactivelink-hover-animation-fdMUJF","light-click-animation":"light-click-animation-CVVLO0",lightClickAnimation:"light-click-animation-CVVLO0","click-animation":"click-animation-kWsXpj",clickAnimation:"click-animation-kWsXpj","semi-animation-rotate":"semi-animation-rotate-_6KR4W",semiAnimationRotate:"semi-animation-rotate-_6KR4W","inactive-btn-hover-animation":"inactive-btn-hover-animation-mopGqZ",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-mopGqZ","cici-ext-always-dark":"cici-ext-always-dark-qI5Prz",ciciExtAlwaysDark:"cici-ext-always-dark-qI5Prz","cici-ext-always-light":"cici-ext-always-light-iOOGJ7",ciciExtAlwaysLight:"cici-ext-always-light-iOOGJ7",ellipsis:"ellipsis-_mAe_j",popover:"popover-zZmrIr","ocr-box":"ocr-box-gg4_r9",ocrBox:"ocr-box-gg4_r9",header:"header-yS3A16","close-btn":"close-btn-VYf25M",closeBtn:"close-btn-VYf25M",title:"title-dj8hTD","extract-text":"extract-text-K9EYSj",extractText:"extract-text-K9EYSj",footer:"footer-xzZ1pJ","left-actions":"left-actions-cur57n",leftActions:"left-actions-cur57n","right-actions":"right-actions-OEW2fB",rightActions:"right-actions-OEW2fB","activelink-hover-animation":"activelink-hover-animation-q0P9Eg",activelinkHoverAnimation:"activelink-hover-animation-q0P9Eg"},DE=({onContentUpdate:e})=>{const t=(0,m.useRef)(null),[n,i]=(0,m.useState)(""),{captures:o,getCaptureText:s,captureBlob:r}=(0,BS.RT)(),{texts:l=[],isDone:c,isError:d}=o[n]||{},u=!c&&!d;(0,m.useEffect)((()=>{l.length&&(null==e||e())}),[l]),(0,m.useEffect)((()=>{const e=s({blob:r});i(e||"")}),[r]);const h=(0,v.B)(),p=function(){var e=(0,a.A)((function*(){BS.RT.getState().setOCRBoxVisible(!1),Co.l.getState().setIsShowSidebar(!0,_.cz.screenCapture),yield(0,ko.Z)(),yield Wy(l.join("\n"))}));return function(){return e.apply(this,arguments)}}(),g=!u&&!d;return(0,Te.jsxs)("div",{className:BE["ocr-box"],ref:t,children:[(0,Te.jsxs)("div",{className:BE.header,children:[(0,Te.jsx)("div",{className:BE.title,children:h("flow_web_ext_screenshot_action_extract_title")}),un()?(0,Te.jsx)(ve.A,{className:BE["close-btn"],onClick:()=>{BS.RT.getState().setOCRBoxVisible(!1)}}):null]}),(0,Te.jsx)(je.EA,{active:!0,loading:u,placeholder:(0,Te.jsx)(je.EA.Paragraph,{rows:2}),className:BE["extract-text"],children:(0,Te.jsx)("div",{className:BE["extract-text"],children:d?(0,Te.jsx)($u,{type:"fail",onRetry:()=>{s({id:n,blob:r})}}):l.map((e=>(0,Te.jsx)("div",{children:e},e)))})}),g&&(0,Te.jsxs)("div",{className:BE.footer,children:[(0,Te.jsx)("div",{className:BE["left-actions"],children:(0,Te.jsx)(ea.c,{type:"quartary",icon:(0,Te.jsx)(ng.A,{}),size:"small",onClick:p,children:h("flow_web_ext_screenshot_action_ask",{brandName:(0,fs.L2)()})})}),(0,Te.jsxs)("div",{className:BE["right-actions"],children:[(0,Te.jsx)(LE,{text:l.join("\n"),getPopupContainer:()=>t.current}),(0,Te.jsx)(Oy.A,{className:BE["copy-btn"],onCopyClick:()=>Gt()(l.join("\n")),tooltip:h("flow_ext_web_general_copy"),successTooltip:h("flow_web_ext_general_copied")})]})]})]})},OE=()=>{var e;const[t,n]=(0,m.useState)(0),{setOCRBoxVisible:i,cursorPosition:o}=(0,BS.RT)(),s=null===(e=(0,m.useContext)(as.A))||void 0===e?void 0:e.getPopupContainer,r=(0,Rh.A)((()=>{i(!1)})),a=(0,Te.jsx)("div",{ref:r,children:(0,Te.jsx)(DE,{onContentUpdate:()=>n(Math.random())})}),l=Math.max(o.clientY-48,16)+window.scrollY;return(0,Te.jsx)(je.AM,{visible:!0,trigger:"custom",content:a,rePosKey:t,autoAdjustOverflow:!0,getPopupContainer:s,onVisibleChange:e=>{i(e)},className:BE.popover,children:(0,Te.jsx)("span",{style:{position:"absolute",pointerEvents:"none",left:o.clientX+window.scrollX,top:l}})})},FE="float-bar-hSOAAZ",UE="bar-divider-ominSL",HE="close-btn-WPWoR8",zE="action-RzOWG1",qE=({area:e,getCanvas:t})=>(0,Te.jsxs)("div",{className:FE,children:[(0,Te.jsx)(ve.A,{className:HE,onClick:()=>{BS.RT.setState({open:!1}),pn.A.emit("get-screen-capture-done",null)}}),(0,Te.jsx)("span",{className:zE,onClick:()=>{var n;null===(n=OS(t(),e))||void 0===n||n.toBlob((e=>{pn.A.emit("get-screen-capture-done",e),BS.RT.setState({open:!1})}))},style:{marginLeft:2},children:(0,Te.jsx)(hu.A,{})})]});var VE=n(55824),$E=n(54733),WE=n(56394),KE=n(1717),YE=n(15824);const GE=({area:e,getCanvas:t})=>{const n=(0,m.useRef)(e);n.current=e;const i=(0,v.B)(),{enable_exercise:o,enable_pic_qa:s,enable_collect:l}=(0,As.A)("capture_assistant"),c=(0,BS.RT)((e=>e.reportParams))||{},d=l,u=(0,m.useCallback)((()=>new Promise((n=>{const i=OS(t(),e,{keepRatio:!1,maxOriginRatioSize:256});i?i.toBlob((e=>{if(e){const t=function(){var t=(0,a.A)((function*(){const t=yield(0,xn.r)(e,"image");n(t)}));return function(){return t.apply(this,arguments)}}();(0,WE.L)(t,3,500)}else n("")})):n("")}))),[e]),h=(0,m.useCallback)(((e,t)=>(...n)=>{var i;(0,It.z8)("screenshot_function_bar_click",{button_name:t,click_from:c.from}),null!==(i=(0,se.TK)("authInfo"))&&void 0!==i&&i.isAuthenticated?e.apply(null,n):(0,_e.DT)({trackMeta:{login_entrance:"screen_capture"}})}),[c]),p=h((n=>{const{clientX:i,clientY:o}=n;var s;e.height&&e.width&&(BS.RT.setState({open:!1,OCRBoxVisible:!0,cursorPosition:{clientX:i,clientY:o},captureBlob:null,captureBlobData:null}),null===(s=OS(t(),e,{maxOriginRatioSize:256,keepRatio:!1}))||void 0===s||s.toBlob((e=>{BS.RT.setState({captureBlob:e}),e&&(0,KE.ql)(e).then((e=>BS.RT.setState({captureBlobData:e})))})))}),"extract_text"),g=h(function(){var t=(0,a.A)((function*(t){try{var n,i;BS.RT.getState().setOpen(!1);const t=new Range,o=36,s=Math.max(e.top-o,16),a=(0,r.A)((0,r.A)({},e),{},{text:"",contextText:"",range:t,top:s,bottom:s+e.height,right:e.left+e.width,clientBottom:window.innerHeight-(e.top+e.height)});qt.t_.setState({inputTextReady:!1,currentAction:so.EU.translate,boxVisible:!0,barVisible:!1,writeEnabled:!1,inputText:"",contextText:"",range:t,selectionBaseInfo:a,simpleSelectionBaseInfo:a,sceneId:fe.Fc.ScreenShotTranslate,reportParams:{scene:null!==(n=c.from)&&void 0!==n&&n.includes("chat_enter_bar")?"chat_enter_bar_screenshot":"side_bar_screenshot",sec_scene:"screenshot_translate"}});const l=yield u(),d=yield(0,le.ml)({uri:l,scene:YE.R.ScreenShotTranslate});if(d.success&&null!==(i=d.texts)&&void 0!==i&&i.length){const e=d.texts.map((e=>e.text)).join("\n");a.text=e,qt.t_.setState({inputTextReady:!0,inputText:e,contextText:e,selectionBaseInfo:(0,r.A)({},a),simpleSelectionBaseInfo:(0,r.A)({},a)})}}catch(o){qt.t_.setState({inputTextReady:!0}),(0,ar.z3)("[screen capture] translate error",o)}}));return function(e){return t.apply(this,arguments)}}(),"translate"),f=h((()=>{const e=OS(t(),n.current);null==e||e.toBlob(function(){var e=(0,a.A)((function*(e){if(e)if(BS.RT.getState().setOpen(!1),Co.l.getState().setIsShowSidebar(!0,_.cz.default),yield(0,ko.Z)(),Co.l.getState().isSidePanelMode){const t=yield(0,KE.ql)(e);(0,jn.cs)({name:"send-message-with-file",body:{action:"capture-ask",blobData:t}})}else pn.A.emit("capture-ask",e)}));return function(t){return e.apply(this,arguments)}}())}),"ask_doubao");(0,m.useEffect)((()=>{if(s){const e=e=>{var t,n;13!==e.keyCode&&"enter"!==(null===(t=e.key)||void 0===t||null===(n=t.toLocaleLowerCase)||void 0===n?void 0:n.call(t))||f()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}}),[s]);const x=h((()=>{const n=OS(t(),e);null==n||n.toBlob(function(){var e=(0,a.A)((function*(e){if(e){BS.RT.getState().setOpen(!1),Co.l.getState().setIsShowSidebar(!0,_.cz.default),yield(0,ko.Z)();const t={skill_id:"11",skill_type:11},n={skill_id:t.skill_id,skill_type:t.skill_type},{convId:i,convType:o,mainBotId:s}=(0,Jt.IK)(),a={reportParams:{use_skill:!0,scene:"chat_enter_bar_screenshot",sec_scene:"screenshot_answer_question",from:"skill_input",skill_id:t.skill_id,skill_name:(0,$E.WW)(t.skill_type)},extraExt:{input_skill:JSON.stringify(n)},ctx:(0,So.Pe)(o,i,s)};if(Co.l.getState().isSidePanelMode){const t=yield(0,KE.ql)(e);(0,jn.cs)({name:"send-message-with-file",body:{action:"exercise-skill",blobData:t,msg:a,chatType:Zt.H.Conversation}})}else(0,ew.C)([(0,r.A)((0,r.A)({},a),{},{image:(0,KE.ps)(e)})],{chatType:Zt.H.Conversation,botType:"Main"})}}));return function(t){return e.apply(this,arguments)}}())}),"answer_question"),y=function(){var n=(0,a.A)((function*(){(0,It.z8)("screenshot_function_bar_click",{button_name:"copy",click_from:c.from}),yield((e,t)=>{const n=OS(e,t,{keepRatio:!0});return n?new Promise((e=>{n.toBlob((function(t){if(!t)return void e(!1);const n=new ClipboardItem({"image/png":t});navigator.clipboard.write([n]).then((()=>e(!0))).catch((()=>e(!1)))}),"image/png")})):Promise.resolve(!1)})(t(),e),BS.RT.getState().setOpen(!1)}));return function(){return n.apply(this,arguments)}}(),b=h((()=>{const n=OS(t(),e,{maxOriginRatioSize:256,keepRatio:!0});n&&(BS.RT.getState().setOpen(!1),ro({collectFrom:zt.vP.after_screenshot,collectType:zt.p6.Screenshot,collectionType:wn.X.Image,image_result:{url:n.toDataURL(),width:Math.round(e.width),height:Math.round(e.height)}}))}),"collect");return(0,m.useEffect)((()=>{d&&(0,zt.ae)(zt.vP.after_screenshot,zt.p6.Screenshot)}),[d]),(0,Te.jsxs)("div",{className:FE,children:[(0,Te.jsx)(ve.A,{className:HE,onClick:()=>{BS.RT.getState().setOpen(!1)}}),(0,Te.jsx)("span",{className:UE}),(0,Te.jsxs)("span",{className:zE,onClick:p,children:[(0,Te.jsx)(Pe.AY,{}),i("flow_web_ext_screenshot_action_extract")]}),(0,Te.jsxs)("span",{className:zE,onClick:g,children:[(0,Te.jsx)(bk.A,{}),i("flow_web_ext_action_translate")]}),o?(0,Te.jsxs)("span",{className:zE,onClick:x,children:[(0,Te.jsx)(VE.A,{}),i("flow_web_ext_screenshot_action_solve")]}):null,(0,Te.jsxs)("span",{className:zE,onClick:y,children:[(0,Te.jsx)(Rc.A,{}),i("message_long_press_copy")]}),d?(0,Te.jsxs)("span",{className:zE,onClick:b,children:[(0,Te.jsx)(Ms.A,{}),i("flow_web_ext_bookmark_screenshot")]}):null,s?(0,Te.jsxs)("span",{className:zE,onClick:f,children:[(0,Te.jsx)(ng.A,{}),i("flow_web_ext_screenshot_action_ask",{brandName:(0,fs.L2)()}),(0,Te.jsx)(Pe.YW,{})]}):null]})},QE="ocr-assistant-wXaWpt",ZE="canvas-baImzF",XE="selection-VNTB4q",JE="float-bar-anchor-oGvAx0",eT="bar-popover-n7CFht",tT=()=>{const{captureMode:e,reportParams:t}=(0,BS.RT)((e=>({captureMode:e.captureMode,reportParams:e.reportParams}))),n=(0,m.useRef)(null),[i,o]=(0,m.useState)({left:-100,top:-100,width:0,height:0}),[s,l]=(0,m.useState)(!1),c=(0,m.useRef)(null),[d,u]=(0,m.useState)(!1);(0,m.useEffect)((()=>{s&&(0,It.z8)("screenshot_function_bar_show",{show_from:null==t?void 0:t.from})}),[s]),(0,m.useEffect)((()=>{(0,a.A)((function*(){const e=yield(0,jn.cs)("capture-visible-tab");if(e.success&&e.data&&c.current){const t=c.current;t.width=window.innerWidth*window.devicePixelRatio,t.height=window.innerHeight*window.devicePixelRatio;const n=new Image;n.src=e.data,n.onload=()=>{const e=t.getContext("2d");null==e||e.drawImage(n,0,0),u(!0)}}}))();const e=()=>{BS.RT.getState().setOpen(!1)},t=e=>{var t;27!==e.keyCode&&"escape"!==(null===(t=e.key)||void 0===t?void 0:t.toLocaleLowerCase())||(e.preventDefault(),e.stopPropagation(),BS.RT.getState().setOpen(!1))};return window.addEventListener("resize",e),window.addEventListener("keydown",t),()=>{window.removeEventListener("resize",e),window.removeEventListener("keydown",t)}}),[]);return(0,Te.jsxs)("div",{className:QE,ref:n,style:{width:window.innerWidth,height:window.innerHeight,visibility:d?"visible":"hidden"},children:[(0,Te.jsx)("canvas",{ref:c,className:ZE}),(0,Te.jsx)(ME,{className:XE,onCaptureAreaUpdate:e=>o(e),onStart:()=>l(!1),onStop:e=>{l(!0)}}),(0,Te.jsx)(je.AM,{position:"bottomRight",visible:s,trigger:"custom",getPopupContainer:()=>n.current,className:eT,spacing:{y:10,x:0},content:"only-capture"===e?(0,Te.jsx)(qE,{area:i,getCanvas:()=>c.current}):(0,Te.jsx)(GE,{area:i,getCanvas:()=>c.current}),children:(0,Te.jsx)("div",{className:JE,style:(0,r.A)({},i),onMouseDown:e=>e.stopPropagation()})})]})},nT=()=>{const{open:e,OCRBoxVisible:t}=(0,BS.RT)();return(0,m.useEffect)((()=>{const t=In.j.getAssistantContainer();t&&(t.style.zIndex=e?"2147483647":"",t.getAttribute("style")||t.removeAttribute("style")),e||BS.RT.setState({captureMode:"global"})}),[e]),(0,Te.jsxs)(Te.Fragment,{children:[e?(0,Te.jsx)(tT,{}):null,t?(0,Te.jsx)(OE,{}):null]})},iT=()=>(0,Mk.F)("all")?(0,Te.jsx)(nT,{}):null,oT={select:qt.t_,layout:Co.l,global:ai.on,page:Tx.IF,translate:Ex.I},sT={select:["barVisible","inputText","contextText","writeEnabled"],layout:["showTip","enterSidebarMode"],global:["floatingCardVisible"],page:["title","url","favicon","type"],translate:["active","showOrigin"]},rT={layout:["showTip","enterSidebarMode"],global:["floatingCardVisible","summaryActionVisible","chatPageReady"],select:[],page:[],translate:["active","showOrigin"]},aT={update:e=>{e.length&&(aw._K.isInSidePanel?jn.Iq:jn.cs)({name:"update-zustand-state",body:e}).catch((e=>{A.vF.persist.error({error:e})}))}},lT=(e,t,n,i={})=>{const o=("contentScript"===e?sT:rT)[t].reduce(((e,o)=>(i&&n[o]===i[o]||e.push({key:o,data:n[o],storeKey:t}),e)),[]);o.length&&aT.update(o)},cT=()=>{lT("contentScript","select",qt.t_.getState()),lT("contentScript","layout",Co.l.getState()),lT("contentScript","global",ai.on.getState()),lT("contentScript","page",Tx.IF.getState()),lT("contentScript","translate",Ex.I.getState())},dT=(e,t)=>e.subscribe(((n,i)=>{e.mutex||lT(aw._K.isInSidePanel?"sidePanel":"contentScript",t,n,i)}));var uT=n(75882),hT=n(10159);const mT=()=>{const[e,t]=(0,m.useState)(Ny);return(0,m.useEffect)((()=>{var e;let n;const i=(e=!1)=>{if((0,et.jg)(document.activeElement))return;const i=(0,bs.GF)(),o=(0,bs.yI)();if(!i||(0,Ko.x)(n,i)||!o)return;n=i;const s=new jy(window.getSelection());t({selectionHelper:s,isContextMenu:e}),qt.t_.setState({writeEnabled:s.canInsert,inputTextReady:!0,inputText:i.text,contextText:i.contextText,range:i.range,selectionBaseInfo:i,simpleSelectionBaseInfo:o,reportParams:{}})};let o=0;const s=()=>{clearTimeout(o),o=(0,KS.A)(i)},r=()=>{clearTimeout(o),o=(0,KS.A)((()=>i(!0)))},a=()=>i();let l=null!==(e=document.fullscreenElement)&&void 0!==e?e:document;const c=e=>{(0,ps.CN)()&&e.addEventListener("selectionchange",s),e.addEventListener("pointerup",s),window.addEventListener("keydown",s),window.addEventListener("keyup",s),window.addEventListener("resize",a),window.addEventListener("contextmenu",r)},d=e=>{clearTimeout(o),e.removeEventListener("selectionchange",s),e.removeEventListener("pointerup",s),window.removeEventListener("resize",a),window.removeEventListener("keydown",s),window.removeEventListener("keyup",s),window.removeEventListener("contextmenu",r)},u=()=>{var e;d(l);const t=null!==(e=document.fullscreenElement)&&void 0!==e?e:document;c(t),l=t};return document.addEventListener("fullscreenchange",u),c(l),()=>{var e;d(null!==(e=document.fullscreenElement)&&void 0!==e?e:document),document.removeEventListener("fullscreenchange",u)}}),[]),e};var pT=n(59355);const gT=()=>{const[e]=(0,f.Y)("autoTranslatePageHosts"),{setActive:t,setShowLangNotice:n}=(0,Ex.I)(),i=(0,m.useMemo)((()=>{const t=new URL(window.location.href).hostname;return(0,pT.A)(e,t)}),[e]),o=function(){var e=(0,a.A)((function*(){try{const e=(0,se.TK)("translateLanguage"),i=(0,se.TK)("pageTranslateService");t(!0),(0,kS.Ip)({lang:e,translateService:(0,Sk.w)(i)});e===(yield(0,nC.b)((0,nC.T)()))&&n(!0)}catch(e){}}));return function(){return e.apply(this,arguments)}}();(0,m.useEffect)((()=>{const{active:e}=Ex.I.getState();i&&!e&&o()}),[i])},vT={name:"chat-page-ready",handle:e=>{pn.A.emit("chat-page-ready",e),cT()}},fT={name:"locate-highlight-dom",handle:e=>{e&&(0,YS.p)(e)}},_T={name:"read-page-request",handle:(xT=(0,a.A)((function*(){return yield(0,ai.nx)()})),function(){return xT.apply(this,arguments)})};var xT;const yT={name:"vocabulary-book-archive",handle:e=>{e&&gy.deleteDict({word:e.word,translation:""},{persist:!1})}},bT={name:"update-zustand-state",handle:(e=[])=>{(e=>{e.forEach((e=>{const{key:t,data:n,storeKey:i}=e;(0,ar.Rm)(`update state env.isInSidePanel=${aw._K.isInSidePanel}\n       store=${i} key=${t} value=${n}`);const o=oT[i];o&&o.getState()[t]!==n&&(o.mutex=!0,o.setState({[t]:n}),o.mutex=!1)}))})(e)}},wT={name:"translate-page-request",handle:()=>(0,LS.TI)({isActive:!0})},CT={name:"auto-translate-page-request",handle:e=>(0,LS.sb)(e)},AT={name:"translate-show-origin-request",handle:()=>(0,LS.S_)()};let ST=location.href;const kT={name:"router-change",handle:e=>{ET(e)}};function ET(e){const t=location.href;ST!==t&&(pn.A.emit("router-change",e),ST=t)}setInterval((()=>ET({})),2e3);const TT={name:"reading-webpage-context",handle:e=>{pn.A.emit("show-reading-effect",e)}};let IT=function(e){return e.start="start",e.update="update",e.error="error",e.done="done",e.receiveEnd="receive-end",e.sendEnd="send-end",e}({});const jT=({type:e,message:t})=>{"done"!==e&&"error"!==e&&"update"!==e||pn.A.emit("show-reading-effect",!1),e===IT.sendEnd?pn.A.emit("im-message-send-end",{from:"sidepanel",message:t}):e===IT.update?pn.A.emit("im-message-update",{from:"sidepanel",message:t}):e===IT.receiveEnd&&pn.A.emit("im-message-receive-end",{from:"sidepanel",message:t})};pn.A.on("im-message",jT);const NT={name:"im-message",handle:jT};var RT=n(26225);const MT={name:"get-screen-capture",handle:e=>(BS.RT.getState().setReportParams({from:"chat_enter_bar"}),(0,RT.E)((null==e?void 0:e.requestId)||"",null==e?void 0:e.mode))},PT={name:"get-page-content",handle:()=>{const e=Tx.IF.getState();return(0,ar.Rm)("[zx] content script parse current",e),{url:e.url,title:e.title,icon:e.favicon}}},LT="assistant-WownMw",BT=()=>{const e=(0,Co.l)((e=>e.isShowSidebar)),[t]=(0,f.Y)("sidebarButtonPosition");return(0,Te.jsx)(AE.A,{align:t,visible:e,scene:"sideBar"})},DT=()=>{var e;(0,nr.A)(null===(e=document.getElementById("ciciai-assistant"))||void 0===e?void 0:e.shadowRoot);const t=(0,Co.l)((e=>e.isShowSidebar)),n=(0,Co.l)((e=>e.isShowSidebarBtn)),i=(0,Co.l)((e=>e.isSidePanelMode)),[s]=(0,f.Y)("sidebarButtonDisabledAll"),[r]=(0,f.Y)("sidebarButtonPosition"),[l]=(0,f.Y)("sidebarButtonDisabledHosts"),[c]=(0,f.Y)("hoverTranslateSetting"),d=l.includes(window.location.host),[u,h]=(0,m.useState)("\u2325K"),p=(0,m.useRef)(null),_=(0,Je.Uk)(),x=mT(),y=!yw(),b=c!==fe.X0.NO_TRANSLATE,w=(0,As.A)("hover_translate_assistant"),C=(0,As.A)("input_translate_assistant"),[S]=(0,f.Y)("inputTranslateInfo");gT();const k=function(){var e=(0,a.A)((function*(){var e;const{data:t}=yield(0,wx.c)("init-shortcut"),n=null==t||null===(e=t.shortcuts)||void 0===e?void 0:e._execute_action;n&&h(n)}));return function(){return e.apply(this,arguments)}}();(0,m.useEffect)((()=>((0,wx.c)("csui-init").then((e=>{const{shortcuts:t}=(null==e?void 0:e.data)||{},n=null==t?void 0:t._execute_action;n&&h(n)})),window.addEventListener("focus",k),()=>window.removeEventListener("focus",k))),[]),(0,m.useEffect)((()=>{i||(t?(e=>{const t="left"===e?kx:Sx,n="left"===e?"\nhtml {\n  position: relative !important;\n  min-height: 100vh !important;\n  padding-left: 420px !important\n}\n":"\nhtml {\n  width: calc(100% - 420px)  !important;\n  position: relative !important;\n  min-height: 100vh !important\n}\n";let i=document.getElementById(t);i?i.innerHTML=n:(i=document.createElement("style"),i.id=t,i.innerHTML=n,(0,rr.EY)(i))})("right"):(e=>{const t="left"===e?kx:Sx,n=document.getElementById(t);n&&n.remove()})("right"))}),[t,i]),(0,m.useEffect)((()=>{if(!i||aw._K.isInSidePanel)return;const e=(0,uT.c)(Object.values(o)),t=[dT(qt.t_,"select"),dT(Co.l,"layout"),dT(ai.on,"global"),dT(Ex.I,"translate")];return()=>{e(),t.forEach((e=>e()))}}),[]),(0,m.useEffect)((()=>{const e=()=>{document.title!==Tx.IF.getState().title&&((0,ar.Rm)(`document update title from=${Tx.IF.getState().title} to=${document.title}`),Tx.IF.getState().setTitle(document.title))};try{const t=document.querySelector("title"),n=new MutationObserver((()=>{e()})),i={childList:!0};return n.observe(t,i),()=>{n.disconnect()}}catch(t){let n;const i=()=>{e(),n=setTimeout(i,300)};return i(),()=>{clearTimeout(n)}}}),[]);const E=!(s||d||!n||[bn.o8,bn.Ud].some((e=>location.host.endsWith(e)))&&(!location.pathname.startsWith(ae.Cp)&&!location.pathname.startsWith("/ext/")));return(0,m.useEffect)((()=>{const e=()=>{const e=In.j.getAssistantContainer();e&&(document.fullscreenElement?e.style.display="none":e.style.display&&(e.style.display="block"))};return document.addEventListener("fullscreenchange",e),setTimeout((()=>e()),500),()=>{document.removeEventListener("fullscreenchange",e)}}),[]),(0,Te.jsx)(g.Y.Provider,{value:A.vF,children:(0,Te.jsx)(Ax.tH,{fallback:null,errorBoundaryName:"flow-ext-next",children:(0,Te.jsx)(as.A.Provider,{value:{getPopupContainer:()=>p.current||document.body},children:(0,Te.jsx)(Ry.Provider,{value:x,children:(0,Te.jsx)(v.C,{t:_,children:(0,Te.jsxs)("div",{onMouseDown:hT.N,className:J()(LT,"cici-ext-always-light","semi-always-light"),children:[null,(0,Te.jsx)($b,{}),(0,Te.jsx)(SS,{}),C.enable&&!S.disableAll&&(0,Te.jsx)(fC,{}),y&&(0,Te.jsx)(Kw,{}),w.enable&&b&&!(0,ps.Im)()&&(0,Te.jsx)(WS,{}),E?(0,Te.jsx)(bE,{align:r,shortcut:u,isSidebarShow:t}):null,i?null:(0,Te.jsx)(BT,{}),(0,Te.jsx)("div",{className:"cici-popup-container",ref:p}),(0,Te.jsx)(uw,{}),(0,Te.jsx)(iT,{}),(0,Ix.wu)()&&(0,Te.jsx)(Cy,{}),(0,Te.jsx)(CE,{})]})})})})})})},OT=DT;var FT=n(27737),UT=n(15704),HT=n(86767),zT=n(79267),qT=n(88608),VT=n(37890),$T=n(46241),WT=n(29659),KT=n(817),YT=n(81057),GT=n(16029),QT=n(5008);const ZT=new class{constructor(e){var t,n,i,o,s,a,l,c,d,u;(0,y.A)(this,"jsMonitor",void 0),(0,y.A)(this,"promiseMonitor",void 0),(0,y.A)(this,"fetchMonitor",void 0),(0,y.A)(this,"crashMonitor",void 0),(0,y.A)(this,"bid",void 0),(0,y.A)(this,"crashLog",void 0),(0,y.A)(this,"region",void 0),(0,y.A)(this,"_options",void 0),(0,y.A)(this,"client",void 0),(0,y.A)(this,"prepared",!1),(0,y.A)(this,"start",((e={})=>{if(self){const t=(0,WT.m)(),n=(0,fs.HF)();this.client.init((0,r.A)({env:"public",release:n,version:n,bid:this.bid,transport:{get:t.get,post:t.post}},e)),this.client.start(),this.runBgMonitors(),this.addMessageListeners(),(0,QT.sN)(this),this.prepared=!0}})),(0,y.A)(this,"config",(e=>{this.client.config(e)})),(0,y.A)(this,"runBgMonitors",(()=>{var e;(this.jsMonitor&&new qT.A(this.region),this.promiseMonitor&&new zT.A(this.region),this.fetchMonitor)&&new VT.A({region:this.region,rule:null===(e=this._options.plugins)||void 0===e?void 0:e.fetchInterceptRule});this.crashMonitor&&new $T.A(this.region,this.crashLog)})),(0,y.A)(this,"addMessageListeners",(()=>{const e=this,t={name:"slardar-message",handle:t=>{const{type:n,data:i}=t||{};switch(n){case GT.O4.CONTENT_EVENT:e.sendEvent(i);break;case GT.O4.CONTENT_LOG:case GT.O4.CONTENT_PERF_EVENT:e.sendLog(i)}}};(0,uT.c)(t)})),(0,y.A)(this,"sendEvent",(e=>{var t,n;this.prepared&&(null===(t=(n=this.client).sendEvent)||void 0===t||t.call(n,e),(0,UT.v)({type:"slardar",payload:e,action:"event"}))})),(0,y.A)(this,"sendLog",(e=>{var t,n;this.prepared&&(null===(t=(n=this.client).sendLog)||void 0===t||t.call(n,e),(0,UT.v)({type:"slardar",payload:e,action:"log"}))})),this.jsMonitor=null===(t=null==e||null===(n=e.plugins)||void 0===n?void 0:n.jsMonitor)||void 0===t||t,this.promiseMonitor=null===(i=null==e||null===(o=e.plugins)||void 0===o?void 0:o.promiseMonitor)||void 0===i||i,this.fetchMonitor=null===(s=null==e||null===(a=e.plugins)||void 0===a?void 0:a.fetchMonitor)||void 0===s||s,this.crashMonitor=null===(l=null==e||null===(c=e.plugins)||void 0===c?void 0:c.crashMonitor)||void 0===l||l,this.bid=e.bid,this.crashLog=null!==(d=null==e||null===(u=e.log)||void 0===u?void 0:u.crashLog)&&void 0!==d&&d,this.region=(0,YT.J)(),this._options=e,this.client=(0,YT.K)(this.region)}configExtraInfo(e){KT.A.recordExtraInfo(e)}}({bid:"flow_web_ext",plugins:{promiseMonitor:!1,crashMonitor:!1}});class XT extends Error{constructor(e,t){super(`ServerError, code: ${e}, msg:${t}`),this.code=e}}Error;const JT=function(){var e=(0,a.A)((function*(e,t){var n,i;const{url:o,method:s,data:a,params:l,headers:c}=e,d=yield fetch((0,Wr.ID)(o,(0,r.A)((0,r.A)({},(0,aE.wH)()),l)),{method:s,body:JSON.stringify(a),headers:(0,r.A)((0,r.A)({},(0,aE.Ql)()),{},{"Content-Type":"application/json"},c)}),u=null===(n=d.headers)||void 0===n||null===(i=n.get)||void 0===i?void 0:i.call(n,"x-tt-logid");if(!d.ok)throw(0,UT.v)({type:"http-request",payload:{config:e,response:{statusText:d.statusText},logId:u}}),new Error(d.statusText);const h=yield d.json();(0,UT.v)({type:"http-request",payload:{config:e,response:h,logId:u}});const{code:m,msg:p}=h;var g;if(void 0!==m&&0!==m)throw ZT.sendEvent((0,r.A)({name:"response_server_code_invalid"},(0,HT.i)({url:null==e?void 0:e.url,msg:p,code:`${m}`,statusCode:200,isSse:!1,"x-tt-env":null==e||null===(g=e.headers)||void 0===g?void 0:g["x-tt-env"],logId:u}))),new XT(m,p);return[FT.t.NOACCESS,FT.t.NOT_LOGIN].includes(Number(m))&&pn.A.emit("auth-info-request-updated"),(0,r.A)((0,r.A)({},h),{},{logId:u})}));return function(t,n){return e.apply(this,arguments)}}(),eI=function(){var e=(0,a.A)((function*(...e){const{data:t}=yield JT(...e);return t}));return function(){return e.apply(this,arguments)}}();function tI(){return(tI=(0,a.A)((function*(e){const t=(0,se.TK)("authInfo");return e?yield eI({method:"POST",url:`${bn.kD}/plugin/prompt_skill/list_by_user`,data:{user_id:t.userId,frontend_source:1}}):yield(0,Nn.S6)({method:"POST",url:`${bn.kD}/plugin/prompt_skill/list_by_user`,data:{user_id:t.userId,frontend_source:1}})}))).apply(this,arguments)}const nI=()=>{const e=[],{selectBarPronounceEnabled:t}=(0,se.tl)("tts");return t||e.push(so.EU.pronounce),(0,ot.ku)()||e.push(so.EU.collect),e},iI=(e,t,n)=>{const i={actionList:[],moreActionList:[]},o=new Set,s=nI();return e&&(e.selectbar.forEach((e=>{if(s.includes(e))return;const n=t.get(e);n&&(i.actionList.push(n),o.add(e))})),e.dropdown.forEach((e=>{if(s.includes(e))return;const n=t.get(e);n&&(i.moreActionList.push(n),o.add(e))}))),t.forEach(((e,t)=>{if(!o.has(t)&&!s.includes(t)){(n?so.aX.includes(t):so.AA.includes(t))?i.actionList.push(e):i.moreActionList.push(e)}})),i},oI={readingPopupActions:{selectbar:so.aX,dropdown:so.Tz},editingPopupActions:{selectbar:so.AA,dropdown:so.Xt}},sI=()=>{const e=nI();(0,se.vE)("readingPopupActions",{actionList:(0,so.Hh)(e),moreActionList:(0,so.WN)(e)}),(0,se.vE)("editingPopupActions",{actionList:(0,so.I8)(e),moreActionList:(0,so.fS)(e)})};function rI(){return aI.apply(this,arguments)}function aI(){return aI=(0,a.A)((function*(e=!1){try{const t=(0,se.TK)("authInfo");if(!t.isAuthenticated||!t.userId)return void sI();const n=yield function(e){return tI.apply(this,arguments)}(e);if(!n)return;const{user_setting:i,items:o}=n;if(!i||!o)return;const s=new Map([...(0,so.Hh)(),...(0,so.WN)()].map((e=>[e.id,e]))),r=new Map([...(0,so.I8)(),...(0,so.fS)()].map((e=>[e.id,e])));null==o||o.forEach((e=>{const{id:t,extra:n,title:i,prompt_template:o}=e,a=JSON.parse(n),{use_in:l="",icon:c="",displayMode:d,conf_id:u}=a||{},h={id:t,icon:c,name:i,prompt:o,displayMode:d,confId:u};"editing"===l?r.set(t,h):s.set(t,h)}));const{settings:a=""}=i,l=a?JSON.parse(a):oI,c=iI(l.readingPopupActions,s,!0),d=iI(l.editingPopupActions,r,!1);c.actionList.length+c.moreActionList.length&&(0,se.vE)("readingPopupActions",c),d.actionList.length+d.moreActionList.length&&(0,se.vE)("editingPopupActions",d)}catch(t){(0,ar.z3)("initSelectBarSkillList err",t),A.vF.persist.info({eventName:"getSelectBarSkillList",meta:(0,r.A)({},t)})}})),aI.apply(this,arguments)}var lI=n(43358);const cI=[bn.o8,bn.Ud];var dI=n(40967),uI=n(22290),hI=n(81725),mI=n.n(hI),pI=n(95081);const gI="wrapper-qH3fD2",vI="mask-v8dwr4",fI="setting-popover-HXRy3h",_I="spell-card-xCZkfq",xI="revision-type-PTC8JH",yI="suggest-FdbK8z",bI="setting-CE1uYq",wI="ignore-Mq8qMp",CI="setting-wrapper-cOQKNa",AI="tip-ZTQTKU",SI="host-UdPObE",kI=e=>{const{allowGrammar:t,onAllowGrammarChange:n}=e,i=function(e){const t=e.split(".").slice(-2);if(t.length<=1)return t[0];const n=t[0],i=t[1];if(n.length>=13)return`${n.substring(0,5)}...${n.substring(n.length-5)}.${i}`;return`${n}.${i}`}(location.hostname);return(0,Te.jsxs)("div",{className:J()(CI,"row"),onMouseDownCapture:e=>{e.stopPropagation(),e.preventDefault()},children:[(0,Te.jsx)("div",{className:J()("row-item",AI),children:(0,Te.jsx)(Hu.x,{i18nKey:"flow_web_ext_grammar_setting_onandoff",defaults:"Check grammar for <0>{{ website }}</0>",values:{website:i},components:[(0,Te.jsx)("span",{className:SI})]})}),(0,Te.jsx)("div",{className:"row-auto",style:{marginLeft:8},children:(0,Te.jsx)(je.Sc,{checked:t,onChange:e=>{var t;return null==n?void 0:n(null!==(t=e.target.checked)&&void 0!==t&&t)}})})]})},EI=(0,m.createContext)(void 0),TI=EI.Provider;function II(){const e=(0,m.useContext)(EI);if(!e)throw new Error("Revision Evn is undefined");return e}const jI=e=>(0,Te.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),{},{children:(0,Te.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.459 7.252c-.955 0-1.763-.63-2.031-1.496H2.615c-.322 0-.583-.282-.583-.63s.261-.63.583-.63h4.813a2.127 2.127 0 0 1 4.062 0h1.895c.322 0 .583.282.583.63s-.261.63-.583.63H11.49A2.13 2.13 0 0 1 9.46 7.252m0-1.063a1.063 1.063 0 1 1 0-2.126 1.063 1.063 0 0 1 0 2.126M6.541 13c.955 0 1.763-.63 2.031-1.496h4.813c.322 0 .583-.282.583-.63s-.261-.63-.583-.63H8.572a2.127 2.127 0 0 0-4.062 0H2.615c-.322 0-.583.282-.583.63s.261.63.583.63H4.51A2.13 2.13 0 0 0 6.54 13m0-1.063a1.063 1.063 0 1 0 0-2.126 1.063 1.063 0 0 0 0 2.126",clipRule:"evenodd"})})),NI=(0,m.forwardRef)(((e,t)=>{const{t:n}=(0,BA.B)(),i=II(),{popupCardShadowContainer:o}=i,[s,r]=(0,m.useState)(!1),{style:a,replacement:l,onReplace:c,allowGrammar:d,onAllowGrammarChange:u,onIgnore:h}=e;(0,m.useEffect)((()=>{(0,Ke.s)("highlight_result_show",{button_name:"grammar"}),(0,$e.dn)({click_from:"writing_assistant"})}),[]);return(0,Te.jsxs)("div",{className:gI,ref:t,style:a,children:[(0,Te.jsx)(je.AM,{trigger:"custom",position:"rightTop",visible:s,spacing:0,className:fI,getPopupContainer:()=>{return(null==o||null===(e=o.shadowRoot)||void 0===e?void 0:e.querySelector(`.${gI}`))||document.body;var e},onClickOutSide:()=>r(!1),content:(0,Te.jsx)(kI,{allowGrammar:d,onAllowGrammarChange:u}),showArrow:!1,children:(0,Te.jsx)("div",{className:vI})}),(0,Te.jsxs)("div",{className:_I,children:[(0,Te.jsxs)("div",{className:"row",children:[(0,Te.jsx)("div",{className:J()("row-item",xI),children:n("flow_web_ext_grammar_title_note")}),(0,Te.jsx)("div",{className:J()("row-auto",bI),onMouseDownCapture:e=>{e.stopPropagation(),r(!s)},children:(0,Te.jsx)(jI,{})})]}),(0,Te.jsxs)("div",{className:"row",style:{marginTop:12},children:[(0,Te.jsx)("div",{className:J()("row-item",yI),onClick:e=>{e.stopPropagation(),e.preventDefault(),null==c||c(),(0,Ke.s)("highlight_result_click",{button_name:"grammer",click_result:"input"})},children:l}),(0,Te.jsx)("div",{className:J()("row-item",wI),style:{marginLeft:6},onClick:()=>{null==h||h(),(0,Ke.s)("highlight_result_click",{button_name:"grammer",click_result:"ignore"})},children:n("flow_web_ext_grammar_action_ignore")})]})]})]})})),RI=NI;var MI=n(20716);const PI=()=>{const e=II(),t=dA(fe.lf.grammar),{clearRemoveActiveTimer:n,setActiveRevision:i}=function(){const e=(0,m.useRef)(void 0),t=II(),n=t.store((e=>e.spellRevisions)),{setActiveRevision:i}=t.store.getState(),o=t.editor.dom,s=(n,o=!1)=>{window.clearTimeout(e.current),e.current=void 0;const s=t.store.getState().activeRevision;(0,MI.A)(s,n)||(o||n?i(n):e.current=window.setTimeout((()=>{i(void 0)}),300))};return(0,m.useEffect)((()=>{const e=()=>{s(void 0,!0)};return window.addEventListener("wheel",e),()=>{window.removeEventListener("wheel",e)}}),[]),(0,m.useEffect)((()=>{const e=(0,T.A)((e=>{const t=o.getBoundingClientRect(),i=e.clientX-(t.left-o.scrollLeft),r=e.clientY-(t.top-o.scrollTop);let a;e:for(const s of(0,dI.A)(n))for(const e of s.rects)if(i>=e.left&&i<=e.right&&r>=e.top&&r<=e.bottom+2){const n=e.top+(t.top-o.scrollTop),i=e.left+(t.left-o.scrollLeft);a={id:s.revision.id,rect:{x:i,y:n,top:n,left:i,width:e.width,height:e.height,right:0,bottom:0}};break e}s(a)}),32),t=()=>{s(void 0)};return o.addEventListener("pointermove",e),o.addEventListener("pointerleave",t),()=>{o.removeEventListener("pointermove",e),o.removeEventListener("pointerleave",t)}}),[o,t,n]),{clearRemoveActiveTimer:()=>{window.clearTimeout(e.current),e.current=void 0},setActiveRevision:s}}(),{activeRevision:o,spellRevisions:s}=e.store((e=>({activeRevision:e.activeRevision,spellRevisions:e.spellRevisions}))),[a,l]=(0,m.useState)(null),c=iS(null==o?void 0:o.rect),{styles:d}=(0,pI.E)(c,a,{placement:"bottom-start",strategy:"fixed"}),u=(0,m.useCallback)(n,[]),h=(0,m.useCallback)((()=>{i(void 0)}),[]);if((0,m.useEffect)((()=>(null==a||a.addEventListener("pointerenter",u),null==a||a.addEventListener("pointerleave",h),()=>{null==a||a.removeEventListener("pointerenter",u),null==a||a.removeEventListener("pointerleave",h)})),[a]),!o)return null;const p=s[o.id];if(!p)return null;const{revision:g}=p,v=!t.hasHost();return(0,Te.jsx)(RI,{allowGrammar:v,onAllowGrammarChange:e=>{t.disableHost(!e)},replacement:g.replacement,ref:l,style:(0,r.A)((0,r.A)({},d.popper),{},{zIndex:2147483647}),onReplace:()=>{e.store.getState().setActiveRevision(void 0),e.replace(g)},onIgnore:()=>{e.store.getState().setActiveRevision(void 0),e.ignore(g)}})};class LI{constructor(e){(0,y.A)(this,"dom",void 0),(0,y.A)(this,"shadowRoot",void 0),(0,y.A)(this,"root",void 0),(0,y.A)(this,"init",(()=>{const e=this.render();this.root.render(e),this.mount(this.dom)})),this.dom=document.createElement(e),this.shadowRoot=this.dom.attachShadow({mode:"open"});const t=document.createElement("div");t.classList.add("cici-ext-container");const n=document.createElement("div");n.classList.add("cici-ext-always-light","semi-always-light"),t.appendChild(n),this.shadowRoot.appendChild(t),this.root=(0,p.createRoot)(n),(0,et.NR)(this.shadowRoot,ae.QN).then((()=>{this.init()}))}destroy(){this.root.unmount(),this.dom.remove()}}class BI extends LI{constructor(e){super(ae.aS),(0,y.A)(this,"env",void 0),this.env=e,this.env.popupCardShadowContainer=this.dom}mount(){document.documentElement.append(this.dom)}render(){return(0,Te.jsx)(TI,{value:this.env,children:(0,Te.jsx)(PI,{})})}}function DI(e,t){const n=new ResizeObserver(t),i=new MutationObserver(t);return window.addEventListener("resize",t),n.observe(e),i.observe(e,{attributes:!0,childList:!0,subtree:!0}),()=>{window.removeEventListener("resize",t),n.disconnect(),i.disconnect()}}const OI=e=>e+1;const FI="anchor-qw0rRl",UI="container-obHg0v",HI="content-XrnZ0O",zI="segment-QsUnSG",qI="active-eqi0bb",VI="diff-nTBpB8",$I=()=>{const e=II(),t=(0,m.useRef)(null),n=(0,m.useRef)(null),i=(0,m.useRef)(null);!function(e,t,n){const i=II(),[o,s]=(0,m.useReducer)(OI,0),r=i.editor.dom;(0,m.useEffect)((()=>{const i=e.current,o=t.current,a=n.current;if(!i||!o||!a)throw new Error("can not find elements");const l=(0,T.A)((()=>{const e=getComputedStyle(r);if("fixed"===e.position)return i.style.position="fixed",i.style.top=e.top,void(i.style.left=e.left);let t=0,n=0;const l=i.style.transform.match(/\-?\d+(\.\d+)?(?=px)/g);l&&(t=Number(l[0]),n=Number(l[1]));const c=r.getBoundingClientRect(),d=i.getBoundingClientRect();t+=c.left-d.left,n+=c.top-d.top,i.style.transform=`translate3d(${t}px, ${n}px, 0)`,"sticky"===e.position&&(i.style.position="sticky","auto"!==e.top&&(i.style.top=parseInt(e.top,10)-n+"px"),"auto"!==e.bottom&&(i.style.bottom=parseInt(e.bottom,10)-n+"px")),o.style.width=`${r.offsetWidth}px`,o.style.height=`${r.offsetHeight}px`,a.style.width=`${r.scrollWidth+r.clientLeft}px`,a.style.height=`${r.scrollHeight+r.clientTop}px`,a.style.transform=`translate3d(${-r.scrollLeft}px, ${-r.scrollTop}px, 0)`,s()}),100),c=DI(r,l);return()=>{c(),l.cancel()}}),[e,t,n,r]),(0,m.useEffect)((()=>{const e=n.current;if(!e)throw new Error("can not find elements");const t=()=>{e.style.transform=`translate3d(${-r.scrollLeft}px, ${-r.scrollTop}px, 0)`};return r.addEventListener("scroll",t),()=>{r.removeEventListener("scroll",t)}}),[n,r])}(t,n,i);const{activeRevision:o,spellRevisions:s,fetching:r}=e.store((e=>({spellRevisions:e.spellRevisions,fetching:e.fetching,activeRevision:e.activeRevision,showSuccessIfNeeded:e.showSuccessIfNeeded}))),a=(0,dI.A)(s),l=a.length,c=l>0;return(0,m.useEffect)((()=>{l&&((0,Ke.s)("detect_grammar_error_show",{current_page:(0,It.M5)(location.href)}),(0,$e.M7)({show_from:"writing_assistant",current_page:(0,It.M5)(location.href)}))}),[c]),(0,m.useEffect)((()=>{hA.getState().updateEditorRevision(e.editor.dom,{count:a.length,loading:r,env:e})}),[s]),(0,m.useEffect)((()=>()=>{hA.getState().removeEditorRevision(e.editor.dom)}),[]),(0,Te.jsx)("div",{className:FI,ref:t,"data-host":window.location.hostname,children:(0,Te.jsx)("div",{className:UI,ref:n,children:(0,Te.jsx)("div",{className:HI,ref:i,children:a.flatMap((e=>e.rects.map(((t,n)=>(0,Te.jsx)("div",{className:J()(zI,VI,{[qI]:e.revision.id===(null==o?void 0:o.id)}),style:{top:t.top,left:t.left,width:t.width,height:t.height}},`${e.revision.id}-${n}`)))))})})})};class WI extends LI{constructor(e){super(ae.GW),(0,y.A)(this,"env",void 0),this.dom.style.zIndex="2",this.env=e,this.env.highlighterShadowContainer=this.dom}mount(){this.env.editor.dom.after(this.dom)}render(){return(0,Te.jsx)(TI,{value:this.env,children:(0,Te.jsx)($I,{})})}}var KI=n(45400),YI=n(88870),GI=n(58114),QI=n(7021);const ZI=[/\b[ap]\.m\.$/i,/\b\w\.$/,/\b\d+\.$/];function XI(e){return(0,QI.lD)(e).filter((e=>"Sentence"===e.type)).flatMap((e=>(0,ie.A)(e,"children",[]))).filter((e=>"Str"===e.type||"Punctuation"===e.type)).reduce((function(t,n){const i=t[t.length-1];if(i){if(!e.slice(i.end,n.range[0]).includes("\n")){if("Punctuation"===n.type||(o=i.raw,ZI.some((e=>e.test(o)))))return i.raw=e.slice(i.start,n.range[1]),i.end=n.range[1],t}}var o;return t.push({raw:n.raw,start:n.range[0],end:n.range[1]}),t}),[])}function JI(e,t=!1){return n=>(n.start=e.transformPosition(n.start),n.end=e.transformPosition(n.end,t),n)}const ej=new Set;function tj(e,t){return`${e} -> ${t}`}class nj extends jd.A{constructor(...e){super(...e),(0,y.A)(this,"sentCounter",0),(0,y.A)(this,"prevText",""),(0,y.A)(this,"spellRevisions",Object.create(null)),(0,y.A)(this,"sentences",Object.create(null)),(0,y.A)(this,"pendingSentences",[]),(0,y.A)(this,"isApplying",!1)}createSent(e){this.sentCounter+=1;const t=this.sentCounter;return this.sentences[t]=(0,r.A)({id:t},e),t}update(e,t,n={keepRevs:!1}){(0,vi.A)(this.spellRevisions,JI(t,!0)),(0,vi.A)(this.sentences,JI(t,!1));const i=(0,uI.A)(XI(e),"start"),o=(0,GI.A)(this.sentences,"start"),s=new Set,r=[];return new Set([...Object.keys(i),...Object.keys(o)]).forEach((e=>{const t=i[e],n=o[e];if(t&&n){const e=n.filter((e=>!(0,YI.A)(e,t)));if(e.forEach((e=>{delete this.sentences[e.id],r.push({start:e.start,end:e.end})})),e.length===n.length){const e=this.createSent(t);s.add(e)}}else if(t){const e=this.createSent(t);s.add(e)}else n&&n.forEach((e=>{delete this.sentences[e.id],r.push({start:e.start,end:e.end})}))})),n.keepRevs||this.removeRevisionByRanges(r),[...s].map((e=>this.sentences[e]))}removeRevisionByRanges(e){(0,vi.A)(this.spellRevisions,((t,n)=>{e.some((e=>uC(t,e)))&&delete this.spellRevisions[n]})),this.emit("revisionChange",this.spellRevisions)}removeRevision(e){delete this.spellRevisions[e],this.emit("revisionChange",this.spellRevisions)}clearRevision(){this.spellRevisions={},this.emit("revisionChange",this.spellRevisions)}getOffsetSortedRevisions(){return Object.values(this.spellRevisions).sort(((e,t)=>e.start-t.start))}ignore(e){var t,n;t=e.raw,n=e.replacement,ej.add(tj(t,n)),this.removeRevision(e.id),this.emit("revisionChange",this.spellRevisions)}updateRevisionOffsetAfterApply(e){const{start:t,end:n,replacement:i}=e,o=this.getOffsetSortedRevisions();(0,vi.A)(o,(e=>{if(e.start<n)return;const o=i.length-(n-t);e.start+=o,e.end+=o})),this.emit("revisionChange",this.spellRevisions)}createRevisions(e){e.forEach((e=>{var t;const{sent_id:n}=e,i=this.sentences[n];i&&(null===(t=e.revision_units)||void 0===t||t.forEach((t=>{var o;null===(o=t.span_list)||void 0===o||o.forEach((o=>{const s=i.raw.slice(o.org_start_idx,o.org_end_idx),r=e.replacement.slice(o.edt_start_idx,o.edt_end_idx);if(!s||!r)return;if(((e,t)=>ej.has(tj(e,t)))(s,r))return;const a=(0,KI.A)(),{label_id:l}=t,c=i.start+o.org_start_idx,d=i.start+o.org_end_idx;this.spellRevisions[a]={id:a,labelId:l,sentId:n,type:"diff",raw:s,replacement:r,start:c,end:d}}))})))})),this.emit("revisionChange",this.spellRevisions)}destroy(){this.removeAllListeners(),this.spellRevisions={},this.sentences={},this.pendingSentences=[]}}class ij extends jd.A{constructor(...e){var t;super(...e),t=this,(0,y.A)(this,"queue",[]),(0,y.A)(this,"isRequesting",!1),(0,y.A)(this,"doRequest",(0,a.A)((function*(){if(!t.isRequesting&&0===t.queue.length)return void t.emit("finish");if(t.isRequesting)return;const e=t.queue.slice(0,10);t.queue=t.queue.slice(10),t.isRequesting=!0,t.emit("fetching");try{const n=yield(0,le.Y_)(e);t.emit("update",n.items)}catch(n){}t.isRequesting=!1,t.doRequest()}))),(0,y.A)(this,"request",((e,t)=>{this.queue=[...this.queue,...e],this.removeInvalidSentence(t),this.doRequest()}))}removeInvalidSentence(e){this.queue=this.queue.filter((t=>e.includes(t.id)))}destroy(){this.queue=[],this.removeAllListeners()}}const oj={spellRevisions:{},fetching:!1,showSuccessIfNeeded:!1},sj=e=>(0,r.A)((0,r.A)({},oj),{},{setSpellRevisions:t=>{e((()=>({spellRevisions:t})))},setActiveRevision:t=>{e((()=>({activeRevision:t})))},setFetching:t=>{e((()=>({fetching:t})))},setShowSuccessIfNeeded:t=>{e((()=>({showSuccessIfNeeded:t})))}});class rj{constructor(e,t){var n=this;(0,y.A)(this,"editor",void 0),(0,y.A)(this,"model",void 0),(0,y.A)(this,"store",void 0),(0,y.A)(this,"highlighterShadowContainer",void 0),(0,y.A)(this,"popupCardShadowContainer",void 0),(0,y.A)(this,"showSuccessTimer",null),(0,y.A)(this,"clearShowSuccessTimer",(()=>{this.showSuccessTimer&&(window.clearTimeout(this.showSuccessTimer),this.showSuccessTimer=null)})),(0,y.A)(this,"showSuccess",(()=>{this.store.getState().setShowSuccessIfNeeded(!0),this.clearShowSuccessTimer(),this.showSuccessTimer=window.setTimeout((()=>{this.store.getState().setShowSuccessIfNeeded(!1),this.showSuccessTimer=null}),1500)})),(0,y.A)(this,"ignore",(e=>{this.model.ignore(e)})),(0,y.A)(this,"replace",function(){var e=(0,a.A)((function*(e){n.model.isApplying=!0,yield n.editor.replace(e.start,e.end,e.replacement),n.model.removeRevision(e.id),n.model.isApplying=!1,n.showSuccess()}));return function(t){return e.apply(this,arguments)}}()),(0,y.A)(this,"replaceAll",(0,a.A)((function*(){n.model.isApplying=!0;const e=n.model.getOffsetSortedRevisions().reverse();for(const t of e)yield n.editor.replace(t.start,t.end,t.replacement);n.model.clearRevision(),n.model.isApplying=!1,n.showSuccess()}))),this.editor=e,this.model=t,this.store=(0,sg.vt)()((0,og.eh)(sj))}setRevisionStore(e){this.store.getState().setSpellRevisions(e.spellRevisions)}getRevisionState(){return this.store.getState()}getEditor(){return this.editor.dom}destroy(){this.store.destroy(),this.highlighterShadowContainer=void 0,this.popupCardShadowContainer=void 0,this.clearShowSuccessTimer()}}class aj extends jd.A{constructor(e){super(),(0,y.A)(this,"editor",void 0),(0,y.A)(this,"model",void 0),(0,y.A)(this,"env",void 0),(0,y.A)(this,"fetcher",void 0),(0,y.A)(this,"highlightRenderer",void 0),(0,y.A)(this,"popupCardRenderer",void 0),(0,y.A)(this,"disconnectObserveEditorLayout",void 0),(0,y.A)(this,"cacheNewSentences",[]),(0,y.A)(this,"bind",(()=>{this.disconnectObserveEditorLayout=DI(this.editor.dom,this.updateRevisionsRectsState),this.editor.addListener("contentChange",this.handleEditorContentChange),this.model.addListener("revisionChange",this.updateRevisionsRectsState),this.fetcher.addListener("update",this.handleRevisionFetchResp),this.fetcher.addListener("fetching",this.handleFetching),this.fetcher.addListener("finish",this.handleFetchFinish)})),(0,y.A)(this,"unbind",(()=>{var e;null===(e=this.disconnectObserveEditorLayout)||void 0===e||e.call(this),this.editor.removeListener("contentChange",this.handleEditorContentChange),this.model.removeListener("revisionChange",this.updateRevisionsRectsState),this.fetcher.removeListener("update",this.handleRevisionFetchResp),this.fetcher.removeListener("fetching",this.handleFetching),this.fetcher.removeListener("finish",this.handleFetchFinish)})),(0,y.A)(this,"handleRevisionFetchResp",(e=>{this.model.createRevisions(e)})),(0,y.A)(this,"handleFetching",(()=>{this.env.store.getState().setFetching(!0)})),(0,y.A)(this,"handleFetchFinish",(()=>{this.env.store.getState().setFetching(!1)})),(0,y.A)(this,"updateRevisionsRectsState",(()=>{const e=this.editor.getRevisionRect((0,dI.A)(this.model.spellRevisions));this.env.setRevisionStore({spellRevisions:(0,uI.A)(e,(e=>e.revision.id))})})),(0,y.A)(this,"handleEditorContentChange",(()=>{const{text:e}=this.editor,t=(new(mI())).insert(this.model.prevText).diff((new(mI())).insert(e));if(0===t.ops.length)return;this.model.prevText=e;const n=this.model.update(e,t,{keepRevs:this.model.isApplying});this.cacheNewSentences.push(...n),this.model.isApplying||this.debounceDoRevision()})),(0,y.A)(this,"filterRequestSentences",(e=>e.filter((e=>e.raw.length<2e3)))),(0,y.A)(this,"doRevision",(()=>{const e=Object.keys(this.model.sentences).map(Number);this.fetcher.request(this.filterRequestSentences(this.cacheNewSentences),e),this.cacheNewSentences=[]})),(0,y.A)(this,"debounceDoRevision",(0,Is.A)(this.doRevision,1500));const{editorType:t,element:n}=e;this.editor=this.createEditor(t,n),this.model=new nj,this.env=new rj(this.editor,this.model),this.fetcher=new ij,this.highlightRenderer=new WI(this.env),this.popupCardRenderer=new BI(this.env),this.bind(),this.handleEditorContentChange()}createEditor(e,t){return e===sC.Input?new sS(t):new tS(t)}destroy(){this.cacheNewSentences=[],this.unbind(),this.env.destroy(),this.editor.destroy(),this.model.destroy(),this.fetcher.destroy(),this.highlightRenderer.destroy(),this.popupCardRenderer.destroy()}}const lj=new class{constructor(){var e=this;(0,y.A)(this,"inited",!1),(0,y.A)(this,"controllerPool",new Map),(0,y.A)(this,"editorRemoveObservers",[]),(0,y.A)(this,"unbindAppStorageConfigChange",void 0),(0,y.A)(this,"bindAppStorageConfigChange",(()=>(re.A.watch({disableGlobalGrammar:this.handleAppStorageConfigChange,disableGrammarHosts:this.handleAppStorageConfigChange}),()=>{re.A.unwatch({disableGlobalGrammar:this.handleAppStorageConfigChange,disableGrammarHosts:this.handleAppStorageConfigChange})}))),(0,y.A)(this,"handleAppStorageConfigChange",(0,a.A)((function*(){yield(0,rr.uk)(500),e.isDisabledGrammar()?e.reset():e.init()}))),(0,y.A)(this,"isDisabledGrammar",(()=>{var e;if(null===(e=(0,se.TK)("authInfo"))||void 0===e||!e.isAuthenticated)return!0;const t=(0,se.TK)("disableGlobalGrammar"),n=(0,se.TK)("disableGrammarHosts");return!!(t||n.includes(window.location.hostname)||(0,ps.Im)())})),(0,y.A)(this,"bind",(()=>{document.addEventListener("focus",this.handleFocus,!0)})),(0,y.A)(this,"unbind",(()=>{document.removeEventListener("focus",this.handleFocus,!0)})),(0,y.A)(this,"handleFocus",(e=>{const{target:t}=e;t instanceof HTMLElement&&this.activeEditor(t)})),(0,y.A)(this,"observeEditorElementRemove",(e=>{if(!e.parentElement)return;const t=new MutationObserver((n=>{for(const i of n)if(i.removedNodes)for(const n of i.removedNodes)if(n===e){const n=this.controllerPool.get(e);return null==n||n.destroy(),this.controllerPool.delete(e),void t.disconnect()}}));return t.observe(e.parentElement,{childList:!0}),t})),(0,y.A)(this,"addController",((e,t)=>{let n=this.controllerPool.get(e);if(!n){n=new aj({element:e,editorType:t}),this.controllerPool.set(e,n);const i=this.observeEditorElementRemove(e);i&&this.editorRemoveObservers.push(i)}})),(0,y.A)(this,"activeEditor",(e=>{if(!(e instanceof HTMLElement))return!1;if(!this.isValid(e))return!1;const t=dC(e);if(!t)return!1;const{type:n,element:i}=t;return this.addController(i,n),!0})),(0,y.A)(this,"isValid",(e=>!!function(e){var t;const{hostname:n}=window.location;return!(cI.some((e=>rC(n,e)))||rC(n,"outlook.live.com",3)&&e.classList.contains("EditorClass")||e.classList.contains("mm-editor")&&null!==(t=lC(e))&&void 0!==t&&t.classList.contains("minder-editor-container")||e instanceof HTMLInputElement||e.matches('[data-testid="chat_input_input"]'))}(e))),this.bindAppStorageConfigChange()}init(){this.isDisabledGrammar()||this.inited||(this.inited=!0,this.activeEditor(document.activeElement),this.bind())}reset(){this.inited=!1,this.unbind(),this.editorRemoveObservers.forEach((e=>e.disconnect())),this.editorRemoveObservers=[],this.controllerPool.forEach((e=>e.destroy())),this.controllerPool.clear()}destroy(){var e;this.reset(),null===(e=this.unbindAppStorageConfigChange)||void 0===e||e.call(this)}},cj=function(){var e=(0,a.A)((function*(e){const{setIsShowSidebar:t}=Co.l.getState();try{var n;if((0,wo.BB)({action:"web_summary",loginParams:{trackMeta:{login_entrance:"float_btn"}}}))return;const i=window.location.href,o=yield(0,en.B9)(),s=(0,kn.wz)((0,se.TK)("uiLanguage"));t(!0,_.cz.other);const r={title:null==o?void 0:o.title,url:i,content:null==o?void 0:o.textContent};ai.on.getState().setFloatingCardVisible(!1),ai.on.getState().setSummaryActionVisible(!1),yield(0,ko.Z)();const{convId:a,convType:l,mainBotId:c}=(0,Jt.IK)(),d={text:i,extraExt:{origin:location.origin,browser_explain:JSON.stringify(r),llm_without_mem:"1",browser_language:s,flag_browser_plugin:"1",answer_with_suggest:"0",need_create_thread:l===Zt.H.NewThread?"1":"0"},reportParams:{scene:bo.sJ.chat_action_bar},ctx:(0,So.Pe)(l,a,c)};A.vF.persist.log({eventName:"summary_page_action",meta:{contentLength:null===(n=r.content)||void 0===n?void 0:n.length,from:"context-menu"}}),Co.l.getState().isSidePanelMode&&!aw._K.isInSidePanel?Tx.IF.getState().type===rw.u9.pdf?(0,jn.cs)({name:"read-pdf",body:{url:i}}):(0,jn.cs)({name:"send-message-to-chat",body:{msg:d,chatType:l}}):Tx.IF.getState().type===rw.u9.pdf?(0,wf.M)({url:i}):(dh.Qz.create("cici_summary_page_action_perf",!0),(0,ew.C)([d],{chatType:l,beforeSendMessage:t=>{null==e||e((null==t?void 0:t[0].local_message_id)||"")},botType:"Main"}))}catch(i){A.vF.persist.error({eventName:"[Context Menu] - SUMMARIZE",error:i})}}));return function(t){return e.apply(this,arguments)}}(),dj={name:"content-menu-click",handle:e=>{const{actionKey:t,selectionText:n=""}=e||{};if(t)if("collect_page"===t)ro({collectFrom:zt.vP.collect_this_page,collectionType:wn.X.Web}),(0,Ke.s)("right_click_function_click",{button_name:"collect_this_page",current_page:(0,zt.p$)()}),(0,$e.dn)({current_page:(0,zt.p$)(),click_from:"right_click_function_click"});else if("page-summarize"===t)cj(),(0,Ke.s)("right_click_function_click",{button_name:"summarize_this_page",current_page:(0,zt.p$)()}),(0,$e.dn)({current_page:(0,zt.p$)(),click_from:"right_click_function_click"});else if("page-translate"===t)(0,LS.TI)({isActive:!0}),(0,Ke.s)("right_click_function_click",{button_name:"translate_this_page",current_page:(0,zt.p$)(),translate_service:(0,se.TK)("pageTranslateService"),to_lang:(0,se.TK)("translateLanguage")}),(0,$e.dn)({current_page:(0,zt.p$)(),click_from:"right_click_function_click"});else{const{inputText:e,selectionBaseInfo:i}=qt.t_.getState(),o=!e||Tx.IF.getState().type===rw.u9.pdf||!(e=>{const{top:t,left:n,width:i,height:o,clientBottom:s}=e;return[t,n,i,o,s].every((e=>null!=e&&!isNaN(e)))})(i);if(o&&n){const e=(0,r.A)((0,r.A)({},bs.Ws),{},{text:n,contextText:n,anchorOffset:0});qt.t_.setState({inputText:n,selectionBaseInfo:e,simpleSelectionBaseInfo:e})}Io(t,_.Z5.context_menu,o)}}},uj={name:"tab-activated",handle:e=>{ai.on.getState().setTabInfo({tabId:e.tabId}),cT()}},hj={name:"toggle-cici-sidebar",handle:e=>{Co.l.getState().toggleShowSidebar((null==e?void 0:e.enterSidebarMode)||_.cz.other)}};var mj=n(8216),pj=n(25563);const gj=()=>{const e=(0,uT.c)(Object.values(s));return()=>{e(),uT.F.destroy()}};var vj=n(31826);const fj=function(){var e=(0,a.A)((function*(){var e,t;const n=yield(0,jn.cs)("check-and-update-ttwid");null!=n&&n.success&&null!==(e=n.data)&&void 0!==e&&e.success&&null!==(t=n.data)&&void 0!==t&&t.updated&&(yield(0,se.pu)({}))}));return function(){return e.apply(this,arguments)}}();let _j=!1;function xj(){return(xj=(0,a.A)((function*(){var e,t;if(_j)return!0;_j=!0,yield fj();const n=yield(0,jn.cs)("is-side-panel-enabled"),i=!!(0,Jr.s)()||Boolean(null==n||null===(e=n.data)||void 0===e?void 0:e.enabled),o=yield(0,jn.cs)("tab-info");ai.on.getState().setTabInfo({tabId:null==o||null===(t=o.data)||void 0===t?void 0:t.tabId}),Co.l.getState().setIsSidePanelMode(i),(0,jn.cs)({name:"update-auth-info",body:{reason:"cs: load start"}}),yield Promise.all([(0,se.lv)()]),function(){const{setLocalActionRecordUpperLimit:e}=wo.cj.getState();vj.bc.forEach((t=>{e(t,vj.zL)}))}()}))).apply(this,arguments)}const yj=(0,jh.A)((()=>{(0,se.TK)("installReason")&&((0,Ke.s)("extension_install_success",{reason:(0,se.TK)("installReason")}),(0,se.vE)("installReason",""))}));var bj=n(33522),wj=n(93888);let Cj;const Aj=e=>{const t=(0,Wr.id)(),{shadowContainer:n,shadowHost:i,shadowRoot:o}=(0,et.VT)(t?"div":ae.ly);return(e=>{u.m.getInstance().init(),Cj=u.m.getInstance().getHostId(),(0,Wr.id)()||(e.dataset.hostId=Cj)})(i),(0,et.YB)(i),e.mark("load_css_start"),(0,et.NR)(o,ae.QN).then((()=>{e.mark("load_css_end"),(0,et.XX)(n,OT),e.mark("component_mounted")})),o},Sj=()=>{if((0,l.Ny)())return;const e=[];e.push((()=>{var e;const t=(0,on.Ay)(location.href);if(!t)return null;let n=null===(e=t.watchRouteChange)||void 0===e?void 0:e.call(t,(()=>{ux(t)}));return ux(t),()=>{var e;null===(e=n)||void 0===e||e(),n=void 0}})()),e.push(hx()),e.push((()=>{var e;if(!(0,se.tl)("mail").enabled)return;const t=(0,lx.Ay)(location.href);if(!t)return;let n;const i=null===(e=t.watchMailWritable)||void 0===e?void 0:e.call(t,(()=>{var e;null===(e=n)||void 0===e||e(),n=gx(t)}));return n=gx(t),()=>{var e;null==i||i(),null===(e=n)||void 0===e||e()}})()),e.push(fx()),e.push((()=>{if(!(0,ot.ku)())return()=>"";let e=qr();const t={socialWebcollectDisabledAll:t=>{const{newValue:n}=t;var i;n?null===(i=e)||void 0===i||i():e=qr()}};return re.A.watch(t),()=>{var t;null===(t=e)||void 0===t||t()}})()),e.push((()=>{var e;const t=dn(location.href);if(!t)return;let n;const i=null===(e=t.watchRouteChange)||void 0===e?void 0:e.call(t,(()=>{var e;null===(e=n)||void 0===e||e(),n=xx(t)}));return n=xx(t),()=>{var e;null==i||i(),null===(e=n)||void 0===e||e()}})()),e.push((()=>{let e=[];return e=[(0,ot.I$)()?it():h.A],()=>{e.forEach((e=>null==e?void 0:e()))}})()),e.push(Ts()),e.push(or()),e.push((()=>{})),u.m.getInstance().registerRecyclables(e)},kj=function(){var e=(0,a.A)((function*(){try{(0,u.A)((()=>{const e=[Cx(),gj(),(0,wo.j)()];return()=>{e.forEach((e=>e()))}})()),(0,bj.Ao)();const e=dh.Qz.create("cici_assistant_startup_perf",!0);yield function(){return xj.apply(this,arguments)}(),(0,lI.F)(),yield Kr.Ay.initTea(),yield(0,Je.LE)(),yield(0,wj.f)(),yield rI();const t=()=>{var t;const n=Aj(e);null===(t=(0,bj.Gl)())||void 0===t||t.startResourceMonitor(n)};if((0,Wr.id)()){const{custom_attr:e}=(0,se.tl)("assistant_mount_config");Gr(ae.Xf,(()=>{const e=In.j.getAssistantContainer();return null!=e&&e.parentElement?e:null}),"display: block !important;",(e=>{const t=e.getAttribute("style");return!!t&&("z-index: unset;"!==t&&"display: block !important;"!==t)}),(()=>t()),e)}else t();if(Sj(),window.addEventListener("keydown",US),(0,u.A)((()=>window.removeEventListener("keydown",US))),(()=>{function e(e){var t,n;e.target instanceof HTMLAnchorElement&&(null===(t=e.dataTransfer)||void 0===t||t.setData("page-url",(0,Wr.Os)(e.target.href)),null===(n=e.dataTransfer)||void 0===n||n.setData("page-title",e.target.textContent||""))}document.addEventListener("dragstart",e),(0,u.A)((()=>document.removeEventListener("dragstart",e)))})(),(0,et.ZL)(),Cf.O.initMessageServiceCtx(),(0,Ix.wu)()&&(setTimeout((()=>{gy.init()}),2e3),(0,u.A)((()=>gy.reset()))),Ix.FH&&(lj.init(),(0,u.A)((()=>lj.reset()))),yj(),-1!==location.origin.indexOf("www.baidu.com")){const t=new MutationObserver((function(t){const n=In.j.getAssistantContainer();for(const i of t)for(const t of i.removedNodes)t===n&&Aj(e)}));t.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),(0,u.A)((()=>null==t?void 0:t.disconnect()))}cT()}catch(e){(0,ar.z3)(e),A.vF.persist.info({eventName:"[CSUI] - BOOTSTRAP",meta:(0,r.A)({},e)})}}));return function(){return e.apply(this,arguments)}}();kj().finally((()=>{(0,u.A)((()=>{var e;void 0!==Cj&&(null===(e=document)||void 0===e||null===(e=e.querySelector(`[data-host-id="${Cj}"]`))||void 0===e||e.remove(),Cj=void 0)})),(0,u.A)(se.LR),(0,u.A)((()=>{const e=d.Pv.get(c.aU.Socket);e&&e.drop()}))}))},10080:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(35278),o=n(82283);let s;const r=[new i.G,new o.P];function a(){return void 0===s&&(s=r.find((e=>e.enable()))||null),s}},84943:(e,t,n)=>{n.d(t,{Dn:()=>o,M:()=>a,Nt:()=>r,Sx:()=>s,wU:()=>i});const i=["ul:has(li)"],o=["block","flow-root","grid","list-item","flex","-webkit-box"],s="en-US",r="__Cici__translate__",a=["mjx-container"]},9064:(e,t,n)=>{n.d(t,{$8:()=>c,Ch:()=>i,J7:()=>u,JP:()=>a,Mx:()=>o,NU:()=>d,Nt:()=>m,SB:()=>r,Sf:()=>s,nC:()=>p,pK:()=>h,rA:()=>g,x_:()=>l});const i="__Cici_translate_similar_text_content__",o="__Cici_translate_origin_node__",s="__Cici_translate_translated_inject_node__",r="__Cici_translate_need_wrapper__",a="lle-page-translate-retry",l="__Cici_translate_loading__",c="__Cici_translate_clamp_unset__",d="__Cici_translate_global_wrapper__",u="__Cici_translated_text_show_underline__",h="__Cici_translate_hide_origin_content_wrapper__",m="__Cici__translate__",p="__Cici_translate_Safari__",g="__Cici__video_highlight__"},10517:(e,t,n)=>{n.d(t,{Ip:()=>x,J7:()=>C,S2:()=>b,Zq:()=>A,g$:()=>w,pz:()=>y});var i=n(14065),o=n(10633),s=n(59355),r=n(56422),a=n(84755),l=n(49278),c=n(12389),d=n(29988),u=n(44118),h=n(51727),m=n(69029),p=n(94953),g=n(88362),v=n(77591),f=n(47730);const _=new class{constructor(){var e=this;(0,o.A)(this,"translator",void 0),(0,o.A)(this,"prepareForMessageFromExtension",(()=>{a.A.on(c.$5,a.x.PAGE,(e=>{a.A.emit(c.Rx,a.x.PAGE,e)})),a.A.on(c.$x,a.x.PAGE,(e=>{e?this.translatePage():this.clearTranslate()})),a.A.on(c.FK,a.x.PAGE,(()=>{const{active:e}=l.I.getState();return a.A.emit(c.vb,a.x.PAGE,e),e})),a.A.on(c.oo,a.x.PAGE,(()=>{const e=g.IF.getState().url,t=new URL(e).hostname,n=(0,v.TK)("autoTranslatePageHosts"),i=(0,s.A)(n,t);a.A.emit(c.OH,a.x.PAGE,i)})),a.A.on(c.NZ,a.x.PAGE,(e=>{this.toggleCurrentPageAutoTranslate(e)})),a.A.on(c._m,a.x.PAGE,(()=>{const{showOrigin:e}=l.I.getState();a.A.emit(c.Yf,a.x.PAGE,e)})),a.A.on(c.bz,a.x.PAGE,(e=>{this.toggleShowOriginalContent(e)})),a.A.on(c.Qh,a.x.PAGE,(e=>{this.setTargetLangCode(e)}))})),(0,o.A)(this,"setTargetLangCode",(e=>{(0,(0,f.Y)("translateLanguage")[1])(e),d.A.set("translateLanguage",e);const{active:t}=l.I.getState();t&&this.translatePage()})),(0,o.A)(this,"toggleShowOriginalContent",(e=>{const{setShowOrigin:t}=l.I.getState();e?this.showOriginContent():this.hideOriginContent(),t(e)})),(0,o.A)(this,"toggleCurrentPageAutoTranslate",function(){var e=(0,i.A)((function*(e){const t=new URL(window.location.href).hostname,n=yield d.A.get("autoTranslatePageHosts"),i=e=>{d.A.set("autoTranslatePageHosts",e)};i(e?[...new Set([...n,t])]:(0,r.A)(n,(e=>e!==t)))}));return function(t){return e.apply(this,arguments)}}()),(0,o.A)(this,"translatePage",(0,i.A)((function*(){const t=yield d.A.get("translateLanguage"),n=yield d.A.get("pageTranslateService"),{setShowLangNotice:i,setActive:o}=l.I.getState();o(!0),e.pageTranslate({lang:t,translateService:(0,p.w)(n)});t===(yield(0,u.b)((0,u.T)()))&&i(!0)}))),(0,o.A)(this,"pageTranslate",(e=>{a.A.emit(c.P9,a.x.PAGE,!0);const{lang:t,translateService:n}=e;this.translator.start(t,n)})),(0,o.A)(this,"showOriginContent",(()=>{this.translator.showOriginContent()})),(0,o.A)(this,"translatedTextShowUnderline",(e=>{this.translator.translatedTextShowUnderline(e)})),(0,o.A)(this,"hideOriginContent",(()=>{this.translator.hideOriginContent()})),(0,o.A)(this,"clearTranslate",(()=>{const{setActive:e}=l.I.getState();a.A.emit(c.P9,a.x.PAGE,!1),this.translator.clearTranslate(),e(!1)})),(0,o.A)(this,"translatePartialPage",function(){var t=(0,i.A)((function*(t){const n=(0,v.TK)("translateLanguage"),i=yield d.A.get("pageTranslateService"),{setShowLangNotice:o}=l.I.getState();e.translator.startPartial({lang:n,service:(0,p.w)(i),container:t});n===(yield(0,u.b)((0,u.T)()))&&o(!0)}));return function(e){return t.apply(this,arguments)}}());const t=(0,m.sC)(),n=(0,m.c5)(),_=(0,m.qO)();this.translator=new h.r({strategyFilters:{traverse:t,paragraph:n,paragraphChild:_},onlyNeedIncludeSelectors:m.B2}),this.prepareForMessageFromExtension()}},{pageTranslate:x,showOriginContent:y,hideOriginContent:b,clearTranslate:w,translatedTextShowUnderline:C,translatePartialPage:A}=_},12710:(e,t,n)=>{n.d(t,{Bx:()=>i,Jh:()=>o,Zf:()=>s});const i=[["rgba(183, 201, 255, 0.44)","rgba(164, 186, 254, 0.44)"],["rgba(215, 160, 255, 0.44)","rgba(199, 126, 250, 0.44)"],["rgba(255, 201, 126, 0.44)","rgba(248, 191, 111, 0.44)"],["rgba(204, 255, 86, 0.44)","rgba(189, 243, 61, 0.44)"],["rgba(251, 255, 20, 0.44)","rgba(251, 255, 30, 0.44)"]];let o=function(e){return e.DictionaryChanged="dictionary-changed",e.DictionaryReady="dictionary-ready",e.Init="init",e}({});const s=["code.byted.org","data.bytedance.net","beta.doubao.com","www.doubao.com"]},95830:(e,t,n)=>{n.d(t,{Gx:()=>c,cP:()=>d,jo:()=>l});var i=n(14065),o=n(67685),s=n(70405);const r="en",a="zh";function l(e){return(0,s.S6)({method:"POST",url:`${o.C1}/samantha/word_notes/save`,data:{word:e,source_lang:r,target_lang:a}})}function c(e,t){const{operation:n=0}=t||{};return(0,s.S6)({method:"POST",url:`${o.C1}/samantha/word_notes/delete`,data:{word:e,delete_operation:n,source_lang:r,target_lang:a}})}function d(e){return u.apply(this,arguments)}function u(){return(u=(0,i.A)((function*(e){const{status:t=0}=e||{},n=yield(0,s.S6)({method:"GET",url:`${o.C1}/samantha/word_notes/get`,params:{source_lang:r,target_lang:a,status:t}});if(n instanceof Error)throw n;return n}))).apply(this,arguments)}},47881:(e,t,n)=>{n.d(t,{Bc:()=>x,Pe:()=>b,ci:()=>f});var i=n(14065),o=n(12648),s=n(10484),r=n(77526),a=n(42265),l=n(75484),c=n(93476),d=n(5842),u=n(77591),h=n(44963),m=n(21559),p=n(20825),g=n(77191);function v(){return(v=(0,i.A)((function*(e){var t;const n=yield l.pU.getState().fetchUpdateConversationInfo(e);yield r.ozw.getState().initMessageList({conversationId:e,messageCursor:Number(null==n?void 0:n.message_cursor),messageIndex:Number(null==n?void 0:n.message_index),range:{start:Number(null==n?void 0:n.message_cursor),end:Number(null==n?void 0:n.message_index)},isGuest:!(null!==(t=(0,u.Fc)())&&void 0!==t&&t.isAuthenticated)})}))).apply(this,arguments)}function f(e){return _.apply(this,arguments)}function _(){return _=(0,i.A)((function*({messageIds:e=[],switchMessageId:t="0"}){const n=yield(0,d.$D)();if(void 0!==n){try{yield(0,g.U8)({conversationId:n,messageIds:e,switchMessageId:t})}catch(i){m.vF.persist.error({message:"push record error",error:i})}c.l.getState().isSidePanelMode&&!p._K.isInSidePanel?(0,h.c)({name:"continue-in-chat",body:{conversationId:n}}):function(e){v.apply(this,arguments)}(n)}})),_.apply(this,arguments)}function x(e,t){return y.apply(this,arguments)}function y(){return(y=(0,i.A)((function*(e,t){c.l.getState().isSidePanelMode&&!p._K.isInSidePanel?yield(0,h.c)({name:"send-message-to-chat",body:{msg:t,chatType:e}}):(0,a.C)(t,{chatType:e,botType:"Main"})}))).apply(this,arguments)}function b(e,t,n){const i=e===s.H.NewThread;return{botId:n,conversationId:i?void 0:t,localConversationId:i?t:void 0,conversationType:i?o.Cr.CocoWebSub:void 0}}},29761:(e,t,n)=>{n.d(t,{O:()=>P,z:()=>B});var i=n(44557),o=n(10633),s=n(79123),r=n(56642),a=n(15159),l=n(16100),c=n(15309),d=n(17834),u=n(43400),h=n(46077),m=n(77526),p=n(98302),g=n(11177),v=n(26206),f=n(15574),_=n(80177),x=n(26817),y=n(29537),b=n(78057),w=n(20682),C=n(83817),A=n(39500),S=n(73929),k=n(19773),E=n(67685),T=n(12038),I=n(47669),j=n(8522),N=n(25141),R=n(7246),M=n(77591);const P=new class{constructor(){(0,o.A)(this,"ctxInit",!1),(0,o.A)(this,"msgProtocolInit",!1),(0,o.A)(this,"serviceCtx",null),(0,o.A)(this,"initMessageServiceCtx",(()=>{if(this.ctxInit)return;this.ctxInit=!0;const{chatBizPlugins:e,configServiceInitParams:t,teaServiceInitParams:n,botServiceInitParams:i}=B(),o=(0,d.c4)(n),r=(0,u.uk)(t),a=(0,h.V)(i),l=(0,m.TbE)({plugins:[c.g,f.m,...p.S,..._.U,...m.Qoi,...x.m,...m.ic8,...g.j,...(0,s.A)(e,(e=>e.chatMessage||[]))]}),b=(0,v.ay)({plugins:(0,s.A)(e,(e=>e.chatInput||[]))}),w={chatMessageService:l,chatConfigService:r,chatBotService:a,chatTeaService:o,chatFeedService:(0,y.Kl)(),chatInputService:b};for(const s of Object.values(w))s.ctx=w;this.serviceCtx=w})),(0,o.A)(this,"initMessageProtocolService",(()=>{var e;if(this.msgProtocolInit)return;const{messageProtocolServiceInitOptions:t}=B();t.config&&null!==(e=this.serviceCtx)&&void 0!==e&&e.chatMessageService&&(this.msgProtocolInit=!0,this.serviceCtx.chatMessageService.updateInitMessageProtocolServiceConfig(t),this.serviceCtx.chatMessageService.tryInitMessageProtocolService())}))}},L=e=>(0,I.w)((t=>e?t.botMap[e]:void 0),r.A),B=()=>({teaServiceInitParams:{tracker:T.bs},configServiceInitParams:()=>{var e;return{appId:Number(E.sZ),userId:(0,M.Fc)().userId,loginSource:"flow-ext",createUploader:e=>new a.UploaderService((0,i.A)((0,i.A)({},e),{},{useDirectUpload:!0})),isGuest:!(null!==(e=(0,M.Fc)())&&void 0!==e&&e.isAuthenticated),localFeatureConfig:{enableMessageListVirtualScroll:!1,enableMessageDebug:!1},featureGating:(0,i.A)((0,i.A)({},u.CA),{},{enableSendFileMessage:!0,enableSendWithAttachmentArea:!0,enableSendOcrImage:!0,enableNewImageCreationSkill:!0,enableSkillPin:!1})}},asrServiceInitParams:{useAudioWorklet:!0},botServiceInitParams:{actions:I.w.getState(),useBotInfoHook:L},chatBizPlugins:[...(0,j.ov)(),...w.C,...k.O,...b.B,...A.d,...C.p,...S.I,...(0,j.Op)(),...R.U,...j.Ge],messageProtocolServiceInitOptions:{config:{},socketClient:N.Hv,reportEvent:(0,l.XB)({eventName:"ext_message_service"}),fetchStream:{baseURL:`https://${E.FI}`,deprecatedClient:N._v}}})},26225:(e,t,n)=>{n.d(t,{E:()=>u,_:()=>d});var i=n(14065),o=n(1717),s=n(35791),r=n(16409),a=n(2573),l=n(20825);let c="";const d=function(){var e=(0,i.A)((function*(){const e=Math.random().toString(32).slice(3);let t;if(c=e,l._K.isInSidePanel){const n=yield(0,r.Iq)({name:"get-screen-capture",body:{requestId:e,mode:"only-capture"}},36e5);if(n.success&&n.data&&n.data.requestId===c){const e=n.data.data;t=(0,o.I0)(e)}}else{s.RT.getState().setReportParams({from:"chat_enter_bar"});const n=yield u(e,"only-capture",!1);(null==n?void 0:n.requestId)===e&&(t=n.data)}return t?(0,o.ps)(t):null}));return function(){return e.apply(this,arguments)}}(),u=(e,t,n=!0)=>(s.RT.setState({captureMode:t||"global",open:!0}),new Promise((t=>{a.A.once("get-screen-capture-done",(i=>{i?n?(0,o.ql)(i).then((n=>{t({data:n,requestId:e})})):t({data:i,requestId:e}):t({requestId:e})}))})))},64353:(e,t,n)=>{n.d(t,{I:()=>r});var i=n(21811),o=n(77591),s=n(16409);const r=e=>{(0,o.TK)("authInfo").isAuthenticated?(0,s.cs)({name:"open-options-page",body:e}):(0,i.DT)()}},86855:(e,t,n)=>{n.d(t,{t_:()=>v});var i=n(14065),o=n(44557),s=n(34870),r=n(45498),a=n(60296),l=n(64802),c=n(5440),d=n(89669),u=n(75943),h=n(4290),m=n(77591),p=n(96638);const g={inputTextReady:!0,barVisible:!1,barFakeHide:!1,boxVisible:!1,displayMode:"bar",inputText:"",contextText:"",range:null,currentAction:p.EU.explain,actionMessages:{},messageCursor:0,askContent:"",writeEnabled:!1,selectionBaseInfo:(0,o.A)({},c.Ws),simpleSelectionBaseInfo:(0,o.A)({},c.Ws),sceneId:void 0},v=(0,r.vt)()((0,s.eh)(((e,t)=>{return(0,o.A)((0,o.A)({},g),{},{setBarVisible:t=>e((()=>({barVisible:t,barFakeHide:!t}))),setBarFakeHide:t=>e((()=>({barFakeHide:t}))),setBoxVisible:t=>e((()=>({boxVisible:t}))),setDisplayMode:t=>e((()=>({displayMode:t}))),setInputText:t=>e((()=>({inputText:t}))),setRange:t=>e((()=>({range:t}))),setAskContent:t=>e((()=>({askContent:t}))),setCurrentAction:t=>e((()=>({currentAction:t}))),clearMessages:()=>e((()=>g)),setMessageCursor:t=>e((()=>({messageCursor:t}))),setWriteEnabled:t=>{e((()=>({writeEnabled:t})))},setTone:t=>{e((()=>({tone:t})))},search:n=>{var i,s;const{inputText:r,currentAction:c,lastSearchId:d="",abort:u,tone:g,askContent:v,range:f}=t();u(null!==(i=null==n||null===(s=n.abortOptions)||void 0===s?void 0:s.id)&&void 0!==i?i:d,null==n?void 0:n.abortOptions);const{enter_chat_method:_,current_page:x="",scene:y="",contextText:b="",translateService:w,answerWithSuggest:C,sceneId:A}=n||{},S=(null==n?void 0:n.text)||r;let k=S;const E=c===p.EU.translate?(0,m.TK)("translateLanguage"):"";let T,I="";var j;(c===p.EU.ask?I=v:c===p.EU.translate&&f&&(k=(0,l.l$)(f)||k),c===p.EU.adjust_skill)?T=(0,h.gR)({text:k||"",template_type:"tone",tone:null==g?void 0:g.value,scene:"highlight_search_result_tool",sec_scene:"highlight_search_result_adjust_tone"}):T=a.P.getState().sendMessage({text:k,prompt:c,language:null!==(j=null==n?void 0:n.language)&&void 0!==j?j:E,answerWithSuggest:C,enter_chat_method:_,current_page:x,scene:y,userQueryContent:I,sec_scene:null==n?void 0:n.sec_scene,isUserCustomSkill:(0,p.em)(c),contextText:b,translateService:w,sceneId:A});e((e=>({inputText:c===p.EU.ask?S:k,actionMessages:(0,o.A)((0,o.A)({},e.actionMessages),{},{[e.currentAction]:[T]}),messageCursor:0,lastSearchId:T})))},regenerate:({replyId:n,enter_chat_method:i,current_page:s="",scene:r="",answerWithSuggest:l}={})=>{var c;const{actionMessages:d,inputText:u,currentAction:g,messageCursor:v,tone:f}=t(),_=null===(c=d[g])||void 0===c?void 0:c[v],x=a.P.getState().messages[null!=_?_:""];let y;var b;g===p.EU.adjust_skill?y=(0,h.gR)({text:u||"",template_type:"tone",tone:null==f?void 0:f.value,scene:"highlight_search_result_tool",sec_scene:"highlight_search_result_adjust_tone"}):y=a.P.getState().sendMessage({text:u,prompt:g,enter_chat_method:i,current_page:s,scene:r,language:g===p.EU.translate?(0,m.TK)("translateLanguage"):navigator.language,isRegenerate:!0,replyId:n||(null==x||null===(b=x.body)||void 0===b||null===(b=b.message)||void 0===b?void 0:b.reply_id),isUserCustomSkill:(0,p.em)(g),answerWithSuggest:l});e((e=>{var t;const n=[...null!==(t=e.actionMessages[e.currentAction])&&void 0!==t?t:[],y];return{actionMessages:(0,o.A)((0,o.A)({},e.actionMessages),{},{[e.currentAction]:n}),messageCursor:n.length-1,lastSearchId:y}}))},retry:({enter_chat_method:n,current_page:i="",scene:s=""}={})=>{const{inputText:r,currentAction:l}=t(),c=a.P.getState().sendMessage({text:r,prompt:l,enter_chat_method:n,current_page:i,scene:s,language:l===p.EU.translate?(0,m.TK)("translateLanguage"):navigator.language,isUserCustomSkill:(0,p.em)(l)});e((e=>{var t;const n=null!==(t=e.actionMessages[e.currentAction])&&void 0!==t?t:[];return n.splice(e.messageCursor,1,c),{actionMessages:(0,o.A)((0,o.A)({},e.actionMessages),{},{[e.currentAction]:n}),lastSearchId:c}}))},abort:(e,t)=>{a.P.getState().abortMessage(e,t)},checkAndSetInputLang:(n=(0,i.A)((function*(){e({inputTextLangDetecting:!0});const n=yield(0,d.v)(t().inputText);return e({inputTextLang:n,inputTextLangDetecting:!1}),n})),function(){return n.apply(this,arguments)}),setSceneId:t=>e({sceneId:t}),setTrigger:t=>e({trigger:t})});var n})));u.m.getInstance().registerStore("useSelectAssistantStore",v)},90747:(e,t,n)=>{n.d(t,{BB:()=>g,GQ:()=>_,OB:()=>p,cj:()=>f,j:()=>x});var i=n(44557),o=n(11855),s=n(34870),r=n(45498),a=n(18590),l=n(21811),c=n(77591),d=n(96638),u=n(47730),h=n(2573);const m="onboardingActionRecord",p=(e,t="web")=>{switch(e){case d.EU.ask:return`${t}_ask`;case d.EU.mail:return`${t}_gmail`;default:return`${t}_${e}`}},g=e=>{const{action:t,triggerLogin:n=!0,loginParams:i}=e,{isActionLimited:o,actionRecordUseOnce:s}=f.getState();return o(t||"")?(n&&(0,l.DT)(i),!0):(t&&s(t),!1)},v={actionRecordUpperLimit:new Map,limitedActionRecord:new Set,limitedBrowserPluginSkill:new Set},f=(0,r.vt)()((0,s.eh)(((e,t)=>(0,i.A)((0,i.A)({},v),{},{setLocalActionRecordUpperLimit:(n,i)=>e((()=>({actionRecordUpperLimit:t().actionRecordUpperLimit.set(n,i)}))),actionRecordUseOnce:e=>{var n;if(!t().actionRecordUpperLimit.has(e))return;const{count:i=0}=(null===(n=(0,c.TK)(m))||void 0===n?void 0:n[e])||{};(0,c.vE)(m,{[e]:{count:i+1}},!0)},addLimitedActionRecord:n=>e((()=>({limitedActionRecord:t().limitedActionRecord.add(n)}))),addLimitedBrowserPluginSkill:n=>e((()=>({limitedBrowserPluginSkill:t().limitedBrowserPluginSkill.add(n)}))),isActionLimited:e=>{var n;const{isAuthenticated:i}=(0,c.TK)("authInfo");if(i)return!1;if(t().limitedActionRecord.has(e))return!0;const{count:o=0}=(null===(n=(0,c.TK)(m))||void 0===n?void 0:n[e])||{},s=t().actionRecordUpperLimit.get(e);return void 0!==s&&o>s},isBrowserPluginSkillLimited:e=>{const{isAuthenticated:n}=(0,c.TK)("authInfo");return!n&&t().limitedBrowserPluginSkill.has(e)}}))));function _(e){const{isActionLimited:t}=f((e=>e)),[n]=(0,u.Y)("authInfo"),{isAuthenticated:i}=n,[s,r]=(0,o.useState)(t(e));return(0,o.useEffect)((()=>{r(t(e));const n=()=>{r(t(e))};return h.A.on("limitedRecordChange",n),()=>{h.A.off("limitedRecordChange",n)}}),[i,e]),s}function x(){return h.A.on("stream-call-bot-unAuthorized",w),h.A.on("api-request-proxy-unAuthorized",C),h.A.on("fetch-stream-proxy-unAuthorized",A),()=>{h.A.off("stream-call-bot-unAuthorized",w),h.A.off("api-request-proxy-unAuthorized",C),h.A.off("fetch-stream-proxy-unAuthorized",A)}}function y(e,t){(0,l.DT)({trackMeta:{login_entrance:e,action_type:t}})}const b=new Map([["explain","web_explain"],["search","web_search"],["youtube","web_video_summary"]]),w=({params:e})=>{const{prompt:t,preventDefaultAuthAction:n}=e,i=b.get(t)||t;if(i===d.EU.browser_plugin_info){const{addLimitedBrowserPluginSkill:t}=f.getState(),{browser_plugin_info:n="{}"}=e,i=(0,a.O)(n,{});null!=i&&i.skill_name&&(t(i.skill_name),h.A.emit("limitedRecordChange"))}else{const{addLimitedActionRecord:e}=f.getState();e(i),h.A.emit("limitedRecordChange")}n||y("stream_call_bot_error",i)},C=({params:e})=>{const{preventDefaultAuthAction:t}=e||{};t||y("api_request_proxy_error")},A=({params:e})=>{const{preventDefaultAuthAction:t}=e||{};t||y("fetch_stream_proxy_error")}},70139:(e,t,n)=>{n.d(t,{Gq:()=>v,Ie:()=>u,Jg:()=>h,R_:()=>p,S1:()=>l,eR:()=>g,j$:()=>f,jv:()=>d,mu:()=>m,oJ:()=>c,pM:()=>_});var i=n(44557),o=n(12038),s=n(56397),r=n(36700),a=n(78503);let l=function(e){return e.NORMAL="normal",e.READ_PAGE="read_this_page",e}({});const c=()=>{(0,o.z8)(s.Ur.showChatAssistant,{})},d=()=>{(0,o.z8)(s.Ur.showChatAssistantPopover,{})},u=({button_name:e,params:t})=>{(0,o.z8)(s.Ur.clickChatAssistantPopover,(0,i.A)({button_name:e,current_page:(0,r.p$)(),click_from:s.Z5.chatAssistantPopover},t))},h=({button_name:e})=>{(0,o.z8)(s.Ur.showChatAssistantPopoverSettings,{button_name:e})},m=({button_name:e,value:t})=>{(0,o.z8)(s.Ur.clickChatAssistantPopoverSettings,{value:t?"1":"0",button_name:e,click_from:s.Z5.chatAssistantPopoverSettings})},p=({button_name:e})=>{(0,o.z8)(s.Ur.showChatHeaderBtn,{current_page:a.$2.chat,button_name:e})},g=({button_name:e})=>{(0,o.z8)(s.Ur.clickChatHeaderBtn,{current_page:a.$2.chat,button_name:e})},v=({highlight_page_url:e,module_name:t})=>{(0,o.z8)(s.Ur.showChatFloatCard,{highlight_page:(0,o.M5)(e),module_name:t})},f=({highlight_page_url:e,module_name:t,button_name:n})=>{(0,o.z8)(s.Ur.clickChatFloatCard,{highlight_page:(0,o.M5)(e),module_name:t,button_name:n})},_=({click_from:e})=>{(0,o.z8)(s.Ur.clickChatAssistant,{click_from:e},!1,!1)}},36700:(e,t,n)=>{n.d(t,{NP:()=>h,ae:()=>c,mL:()=>u,o2:()=>d,p$:()=>l,p6:()=>r,vP:()=>s});var i=n(12038),o=n(56397);let s=function(e){return e.arxiv_view_pdf="arxiv_view_pdf",e.chrome_pdf_viewer="chrome_pdf_viewer",e.side_bar_popover="side_bar_popover",e.search_result_card="search_result_card",e.video_page_summarize="video_page_summarize",e.highlight_result_card_translate="highlight_result_card_translate",e.highlight_result_card_explain="highlight_result_card_explain",e.highlight_result_card_custom_skill="highlight_result_card_custom_skill",e.highlight_function_bar="highlight_function_bar",e.right_click="right_click",e.collect_this_page="collect_this_page",e.webimage_collect="webimage_collect",e.video_memo_save="video_memo_save",e.web_other="web_other",e.podcast_collect="podcast_collect",e.after_screenshot="after_screenshot",e.extract_text_card="extract_text_card",e}({}),r=function(e){return e.videosummary="videosummary",e.searchresult="searchresult",e.textfragment="textfragment",e.TranslateResult="TranslateResult",e.ExplainResult="ExplainResult",e.CustomSkillResult="CustomSkillResult",e.web="web",e.pdf="pdf",e.Podcast="Podcast",e.Image="Image",e.Screenshot="ScreenShot",e.ExtractText="ExtractText",e}({});function a(e=location.hostname){return e}function l(){return(0,i.M5)(location.href)}function c(e,t){(0,i.z8)(o.Ur.collectionButtonShow,{show_from:e,current_page:l(),collect_type:t,collect_from_site:a()})}function d(e,t,n="collect"){(0,i.z8)(o.Ur.collectionButtonClickSave,{click_from:e,collect_type:t,current_page:l(),collect_from_site:a(),button_name:n})}function u(e,t,n,s){(0,i.z8)(o.Ur.collectionButtonClickSaveStatus,{click_from:e,current_page:l(),collect_from_site:a(),success:t,collect_type:n,collect_id:s})}function h(e){(0,i.z8)(o.Ur.seeCollectionButtonShow,{show_from:e,current_page:l()})}},58484:(e,t,n)=>{n.d(t,{M7:()=>d,dn:()=>h,gR:()=>u,zl:()=>m});var i=n(72106),o=n(56397),s=n(82770),r=n(82275),a=n(97311),l=n(21559);const c=e=>e&&e!==o.g6.webOther?e:window.location.host,d=e=>{var t;const{current_page:n,show_from:r,show_type:a}=e,l=(0,i.A)({current_page:c(n),show_from:r,show_type:a},(e=>void 0===e));null===(t=s.Ay.Tea)||void 0===t||t.event(o.Ur.viewDAU,l)},u=(e,t)=>e===o.Ur.enterPage&&(null==t?void 0:t.current_page)===o.g6.chat?(t.show_from="enter_page_chat",void d(t)):e===o.Ur.showMailEntryButton||e===o.Ur.writingSkilShow?(t.show_from=t.show_from||e,void d(t)):e===o.Ur.showSelectAssistantMenu||e===o.Ur.showSearchAssistant||e===o.Ur.showVideoAssistant||e===o.Ur.showChatAssistant||e===o.Ur.collectionButtonShow?(t.show_from=e,void d(t)):e===o.Ur.searchLinkPreviewEntryShow||e===o.Ur.hyperLinkPreviewEntryShow?(t.show_from=e===o.Ur.searchLinkPreviewEntryShow?o.Z5.searchResultPreview:o.Z5.hyperlinkResultPreview,void d(t)):e===o.Ur.showPodcastAssistant?(t.show_from=o.Z5.podcast_show,void d(t)):void 0,h=e=>{var t;null===(t=s.Ay.Tea)||void 0===t||t.event(o.Ur.activeDAU,{current_page:c(null==e?void 0:e.current_page),button_name:null==e?void 0:e.button_name,click_from:null==e?void 0:e.click_from})},m=(e,t)=>e!==o.Ur.copy&&e!==o.Ur.regenerate&&e!==o.Ur.continueInChat&&e!==o.Ur.retry||(null==t?void 0:t.click_from)!==o.Z5.selectAssistantResult?(null==t?void 0:t.click_from)===o.Z5.deepSearchMode||e===o.Ur.searchResultCardClick||e===o.Ur.clickDeepSearchBtn?(t.click_from=o.Z5.searchAssistant,void h(t)):t.click_from!==a.sJ.writing_assistant?e===o.Ur.copy||e===o.Ur.regenerate||e===o.Ur.continueInChat||e===o.Ur.retry||e===o.Ur.clickSearchAssistantSuggest?(null===t.click_from&&l.vF.persist.log({eventName:"NULL_CLICK_FROM_EVENT",meta:{event_name:e,params:t}}),void h(t)):e===o.Ur.clickSelectAssistantMenuBtn||e===o.Ur.clickSelectAssistantResultBtn?(t.click_from=o.Z5.selectAssistantMenu,void h(t)):e!==o.Ur.clickVideoAssistantSummarizeBtn||t.click_from!==r.K.IMMERSION_BTN&&t.click_from!==r.K.UPPER_RIGHT&&t.click_from!==r.K.ONBOARDING?e===o.Ur.clickVideoImmersionGuideTips||e===o.Ur.clickVideoImmersionGuideIcon||e===o.Ur.immersionTimeLine?(t.click_from=o.Z5.videoAssistant,void h(t)):e===o.Ur.clickChatAssistantPopoverSettings||e===o.Ur.clickChatAssistantPopover?(t.click_from=o.Z5.chatAssistantPopover,void h(t)):e===o.Ur.sendMessage&&(null==t?void 0:t.current_page)===o.g6.chat?(t.click_from=o.Z5.sendMessageInChat,void h(t)):e===o.Ur.clickMailEntryButton?(t.click_from=o.Z5.mailEntryButton,void h(t)):e===o.Ur.collectionButtonClickSave?(t.click_from=o.Z5.collect,void h(t)):e===o.Ur.searchLinkPreviewResultShow||e===o.Ur.hyperLinkPreviewResultShow?(t.click_from=e===o.Ur.searchLinkPreviewResultShow?o.Z5.searchResultPreview:o.Z5.hyperlinkResultPreview,void h(t)):e===o.Ur.clickPodcastAssistantSummarizeBtn||e===o.Ur.clickPodcastAssistantSummarizeResult?(t.click_from=o.Z5.podcast_click,void h(t)):e===o.Ur.quickTranslate?(t.click_from=o.Z5.quick_translate,void h(t)):e===o.Ur.takeNoteBtnClick?(t.click_from=o.Z5.videoAssistant,void h(t)):void 0:(t.click_from=o.Z5.videoAssistant,void h(t)):void h(t):(t.click_from=o.Z5.selectAssistantMenu,void h(t))},56397:(e,t,n)=>{n.d(t,{Ld:()=>a,Ur:()=>l,Yd:()=>s,Z5:()=>o,_h:()=>r,cz:()=>c,g6:()=>i});let i=function(e){return e.setting="setting",e.landing="landing",e.welcome="extension_welcome",e.login="login",e.uninstall="uninstall",e.extensionOther="extension_other",e.baidu="search_engine_baidu",e.google="search_engine_google",e.bing="search_engine_bing",e.toutiao="search_engine_toutiao",e.youtube="youtube",e.bilibili="bilibili",e.douyin="douyin",e.chat="chat",e.chatgpt="chatgpt",e.mail="mail_page",e.xiaoyuzhou="xiaoyuzhou",e.apple="apple",e.webOther="web_otherpage",e}({}),o=function(e){return e.onboarding="onboarding",e.selectAssistantMenu="highlight_function_bar",e.selectAssistantMoreMenu="highlight_function_bar_dropdown",e.selectAssistantResult="highlight_result_card",e.searchAssistant="search_result_card",e.videoAssistant="video_page_summarize",e.podcastAssistant="podcast_page_summarize",e.chatAssistantPopover="sidebar_action_popover",e.chatAssistantPopoverSettings="sidebar_action_popover_settings",e.sendMessageInChat="send_message_in_chat",e.mailCreate="mail_create",e.mailUpdate="mail_update",e.mailEntryButton="mail_entry_button",e.mailPositive="mail_positive",e.mailNegative="mail_negative",e.mailNeedMore="mail_need_more",e.arxiv="arxiv",e.pdf="pdf",e.context_menu="context_menu",e.shortcut="shortcut",e.inputText="input_text",e.collect="collect",e.searchResultPreview="search_result_preview",e.hyperlinkResultPreview="hyperlink_preview",e.deepSearchMode="deep_search_mode",e.podcast_show="podcast_summarize_show",e.podcast_click="podcast_summarize",e.quick_translate="quick_translate",e}({}),s=function(e){return e.setting="setting",e.addASkill="add_a_skill",e.discoverSkill="discover_skill",e}({}),r=function(e){return e.insert="insert_below",e.replace="replace_selection",e.suggest="suggest",e.share="share",e.summarizeVideo="summarize_video",e.immersionGuideTips="immersion_guide_tips",e.immersionGuideIcon="immersion_guide_icon",e.summarizePodcast="summarize_podcast",e.translatePage="translate_this_page",e.summarizePage="summarize_this_page",e.languageSettings="language_settings",e.displayOriginalText="display_original_text",e.alwaysTranslatePage="always_translate_this_page",e.viewInWeb="view_in_web",e.settings="settings",e.historyChats="history_chats",e.collection="collection",e.allConversation="all_conversation",e.understandContext="understand_context",e.download="download",e.updateLog="update_log",e.highlightRecord="highlight_record",e.highlightSelectionBar="highlight_selection_bar",e.fold="fold",e.expand="expand",e.expanded="expanded",e.collapsed="collapsed",e.regeneration="regeneration",e.formalize="formalize",e.elaborate="elaborate",e.shorten="shorten",e.write="help_me_write",e.rewrite="rewrite",e.changeReplyLang="change_reply_lang",e.hideUntilNext="hide_until_next",e.closeWritingAssistant="close_writing_assistant",e.closeGrammerCheck="close_grammar_check",e.writingLanguage="language_setting",e.btnCopy="copy",e.btnInsert="insert",e.btnReplace="replace",e.helpMeReply="help_me_reply",e.gotIt="got_it",e.save="save",e.targetLanguage="target_language",e.shortcut="shortcut",e.translateService="translate_service",e.dismiss="dismiss",e.understandContextOn="understand_context_on",e.understandContextOff="understand_context_off",e.screenCapture="screenshot",e.searchButton="search",e.voiceInput="voice_input",e.translateRead="read",e.translateEdit="edit",e.translateCopyOrigin="copy_origin",e}({}),a=function(e){return e.search="search_related_suggested_prompt",e.select_explain="explain_related_suggested_prompt",e.video_summary_card="video_summary_card",e.podcast_summary_card="podcast_summary_card",e}({}),l=function(e){return e.copy="copy",e.regenerate="click_regenerate",e.continueInChat="continue_in_chat",e.retry="retry",e.enterPage="enter_page",e.generationFailure="generation_failure",e.share="share",e.viewDAU="view_dau",e.activeDAU="active_dau",e.sendMessage="send_message",e.showSelectAssistantMenu="highlight_function_bar_show",e.showSelectAssistantBtn="highlight_function_bar_function_show",e.clickSelectAssistantMenuBtn="highlight_function_bar_click",e.showSelectAssistantResult="highlight_result_show",e.clickSelectAssistantResultBtn="highlight_result_action",e.closeSelectAssistantResult="highlight_result_close",e.showChatAssistant="side_bar_entrance_show",e.clickChatAssistant="side_bar_entrance_click",e.showChatAssistantPopover="show_side_bar_popover",e.clickChatAssistantPopover="click_side_bar_popover",e.showChatAssistantPopoverSettings="show_side_bar_settings_popover_button",e.clickChatAssistantPopoverSettings="click_side_bar_settings_popover_button",e.showChatHeaderBtn="show_chat_header_button",e.clickChatHeaderBtn="click_chat_header_button",e.showChatFloatCard="highlight_action_module_sidebarshow",e.clickChatFloatCard="highlight_action_module_sidebarclick",e.showSearchAssistant="search_result_card_show",e.searchResultCardClick="search_result_card_click",e.showSearchAssistantSuggest="show_suggested_prompt",e.showSearchAssistantSuggestQuestion="show_suggested_prompt_single_question",e.clickSearchAssistantSuggest="click_suggested_prompt",e.closeSearchAssistant="search_result_card_disappear",e.showDeepSearchAssistant="search_summarize_result_show",e.showSources="sources_show",e.clickSources="sources_click",e.collapseDeepSearchCard="search_card_collapse",e.showDeepSearchBtn="deep_search_button_show",e.clickDeepSearchBtn="deep_search_button_click",e.showVideoAssistant="video_summarize_module_show",e.clickVideoAssistantSummarizeBtn="video_summarize_module_click",e.showVideoAssistantSummarizeResult="video_summarize_result_show",e.clickVideoAssistantSummarizeResult="video_summarize_result_click",e.showVideoAssistantHighlightsTimeline="highlights_timeline_singleshow",e.clickVideoAssistantHighlightsTimeline="highlights_timeline_singleclick",e.clickVideoImmersion="video_immersion_click",e.showVideoImmersion="video_immersion_show",e.immersionTimeLine="immersion_timeline",e.showVideoImmersionGuideTips="video_immersion_guide_tips_show",e.clickVideoImmersionGuideTips="video_immersion_guide_tips_click",e.showVideoImmersionGuideIcon="video_immersion_guide_icon_show",e.clickVideoImmersionGuideIcon="video_immersion_guide_icon_click",e.showPodcastAssistant="podcast_summarize_module_show",e.clickPodcastAssistantSummarizeBtn="podcast_summarize_module_click",e.showPodcastAssistantSummarizeResult="podcast_summarize_result_show",e.clickPodcastAssistantSummarizeResult="podcast_summarize_result_click",e.showMailEntryButton="mail_entry_button_show",e.clickMailEntryButton="mail_entry_button_click",e.clickInputBar="input_bar_click",e.showMailThreadResult="mail_thread_result_show",e.clickMailThreadResult="mail_thread_result_click",e.insertMailThreadResult="mail_thread_result_insert",e.closeMailThreadResult="mail_thread_result_close",e.quickReplyButtonShow="ai_reply_button_show",e.hoverQuickReplyButton="hover_ai_reply_button",e.showPdfAssistant="pdf_read_show",e.clickReadPdfBtn="pdf_read_click",e.showDisableMenu="disable_menu_show",e.clickDisableMenu="confirm_close_function",e.chooseLanguage="choose_language_result",e.shortcutClick="shortcut_click",e.newSkillAdd="new_skill_add",e.skillEditClick="skill_edit_click",e.skillEditDelete="skill_edit_delete",e.skillPopupSave="skill_popup_save",e.skillPopupIconClick="skill_popup_icon_click",e.skillPopupCancel="skill_popup_cancel",e.skillPopupClose="skill_popup_close",e.exampleClick="example_click",e.examplePopupClose="example_popup_close",e.collectionButtonShow="collection_button_show",e.collectionButtonClickSave="collection_button_click_save",e.collectionButtonClickSaveStatus="collection_button_click_save_status",e.seeCollectionButtonShow="see_collection_button_show",e.collectionSettingClick="collection_setting_click",e.writingSettingClick="mail_entry_setting_click",e.writingSkilShow="skill_module_show",e.writingSkillClick="click_suggested_content",e.writingAssistantResultClick="writing_assistant_result_click",e.searchLinkPreviewEntryShow="search_result_preview_icon_show",e.searchLinkPreviewResultShow="search_result_preview_result_show",e.searchLinkPreviewResultClick="search_result_preview_result_click",e.hyperLinkPreviewEntryShow="hyperlink_preview_icon_show",e.hyperLinkPreviewResultShow="hyperlink_preview_result_show",e.hyperLinkPreviewResultClick="hyperlink_preview_result_click",e.doubaoDownloadPopupShow="doubao_download_popup_show",e.doubaoDownloadPopupClick="doubao_download_popup_click",e.takeNoteShow="take_note_show",e.takeNotePadShow="take_note_pad_show",e.takeNotePadClick="take_note_pad_click",e.takeNoteBtnClick="video_tool_bar_take_note_click",e.takeNoteStatus="take_note_pad_click_status",e.quickTranslatePopupShow="quick_translate_popup_show",e.quickTranslatePopupClick="quick_translate_popup_click",e.quickTranslate="quick_translate",e.quickTranslateSettingClick="quick_translate_setting_click",e.chooseMouseHoverResult="choose_mouse_hover_result",e.doubaoUpdatePopupShow="doubao_update_popup_show",e.doubaoUpdatePopupClick="doubao_update_popup_click",e.videoSettingClick="video_setting_click",e.translationCardShow="translation_card_show",e.translationCardClick="translation_card_click",e}({}),c=function(e){return e.clickSidebar="click_side_bar",e.selectAssistantMenu="highlight_function_bar",e.selectAssistantResult="highlight_result_card",e.searchAssistant="search_result_card",e.videoAssistant="video_page_summarize",e.podcastAssistant="podcast_page_summarize",e.onboarding="onboarding",e.chatHeader="chat_header",e.disableMenu="close_function",e.screenCapture="screen_capture",e.searchPreview="search_preview",e.other="other",e.default="default",e}({})},40992:(e,t,n)=>{n.d(t,{Kt:()=>u,o$:()=>d});var i=n(58980),o=n(56397),s=n(12038),r=n(77591),a=n(64123),l=n(4252);const c=({hoverTranslateSetting:e})=>{const t=(0,r.gv)(),n={[i.X0.NO_TRANSLATE]:{clickFrom:"mouse_nothing",value:"nothing"},[i.X0.TRANSLATE_DIRECTLY]:{clickFrom:"mouse_hover",value:"direct_translate"},[i.X0.TRANSLATE_BY_COMMAND]:{clickFrom:`mouse_${(0,a.AI)(a.jv.Command)}`,value:(0,a.AI)(a.jv.Command)},[i.X0.TRANSLATE_BY_OPTION]:{clickFrom:`mouse_${(0,a.AI)(a.jv.Option)}`,value:(0,a.AI)(a.jv.Option)},[i.X0.TRANSLATE_BY_CUSTOM_SHORTCUT]:{clickFrom:`mouse_${t[l.e.HoverTextTranslate].key}`,value:t[l.e.HoverTextTranslate].key}};if(e){return n[e]}return{clickFrom:"setting",value:"setting"}},d=()=>{const e=(0,r.TK)("hoverTranslateSetting"),t=c({hoverTranslateSetting:e}).clickFrom;(0,s.z8)(o.Ur.clickChatAssistantPopover,{click_from:t.toLowerCase(),button_name:o._h.translatePage})},u=({hoverTranslateSetting:e,isClickSetting:t})=>{const n=c({hoverTranslateSetting:e,isClickSetting:t});(0,s.z8)(o.Ur.chooseMouseHoverResult,{value:n.value.toLowerCase()})}},17933:(e,t,n)=>{n.d(t,{Bq:()=>m,Su:()=>g,jk:()=>p,jv:()=>c});var i=n(88090),o=n(12038),s=n(56397),r=n(78503);let a=function(e){return e.page="disable_page",e.global="disable_all",e.temp="hide_till_next_time",e}({}),l=function(e){return e.drop_down_box="drop_down_box",e}({}),c=function(e){return e.translate_this_page="translate_this_page",e.highlight_result_choose="highlight_result_choose",e.youtube_page_summary="youtube_page_summary",e.settings="settings",e.mail="gmail",e}({});const d={[r.lf.chatAssistant]:"side_bar_entrance",[r.lf.searchAssistant]:"search_card",[r.lf.selectAssistant]:"highlight_function",[r.lf.searchAddons]:"search_recommend",[r.lf.linkPreview]:"search_preview",[r.lf.videoSummary]:"video_summarize_card",[r.lf.videoSubtitle]:"video_subtitle",[r.lf.podcastSummary]:"podcast_summarize_card",[r.lf.sidebarFloatCard]:"side_panel",[r.lf.grammar]:"writing_assistant_grammar",[r.lf.inputAssistant]:"writing_assistant",[r.lf.videoImmersion]:"video_immersion",[r.lf.replyAssistant]:"reply_assistant",[r.lf.vocabruary]:"highlight_mark",[r.lf.collectionImage]:"webimage_collect",[r.lf.collectionPage]:"web_collect",[r.lf.videoMemo]:"video_memo"},u=e=>d[e]||"",h=e=>{let t="";switch(e){case r.iI.temp:t=a.temp;break;case r.iI.page:t=a.page;break;case r.iI.global:t=a.global}return t},m=e=>{(0,o.z8)(s.Ur.showDisableMenu,{enter_method:u(e)})},p=(e,t)=>{(0,o.z8)(s.Ur.clickDisableMenu,{enter_method:u(t),button_name:h(e)})},g=({before_language_result:e,after_language_result:t,scene:n})=>{(0,o.z8)(s.Ur.chooseLanguage,{choose_way:l.drop_down_box,before_language_result:(0,i.wz)(e),after_language_result:(0,i.wz)(t),scene:n})}},78503:(e,t,n)=>{n.d(t,{$2:()=>s,Fc:()=>d,LT:()=>h,WR:()=>u,X0:()=>c,c$:()=>a,cD:()=>r,iI:()=>o,lf:()=>i,th:()=>l});let i=function(e){return e.chatAssistant="sidebarButton",e.searchAssistant="search",e.selectAssistant="quick",e.grammar="grammar",e.inputAssistant="input",e.replyAssistant="reply",e.searchAddons="search-addons",e.videoSummary="videoSummary",e.videoSubtitle="videoSubtitle",e.videoImmersion="videoImmersion",e.videoMemo="videoMemo",e.podcastSummary="podcastSummary",e.linkPreview="linkPreview",e.sidebarFloatCard="sidebarFloatCard",e.vocabruary="vocabruary",e.collectionImage="collectionImage",e.collectionPage="collectionPage",e}({}),o=function(e){return e.temp="temp",e.page="page",e.global="global",e}({}),s=function(e){return e.youtube="youtube",e.chat="chat",e}({}),r=function(e){return e.insert_below="insert_below",e.replace_selection="replace_selection",e}({}),a=function(e){return e.HUOSHAN="huoshan",e.DOUBAO="doubao",e.GPT="gpt",e.GOOGLE="google",e.MICROSOFT="microsoft",e.DEEPL="deepl",e}({}),l=function(e){return e.HUOSHAN="0",e.LLM="1",e.GOOGLE="2",e.MICROSOFT="3",e}({}),c=function(e){return e.NO_TRANSLATE="no_translate",e.TRANSLATE_DIRECTLY="translate_directly",e.TRANSLATE_BY_COMMAND="translate_by_command",e.TRANSLATE_BY_OPTION="translate_by_option",e.TRANSLATE_BY_CUSTOM_SHORTCUT="translate_by_custom_shortcut",e}({}),d=function(e){return e[e.PageTranslate=1]="PageTranslate",e[e.AIReader=2]="AIReader",e[e.ChooseWordsTranslate=3]="ChooseWordsTranslate",e[e.ScreenShotTranslate=4]="ScreenShotTranslate",e[e.ImageTextExtraction=5]="ImageTextExtraction",e[e.HoverTranslate=6]="HoverTranslate",e[e.InputFieldInstantTranslate=7]="InputFieldInstantTranslate",e[e.ToutiaoSearchCard=8]="ToutiaoSearchCard",e[e.SearchRecommendCard=9]="SearchRecommendCard",e[e.CommentReply=10]="CommentReply",e}({}),u=function(e){return e.Space="Space",e.Comma="Comma",e.Slash="Slash",e.Equal="Equal",e}({}),h=function(e){return e.VocabruaryHighlight="vocabruary_highlight",e}({})},58980:(e,t,n)=>{n.d(t,{Fc:()=>o.Fc,LT:()=>o.LT,WR:()=>o.WR,X0:()=>o.X0,c$:()=>o.c$,iI:()=>o.iI,lG:()=>i.l,lf:()=>o.lf,th:()=>o.th});var i=n(15959),o=n(78503)},4252:(e,t,n)=>{n.d(t,{e:()=>i});let i=function(e){return e.OpenSide="OpenSide",e.TranslatePage="TranslatePage",e.ReadPage="ReadPage",e.HoverTextTranslate="HoverTextTranslate",e.ScreenCapture="ScreenCapture",e.VoiceInput="VoiceInput",e.CollectPage="CollectPage",e.BilingualSubtitles="BilingualSubtitles",e.TTSReadPage="TTSReadPage",e}({})},49299:(e,t,n)=>{n.d(t,{E8:()=>r,EY:()=>l,NZ:()=>c,_0:()=>a,uk:()=>s});var i=n(10080),o=n(77259);function s(e=0){return new Promise((t=>setTimeout(t,e)))}function r(){return o.j.getCommonPopupContainer()}function a(){const e=(0,i.A)(),t=null==e?void 0:e.getAssistantId();return o.j.getContainerById(t||"")}function l(e){if(!document.head){const e=document.createElement("head");document.documentElement.appendChild(e)}document.head.appendChild(e)}function c(e,t=1e3,n=3,i=null){let o=0;const s=(r,a)=>{try{const l=e();l===i&&o<n?(o++,setTimeout((()=>s(r,a)),t)):r(l)}catch(l){a(l)}};return new Promise(s)}},67685:(e,t,n)=>{n.d(t,{C1:()=>a,FI:()=>o,Jk:()=>h,Ud:()=>g,Vl:()=>m,_E:()=>f,ch:()=>c,eG:()=>v,gH:()=>l,kD:()=>u,lx:()=>d,nD:()=>r,o8:()=>p,sZ:()=>s,zs:()=>_});var i=n(78503);const o="www.doubao.com",s="586864",r="production",a="https://www.doubao.com",l=420,c=10,d="web",u=`https://${o}/samantha`,h=`https://${o}/alice`,m=`https://${o}/chat/collection`,p="ciciai.com",g="doubao.com",v="release_version",f=[{name:"flow_web_ext_sidebar_hide_1",key:i.iI.temp,id:1},{name:"flow_web_ext_sidebar_hide_2",key:i.iI.page,id:2},{name:"flow_web_ext_sidebar_hide_3",key:i.iI.global,id:3}],_={[i.lf.sidebarFloatCard]:{global:"chatFloatCardDisableAll",page:"chatFloatCardDisableHosts"},[i.lf.videoSubtitle]:{global:"videoSubtitleDisableAll",page:"videoSubtitleDisableHosts"},[i.lf.videoSummary]:{global:"videoSummaryDisableAll",page:"videoSummaryDisableHosts"},[i.lf.videoMemo]:{global:"videoMemoDisableAll",page:"videoMemoDisableHosts"},[i.lf.podcastSummary]:{global:"podcastSummaryDisableAll",page:"podcastSummaryDisableHosts"},[i.lf.chatAssistant]:{global:"sidebarButtonDisabledAll",page:"sidebarButtonDisabledHosts"},[i.lf.searchAssistant]:{global:"searchDisabledAll",page:"searchDisabledHosts"},[i.lf.selectAssistant]:{global:"quickDisabledAll",page:"quickDisabledHosts"},[i.lf.grammar]:{global:"disableGlobalGrammar",page:"disableGrammarHosts"},[i.lf.inputAssistant]:{global:"InputAssistantDisabledAll",page:"InputAssistantDisabledHosts"},[i.lf.searchAddons]:{global:"disableSearchAddonsGlobal",page:"disableSearchAddonsHosts"},[i.lf.linkPreview]:{global:"linkPreviewDisabledAll",page:"linkPreviewDisabledHosts"},[i.lf.videoImmersion]:{global:"videoImmersionDisableAll",page:"videoImmersionDisableHosts"},[i.lf.replyAssistant]:{global:"replyAssistantDisabledAll",page:"replyAssistantDisabledHosts"},[i.lf.vocabruary]:{global:"vocabruaryDisableAll",page:"vocabruaryDisableHosts"},[i.lf.collectionImage]:{global:"collectImageDisabledAll",page:"collectImageDisabledHosts"}}},28328:(e,t,n)=>{n.d(t,{SM:()=>r,V$:()=>a,d:()=>s,u9:()=>o});var i=n(76360);let o=function(e){return e.web="web",e.pdf="pdf",e}({});const s=()=>{const e=document.body.firstElementChild;return{type:"EMBED"===(null==e?void 0:e.nodeName)&&"application/pdf"===(null==e?void 0:e.type)?o.pdf:o.web,url:window.location.href,title:document.title,favicon:(0,i.p2)(window.location.host,window.location.protocol)}},r=(e,t)=>{let n=e.classList.toString();const i=new MutationObserver((i=>{for(const o of i)if("class"===o.attributeName){const i=e.classList.toString();if(i!==n){t(i),n=i;break}}}));return i.observe(e,{attributes:!0}),i},a=(e,t)=>{const n=new MutationObserver(t);return n.observe(e,{attributes:!0}),n}},98767:(e,t,n)=>{n.d(t,{CU:()=>l,hm:()=>c,n_:()=>a});var i=n(14065),o=n(16409);function s(e){(0,o.cs)({name:"remove-fetch-cross-header",body:e})}let r;function a(e){return new Promise(((t,n)=>{const i=()=>{r=e,(0,o.cs)({name:"add-fetch-cross-header",body:e}).then((({data:i})=>{try{o=i,fetch(e).then((e=>{if(!e.ok)throw new Error("Network response was not ok");e.blob().then((n=>t({blob:n,type:e.headers.get("Content-Type")||"image/jpg"}))).catch(n)})).catch(n).finally((()=>{s(o)}))}catch(r){s(i),n(r)}var o})).catch(n).finally((()=>{r=void 0}))},a=()=>{r?setTimeout((()=>a()),50):i()};a()}))}function l(e){return new Promise(((t,n)=>{try{var i;const n=null===(i=e.getClientRects())||void 0===i?void 0:i[0],o=document.createElement("canvas"),s=o.getContext("2d");o.width=n.width,o.height=n.height,null==s||s.drawImage(e,0,0,n.width,n.height),o.toBlob(t,"image/jpeg",1)}catch(o){n(o)}}))}const c=function(){var e=(0,i.A)((function*(e){const t=yield(0,o.cs)({name:"tos-get-file-url",body:e.filter((e=>e))});return t.success?t.data:{}}));return function(t){return e.apply(this,arguments)}}()},21255:()=>{window.Prism=window.Prism||{},window.Prism.manual=!0},64802:(e,t,n)=>{n.d(t,{q4:()=>_,YA:()=>x,l$:()=>f,Oi:()=>y});var i=n(52289),o=n(5687),s=n(89380),r=n(43714),a=n.n(r),l=n(35661),c=n(24693);function d(e,t=[]){const n=(0,s.A)(e);let i="";for(const o of n){if((0,c.DC)(o))continue;if(!(o instanceof HTMLElement)){i+=o.textContent||"";continue}const e=o.tagName.toLowerCase();if(l.A2.includes(e)){const n=l.hT[e],s={};for(const{key:e,getter:t}of(null==n?void 0:n.attrs)||[]){const n=t?t(o):o.getAttribute(e);n&&(s[e]=n)}t.push({tag:e,originContent:(0,c.UU)(o.textContent||""),attrs:s});const r=t.length-1,{output:a}=d(Array.from(o.childNodes),t);i+=`<b${r}>${a}</b${r}>`;continue}const{output:n}=d(Array.from(o.childNodes),t);i+=n}return{output:(0,c.UU)(i),metaInfo:t}}const u=(e,t=[])=>((0,o.A)(t,((t,n)=>{const{tag:i,originContent:o}=t;if(!l.Jy.includes(i))return;const s=new RegExp(`<\\s*[bB]\\s*${n}\\s*>([\\s\\S]*?)<\\s*/\\s*[bB]\\s*${n}\\s*>`),r=`<b0>${o}</b0>`;e=e.replace(s,r)})),e=(0,i.qP)(e)),h=(e,t=[])=>{(0,o.A)(t,((t,n)=>{const{tag:i,originContent:o}=t,s=new RegExp(`<\\s*[bB]\\s*${n}\\s*>([\\s\\S]*?)<\\s*/\\s*[bB]\\s*${n}\\s*>`),{openTag:r,closeTag:a}=function(e){const{tag:t,attrs:n={}}=e;let i="";for(const[o,s]of Object.entries(n))i+=` ${o}="${s}"`;return["li","ol"].includes(t)?{openTag:`<ul><${t}${i}>`,closeTag:`</${t}></ul>`}:"code"===t?{openTag:"`",closeTag:"`"}:"em"===t?{openTag:"<strong>",closeTag:"</strong>"}:{openTag:`<${t}${i}>`,closeTag:`</${t}>`}}(t),c=l.Jy.includes(i)?`${r}${o}${a}`:`${r}$1${a}`;e=e.replace(s,c)})),e=(e=(0,i.qP)(e)).replaceAll(/\n/g,"<br />");try{return a()(e)}catch(n){return e}};var m=n(12312),p=n(46514),g=n(96638);let v;function f(e){if(e.commonAncestorContainer instanceof Element){(0,m.M)(e.commonAncestorContainer);const t=e.cloneContents(),n=(0,m.u)(Array.from(t.childNodes));v=[];return n.map((e=>d(e,v))).map((e=>e.output)).join("\n")}v=void 0}function _(e){return h(e,v||[])}function x(e){return u(e,v||[])}function y(e){const{encodeText:t,lang:n,translateService:o,contextText:s}=e,r=(0,i.qP)(t);return new Promise((e=>{(0,p._)({text:r,prompt:g.EU.translate,language:n,answerWithSuggest:!1,translateService:o,contextText:s,trackEvent:!1},{onDone(t,n){e(n)}})}))}},52289:(e,t,n)=>{function i(e){const t=e.getAttribute("data-cici-select-uid");if(t){const e=document.querySelector(`[data-cici-select-uid="${t}"]`);if(e)return getComputedStyle(e)}}function o(e){return e.replaceAll(/<\s*\/?\s*[bB]\s*\d+\s*>/g,"")}function s(e){return e.replace(/<\s*\/?\s*[bB]?\s*\d*\s*$/,"")}n.d(t,{D6:()=>i,qP:()=>o,sh:()=>s})},5440:(e,t,n)=>{n.d(t,{GF:()=>v,yI:()=>f,Ws:()=>p,GT:()=>_});var i=n(44557),o=n(93772),s=n(77453),r=n(43766),a=n(10633);const l=["width","height","max-width","max-height","min-width","min-height","padding-top","padding-bottom","padding-left","padding-right","border","box-sizing","line-height","text-indent","text-align","font-size","font-family","font-weight","font-style","font-variant","letter-spacing","white-space","word-spacing","word-wrap","word-break","position","overflow"],c=class{getStyles(e,t=l){const n=window.getComputedStyle(e),i={};return t.map((t=>{const o=function(e,t=["-","_"]){let n=[],i=0,o=new Set(t);for(;i<e.length;)o.has(e[i])?(n.push(e[i+1].toUpperCase()),i++):n.push(e[i]),i++;return n.join("")}(t),s=n.getPropertyValue(t);if(["width","height"].includes(t)&&"auto"===s){const t=e.getBoundingClientRect();i[o]=`${t[o]}px`}else["max-width","max-height","min-width","min-height"].includes(t)?i[o]=this.convertPercentToPx(e,t,s):i[o]=s})),i}getStyle(e,t){return window.getComputedStyle(e).getPropertyValue(t)}getCssText(e,t=l){const n=window.getComputedStyle(e);return t.map((t=>{const i=n.getPropertyValue(t);if(["width","height"].includes(t)&&"auto"===i){return`${t}: ${e.getBoundingClientRect()[t]}px`}return["max-width","max-height","min-width","min-height"].includes(t)?`${t}: ${this.convertPercentToPx(e,t,i)}`:`${t}: ${i}`})).join(";")}getFontStyles(e){const t=window.getComputedStyle(e);return{fontFamily:t.getPropertyValue("font-family"),fontSize:parseFloat(t.getPropertyValue("font-size")),fontWeight:parseFloat(t.getPropertyValue("font-weight")),lineHeight:parseFloat(t.getPropertyValue("line-height"))}}getContentBox(e){return{width:e.scrollWidth,height:e.scrollHeight}}getScrollbarWidth(e){const t=window.getComputedStyle(e),n=parseFloat(t.getPropertyValue("border-left-width"))||0,i=parseFloat(t.getPropertyValue("border-right-width"))||0;return e.offsetWidth-e.clientWidth-n-i}convertPercentToPx(e,t,n){if(!n.includes("%"))return n;const i=parseFloat(n)/100,o=e.parentElement;if(!o)return"none";let s=window.getComputedStyle(o),r=parseFloat(s.getPropertyValue("width")),a=parseFloat(s.getPropertyValue("height")),l=s.getPropertyValue("box-sizing"),c=parseFloat(s.getPropertyValue("border-width")),d=parseFloat(s.getPropertyValue("padding-left")),u=parseFloat(s.getPropertyValue("padding-right")),h=parseFloat(s.getPropertyValue("padding-top")),m=parseFloat(s.getPropertyValue("padding-bottom")),p=r,g=a;return"border-box"===l&&(p=r-d-u-2*c,g=a-h-m-2*c),t.includes("height")?g*i+"px":p*i+"px"}},d=class{constructor(){if((0,a.A)(this,"nodeId","-aichat-mirrorTextNode"),(0,a.A)(this,"mirrorTextNode",void 0),(0,a.A)(this,"domMeasurement",new c),(0,a.A)(this,"mirrorContainer",void 0),!document)throw new Error("TextareaMeasurement can only be run under DOM environment");this.initMirrorTextarea()}measureText(e,t,n){const i=this.domMeasurement.getStyle(e,"display"),o=this.domMeasurement.getCssText(e);return this.mirrorTextNode.style.cssText=o,"inline"===i&&(this.mirrorTextNode.style.textAlign="initial"),this.mirrorTextNode.innerHTML=t.split("").map((e=>`<span>${e}</span>`)).join(""),this.doMeasureText({element:e,display:i,text:t,index:n})}loadElement(e,t){let n=this.domMeasurement.getStyle(e,"display"),i=parseFloat(this.domMeasurement.getStyle(e,"width"))-this.domMeasurement.getScrollbarWidth(e),o=this.domMeasurement.getCssText(e);return o+=`; height: auto; max-height: none; width: ${i}px; overflow: hidden;`,"inline"===n&&(o+="; text-align: initial"),this.mirrorTextNode.style.cssText=o,this.mirrorTextNode.innerHTML=t.split("").map((e=>`<span>${e}</span>`)).join(""),{measureText:i=>this.doMeasureText({element:e,display:n,text:t,index:i})}}destroy(){this.mirrorContainer.remove()}doMeasureText(e){const{element:t,display:n,index:i,text:o}=e;if(i<0||i>o.length-1)throw new Error(`char indexing(index: ${i})overflowed, allowed range:0 - ${o.length-1}`);let s=this.mirrorTextNode.querySelector(`span:nth-child(${i+1})`),{offsetLeft:r,offsetTop:a,offsetHeight:l,offsetWidth:c}=s,d=0;if("inline"===n){const e=this.mirrorTextNode.querySelector("span:nth-child(1)");e&&(d=e.offsetTop)}let u=a,h=r;if("\n"===o[i]&&i===o.length-1){u+=parseFloat(this.domMeasurement.getStyle(t,"line-height")),h=0}return{left:h,right:h+c,top:u,bottom:u+l,width:c,height:l,deviation:d}}initMirrorTextarea(){const e=document.createElement("div");this.mirrorContainer=e,e.setAttribute("contenteditable","false"),e.id=this.nodeId,e.style.position="absolute",e.style.width="0px",e.style.height="0px",e.style.overflow="hidden",document.body.appendChild(e);const t=e.shadowRoot||e.attachShadow({mode:"open"});if(!this.mirrorTextNode){const e=document.createElement("div");e.className="mirror-text-container",t.appendChild(e),this.mirrorTextNode=e,this.mirrorTextNode.style.display="block"}}},u=new class{getSelectionRect(e,t){if(!e.collapsed){const t=e.getBoundingClientRect();if(0!==t.width||0!==t.height)return t}const n=e.startContainer;if(n instanceof HTMLElement){const i=n.childNodes[e.startOffset];if(i&&this.isBasicInput(i)){const e=this.getSelectionRectForBasicInputV2(i);return e.left=Math.round(e.left),e.right=Math.round(e.right),e.top=Math.round(e.top),e.bottom=Math.round(e.bottom),e.width=Math.round(e.width),e.height=Math.round(e.height),e}if(t)return this.getSelectionRectFromCollapsedElement(i)}return null}getSelectedText(e){if(e.commonAncestorContainer.nodeType===Node.TEXT_NODE){const t=a(e.commonAncestorContainer.parentElement);return t.selectable?r(t.whiteSpaceType,e.commonAncestorContainer.textContent.slice(e.startOffset,e.endOffset).trim()):""}if(e.startContainer instanceof HTMLElement){const t=e.startContainer.childNodes[e.startOffset];if(t&&this.isBasicInput(t)){if(!a(t).selectable)return"";const{selectionStart:e,selectionEnd:n}=t;return t.value.slice(e,n).trim()}}let t,n=[],i=!1,o=!1,s=(t,l)=>{t.nodeType===Node.TEXT_NODE?function(t,s){function a(e){return r(s.whiteSpaceType,e)}t===e.startContainer&&(i=!0),i&&t.nodeType===Node.TEXT_NODE&&s.selectable&&(t===e.startContainer&&t===e.endContainer?n.push({content:a(t.textContent.slice(e.startOffset,e.endOffset))}):t===e.startContainer?n.push({content:a(t.textContent.slice(e.startOffset))}):t===e.endContainer?n.push({content:a(t.textContent.slice(0,e.endOffset))}):n.push({content:a(t.textContent)})),t===e.endContainer&&(o=!0)}(t,l):t.nodeType===Node.ELEMENT_NODE&&function(t){if(t===e.startContainer&&(i=!0),t===e.endContainer)return void(o=!0);const r=a(t);r.selectable&&n.push({content:" "});for(const e of t.childNodes)if(s(e,r),o)break;r.selectable&&(function(e,t){return"BR"===e.tagName||!t.display.startsWith("inline")}(t,r.style)?n.push({content:"\n"}):n.push({content:" "}))}(t)};return t=e.commonAncestorContainer instanceof HTMLElement?a(e.commonAncestorContainer):a(e.commonAncestorContainer.parentElement),s(e.commonAncestorContainer,t),n.map((e=>e.content)).join("").trim().split("\n").map((e=>e.trim())).join("\n").replace(/\n\n+/g,"\n\n").replace(/  +/g," ");function r(e,t){return"normal"===e?t.split("\n").map((e=>e.trim())).join(""):"keepNewLine"===e?t.split("\n").map((e=>e.trim())).join("\n"):t}function a(e){const t=getComputedStyle(e);if("SCRIPT"===e.tagName||"STYLE"===e.tagName||"none"===t.userSelect||"0"===t.opacity||"none"===t.display||"hidden"===t.visibility)return{style:t,selectable:!1,whiteSpaceType:"normal"};let n;return n="pre-line"===t.whiteSpace?"keepNewLine":t.whiteSpace.startsWith("pre")||"break-spaces"===t.whiteSpace?"keepNewLineAndSpace":"normal",{style:t,selectable:!0,whiteSpaceType:n}}}isBasicInput(e){return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement}getSelectionRectFromCollapsedElement(e){const t=e.shadowRoot.getSelection().getRangeAt(0);return this.getSelectionRect(t)}getSelectionRectForBasicInputV2(e){const t=e.getBoundingClientRect(),n=e.selectionStart,i=e.selectionEnd-1,o=e.scrollTop,s=e.value,r=new d,{measureText:a}=r.loadElement(e,e.value),l=a(n),c=a(i);if(l.top===c.top)return r.destroy(),{left:t.left+l.left,right:t.left+c.left,top:t.top+l.top-o,bottom:t.top+c.bottom,width:c.left-l.left,height:c.bottom-l.top};let u="",h="",m=n,p=n;for(let d=n;d<=i;d++){const e=s[d];"\n"===e||d===i?(h.length>u.length&&(u=h,m=p),h="",p=d+1):h+=e}const g=a(m),v=a(m+u.length);if(g.top!==v.top)return r.destroy(),{left:t.left,right:t.right,top:t.top+l.top-o,bottom:t.top+c.bottom,width:t.width,height:c.bottom-l.top};const f=Math.min(l.left,c.left,g.left,v.left),_=Math.max(l.left,c.left,g.left,v.left);return r.destroy(),{left:t.left+f,right:t.left+_,top:t.top+l.top-o,bottom:t.top+c.bottom,width:_-f,height:c.bottom-l.top}}};var h=n(77259);const m={top:NaN,left:NaN,bottom:NaN,right:NaN,height:NaN,width:NaN,clientBottom:NaN},p=(0,i.A)({text:"",contextText:"",range:null},m),g=(e,t=!1)=>{if(!e)return m;if(e.rangeCount<1)return m;const n=e.getRangeAt(0),i=u.getSelectionRect(n,t),o=n.getBoundingClientRect();if(!i)return null;const s=window.innerHeight-o.bottom,{top:r,left:a,bottom:l,right:c,width:d,height:h}=i;return{top:r,left:a,bottom:l,right:c,width:d,height:h,clientBottom:s}},v=e=>{var t;let n=null,r="",a=m;if(!window.getSelection)return;n=window.getSelection();let l=!1;if(null!==(t=n)&&void 0!==t&&null!==(t=t.anchorNode)&&void 0!==t&&t.childNodes){var c,d,u;const e=h.j.getAssistantContainer();l=!(null===(c=Array.prototype.slice.call(null===(u=n)||void 0===u||null===(u=u.anchorNode)||void 0===u?void 0:u.childNodes))||void 0===c||null===(d=c.filter)||void 0===d||!d.call(c,(t=>t===e)).length)}r=n?n.toString():"";let v=null;if(n&&n.rangeCount>0&&(v=n.getRangeAt(0).cloneRange()),"close"===e&&!r&&l)return p;if(l)return;if(""!==r.trim()){var f;const e=(e=>{var t;if(!e)return!1;const{startContainer:n}=e,{startOffset:i}=e,s=null==n||null===(t=n.childNodes)||void 0===t?void 0:t[i];return!!s&&s.id===o.$})(null===(f=n)||void 0===f?void 0:f.getRangeAt(0));if(a=g(n,e),!a)return p;const{contextText:t,selectedText:r,start:l}=(0,s.Fd)(n);return(0,i.A)({text:r,contextText:t,range:v,anchorOffset:l.length},a)}return p},f=e=>{var t;let n=null,o="",s=m;if(!window.getSelection)return;n=window.getSelection();let a=!1;if(null!==(t=n)&&void 0!==t&&null!==(t=t.anchorNode)&&void 0!==t&&t.childNodes){var l,c,d;const e=h.j.getAssistantContainer();a=!(null===(l=Array.prototype.slice.call(null===(d=n)||void 0===d||null===(d=d.anchorNode)||void 0===d?void 0:d.childNodes))||void 0===l||null===(c=l.filter)||void 0===c||!c.call(l,(t=>t===e)).length)}if(o=n?n.toString():"","close"===e&&!o&&a)return p;if(a)return;let u=null;n&&n.rangeCount>0&&(u=n.getRangeAt(0).cloneRange());if(""!==o.trim()){if(s=g(n),!s)return p;const e=(0,r.P)(n);return(0,i.A)({text:e.selection,anchorOffset:e.offset,contextText:e.context,selectContext:e,range:u},s)}return p},_=(e=[])=>{var t;const n=window.getSelection();let i=null==n||null===(t=n.anchorNode)||void 0===t?void 0:t.parentElement;if(i)for(;i;){if(e.some((e=>{var t;return null===(t=i)||void 0===t||null===(t=t.className)||void 0===t?void 0:t.includes(e)})))return!0;i=i.parentElement}return!1}},16305:(e,t,n)=>{function i(e){if(!e)return!1;switch(e.nodeType){case Node.TEXT_NODE:case Node.COMMENT_NODE:case Node.CDATA_SECTION_NODE:return!0;case Node.ELEMENT_NODE:switch(e.tagName){case"A":case"ABBR":case"B":case"BDI":case"BDO":case"BR":case"CITE":case"CODE":case"DATA":case"DFN":case"EM":case"I":case"KBD":case"MARK":case"Q":case"RP":case"RT":case"RTC":case"RUBY":case"S":case"SAMP":case"SMALL":case"SPAN":case"STRONG":case"SUB":case"SUP":case"TIME":case"U":case"VAR":case"WBR":return!0;default:return!1}}return!1}function o(e){return e.nodeType===Node.TEXT_NODE?e.nodeValue||"":e.nodeType===Node.ELEMENT_NODE&&e.innerText||""}function s(e){let t=e.startContainer,n="";switch(t.nodeType){case Node.TEXT_NODE:{const{textContent:i}=t;i&&(n=i.slice(0,e.startOffset));break}case Node.COMMENT_NODE:case Node.CDATA_SECTION_NODE:break;default:t=t.childNodes[e.startOffset]}let s=t;for(;i(s);s=s.parentElement){let e=s.previousSibling;for(;i(e);e=e.previousSibling)n=o(e)+n}return{node:s,text:n}}function r(e){let t=e.endContainer,n="";switch(t.nodeType){case Node.TEXT_NODE:{const{textContent:i}=t;i&&(n=i.slice(e.endOffset));break}case Node.COMMENT_NODE:case Node.CDATA_SECTION_NODE:break;default:t=t.childNodes[e.endOffset-1]}let s=t;for(;i(s);s=s.parentElement){let e=s.nextSibling;for(;i(e);e=e.nextSibling)n+=o(e)}return{node:s,text:n}}n.d(t,{Qz:()=>i,YZ:()=>o,kW:()=>r,wM:()=>s})},43766:(e,t,n)=>{n.d(t,{P:()=>o});var i=n(16305);function o(e,t=30){var n,o;const s={context:"",selection:"",offset:0};if(!e||e.rangeCount<1)return s;const r=e.toString();if(!r.trim())return s;const a=e.getRangeAt(0);if(!a)return s;const l=(0,i.wM)(a),c=(0,i.kW)(a);let d=null===(n=l.node)||void 0===n?void 0:n.previousSibling,u=null===(o=c.node)||void 0===o?void 0:o.nextSibling,h=l.text,m=h+r+c.text,p=m.replace(/\s+/g,"");if(p.length>=t)return{context:m,selection:r,offset:h.length};m+="\n";let g=!0,v=0;for(;p.length<t&&v<50;){if(v++,g){if(u){const e=(0,i.YZ)(u);let t={};try{t=window.getComputedStyle(u)}catch(_){}finally{var f;u=u.nextSibling,m+=e,"block"===(null===(f=t)||void 0===f?void 0:f.display)&&(m+="\n")}}}else if(d){let e=(0,i.YZ)(d),t={};try{t=window.getComputedStyle(d)}catch(_){}finally{d=d.previousSibling,"block"===t.display&&(e+="\n"),m=e+m,h=e+h}}p=m.replace(/\s+/g,""),g=!g}return{context:m,selection:r,offset:h.length}}},77453:(e,t,n)=>{n.d(t,{Fd:()=>p,kW:()=>m,wM:()=>h});var i=n(16305),o=n(24337);const s=["SCRIPT","STYLE","LINK","IMG","VIDEO","FIGURE","svg"],r=800,a=(()=>{let e=null;return()=>(e=e||new TextEncoder,e)})(),l=(e,t)=>a().encode(e).length>t,c=(e="")=>e.replace(/\s+/g," "),d=(e,t,n)=>{let i=e;const o="prev"===t?"previousSibling":"nextSibling";for(;i&&!i[o];)if(i=i.parentNode,null!=n&&n(i))return null;return i?i[o]:null},u=(e,t,n,o,r)=>{if(n>=50||e===t)return!1;let a=e;const l="prev"===o?"lastChild":"firstChild",c="prev"===o?"previousSibling":"nextSibling";for(;a;){let e="";for(;a&&(0,i.Qz)(a);){const t=(0,i.YZ)(a);t.replace(/\s+/g,"")&&(e="prev"===o?t+e:e+t),a=a[c]}if(e&&r(e))return!0;if(a){if(!s.some((e=>a.nodeName===e))&&a.childNodes.length){let e=a;for(;e[l];)e=e[l];const t=u(e,a,n+1,o,r);if(t)return t}a=a[c]}}if(e.parentNode!==t){const i=d(e.parentNode,o,(e=>e===t));if(i)return u(i,t,n+1,o,r)}return!1};function h(e,t){let n=e.startContainer,i="";switch(n.nodeType){case Node.TEXT_NODE:{const{textContent:t}=n;t&&(i=t.slice(0,e.startOffset));break}case Node.COMMENT_NODE:case Node.CDATA_SECTION_NODE:break;default:n=n.childNodes[e.startOffset]}const o=d(n,"prev");return o&&u(o,document.body,0,"prev",(e=>{const n=c(e);return i=`${n}\n${i}`,l(i,t)})),i}function m(e,t){let n=e.endContainer,i="";switch(n.nodeType){case Node.TEXT_NODE:{const{textContent:t}=n;t&&(i=t.slice(e.endOffset));break}case Node.COMMENT_NODE:case Node.CDATA_SECTION_NODE:break;default:n=n.childNodes[e.endOffset-1]}const o=d(n,"next");return o&&u(o,document.body,0,"next",(e=>{const n=c(e);return i=`${i}\n${n}`,l(i,t)})),i}function p(e,t=r){const n={contextText:"",selectedText:"",start:"",end:""};try{if(!e||e.rangeCount<=0)return n;const i=e.toString();if(!i.trim())return n;const o=e.getRangeAt(0);if(!o)return n;const s=h(o,t/2).trimStart(),r=m(o,t/2).trimEnd();return{contextText:s+i+r,selectedText:i,start:s,end:r}}catch(i){return(0,o.z3)("[selection] context text error: ",i),n}}},76813:(e,t,n)=>{n.d(t,{$Z:()=>g,H2:()=>l,ID:()=>a,Os:()=>_,Wh:()=>d,Z:()=>p,cr:()=>v,id:()=>u,pQ:()=>m,tY:()=>c,y:()=>f,yf:()=>h});var i=n(44557),o=n(67685),s=n(73717),r=n(77591);function a(e,t={}){const n=e.includes("?"),i=Object.keys(t).reduce(((e,n)=>{const i=void 0===t[n]||null===t[n]?"":String(t[n]);return e=`${e}&${`${encodeURIComponent(n)}=${encodeURIComponent(i)}`}`}),"");return n?`${e}${i}`:`${e}?${i.replace(/^&/,"")}`}function l(e,t={},n){const{isEnableDebug:s,webEnv:l}=(0,r.MI)(),c=(0,i.A)({from:"ext",extId:encodeURIComponent(chrome.runtime.id)},t);return n&&!c.extra&&(c.extra=btoa(JSON.stringify(n))),s&&l&&(c["x-flow-env"]=l),a(`https://${o.FI}${e}`,c)}function c(){const{hostname:e}=window.location;return!!e.startsWith("youtube.com")||e.indexOf(".youtube.com")>0}function d(){return!(!c()||!location.pathname.startsWith("/watch"))}function u(){const{hostname:e}=window.location;return!!e.startsWith("bilibili.com")||e.indexOf(".bilibili.com")>0}function h(){return/douyin.com/.test(location.hostname)}function m(){return c()?"youtube":u()?"bilibili":""}function p(){var e;return null===(e=location.hash)||void 0===e?void 0:e.startsWith(s.RB)}function g(){var e;return null===(e=location.hash)||void 0===e?void 0:e.startsWith(s.pi)}function v(){var e;return null===(e=location.hash)||void 0===e?void 0:e.startsWith(s.yt)}function f(){var e;return null===(e=location.hash)||void 0===e?void 0:e.startsWith(s.g$)}function _(e){try{const t=new URL(e);return t.hash="",t.href}catch(t){return""}}},41772:(e,t,n)=>{n.d(t,{j:()=>o});var i=n(82854);function o(e,t){const n=i.ozw.getState(),o=n.messageLinkMap[e];if(!o)return[];const s=o.slice(Math.max(0,o.length-t)),r=(0,i.A4i)((0,i.tvN)(n,e));return s.map(r).filter(Boolean)}},62887:(e,t,n)=>{n.d(t,{I0:()=>d,KH:()=>h,eb:()=>m,gk:()=>u});var i=n(44557),o=n(48485),s=n(92431),r=n(98502),a=n(16100),l=n(81435),c=n(82854);const d=(e,t)=>{var n;const o=c.ozw.getState().regenerateMessageMap[e];if(!o){const n=(0,a.XB)({eventName:t});return c.ozw.setState((0,r.jM)((i=>(i.regenerateMessageMap[e]={messageMap:{},reportEvents:{[t]:n}},i)))),n}if(null==o||null===(n=o.reportEvents)||void 0===n||!n[t]){const n=(0,a.XB)({eventName:t});return c.ozw.setState((0,r.jM)((s=>(s.regenerateMessageMap[e].reportEvents=(0,i.A)((0,i.A)({},o.reportEvents),{},{[t]:n}),s)))),n}return o.reportEvents[t]},u=e=>({setRegenMessageInActive:({messageId:t})=>{const{draftMessageMap:{[t]:n},draftRegenerateMessageMap:{messageMap:{[t]:o}={}}={},draftRegenerateMessageMap:r}=e;{var a;const e=null!=o?o:(0,s.A)(n);null==o||null===(a=o.ext)||void 0===a||delete a.regen_active,(null==e?void 0:e.ext)&&(e.ext.regen="1"),r.messageMap=(0,i.A)((0,i.A)({},r.messageMap),{},{[t]:e})}n.ext&&(n.ext.regen="1"),(0,c.Jij)(n)||(n.status=l.q7.InVisible)},setRegenMessageActive:t=>{const{messageId:n}=t,{draftMessageMap:o,draftRegenerateMessageMap:{messageMap:{[n]:r}={}}}=e;r&&(o[n]=(0,i.A)((0,i.A)({},o[n]),(0,s.A)(r)),r.ext&&(r.ext.regen_active="1"))}}),h=(e,t)=>{if(!e||!t.reply_id)return!1;const n=t.reply_id,i=c.ozw.getState(),s=i.messageLinkMap[e],r=(0,c.A4i)({messageMap:i.messageMap[e],localMessageMap:i.localMessageMap[e]}),a=(0,c.rUA)({messageLinks:s,replyId:n,getMessage:r});if(1===(null==a?void 0:a.length))return!0;return(0,o.A)(a,(e=>{const t=r(e);return t&&(0,c.oQq)(t)}))},m=(e,t)=>{var n,i,o;if(!e||!t.messageId)return!1;const s=c.ozw.getState(),r=null===(n=s.messageMap[e])||void 0===n?void 0:n[null==t?void 0:t.messageId],a=null!==(i=null==r?void 0:r.reply_id)&&void 0!==i?i:"",l=null===(o=s.messageMap[e])||void 0===o?void 0:o[a];return((0,c.UGb)(r)||(0,c.aN2)(l))&&((0,c.pu_)(r)||(0,c.UQm)(r))}},36682:(e,t,n)=>{n.d(t,{gI:()=>H,Z$:()=>T,ZU:()=>F,BR:()=>s.B,hJ:()=>S,lv:()=>j,Rk:()=>w,gW:()=>I,ic:()=>D,UQ:()=>E,JX:()=>C,uj:()=>b,AG:()=>A,KR:()=>O,a1:()=>V,MH:()=>$,kA:()=>P,tb:()=>M,Pm:()=>z,fK:()=>U.f,P9:()=>k,zQ:()=>q});var i=n(82854),o=n(56642),s=n(21890),r=n(44557),a=n(49392),l=n(20716),c=n(72372),d=n(47997),u=n(22358),h=n(11855),m=n(81626),p=n(78821),g=n(75484),v=n(46219),f=n(89361),_=n(47389);const x=(0,s.B)(((e,t)=>e.messageLinkMap[t]||[])),y=(0,s.B)(((e,t)=>e.messageListStatusMap[t]||{})),b=(0,s.B)(((e,t)=>{const n=y.raw(e,t),i=x.raw(e,t),o=y.raw(e,v.i9),s=x.raw(e,v.i9),r=(0,p.VN)(g.pU.getState(),t);return(null==r?void 0:r.conversation_type)===d.Cr.Coco&&0===i.length?{status:o,messageLinks:s,resolveConversationId:v.i9}:{status:n,messageLinks:i,resolveConversationId:t}})),w=(e,t)=>{const{updateMessageFeedback:n}=i.ozw.getState(),{liked:o,disliked:s,detail:d,remoteFeedbackType:p,localFeedbackType:g}=(0,i.ozw)((n=>{var i,o;const{feedback:s}=null!==(i=(0,m.Tc)(e,{isLocalMessage:!1,messageId:t},n))&&void 0!==i?i:{},a=null===(o=n.messageFeedbackMap[e])||void 0===o?void 0:o[t],l=(0,c.A)((0,r.A)({},a),{feedback_type:s});return{liked:l.feedback_type===u.MW.Like,disliked:l.feedback_type===u.MW.Unlike,detail:l,remoteFeedbackType:s,localFeedbackType:null==a?void 0:a.feedback_type}}),l.A);return(0,h.useEffect)((()=>{(0,a.A)(p)||g===p||n({conversationId:e,messageId:t,detail:{feedback_type:p},onlyLocal:!0})}),[p]),{liked:o,disliked:s,detail:d}},C=((0,s.B)(((e,t)=>e.messageMap[t]||{})),(0,s.B)(((e,t)=>e.localMessageMap[t]||{})),(0,s.B)(((e,t,n)=>{var i;if(!n)return;return null===(i=(n.isLocalMessage?e.localMessageMap:e.messageMap)[t])||void 0===i?void 0:i[n.messageId]}))),A=(0,s.B)(((e,t,n)=>{const o=(0,i.A4i)((0,i.tvN)(e,t)),s=[];for(const i of n){const e=o(i);e&&s.push(e)}return s})),S=((0,s.B)(((e,t,n)=>{var i;return n?null===(i=e.localMessageMap[t])||void 0===i?void 0:i[n]:void 0})),(0,s.B)(((e,t,n)=>{var o,s,a;const{regenerateMessageMap:{[t]:l},messageLinkMap:{[t]:c},messageMap:{[t]:d}}=e,u=(0,i.tP$)(e,t,n),h=(()=>{if(null!=u&&u.reply_id&&(0,i.oQq)(u))return(0,i.Jij)(u)?(0,i.rUA)({messageLinks:c,replyId:u.reply_id,getMessage:(0,i.A4i)({localMessageMap:e.localMessageMap[t],messageMap:e.messageMap[t]})}):n.regen_head?null==c?void 0:c.filter((e=>e.regen_head===n.regen_head||e.messageId===n.regen_head)).map((e=>(0,r.A)((0,r.A)({},e),{},{regen_head:e.regen_head||e.messageId}))):void 0})(),m=null===(o=[n,...null!=h?h:[]].map((e=>{var t;return null!==(t=null==d?void 0:d[e.messageId])&&void 0!==t?t:null})).find((e=>null==e?void 0:e.reply_id)))||void 0===o?void 0:o.reply_id;return{activeRegenerateMessage:null!=h&&h.length?null==l||null===(s=l.messageMap)||void 0===s?void 0:s[n.messageId]:void 0,regenerateActiveIndex:null==h?void 0:h.findIndex((({messageId:e})=>e===n.messageId)),isRegenerateHead:Boolean(n.regen_head&&n.messageId),isRegenerateTail:Boolean(n.regen_head&&(null==h||null===(a=h[h.length-1])||void 0===a?void 0:a.messageId)===n.messageId),regenerateMessageLinks:h,replyFromMessage:m&&d[m]||void 0}}))),k=(0,s.B)(((e,t,n)=>{const i=e.suggestMessageMap[t];return(null==i?void 0:i.replyId)===n?i:void 0})),E=e=>(0,g.pU)((t=>t.lastSectionIdMap[e]),o.x),T=((0,s.B)(((e,t)=>e.lastMessageMap[t])),(e,t)=>{try{const n=e.messageLinkMap[t],o=n[n.length-1];if(!o)return!0;const s=e.messageMap[t][o.messageId];return!s||!(0,i.oSs)(s)}catch(n){return!0}}),I=(0,s.B)(T),j=()=>{const{conversationDisabledParams:e}=(0,f.Y_)(),{isLimited:t,limitTips:n}=(()=>{const{limitExpired:e,limitTips:t,isLimited:n}=(0,i.ozw)((e=>e.rateLimitConfig),o.x);(0,h.useEffect)((()=>{s(e)}),[e]);const{setExpired:s}=(0,_.G)((()=>{i.ozw.getState().updateRateLimitConfig({isLimited:!1,limitExpired:void 0,limitTips:""})}));return{limitTips:t,isLimited:n}})();return null!=e&&e.isDisabled?(0,r.A)({},e):{disabledText:t?n:void 0,isDisabled:!!t}};var N=n(37357),R=n(16100);const M=({sendMessage:e,messageLink:t,conversationId:n})=>()=>{if(!t)return;const i={conversation_id:n,message_id:null==t?void 0:t.messageId,is_local_message:null==t?void 0:t.isLocalMessage};N.v.persist.info({eventName:"retry_send_message_start",meta:i});try{e([{reportParams:{scene:"resend"},operation:{resend:{messageLink:t}}}])}catch(o){N.v.persist.error({eventName:"retry_send_message_failed",meta:i,error:o})}},P=({sendMessage:e,messageLink:t,conversationId:n})=>()=>{if(!t||!n)return;const i=(0,m.Tc)(n,t),o=(0,R.XB)({eventName:"retry_receive_message",meta:{conversation_id:n,reply_id:null==i?void 0:i.reply_id,message_id:null==i?void 0:i.message_id}}),{reply_id:s}=i||{};if(!s)return void o.error({reason:"reply_id is null, retry failed"});const r={isLocalMessage:!1,messageId:s},a=(0,m.Tc)(n,r);try{e([{operation:{replace:{messageLink:r}},reportParams:{scene:"resend"}}]),o.successIfIdle(3e3)}catch(l){o.error({reason:"send message happen error, retry failed",error:l,meta:{content_type:null==a?void 0:a.content_type,is_local_message:null==r?void 0:r.isLocalMessage}})}};var L=n(40967),B=n(90321);const D=e=>(0,i.ozw)((t=>{if((0,B.A)(t.messageMap,e)){const n=t.messageMap[e];return!!(0,L.A)(n).every((e=>(0,i.RRO)(e)))}return!0}),o.x),O=e=>{var t;const[n,o]=(0,h.useState)(null===(t=i.ozw.persist)||void 0===t?void 0:t.hasHydrated);return(0,h.useEffect)((()=>{const t=i.ozw.persist.onHydrate((()=>o(!1))),n=i.ozw.persist.onFinishHydration((()=>{o(!0),null==e||e()}));return o(i.ozw.persist.hasHydrated()),i.ozw.persist.hasHydrated()&&(null==e||e()),()=>{t(),n()}}),[]),n},F=()=>i.ozw.persist.hasHydrated()?Promise.resolve():new Promise((e=>{i.ozw.persist.onFinishHydration((()=>{e()}))}));var U=n(30875);const H=(e=i.ozw.getState())=>{var t;return null===(t=e.userInfo)||void 0===t?void 0:t.secUserId},z=()=>(0,i.ozw)(H),q=()=>(0,i.ozw)((e=>{var t;return null===(t=e.userInfo)||void 0===t?void 0:t.userNickName})),V=()=>(0,i.ozw)((e=>e.userOgfQuota),o.x),$=()=>(0,i.ozw)((e=>e.userOgf),o.x)},17003:(e,t,n)=>{n.d(t,{Aj:()=>o.A,BF:()=>a.BF,EM:()=>s.EM,Ej:()=>i.Ej,I6:()=>r.I,ZH:()=>i.ZH,c5:()=>i.c5,hT:()=>i.hT,k:()=>i.k,pl:()=>l.p,u1:()=>s.u1});var i=n(1456),o=n(35119),s=n(68503),r=n(19867),a=n(51239),l=n(45576)},46346:(e,t,n)=>{n.d(t,{YJ:()=>d,Zw:()=>h,bR:()=>o,mf:()=>u,qQ:()=>l,qo:()=>a,tP:()=>r,vW:()=>c});var i=n(94268);const o=(e,t)=>{const n=e.messageLinkMap[t]?s(e,t,e.messageLinkMap[t]):void 0;return{lastAvailableMessage:n?r(e,t,n):void 0,lastAvailableMessageLink:n}},s=(e,t,n)=>{for(let o=n.length-1;o>=0;o--){const s=n[o],a=n[o-1],l=r(e,t,s),c=r(e,t,a);if((0,i.i8)(l)&&(0,i.i8)(c))return(0,i.hd)(l)?a:s;if((0,i.$4)(l))return s}},r=(e,t,n)=>(0,i.A4)((0,i.tv)(e,t))(n),a=(e,t)=>{const{message:n}=l(e,t,e.messageLinkMap[t],(({messageLink:e})=>e.isLocalMessage&&!!e.messageId));return n&&(0,i.xX)(n)?n:void 0},l=(e,t,n,o)=>{const s=(0,i.A4)((0,i.tv)(e,t)),r=(0,i.WZ)(n||[],(e=>o({messageLink:e,getMessage:()=>s(e)})));return{messageLink:r,message:r?s(r):void 0}},c=(e,{conversationId:t,replyId:n})=>{const o=(0,i.ci)({messageLinks:e.messageLinkMap[t],replyId:n,getMessage:(0,i.A4)((0,i.tv)(e,t))});return o?r(e,t,o):void 0},d=(e,t,n)=>{var i;return(null===(i=e.localMessageMap[t])||void 0===i?void 0:i[n])||{}},u=(e,t)=>e.preprocessTaskMap[t].key,h=(e,t,n)=>{const i=e.messageMap[t],o=i[n];if(!o)return[];const s=!o.reply_id||"0"===o.reply_id?n:o.reply_id,r=i[null!=s?s:""],a=Object.keys(i).filter((e=>{var t;return(null===(t=i[e])||void 0===t?void 0:t.reply_id)===s})).map((e=>Number(i[e].index)));return[...r?[Number(r.index)]:[],...a]}},56570:(e,t,n)=>{n.d(t,{k:()=>f});var i=n(62693),o=n(21511),s=n(76779),r=n(16350),a=n(45498),l=n(81435),c=n(20592),d=n(46219),u=n(37357),h=n(46346),m=n(82205),p=n(34870),g=n(64873);const v=[l.cM.Text,l.cM.Music,l.cM.Video,l.cM.Image,l.cM.File,l.cM.PluginSearchResult,l.cM.Composite,l.cM.Nested,l.cM.CopilotCard,l.cM.LyricsToSongMusic,l.cM.LyricsToSongLyric,l.cM.Outline],f=(0,a.vt)()((0,p.eh)(((e,t)=>({scene:void 0,isSelectMode:!1,messageIndexList:[],contentTypeWhiteList:v,preShareId:"",preMessageIndexList:[],preShareType:c.I9.All,shareType:c.I9.All,extraInfo:{},setContentTypeWhiteList:(t=v)=>{e({contentTypeWhiteList:t})},enterSelectMode:({scene:n,extraInfo:i={},data:o})=>{var s,r,a,l,d,u,h;const{isSelectMode:m,scene:p}=t();m&&n===p||e({extraInfo:i,scene:n,isSelectMode:!0,preShareId:null!==(s=null==o||null===(r=o.share_info)||void 0===r?void 0:r.share_id)&&void 0!==s?s:"",preMessageIndexList:2===(null==o||null===(a=o.share_info)||void 0===a?void 0:a.share_status)&&null!==(l=null==o||null===(d=o.share_info)||void 0===d?void 0:d.message_index_list)&&void 0!==l?l:[],preShareType:(null==o||null===(u=o.share_info)||void 0===u?void 0:u.share_type)||c.I9.All,shareType:(null==o||null===(h=o.share_info)||void 0===h?void 0:h.share_type)||c.I9.All})},exitSelectMode:()=>{t().isSelectMode&&e({scene:void 0,isSelectMode:!1,messageIndexList:[],preShareId:"",preMessageIndexList:[],extraInfo:{}})},toggleMessage:({conversationId:n,messageIndex:i,state:s})=>{var a;const{messageIndexList:l,getIsCheckboxDisabled:c,_findMessageByIndex:u}=t(),m=l.includes(i),p=u({conversationId:n,state:s,messageIndex:i}),g=(0,h.Zw)(s,n,null!==(a=null==p?void 0:p.message_id)&&void 0!==a?a:""),[v,...f]=g;if(m)return!(i===v)&&f.filter((e=>l.includes(e))).length>1?void e({messageIndexList:(0,r.A)(l,i)}):void e({messageIndexList:(0,r.A)(l,...g)});if(c({conversationId:n,messageIndex:i,state:s}))return;const _=g.filter((e=>!c({conversationId:n,messageIndex:e,state:s})));l.length+_.length>d.fV?e({messageIndexList:[...l,i].sort(((e,t)=>e-t))}):e({messageIndexList:(0,o.A)([...l,..._]).sort(((e,t)=>e-t))})},selectAll:n=>{const{_getSelectAllIndexList:i}=t();e({messageIndexList:i(n)})},deselectAll:()=>{e({messageIndexList:[]})},_findMessageByIndex:({conversationId:e,state:t,messageIndex:n})=>{var i,o;const s=t.messageMap[e],r=t.messageLinkMap[e];if(!s||!r)return;const a=Number(null===(i=s[null===(o=r[0])||void 0===o?void 0:o.messageId])||void 0===i?void 0:i.index),l=r[n-a];if(l){const i=(0,m.Tc)(e,l,t);if((null==i?void 0:i.index)===n)return i}const c=Object.keys(s).find((e=>{var t;return Number(null===(t=s[e])||void 0===t?void 0:t.index)===n}));return c?s[c]:void 0},_getSelectAllIndexList:({conversationId:e,state:n,lastMessageIndex:o})=>{var r,a,l,c;const{getIsCheckboxDisabled:d}=t(),u=n.messageMap[e],h=n.messageLinkMap[e];if(!u||!h)return[];const m=Number(null===(r=u[null===(a=h[0])||void 0===a?void 0:a.messageId])||void 0===r?void 0:r.index),p=Number(null===(l=u[null===(c=h[h.length-1])||void 0===c?void 0:c.messageId])||void 0===l?void 0:l.index);return(0,s.A)(1,o+1).filter((t=>!(0,i.A)(t,m,p+1)||!d({conversationId:e,messageIndex:t,state:n})))},getIsSelectAllChecked:e=>{const{messageIndexList:n,_getSelectAllIndexList:i}=t(),o=i(e);return n.length>0&&n.length>=o.length},getIsCheckboxDisabled:({conversationId:e,state:n,messageIndex:i})=>{const{messageIndexList:o,_findMessageByIndex:s,_isMessageDisableSelect:r,contentTypeWhiteList:a}=t();if(o.includes(i))return!1;const l=s({state:n,messageIndex:i,conversationId:e}),c=r(l);var d;c&&u.v.persist.info({eventName:"thread_share_checkbox_disabled",meta:{messageIndex:null==l?void 0:l.index,messageId:null==l?void 0:l.message_id,messageStatus:null==l?void 0:l.status,messageContentType:null==l?void 0:l.content_type,contentTypeWhiteList:a,isOnboarding:null==l||null===(d=l.ext)||void 0===d?void 0:d.onboarding,listLength:o.length}});return c},_isMessageDisableSelect:e=>{var n;const{messageIndexList:i,contentTypeWhiteList:o}=t();return!e||(!!(0,g.Tq)(e)||(e.status===l.q7.InVisible||("1"===(null===(n=e.ext)||void 0===n?void 0:n.onboarding)||(i.length>=d.fV||(!e.content_type||!o.includes(e.content_type))))))},updateMessageIndexList:n=>{const{messageIndexList:i,_isMessageDisableSelect:o}=t(),s=[];for(const e of Object.values(n)){-1!==i.indexOf(Number(e.index))&&o(e)&&s.push(Number(e.index))}const r=i.filter((e=>!s.includes(e)));e({messageIndexList:r})},setShareType:t=>{e({shareType:t})}}))))},74125:(e,t,n)=>{n.d(t,{ke:()=>i});n(51239);var i={Share:"Share",Collection:"Collection"}},98673:(e,t,n)=>{n.d(t,{A4:()=>d,AC:()=>v,Kj:()=>l,Ww:()=>g,i0:()=>p,kI:()=>m,rJ:()=>h,tv:()=>c,uT:()=>a,um:()=>u});var i=n(28159),o=n(81435),s=n(64873),r=(n(51239),n(10129));const a=({messageLinks:e,getMessage:t,range:n})=>{var i;const o=Number(null===(i=t(e[0]))||void 0===i?void 0:i.index)||0;return{hasMore:o>n.start,lastCursor:o,loading:!1}},l=({messageLinks:e,getMessage:t,size:n})=>{if(Array.isArray(e)&&e.length>0){var i;const o=Number(null===(i=t(e[0]))||void 0===i?void 0:i.index)||0,s=e.length>=n;return{hasMore:o>1&&s,lastCursor:o,loading:!1}}return{hasMore:!1,lastCursor:0,loading:!1}},c=(e,t)=>({messageMap:e.messageMap[t],localMessageMap:e.localMessageMap[t],messageLinks:e.messageLinkMap[t],messageListStatus:e.messageListStatusMap[t]}),d=e=>t=>{var n,i;if(!t)return;const{isLocalMessage:o,messageId:s}=t;return o?null===(n=e.localMessageMap)||void 0===n?void 0:n[s]:null===(i=e.messageMap)||void 0===i?void 0:i[s]},u=e=>`replyTo${e}`,h=e=>e?(0,s.Ji)(e)?"pic":(0,s.ze)(e)?"video":(0,s.dz)(e)?"music":(0,s.ml)(e)?"file":(0,s._n)(e)?"search_card":(0,s.TQ)(e)?"lyrics_to_song_lyric":(0,s.lT)(e)||(0,s.A9)(e)?"lyrics_to_song_music":"text":"text",m=e=>{if(e&&(0,s.pu)(e)){const{text:t}=e.content_obj||{};return(0,i.A)(t)?t.length:0}return 0},p=e=>{if(e&&(0,s.pu)(e)){const{text:t}=e.content_obj||{};return(0,i.A)(t)&&t.includes("coco://sendMessage")?1:0}return 0};function g(e){const{Xt:t}=o;return e.next_connection_type===t.WebSocket?r.aU.Socket:e.next_connection_type===t.HttpChunk?r.aU.HttpChunk:null===(n=e.local_info)||void 0===n?void 0:n.from;var n}function v(e){var t,n,i,o,s,r,a;return{conversation_id:e.conversation_id,message_id:e.message_id,from:null===(t=e.local_info)||void 0===t?void 0:t.from,local_message_id:null==e?void 0:e.local_message_id,is_regenerate:"local"in e&&(null==e||null===(n=e.local)||void 0===n?void 0:n.isRegenerate),has_err:null===(i=e.error_details)||void 0===i?void 0:i.error_code,log_id:null===(o=e.local_info)||void 0===o?void 0:o.log_id,inner_log_id:null==e||null===(s=e.ext)||void 0===s?void 0:s.log_id,trace_id:null===(r=e.local_info)||void 0===r?void 0:r.trace_id,retried:null==e||null===(a=e.local_info)||void 0===a?void 0:a.retried,next_connection_type:null==e?void 0:e.next_connection_type}}},32618:(e,t,n)=>{n.d(t,{D6:()=>l,P5:()=>a,YF:()=>c,nD:()=>d,oM:()=>r});var i=n(28159),o=n(2633),s=n(64873);const r=e=>{var t,n;if(e&&((0,s.pu)(e)||(0,s.UQ)(e))&&(0,i.A)(null==e||null===(t=e.content_obj)||void 0===t?void 0:t.text))return null==e||null===(n=e.content_obj)||void 0===n?void 0:n.text},a=(e,t,n)=>{if(!e)return;const a=r(e);return(0,i.A)(a)?a:(0,s.HN)(e)||(0,s.Ji)(e)?void 0:t?(0,o.A)(null==e?void 0:e.content_obj)?`${n} message.content\uff1a${null==e?void 0:e.content}`:`${n} message.content\uff1a\n\n\`\`\`json\n${JSON.stringify(null==e?void 0:e.content_obj,void 0,2)}\n\`\`\`\n\n`:n},l=e=>{const t=null==e?void 0:e.match(/\[(\S*?)\](?=\(coco:\/\/sendMessage)/g);return null!=t&&t.length?t.map((e=>e.split(/[\[\]]/).join(""))):[]},c=e=>{var t;return(0,s.TQ)(e)&&(null==e||null===(t=e.content_obj)||void 0===t?void 0:t.text)||""},d=e=>(0,s.rI)(e)?"simple_search":(0,s.C9)(e)?"deep_search":(0,s.XV)(e)?"complex_search":"ai_search"},94363:(e,t,n)=>{n.d(t,{z:()=>o});var i=n(14065);n(27527),n(82854),n(37357);function o(){return s.apply(this,arguments)}function s(){return(s=(0,i.A)((function*(){}))).apply(this,arguments)}},51067:(e,t,n)=>{n.d(t,{P:()=>o});var i=n(170);const o=[i.nc,i.VX,i.P9]},59076:(e,t,n)=>{n.d(t,{rd:()=>r,w8:()=>a});var i=n(10633),o=n(8607);class s{constructor(e){(0,i.A)(this,"ctx",void 0),(0,i.A)(this,"_chatProtocolPluginEntries",void 0),(0,i.A)(this,"_chatProtocolPluginInstances",{});const{plugins:t=[]}=e;this._chatProtocolPluginEntries=t}getChatProtocolPlugin(e){var t;const n=null===(t=this._chatProtocolPluginEntries)||void 0===t?void 0:t.filter((t=>t.matchContentType(e)));if(null==n||!n.length)return;return n.map((e=>(this._chatProtocolPluginInstances[e.pluginId]||(this._chatProtocolPluginInstances[e.pluginId]=new e.Plugin),this._chatProtocolPluginInstances[e.pluginId])))}}const r=(0,o.p)(),a=e=>(r.service||(r.service=new s(e)),r.service)},964:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var i=n(14065),o=n(44557),s=n(10633),r=n(17837),a=n(5394),l=n(5947),c=n(59181),d=n(58871),u=n(68560),h=n(32512);const m=class{constructor(e){var t=this;if((0,s.A)(this,"config",void 0),(0,s.A)(this,"recorderInstance",null),(0,s.A)(this,"wsProxy",void 0),(0,s.A)(this,"wsInstance",null),(0,s.A)(this,"isAsrRecordingOrLoading",(e=>e===r.rE.RECORDING||e===r.rE.PAUSED||e===r.rE.LOADING)),(0,s.A)(this,"initWsService",(()=>{this.wsInstance=new h.A({wsConfig:(0,o.A)((0,o.A)({},this.config.wsConfig),{},{onWsConnectError:()=>{var e,t;null===(e=this.config.wsConfig)||void 0===e||null===(t=e.onWsConnectError)||void 0===t||t.call(e),this.stopAsrSession()},onWsConnectClose:()=>{var e,t;null===(e=this.config.wsConfig)||void 0===e||null===(t=e.onWsConnectClose)||void 0===t||t.call(e),this.stopAsrSession()}}),wsProxy:this.wsProxy})})),(0,s.A)(this,"startAsr",(0,i.A)((function*(){if(!t.isAsrRecordingOrLoading(u.A.getCurrentAsrStatus())){u.A.setAsrStatus(r.rE.LOADING);try{const e=yield navigator.mediaDevices.getUserMedia({audio:!0});t.initWsService();const n=new AudioContext({sampleRate:16e3});t.recorderInstance=yield t.createRecorderInstance(n,e),t.recorderInstance.startRecording()}catch(i){var e,n;null===(e=t.config)||void 0===e||null===(n=e.onPermissionDenied)||void 0===n||n.call(e),t.stopAsrSession()}}}))),(0,s.A)(this,"stopAsr",(()=>{this.stopAsrSession()})),(0,s.A)(this,"getAsrMessageSubscription",(()=>u.A.getAsrResultObservable())),(0,s.A)(this,"getAsrStatusSubscription",(()=>u.A.getAsrStatusObservable())),(0,s.A)(this,"getAudioVolumeSubscription",(()=>u.A.getVolumeObservable())),(0,s.A)(this,"stopAsrSession",(()=>{var e,t;u.A.setAsrStatus(r.rE.DESTROYED),null===(e=this.recorderInstance)||void 0===e||e.stopRecorder(),this.recorderInstance=null,null===(t=this.wsInstance)||void 0===t||t.stopWsConnection(),this.wsInstance=null})),(0,s.A)(this,"destroyAsr",(()=>{this.stopAsrSession(),u.A.destroy(!1)})),(0,s.A)(this,"enterMuteMode",(()=>{var e;null===(e=this.recorderInstance)||void 0===e||e.enterMuteMode()})),(0,s.A)(this,"exitMuteMode",(()=>{var e;null===(e=this.recorderInstance)||void 0===e||e.exitMuteMode()})),this.config=e,this.recorderInstance=null,e.wsProxy)this.wsProxy=e.wsProxy;else{const t=new c.k({commonParams:e.wsConfig.commonParams});this.wsProxy=t}}createRecorderInstance(e,t){var n=this;return(0,i.A)((function*(){if(n.config.audioWorklet&&(yield(0,a.eu)()))return new l.A({audioCtx:e,stream:t,wsInstance:n.wsInstance});{const i=e.createMediaStreamSource(t);return new d.A({source:i,audioCtx:e,stream:t,wsInstance:n.wsInstance})}}))()}}},38080:(e,t,n)=>{n.d(t,{GV:()=>d,WF:()=>l,_i:()=>c,fG:()=>r,sW:()=>a});var i=n(44557),o=n(14065),s=n(64462);const r=function(){var e=(0,o.A)((function*(e,t){let n=null;try{const o='@font-face { font-family: Inter, -apple-system, "system-ui", "Segoe UI", "SF Pro SC", "SF Pro Display", "SF Pro Icons", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif; src: url(""); unicode-range: U+0; }';n=yield(0,s.mo)(e,(0,i.A)({fontEmbedCSS:o},t))}catch(o){}return n}));return function(t,n){return e.apply(this,arguments)}}(),a=function(){var e=(0,o.A)((function*(e){const t=yield r(e);return!!t&&(yield l(t))}));return function(t){return e.apply(this,arguments)}}(),l=e=>new Promise((t=>{e.toBlob((function(e){if(!e)return void t(!1);const n=new ClipboardItem({"image/png":e});navigator.clipboard.write([n]).then((()=>t(!0))).catch((()=>t(!1)))}),"image/png")})),c=function(){var e=(0,o.A)((function*(e,t){const n=yield r(e);if(!n)return"";const i=n.toDataURL("image/png");i&&d(i,t)}));return function(t,n){return e.apply(this,arguments)}}(),d=(e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,n.click()}},41349:(e,t,n)=>{n.d(t,{EL:()=>l,GI:()=>u,Pg:()=>a,e8:()=>c,fG:()=>d,kE:()=>s,zS:()=>r});var i=n(13322),o=n(4044);const s=e=>e.type===i.b.Select,r=e=>e.type===i.b.Text,a=e=>e.type===i.b.Placeholder,l=e=>e.map(((t,n)=>{if((0,o.vq)(t)){if((0,o.je)(t)){const{children:o}=t;return l(o).concat(n===e.length-1?[]:[{type:i.b.Text,text:"\n"}])}if((0,o.KI)(t)){const{children:e,placeholder:n,key:s,clickable:r}=t;return{type:i.b.Placeholder,placeholder:n,text:(0,o.Ae)(e),key:s,clickable:r}}if((0,o.q6)(t)){const{value:e,options:n,title:o,key:s}=t;return{type:i.b.Select,title:o,key:s,optionList:n,value:e}}}const{text:s}=t;return{type:i.b.Text,text:s}})).flat(),c=e=>{if(!e.length)return[{type:"paragraph",children:[{text:""}]}];const t=[{type:"paragraph",children:[]}];for(const n of e)if(n.type===i.b.Text&&"\n"===n.text)t.push({type:"paragraph",children:[]});else if(a(n)){const{text:e,placeholder:i,key:o,clickable:s}=n;t[t.length-1].children.push({type:"labeled_input",children:[{text:e}],placeholder:i,key:o,clickable:s})}else if(s(n)){const{optionList:e,value:i,title:o,key:s}=n;t[t.length-1].children.push({type:"labeled_select",title:o,key:s,options:e,value:i,children:[{text:""}]})}else if(r(n)){const{text:e}=n;t[t.length-1].children.push({text:e})}return t},d=(e,t={})=>{const{stringifyItem:n}=t;return e.map((e=>{return a(e)?e.text||e.placeholder:s(e)?null!==(t=null==n?void 0:n(e))&&void 0!==t?t:e.value:r(e)?e.text:void 0;var t})).join("")},u=e=>0===d(e.data).length},39415:(e,t,n)=>{n.d(t,{F_:()=>h,Fr:()=>r,M:()=>f,Mx:()=>u,Ny:()=>a,UP:()=>p,Z5:()=>_,gm:()=>m,jc:()=>d,nr:()=>g,ps:()=>x,w_:()=>v});var i=n(7685),o=n.n(i);let s;const r=()=>o().getParser(navigator.userAgent).getPlatformType(!0).includes("mobile"),a=()=>(void 0===s&&(s=r()),s);let l;let c;const d=()=>{if(void 0===c){const{userAgent:e}=navigator,t=/iPad/.test(e),n=e.includes("Macintosh")&&"ontouchstart"in document.documentElement;c=t||n}return c},u=()=>a()||(()=>{if("undefined"==typeof document)return!1;if(void 0===l){const{userAgent:e}=navigator,t=/iPad|iPhone|iPod/.test(e),n=e.includes("Macintosh")&&"ontouchstart"in document.documentElement;l=t||n}return l})(),h=()=>"function"==typeof window.webkitConvertPointFromNodeToPage,m=()=>navigator.userAgent.toLowerCase().includes("firefox"),p=()=>/edge?\//.test(navigator.userAgent.toLowerCase()),g=()=>navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome"),v=()=>h()&&!u();const f="undefined"!=typeof window,_=()=>{if("undefined"==typeof navigator)return;const e=navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)/);if(null===e||5!==e.length)return;const[,t,n,i,o]=e.map((e=>parseInt(e,10)));return{major:t,minor:n,build:i,patch:o}},x=()=>{if("undefined"!=typeof window){const{userAgent:e}=navigator;return/Samantha/.test(e)}return!1}},39779:(e,t,n)=>{n.d(t,{AY:()=>s,OM:()=>i,ax:()=>o});n(80160);function i(){return/youtube/.test(location.hostname)?!!location.pathname.startsWith("/watch"):!!/bilibili/.test(location.hostname)&&!!location.pathname.startsWith("/video/")}function o(){return!!/bilibili/.test(location.hostname)&&location.pathname.startsWith("/festival/")}const s=(e,t={})=>{try{var n;const i=new URL(e);return(!t.allowedProtocols||t.allowedProtocols.includes(i.protocol))&&(!t.allowedExtensions||t.allowedExtensions.map((e=>e.toLowerCase())).includes(null!==(n=i.pathname.split(".").pop())&&void 0!==n?n:""))&&(!t.allowedHosts||t.allowedHosts.includes(i.host))}catch(i){return!1}}},85379:(e,t,n)=>{n.d(t,{A:()=>i});const i={"cici-ext-container":"cici-ext-container-ZsL3N4",ciciExtContainer:"cici-ext-container-ZsL3N4","inactivelink-hover-animation":"inactivelink-hover-animation-uqtsZZ",inactivelinkHoverAnimation:"inactivelink-hover-animation-uqtsZZ","notactivelink-hover-animation":"notactivelink-hover-animation-qIF7Pk",notactivelinkHoverAnimation:"notactivelink-hover-animation-qIF7Pk","light-click-animation":"light-click-animation-aP0sBM",lightClickAnimation:"light-click-animation-aP0sBM","click-animation":"click-animation-m_aVOk",clickAnimation:"click-animation-m_aVOk","semi-animation-rotate":"semi-animation-rotate-guIq9p",semiAnimationRotate:"semi-animation-rotate-guIq9p","inactive-btn-hover-animation":"inactive-btn-hover-animation-p55iH4",inactiveBtnHoverAnimation:"inactive-btn-hover-animation-p55iH4","cici-ext-always-dark":"cici-ext-always-dark-cZEcux",ciciExtAlwaysDark:"cici-ext-always-dark-cZEcux","cici-ext-always-light":"cici-ext-always-light-asgCmn",ciciExtAlwaysLight:"cici-ext-always-light-asgCmn",ellipsis:"ellipsis-crsBmL",wrapper:"wrapper-hUZARQ",translateServicePopover:"translateServicePopover-hsdsA4",translatePanel:"translatePanel-zEvg3V",options:"options-Sqt4ba",translatePanelTitle:"translatePanelTitle-aF2p_o",translatePanelText:"translatePanelText-tZn2Vm","translate-panel-checkbox":"translate-panel-checkbox-zBRKCS",translatePanelCheckbox:"translate-panel-checkbox-zBRKCS",translatePanelSelectTitle:"translatePanelSelectTitle-PuACPl",translatePanelSelectList:"translatePanelSelectList-CM7MDK",translatePanelSelectItem:"translatePanelSelectItem-Hjf6Y1",nameWrapper:"nameWrapper-Ie1kv0",locName:"locName-jenbnm",active:"active-yOqMUg",name:"name-b4vXqU",checkbox:"checkbox-yjLP5c",selectedHoverTranslateSetting:"selectedHoverTranslateSetting-VF9aq0","language-notice-wrapper":"language-notice-wrapper-jvVOm3",languageNoticeWrapper:"language-notice-wrapper-jvVOm3","placement-left":"placement-left-rpzGBS",placementLeft:"placement-left-rpzGBS","language-notice":"language-notice-mWw7Vf",languageNotice:"language-notice-mWw7Vf",icon:"icon-C9iS8d",content:"content-TpyY49","activelink-hover-animation":"activelink-hover-animation-pD7DOP",activelinkHoverAnimation:"activelink-hover-animation-pD7DOP"}}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=i,s.amdO={},e=[],s.O=(t,n,i,o)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,i,o]=e[d],a=!0,l=0;l<n.length;l++)(!1&o||r>=o)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,i,o]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,i){if(1&i&&(e=this(e)),8&i)return e;if("object"==typeof e&&e){if(4&i&&e.__esModule)return e;if(16&i&&"function"==typeof e.then)return e}var o=Object.create(null);s.r(o);var r={};t=t||[null,n({}),n([]),n(n)];for(var a=2&i&&e;"object"==typeof a&&!~t.indexOf(a);a=n(a))Object.getOwnPropertyNames(a).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,s.d(o,r),o},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={854:0,896:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var i,o,[r,a,l]=n,c=0;if(r.some((t=>0!==e[t]))){for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(l)var d=l(s)}for(t&&t(n);c<r.length;c++)o=r[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},n=self.webpackChunkflow_web_extension=self.webpackChunkflow_web_extension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),s.O(void 0,[126,627,419,279,441,736,773,866,609],(()=>s(37894)));var r=s.O(void 0,[126,627,419,279,441,736,773,866,609],(()=>s(87702)));r=s.O(r);